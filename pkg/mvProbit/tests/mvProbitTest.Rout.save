
R version 2.13.2 (2011-09-30)
Copyright (C) 2011 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: i686-pc-linux-gnu (32-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library( "mvProbit" )
Loading required package: mvtnorm
Loading required package: maxLik
Loading required package: miscTools
Loading required package: abind
> 
> ## generate a simulated data set
> set.seed( 123 )
> # number of observations
> nObs <- 10
> 
> # generate explanatory variables
> xMat <- cbind( 
+    const = rep( 1, nObs ),
+    x1 = as.numeric( rnorm( nObs ) > 0 ),
+    x2 = as.numeric( rnorm( nObs ) > 0 ),
+    x3 = rnorm( nObs ),
+    x4 = rnorm( nObs ) )
> 
> # model coefficients
> beta <- cbind( c(  0.8,  1.2, -1.0,  1.4, -0.8 ),
+                c( -0.6,  1.0,  0.6, -1.2, -1.6 ),
+                c(  0.5, -0.6, -0.7,  1.1,  1.2 ) )
> 
> # covariance matrix of error terms
> sigma <- miscTools::symMatrix( c( 1, 0.2, 0.4, 1, -0.1, 1 ) )
> 
> # all parameters in a vector
> allCoef <- c( c( beta ), sigma[ lower.tri( sigma ) ] )
> 
> # generate dependent variables
> yMatLin <- xMat %*% beta 
> yMat <- ( yMatLin + rmvnorm( nObs, sigma = sigma ) ) > 0
> colnames( yMat ) <- paste( "y", 1:3, sep = "" )
> # (yMatLin > 0 )== yMat
> 
> # unconditional expectations of dependent variables
> yExp <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ) )
> print( yExp )
           V1         V2         V3
1  0.02086892 0.72542879 0.19411024
2  0.39392340 0.76842941 0.21363900
3  0.12455645 0.78785603 0.19642672
4  0.23485392 0.68069956 0.29183903
5  0.67999333 0.43467562 0.57861599
6  0.02791996 0.97271018 0.03370023
7  0.95816411 0.18630028 0.78414444
8  0.85639266 0.24667543 0.72388317
9  0.06073636 0.96822363 0.03444764
10 0.99787991 0.06734972 0.92257845
> yExpA <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ) )
> all.equal( yExp, yExpA )
[1] TRUE
> yExp2 <- pnorm( yMatLin )
> all.equal( yExp, as.data.frame( yExp2 ) )
[1] TRUE
> 
> 
> # conditional expectations of dependent variables
> # (assuming that all other dependent variables are one)
> yExpCond <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz() )
> print( yExpCond )
           V1         V2        V3
1  0.07187274 0.83441226 0.5236193
2  0.66023348 0.77856855 0.3142187
3  0.29709617 0.83846471 0.3994699
4  0.44823829 0.72724816 0.4608874
5  0.84677186 0.44247741 0.6176247
6  0.13901197 0.98492618 0.1616680
7  0.99080074 0.17880919 0.7487862
8  0.95048885 0.24377749 0.7104822
9  0.24434181 0.97834900 0.1330594
10 0.99980223 0.06515097 0.8917154
> yExpCondA <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz() )
> all.equal( yExpCond, yExpCondA )
[1] TRUE
> yExpCond2 <- matrix( NA, nrow = nObs, ncol = ncol( yMat ) )
> for( i in 1:nObs ) {
+    for( k in 1:ncol( yMat ) ) {
+       set.seed( 123 )
+       numerator <- pmvnorm( upper = yMatLin[ i, ], sigma = sigma )
+       set.seed( 123 )
+       denominator <- pmvnorm( upper = yMatLin[ i, -k ], sigma = sigma[ -k, -k ] )
+       yExpCond2[ i, k ] <- numerator / denominator
+    }
+ }
> all.equal( yExpCond, as.data.frame( yExpCond2 ) )
[1] TRUE
> # now with explicitly specifying the algorithm
> yExpCond3 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz )
> all.equal( yExpCond, yExpCond3 )
[1] TRUE
> identical( yExpCond, yExpCond3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm
> yExpCond4 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = Miwa )
> all.equal( yExpCond, yExpCond4 )
[1] "Component 1: Mean relative difference: 4.435478e-05"
[2] "Component 2: Mean relative difference: 0.0001002261"
[3] "Component 3: Mean relative difference: 5.938566e-05"
> # now with integrals obtained by the Miwa algorithm, less precise
> yExpCond5 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = Miwa( steps = 32 ) )
> all.equal( yExpCond4, yExpCond5 )
[1] "Component 1: Mean relative difference: 1.014946e-05"
[2] "Component 2: Mean relative difference: 1.070674e-05"
[3] "Component 3: Mean relative difference: 9.286508e-06"
> # now with integrals obtained by the TVPACK algorithm
> yExpCond6 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = TVPACK )
> all.equal( yExpCond, yExpCond6 )
[1] "Component 1: Mean relative difference: 4.435948e-05"
[2] "Component 2: Mean relative difference: 0.0001002157"
[3] "Component 3: Mean relative difference: 5.938604e-05"
> # now with integrals obtained by the TVPACK algorithm, less precise
> yExpCond7 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = TVPACK( abseps = 0.5 ) )
> all.equal( yExpCond6, yExpCond7 )
[1] "Component 1: Mean relative difference: 0.03017515"
[2] "Component 2: Mean relative difference: 0.04273065"
[3] "Component 3: Mean relative difference: 0.0424229" 
> # now with integrals obtained by the GHK algorithm
> yExpCond8 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE )
> all.equal( yExpCond, yExpCond8 )
[1] "Component 1: Mean relative difference: 0.002370084"
[2] "Component 2: Mean relative difference: 0.005788364"
[3] "Component 3: Mean relative difference: 0.005552991"
> # now with integrals obtained by the GHK algorithm, less precise
> yExpCond9 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    nGHK = 100 )
> all.equal( yExpCond8, yExpCond9 )
[1] "Component 1: Mean relative difference: 0.089207"  
[2] "Component 2: Mean relative difference: 0.05716181"
[3] "Component 3: Mean relative difference: 0.0646556" 
> 
> 
> # conditional expectations of dependent variables
> # (assuming that all other dependent variables are as observed)
> yExpCondObs <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE, algorithm = GenzBretz() )
> print( yExpCondObs )
           y1         y2         y3
1  0.01446330 0.73515489 0.17239140
2  0.36422466 0.74444655 0.11898201
3  0.10197280 0.78808436 0.15158540
4  0.19744044 0.81305670 0.46088740
5  0.46887344 0.54232735 0.70688505
6  0.02469662 0.97269183 0.02935400
7  0.97137607 0.17880919 0.80927845
8  0.88954588 0.24377749 0.78280394
9  0.05566761 0.96764681 0.02721613
10 0.99859830 0.06515097 0.92560102
> yExpCondObsA <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE, algorithm = GenzBretz() )
> all.equal( yExpCondObs, yExpCondObsA )
[1] TRUE
> yExpCondObs2 <- matrix( NA, nrow = nObs, ncol = ncol( yMat ) )
> for( i in 1:nObs ){
+    for( k in 1:ncol( yMat ) ) {
+       ySign <- 2 * yMat[ i, ] - 1
+       ySign[ k ] <- 1
+       yLinTmp <- yMatLin[ i, ] * ySign
+       sigmaTmp <- diag( ySign ) %*% sigma %*% diag( ySign )
+       set.seed( 123 )
+       numerator <- pmvnorm( upper = yLinTmp, sigma = sigmaTmp )
+       set.seed( 123 )
+       denominator <- pmvnorm( upper = yLinTmp[ -k ], sigma = sigmaTmp[ -k, -k ] )
+       yExpCondObs2[ i, k ] <- numerator / denominator
+    }
+ }
> all.equal( yExpCondObs, as.data.frame( yExpCondObs2 ) )
[1] "Names: 3 string mismatches"
> # now with explicitly specifying the algorithm
> yExpCondObs3 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = GenzBretz )
> all.equal( yExpCondObs, yExpCondObs3 )
[1] TRUE
> identical( yExpCondObs, yExpCondObs3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm
> yExpCondObs4 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = Miwa )
> all.equal( yExpCondObs, yExpCondObs4 )
[1] "Component 1: Mean relative difference: 9.258897e-05"
[2] "Component 2: Mean relative difference: 5.029085e-05"
[3] "Component 3: Mean relative difference: 0.0001009532"
> # now with integrals obtained by the Miwa algorithm, less precise
> yExpCondObs5 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = Miwa( steps = 32 ) )
> all.equal( yExpCondObs4, yExpCondObs5 )
[1] "Component 1: Mean relative difference: 4.471818e-06"
[2] "Component 2: Mean relative difference: 3.954285e-06"
[3] "Component 3: Mean relative difference: 4.758699e-06"
> # now with integrals obtained by the TVPACK algorithm
> yExpCondObs6 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = TVPACK )
> all.equal( yExpCondObs, yExpCondObs6 )
[1] "Component 1: Mean relative difference: 9.258463e-05"
[2] "Component 2: Mean relative difference: 5.028616e-05"
[3] "Component 3: Mean relative difference: 0.0001009503"
> # now with integrals obtained by the TVPACK algorithm, less precise
> yExpCondObs7 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = TVPACK( abseps = 0.5 ) )
> all.equal( yExpCondObs6, yExpCondObs7 )
[1] "Component 1: Mean relative difference: 0.05130138"
[2] "Component 2: Mean relative difference: 0.04744355"
[3] "Component 3: Mean relative difference: 0.02586555"
> # now with integrals obtained by the GHK algorithm
> yExpCondObs8 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE )
> all.equal( yExpCondObs, yExpCondObs8 )
[1] "Component 1: Mean relative difference: 0.002650961"
[2] "Component 2: Mean relative difference: 0.002438056"
[3] "Component 3: Mean relative difference: 0.00287644" 
> # now with integrals obtained by the GHK algorithm, less precise
> yExpCondObs9 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, nGHK = 100 )
> all.equal( yExpCondObs8, yExpCondObs9 )
[1] "Component 1: Mean relative difference: 0.01486969"
[2] "Component 2: Mean relative difference: 0.0173985" 
[3] "Component 3: Mean relative difference: 0.01629308"
> 
> 
> # unconditional expectations of dependent variables by simulation
> nSim <- 10000
> ySim <- array( NA, c( nObs, ncol( yMat ), nSim ) )
> for( s in 1:nSim ) {
+    ySim[ , , s ] <- ( yMatLin + rmvnorm( nObs, sigma = sigma ) ) > 0
+ }
> yExpSim <- matrix( NA, nrow = nObs, ncol = ncol( yMat ) )
> for( i in 1:nObs ) {
+    yExpSim[ i, ] <- rowSums( ySim[ i, , ] ) / nSim
+ }
> print( yExpSim )
        [,1]   [,2]   [,3]
 [1,] 0.0192 0.7292 0.1974
 [2,] 0.4004 0.7599 0.2151
 [3,] 0.1185 0.7867 0.1978
 [4,] 0.2374 0.6843 0.2992
 [5,] 0.6817 0.4368 0.5779
 [6,] 0.0275 0.9709 0.0356
 [7,] 0.9580 0.1843 0.7872
 [8,] 0.8551 0.2551 0.7156
 [9,] 0.0624 0.9697 0.0332
[10,] 0.9984 0.0636 0.9231
> print( yExpSim - as.matrix( yExp ) )
                 V1           V2            V3
 [1,] -0.0016689243  0.003771207  0.0032897559
 [2,]  0.0064765951 -0.008529406  0.0014610027
 [3,] -0.0060564475 -0.001156035  0.0013732843
 [4,]  0.0025460841  0.003600442  0.0073609724
 [5,]  0.0017066657  0.002124382 -0.0007159879
 [6,] -0.0004199629 -0.001810177  0.0018997717
 [7,] -0.0001641098 -0.002000281  0.0030555602
 [8,] -0.0012926616  0.008424570 -0.0082831712
 [9,]  0.0016636425  0.001476372 -0.0012476431
[10,]  0.0005200914 -0.003749723  0.0005215455
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -0.07304505  0.71128820  0.08262612 -1.11816720
> 
> # calculating log likelihood value(s)
> logLikVal <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = GenzBretz() )
> print( logLikVal )
 [1] -0.53540368 -0.94155840 -0.55161623 -2.32656485 -2.25902218 -0.08645378
 [7] -0.46570791 -0.70386950 -0.12392314 -0.14927833
> logLikValA <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = GenzBretz() )
> all.equal( logLikVal, logLikValA )
[1] TRUE
> # now with explicitly specifying the algorithm
> logLikVal3 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = GenzBretz )
> all.equal( logLikVal, logLikVal3 )
[1] TRUE
> identical( logLikVal, logLikVal3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm
> logLikVal4 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = Miwa )
> all.equal( logLikVal, logLikVal4 )
[1] "Mean relative difference: 8.840686e-05"
> # now with integrals obtained by the Miwa algorithm, less precise
> logLikVal5 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = Miwa( steps = 32 ) )
> all.equal( logLikVal4, logLikVal5 )
[1] "Mean relative difference: 4.53253e-06"
> # now with integrals obtained by the TVPACK algorithm
> logLikVal6 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = TVPACK )
> all.equal( logLikVal, logLikVal6 )
[1] "Mean relative difference: 8.840067e-05"
> # now with integrals obtained by the TVPACK algorithm, less precise
> logLikVal7 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = TVPACK( abseps = 0.5 ) )
> all.equal( logLikVal6, logLikVal7 )
[1] "Mean relative difference: 0.05527167"
> # now with integrals obtained by the GHK algorithm
> logLikVal8 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ) )
> all.equal( logLikVal, logLikVal8 )
[1] "Mean relative difference: 0.002220837"
> # now with integrals obtained by the GHK algorithm, less precise
> logLikVal9 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    nGHK = 100 )
> all.equal( logLikVal8, logLikVal9 )
[1] "Mean relative difference: 0.01480876"
> 
> # calculating log likelihood value(s) with one-sided gradients
> logLikValGrad1 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    oneSidedGrad = TRUE, algorithm = GenzBretz() )
> print( logLikValGrad1 )
 [1] -0.53540368 -0.94155840 -0.55161623 -2.32656485 -2.25902218 -0.08645378
 [7] -0.46570791 -0.70386950 -0.12392314 -0.14927833
attr(,"gradient")
             b_1_0       b_1_1       b_1_2        b_1_3        b_1_4
 [1,] -0.039483841  0.00000000 -0.03948384  0.042161781 -0.016838445
 [2,] -0.620181812  0.00000000 -0.62018181  0.135184078  0.182997967
 [3,] -0.208837065 -0.20883706 -0.20883706  0.214267758 -0.186935416
 [4,]  1.493926467  1.49392647  1.49392647 -1.088909899  1.311866859
 [5,]  0.917269941  0.91726994  0.00000000 -0.573329732  0.753611630
 [6,] -0.060924129 -0.06092413 -0.06092413  0.102760321 -0.041954808
 [7,]  0.071223816  0.07122382  0.07122382  0.059670391  0.039452129
 [8,]  0.224807263  0.00000000  0.00000000  0.034479391 -0.013918202
 [9,] -0.121700445  0.00000000 -0.12170044  0.138511771  0.037235792
[10,]  0.004787314  0.00000000  0.00000000  0.006002406 -0.001821434
            b_2_0      b_2_1       b_2_2       b_2_3       b_2_4       b_3_0
 [1,]  0.44704993  0.0000000  0.44704993 -0.47737052  0.19065080 -0.31393241
 [2,]  0.43840786  0.0000000  0.43840786 -0.09556192 -0.12936166 -0.24068300
 [3,]  0.37076298  0.3707630  0.37076298 -0.38040447  0.33187946 -0.28829263
 [4,]  0.33970605  0.3397061  0.33970605 -0.24760876  0.29830726 -0.79100711
 [5,] -0.88642408 -0.8864241  0.00000000  0.55404986 -0.72826926 -1.24501533
 [6,]  0.06467570  0.0646757  0.06467570 -0.10908807  0.04453829 -0.07038947
 [7,] -0.31973919 -0.3197392 -0.31973919 -0.26787335 -0.17710918  0.34377267
 [8,] -0.41846140  0.0000000  0.00000000 -0.06418073  0.02590766  0.39132057
 [9,]  0.07517436  0.0000000  0.07517436 -0.08555872 -0.02300055 -0.06658594
[10,] -0.13608740  0.0000000  0.00000000 -0.17062841  0.05177731  0.15270486
            b_3_1       b_3_2      b_3_3       b_3_4         R_1_2        R_1_3
 [1,]  0.00000000 -0.31393241 0.33522447 -0.13388094 -0.0089522200  0.031648334
 [2,]  0.00000000 -0.24068300 0.05246286  0.07101869 -0.2109161681  0.242606606
 [3,] -0.28829263 -0.28829263 0.29578952 -0.25805813 -0.0489604016  0.118484255
 [4,] -0.79100711 -0.79100711 0.57655815 -0.69460983  0.5931737070 -0.947273870
 [5,] -1.24501533  0.00000000 0.77818347 -1.02288104 -0.6958962371 -0.901556093
 [6,] -0.07038947 -0.07038947 0.11872545 -0.04847302 -0.0020805973  0.015112572
 [7,]  0.34377267  0.34377267 0.28800829  0.19042175 -0.0121688745  0.055215327
 [8,]  0.00000000  0.00000000 0.06001806 -0.02422733 -0.0620710172  0.159552938
 [9,]  0.00000000 -0.06658594 0.07578392  0.02037281 -0.0038911046  0.024566263
[10,]  0.00000000  0.00000000 0.19146363 -0.05809977 -0.0003026088  0.003157443
             R_2_3
 [1,] -0.161540001
 [2,] -0.132532626
 [3,] -0.129196504
 [4,] -0.319508443
 [5,]  1.016442887
 [6,] -0.006549753
 [7,] -0.129101410
 [8,] -0.192174063
 [9,] -0.007700663
[10,] -0.026654477
> logLikValGrad1A <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ),
+    oneSidedGrad = TRUE, algorithm = GenzBretz() )
> all.equal( logLikValGrad1, logLikValGrad1A )
[1] TRUE
> 
> # calculating log likelihood value(s) with two-sided gradients
> logLikValGrad <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    returnGrad = TRUE, algorithm = GenzBretz() )
> print( logLikValGrad )
 [1] -0.53540368 -0.94155840 -0.55161623 -2.32656485 -2.25902218 -0.08645378
 [7] -0.46570791 -0.70386950 -0.12392314 -0.14927833
attr(,"gradient")
             b_1_0       b_1_1       b_1_2        b_1_3        b_1_4
 [1,] -0.039483794  0.00000000 -0.03948379  0.042161732 -0.016838426
 [2,] -0.620181508  0.00000000 -0.62018151  0.135184011  0.182997877
 [3,] -0.208836904 -0.20883690 -0.20883690  0.214267592 -0.186935272
 [4,]  1.493926913  1.49392691  1.49392691 -1.088910224  1.311867250
 [5,]  0.917270326  0.91727033  0.00000000 -0.573329973  0.753611947
 [6,] -0.060924066 -0.06092407 -0.06092407  0.102760215 -0.041954764
 [7,]  0.071223890  0.07122389  0.07122389  0.059670452  0.039452170
 [8,]  0.224807433  0.00000000  0.00000000  0.034479417 -0.013918213
 [9,] -0.121700338  0.00000000 -0.12170034  0.138511650  0.037235760
[10,]  0.004787322  0.00000000  0.00000000  0.006002416 -0.001821437
            b_2_0       b_2_1       b_2_2       b_2_3       b_2_4       b_3_0
 [1,]  0.44705018  0.00000000  0.44705018 -0.47737078  0.19065091 -0.31393221
 [2,]  0.43840810  0.00000000  0.43840810 -0.09556197 -0.12936173 -0.24068282
 [3,]  0.37076320  0.37076320  0.37076320 -0.38040469  0.33187965 -0.28829243
 [4,]  0.33970627  0.33970627  0.33970627 -0.24760892  0.29830745 -0.79100675
 [5,] -0.88642374 -0.88642374  0.00000000  0.55404964 -0.72826897 -1.24501491
 [6,]  0.06467576  0.06467576  0.06467576 -0.10908818  0.04453833 -0.07038940
 [7,] -0.31973900 -0.31973900 -0.31973900 -0.26787319 -0.17710907  0.34377288
 [8,] -0.41846116  0.00000000  0.00000000 -0.06418069  0.02590765  0.39132081
 [9,]  0.07517443  0.00000000  0.07517443 -0.08555880 -0.02300057 -0.06658587
[10,] -0.13608729  0.00000000  0.00000000 -0.17062827  0.05177727  0.15270498
           b_3_1       b_3_2      b_3_3       b_3_4         R_1_2        R_1_3
 [1,]  0.0000000 -0.31393221 0.33522426 -0.13388086 -0.0089522338  0.031648323
 [2,]  0.0000000 -0.24068282 0.05246282  0.07101864 -0.2109161814  0.242606594
 [3,] -0.2882924 -0.28829243 0.29578932 -0.25805795 -0.0489604439  0.118484204
 [4,] -0.7910068 -0.79100675 0.57655789 -0.69460952  0.5931740810 -0.947273090
 [5,] -1.2450149  0.00000000 0.77818321 -1.02288070 -0.6958959089 -0.901555435
 [6,] -0.0703894 -0.07038940 0.11872533 -0.04847297 -0.0020805997  0.015112555
 [7,]  0.3437729  0.34377288 0.28800846  0.19042187 -0.0121688919  0.055215307
 [8,]  0.0000000  0.00000000 0.06001809 -0.02422734 -0.0620710620  0.159552892
 [9,]  0.0000000 -0.06658587 0.07578384  0.02037279 -0.0038911139  0.024566240
[10,]  0.0000000  0.00000000 0.19146378 -0.05809982 -0.0003026087  0.003157441
             R_2_3
 [1,] -0.161540032
 [2,] -0.132532661
 [3,] -0.129196543
 [4,] -0.319508409
 [5,]  1.016443490
 [6,] -0.006549763
 [7,] -0.129101448
 [8,] -0.192174094
 [9,] -0.007700674
[10,] -0.026654501
> # now manually
> llTmp <- function( coef ) {
+    betaTmp <- coef[ 1:15 ]
+    sigmaTmp <- diag( 3 )
+    sigmaTmp[ lower.tri( sigmaTmp ) ] <- coef[ -(1:15) ]
+    sigmaTmp[ upper.tri( sigmaTmp ) ] <- t( sigmaTmp )[ upper.tri( sigmaTmp ) ]
+    result <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+       coef = betaTmp, sigma = sigmaTmp, 
+       data = as.data.frame( cbind( xMat, yMat ) ), algorithm = GenzBretz() )
+    return( result )
+ }
> logLikValGrad2 <- numericGradient( llTmp, allCoef )
> print( logLikValGrad2 )
              [,1]        [,2]        [,3]         [,4]         [,5]
 [1,] -0.039483794  0.00000000 -0.03948379  0.042161731 -0.016838426
 [2,] -0.620181508  0.00000000 -0.62018151  0.135184012  0.182997877
 [3,] -0.208836904 -0.20883690 -0.20883690  0.214267592 -0.186935271
 [4,]  1.493926913  1.49392691  1.49392691 -1.088910224  1.311867250
 [5,]  0.917270326  0.91727033  0.00000000 -0.573329973  0.753611947
 [6,] -0.060924066 -0.06092407 -0.06092407  0.102760215 -0.041954764
 [7,]  0.071223890  0.07122389  0.07122389  0.059670453  0.039452170
 [8,]  0.224807433  0.00000000  0.00000000  0.034479417 -0.013918213
 [9,] -0.121700338  0.00000000 -0.12170034  0.138511650  0.037235760
[10,]  0.004787322  0.00000000  0.00000000  0.006002416 -0.001821437
             [,6]        [,7]        [,8]        [,9]       [,10]       [,11]
 [1,]  0.44705018  0.00000000  0.44705018 -0.47737078  0.19065091 -0.31393221
 [2,]  0.43840810  0.00000000  0.43840810 -0.09556197 -0.12936173 -0.24068282
 [3,]  0.37076320  0.37076320  0.37076320 -0.38040469  0.33187965 -0.28829243
 [4,]  0.33970627  0.33970627  0.33970627 -0.24760892  0.29830745 -0.79100675
 [5,] -0.88642374 -0.88642374  0.00000000  0.55404964 -0.72826897 -1.24501491
 [6,]  0.06467576  0.06467576  0.06467576 -0.10908818  0.04453834 -0.07038940
 [7,] -0.31973900 -0.31973900 -0.31973900 -0.26787319 -0.17710907  0.34377288
 [8,] -0.41846116  0.00000000  0.00000000 -0.06418069  0.02590765  0.39132081
 [9,]  0.07517443  0.00000000  0.07517443 -0.08555880 -0.02300057 -0.06658587
[10,] -0.13608729  0.00000000  0.00000000 -0.17062827  0.05177727  0.15270498
           [,12]       [,13]      [,14]       [,15]         [,16]        [,17]
 [1,]  0.0000000 -0.31393221 0.33522426 -0.13388086 -0.0089522338  0.031648323
 [2,]  0.0000000 -0.24068282 0.05246282  0.07101864 -0.2109161814  0.242606594
 [3,] -0.2882924 -0.28829243 0.29578932 -0.25805795 -0.0489604439  0.118484204
 [4,] -0.7910068 -0.79100675 0.57655789 -0.69460952  0.5931740810 -0.947273090
 [5,] -1.2450149  0.00000000 0.77818321 -1.02288070 -0.6958959089 -0.901555435
 [6,] -0.0703894 -0.07038940 0.11872533 -0.04847297 -0.0020805997  0.015112555
 [7,]  0.3437729  0.34377288 0.28800846  0.19042187 -0.0121688919  0.055215307
 [8,]  0.0000000  0.00000000 0.06001809 -0.02422734 -0.0620710620  0.159552892
 [9,]  0.0000000 -0.06658587 0.07578384  0.02037279 -0.0038911139  0.024566240
[10,]  0.0000000  0.00000000 0.19146378 -0.05809982 -0.0003026087  0.003157441
             [,18]
 [1,] -0.161540032
 [2,] -0.132532661
 [3,] -0.129196543
 [4,] -0.319508409
 [5,]  1.016443490
 [6,] -0.006549763
 [7,] -0.129101448
 [8,] -0.192174094
 [9,] -0.007700674
[10,] -0.026654501
> attr( logLikValGrad1, "gradient" ) / logLikValGrad2 - 1
              b_1_0         b_1_1         b_1_2         b_1_3         b_1_4
 [1,]  1.169727e-06           NaN  1.169727e-06  1.181532e-06  1.167503e-06
 [2,]  4.905034e-07           NaN  4.905034e-07  4.878083e-07  4.899239e-07
 [3,]  7.713836e-07  7.713836e-07  7.713836e-07  7.719682e-07  7.722624e-07
 [4,] -2.984521e-07 -2.984521e-07 -2.984521e-07 -2.982630e-07 -2.983360e-07
 [5,] -4.202354e-07 -4.202354e-07           NaN -4.203501e-07 -4.198882e-07
 [6,]  1.037576e-06  1.037576e-06  1.037576e-06  1.035756e-06  1.034561e-06
 [7,] -1.035809e-06 -1.035809e-06 -1.035809e-06 -1.040666e-06 -1.039924e-06
 [8,] -7.585615e-07           NaN           NaN -7.597718e-07 -7.471492e-07
 [9,]  8.733745e-07           NaN  8.733745e-07  8.730534e-07  8.689078e-07
[10,] -1.623363e-06           NaN           NaN -1.600836e-06 -1.740423e-06
              b_2_0         b_2_1         b_2_2         b_2_3         b_2_4
 [1,] -5.396519e-07           NaN -5.396519e-07 -5.394351e-07 -5.394276e-07
 [2,] -5.538351e-07           NaN -5.538351e-07 -5.522756e-07 -5.537955e-07
 [3,] -5.893031e-07 -5.893031e-07 -5.893031e-07 -5.888807e-07 -5.895688e-07
 [4,] -6.248770e-07 -6.248770e-07 -6.248770e-07 -6.254775e-07 -6.269256e-07
 [5,]  3.897700e-07  3.897700e-07           NaN  3.899053e-07  3.900746e-07
 [6,] -9.979873e-07 -9.979873e-07 -9.979873e-07 -9.989299e-07 -9.994048e-07
 [7,]  6.222324e-07  6.222324e-07  6.222324e-07  6.209271e-07  6.213553e-07
 [8,]  5.603366e-07           NaN           NaN  5.606959e-07  5.540384e-07
 [9,] -9.653143e-07           NaN -9.653143e-07 -9.645375e-07 -9.626632e-07
[10,]  8.286660e-07           NaN           NaN  8.285449e-07  8.251560e-07
              b_3_0         b_3_1         b_3_2         b_3_3         b_3_4
 [1,]  6.348028e-07           NaN  6.348028e-07  6.354245e-07  6.342468e-07
 [2,]  7.486583e-07           NaN  7.486583e-07  7.429443e-07  7.456520e-07
 [3,]  6.754708e-07  6.754708e-07  6.754708e-07  6.748861e-07  6.770351e-07
 [4,]  4.508225e-07  4.508225e-07  4.508225e-07  4.496625e-07  4.498411e-07
 [5,]  3.381458e-07  3.381458e-07           NaN  3.372164e-07  3.381200e-07
 [6,]  1.001559e-06  1.001559e-06  1.001559e-06  9.975476e-07  1.001632e-06
 [7,] -6.152245e-07 -6.152245e-07 -6.152245e-07 -6.154662e-07 -6.161925e-07
 [8,] -5.986317e-07           NaN           NaN -5.969109e-07 -6.023370e-07
 [9,]  1.026049e-06           NaN  1.026049e-06  1.025151e-06  1.029128e-06
[10,] -8.031951e-07           NaN           NaN -8.032986e-07 -8.019783e-07
              R_1_2        R_1_3         R_2_3
 [1,] -1.550204e-06 3.543080e-07 -1.876259e-07
 [2,] -6.316574e-08 4.713515e-08 -2.680633e-07
 [3,] -8.639525e-07 4.254080e-07 -2.990464e-07
 [4,] -6.303767e-07 8.236957e-07  1.056335e-07
 [5,]  4.715963e-07 7.295127e-07 -5.933169e-07
 [6,] -1.107235e-06 1.105627e-06 -1.567929e-06
 [7,] -1.432382e-06 3.538860e-07 -2.906671e-07
 [8,] -7.208188e-07 2.901627e-07 -1.606054e-07
 [9,] -2.389577e-06 9.292818e-07 -1.400272e-06
[10,]  3.668841e-07 6.856613e-07 -9.048976e-07
> range( attr( logLikValGrad1, "gradient" ) / logLikValGrad2 - 1, na.rm = TRUE )
[1] -2.389577e-06  1.181532e-06
> attr( logLikValGrad1, "gradient" ) - logLikValGrad2
              b_1_0         b_1_1         b_1_2         b_1_3         b_1_4
 [1,] -4.618528e-08  0.000000e+00 -4.618528e-08  4.981541e-08 -1.965892e-08
 [2,] -3.042011e-07  0.000000e+00 -3.042011e-07  6.594388e-08  8.965504e-08
 [3,] -1.610934e-07 -1.610934e-07 -1.610934e-07  1.654078e-07 -1.443631e-07
 [4,] -4.458656e-07 -4.458656e-07 -4.458656e-07  3.247817e-07 -3.913773e-07
 [5,] -3.854694e-07 -3.854694e-07  0.000000e+00  2.409993e-07 -3.164328e-07
 [6,] -6.321332e-08 -6.321332e-08 -6.321332e-08  1.064345e-07 -4.340476e-08
 [7,] -7.377432e-08 -7.377432e-08 -7.377432e-08 -6.209700e-08 -4.102726e-08
 [8,] -1.705303e-07  0.000000e+00  0.000000e+00 -2.619649e-08  1.039898e-08
 [9,] -1.062900e-07  0.000000e+00 -1.062900e-07  1.209281e-07  3.235444e-08
[10,] -7.771561e-09  0.000000e+00  0.000000e+00 -9.608886e-09  3.170071e-09
              b_2_0         b_2_1         b_2_2         b_2_3         b_2_4
 [1,] -2.412515e-07  0.000000e+00 -2.412515e-07  2.575105e-07 -1.028424e-07
 [2,] -2.428058e-07  0.000000e+00 -2.428058e-07  5.277654e-08  7.163994e-08
 [3,] -2.184919e-07 -2.184919e-07 -2.184919e-07  2.240130e-07 -1.956659e-07
 [4,] -2.122746e-07 -2.122746e-07 -2.122746e-07  1.548738e-07 -1.870166e-07
 [5,] -3.455014e-07 -3.455014e-07  0.000000e+00  2.160269e-07 -2.840792e-07
 [6,] -6.454559e-08 -6.454559e-08 -6.454559e-08  1.089714e-07 -4.451183e-08
 [7,] -1.989520e-07 -1.989520e-07 -1.989520e-07 -1.663297e-07 -1.100477e-07
 [8,] -2.344791e-07  0.000000e+00  0.000000e+00 -3.598585e-08  1.435383e-08
 [9,] -7.256695e-08  0.000000e+00 -7.256695e-08  8.252467e-08  2.214180e-08
[10,] -1.127709e-07  0.000000e+00  0.000000e+00 -1.413732e-07  4.272432e-08
              b_3_0         b_3_1         b_3_2         b_3_3         b_3_4
 [1,] -1.992850e-07  0.000000e+00 -1.992850e-07  2.130097e-07 -8.491351e-08
 [2,] -1.801892e-07  0.000000e+00 -1.801892e-07  3.897695e-08  5.295519e-08
 [3,] -1.947331e-07 -1.947331e-07 -1.947331e-07  1.996241e-07 -1.747143e-07
 [4,] -3.566036e-07 -3.566036e-07 -3.566036e-07  2.592565e-07 -3.124639e-07
 [5,] -4.209966e-07 -4.209966e-07  0.000000e+00  2.624161e-07 -3.458564e-07
 [6,] -7.049916e-08 -7.049916e-08 -7.049916e-08  1.184342e-07 -4.855208e-08
 [7,] -2.114975e-07 -2.114975e-07 -2.114975e-07 -1.772595e-07 -1.173365e-07
 [8,] -2.342571e-07  0.000000e+00  0.000000e+00 -3.582545e-08  1.459302e-08
 [9,] -6.832035e-08  0.000000e+00 -6.832035e-08  7.768985e-08  2.096622e-08
[10,] -1.226519e-07  0.000000e+00  0.000000e+00 -1.538026e-07  4.659479e-08
              R_1_2         R_1_3         R_2_3
 [1,]  1.387779e-08  1.121325e-08  3.030909e-08
 [2,]  1.332268e-08  1.143530e-08  3.552714e-08
 [3,]  4.229950e-08  5.040413e-08  3.863576e-08
 [4,] -3.739231e-07 -7.802647e-07 -3.375078e-08
 [5,] -3.281819e-07 -6.576961e-07 -6.030731e-07
 [6,]  2.303713e-09  1.670886e-08  1.026956e-08
 [7,]  1.743050e-08  1.953993e-08  3.752554e-08
 [8,]  4.474199e-08  4.629630e-08  3.086420e-08
 [9,]  9.298118e-09  2.282896e-08  1.078304e-08
[10,] -1.110223e-10  2.164935e-09  2.411960e-08
> range( attr( logLikValGrad1, "gradient" ) - logLikValGrad2 )
[1] -7.802647e-07  3.247817e-07
> attr( logLikValGrad1, "gradient" ) / logLikValGrad2 - 1
              b_1_0         b_1_1         b_1_2         b_1_3         b_1_4
 [1,]  1.169727e-06           NaN  1.169727e-06  1.181532e-06  1.167503e-06
 [2,]  4.905034e-07           NaN  4.905034e-07  4.878083e-07  4.899239e-07
 [3,]  7.713836e-07  7.713836e-07  7.713836e-07  7.719682e-07  7.722624e-07
 [4,] -2.984521e-07 -2.984521e-07 -2.984521e-07 -2.982630e-07 -2.983360e-07
 [5,] -4.202354e-07 -4.202354e-07           NaN -4.203501e-07 -4.198882e-07
 [6,]  1.037576e-06  1.037576e-06  1.037576e-06  1.035756e-06  1.034561e-06
 [7,] -1.035809e-06 -1.035809e-06 -1.035809e-06 -1.040666e-06 -1.039924e-06
 [8,] -7.585615e-07           NaN           NaN -7.597718e-07 -7.471492e-07
 [9,]  8.733745e-07           NaN  8.733745e-07  8.730534e-07  8.689078e-07
[10,] -1.623363e-06           NaN           NaN -1.600836e-06 -1.740423e-06
              b_2_0         b_2_1         b_2_2         b_2_3         b_2_4
 [1,] -5.396519e-07           NaN -5.396519e-07 -5.394351e-07 -5.394276e-07
 [2,] -5.538351e-07           NaN -5.538351e-07 -5.522756e-07 -5.537955e-07
 [3,] -5.893031e-07 -5.893031e-07 -5.893031e-07 -5.888807e-07 -5.895688e-07
 [4,] -6.248770e-07 -6.248770e-07 -6.248770e-07 -6.254775e-07 -6.269256e-07
 [5,]  3.897700e-07  3.897700e-07           NaN  3.899053e-07  3.900746e-07
 [6,] -9.979873e-07 -9.979873e-07 -9.979873e-07 -9.989299e-07 -9.994048e-07
 [7,]  6.222324e-07  6.222324e-07  6.222324e-07  6.209271e-07  6.213553e-07
 [8,]  5.603366e-07           NaN           NaN  5.606959e-07  5.540384e-07
 [9,] -9.653143e-07           NaN -9.653143e-07 -9.645375e-07 -9.626632e-07
[10,]  8.286660e-07           NaN           NaN  8.285449e-07  8.251560e-07
              b_3_0         b_3_1         b_3_2         b_3_3         b_3_4
 [1,]  6.348028e-07           NaN  6.348028e-07  6.354245e-07  6.342468e-07
 [2,]  7.486583e-07           NaN  7.486583e-07  7.429443e-07  7.456520e-07
 [3,]  6.754708e-07  6.754708e-07  6.754708e-07  6.748861e-07  6.770351e-07
 [4,]  4.508225e-07  4.508225e-07  4.508225e-07  4.496625e-07  4.498411e-07
 [5,]  3.381458e-07  3.381458e-07           NaN  3.372164e-07  3.381200e-07
 [6,]  1.001559e-06  1.001559e-06  1.001559e-06  9.975476e-07  1.001632e-06
 [7,] -6.152245e-07 -6.152245e-07 -6.152245e-07 -6.154662e-07 -6.161925e-07
 [8,] -5.986317e-07           NaN           NaN -5.969109e-07 -6.023370e-07
 [9,]  1.026049e-06           NaN  1.026049e-06  1.025151e-06  1.029128e-06
[10,] -8.031951e-07           NaN           NaN -8.032986e-07 -8.019783e-07
              R_1_2        R_1_3         R_2_3
 [1,] -1.550204e-06 3.543080e-07 -1.876259e-07
 [2,] -6.316574e-08 4.713515e-08 -2.680633e-07
 [3,] -8.639525e-07 4.254080e-07 -2.990464e-07
 [4,] -6.303767e-07 8.236957e-07  1.056335e-07
 [5,]  4.715963e-07 7.295127e-07 -5.933169e-07
 [6,] -1.107235e-06 1.105627e-06 -1.567929e-06
 [7,] -1.432382e-06 3.538860e-07 -2.906671e-07
 [8,] -7.208188e-07 2.901627e-07 -1.606054e-07
 [9,] -2.389577e-06 9.292818e-07 -1.400272e-06
[10,]  3.668841e-07 6.856613e-07 -9.048976e-07
> range( attr( logLikValGrad, "gradient" ) / logLikValGrad2 - 1, na.rm = TRUE )
[1] -1.170599e-07  2.252657e-08
> attr( logLikValGrad, "gradient" ) - logLikValGrad2
      b_1_0 b_1_1 b_1_2         b_1_3         b_1_4 b_2_0 b_2_1 b_2_2
 [1,]     0     0     0  4.976800e-10  3.745312e-11     0     0     0
 [2,]     0     0     0 -3.643294e-10 -1.060298e-10     0     0     0
 [3,]     0     0     0  1.252659e-10 -1.642822e-10     0     0     0
 [4,]     0     0     0 -2.058271e-10  1.522227e-10     0     0     0
 [5,]     0     0     0  6.575140e-11  2.616248e-10     0     0     0
 [6,]     0     0     0 -1.869624e-10  1.264781e-10     0     0     0
 [7,]     0     0     0 -2.898278e-10 -1.623588e-10     0     0     0
 [8,]     0     0     0 -4.173131e-11 -1.588380e-10     0     0     0
 [9,]     0     0     0 -4.448322e-11 -1.663232e-10     0     0     0
[10,]     0     0     0  1.352138e-10  2.132173e-10     0     0     0
              b_2_3         b_2_4 b_3_0 b_3_1 b_3_2         b_3_3         b_3_4
 [1,] -1.034852e-10  4.275993e-11     0     0     0  2.084143e-10  7.442630e-11
 [2,] -1.490270e-10 -5.118989e-12     0     0     0 -2.997732e-10 -2.135072e-10
 [3,] -1.606591e-10 -8.818213e-11     0     0     0 -1.729538e-10 -4.036885e-10
 [4,]  1.486723e-10 -6.110910e-10     0     0     0 -6.688090e-10  6.817048e-10
 [5,]  7.493617e-11 -2.217951e-10     0     0     0 -7.232756e-10  2.640244e-11
 [6,]  1.028245e-10 -6.313480e-11     0     0     0 -4.762960e-10 -3.519740e-12
 [7,]  3.496612e-10  1.553381e-10     0     0     0 -6.963397e-11 -1.843262e-10
 [8,] -2.306301e-11 -1.631720e-10     0     0     0  1.032831e-10  8.976823e-11
 [9,] -6.646317e-11 -6.097595e-11     0     0     0 -6.806601e-11  6.274188e-11
[10,]  2.065775e-11 -1.817360e-10     0     0     0 -1.981207e-11 -7.069692e-11
      R_1_2 R_1_3 R_2_3
 [1,]     0     0     0
 [2,]     0     0     0
 [3,]     0     0     0
 [4,]     0     0     0
 [5,]     0     0     0
 [6,]     0     0     0
 [7,]     0     0     0
 [8,]     0     0     0
 [9,]     0     0     0
[10,]     0     0     0
> range( attr( logLikValGrad, "gradient" ) - logLikValGrad2 )
[1] -7.232756e-10  6.817048e-10
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -1.3162070  0.7625245  0.9035873  1.6774175
> 
> # calculating marginal effects, unconditional
> margEffUnc <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ) )
> print( margEffUnc )
     d_y1_d_x1  d_y2_d_x1   d_y3_d_x1   d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.180673491 0.21966598 -0.12235589 -0.12920309 0.22580951 -0.24120841
2  0.430121958 0.19008353 -0.13195878 -0.37365413 0.21525553 -0.24897191
3  0.115232772 0.36750507 -0.20314566 -0.31483718 0.20898573 -0.24219913
4  0.207611034 0.38276287 -0.22888859 -0.37427350 0.23255246 -0.26855955
5  0.448006648 0.31256137 -0.20905150 -0.38274109 0.23373092 -0.27065767
6  0.026991730 0.15092034 -0.07583674 -0.15288996 0.06575970 -0.09574988
7  0.256300597 0.15702898 -0.13302286 -0.03866694 0.11839993 -0.14725130
8  0.131828020 0.37694792 -0.22611070 -0.33077755 0.21945964 -0.26592681
9  0.302950354 0.02962659 -0.02666829 -0.23089623 0.07290773 -0.09709985
10 0.002095525 0.24265946 -0.12793733 -0.02934265 0.11782358 -0.15753170
     d_y1_d_x3   d_y2_d_x3  d_y3_d_x3    d_y1_d_x4  d_y2_d_x4  d_y3_d_x4
1  0.070272979 -0.40009837 0.30243692 -0.040155988 -0.5334645 0.32993118
2  0.538657270 -0.36576535 0.32022424 -0.307804155 -0.4876871 0.34933554
3  0.287479936 -0.34790671 0.30462485 -0.164274249 -0.4638756 0.33231802
4  0.430074036 -0.42873970 0.37764850 -0.245756592 -0.5716529 0.41198018
5  0.500659694 -0.47229842 0.43028800 -0.286091254 -0.6297312 0.46940509
6  0.089736371 -0.07546714 0.08239434 -0.051277926 -0.1006229 0.08988474
7  0.125115932 -0.32171038 0.32215058 -0.071494818 -0.4289472 0.35143700
8  0.317022613 -0.37862010 0.36777139 -0.181155779 -0.5048268 0.40120515
9  0.168371792 -0.08563215 0.08389399 -0.096212453 -0.1141762 0.09152071
10 0.009358606 -0.15639629 0.15952285 -0.005347775 -0.2085284 0.17402492
> print( attr( margEffUnc, "vcov" )[ 1:3, , ] )
, , d_y1_d_x1

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1   d_y1_d_x2 d_y2_d_x2 d_y3_d_x2   d_y1_d_x3
1 0.2564698         0         0 -0.08661131         0         0  0.09745006
2 0.1008447         0         0 -0.05986199         0         0 -0.02843561
3 0.1674119         0         0 -0.09902071         0         0  0.26025301
  d_y2_d_x3 d_y3_d_x3   d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0 -0.05781656         0         0
2         0         0  0.03660661         0         0
3         0         0 -0.13728355         0         0

, , d_y2_d_x1

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2   d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0 0.1765481         0         0 -0.04029736         0         0
2         0 0.1075070         0         0 -0.04364529         0         0
3         0 0.1234019         0         0 -0.02945168         0         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1 -0.097864360         0         0 -0.26763695         0
2 -0.109431756         0         0 -0.14561675         0
3  0.002384426         0         0 -0.06311792         0

, , d_y3_d_x1

  d_y1_d_x1 d_y2_d_x1  d_y3_d_x1 d_y1_d_x2 d_y2_d_x2     d_y3_d_x2 d_y1_d_x3
1         0         0 0.08208219         0         0  0.0001099928         0
2         0         0 0.06470109         0         0 -0.0239228542         0
3         0         0 0.12273407         0         0 -0.0261632905         0
  d_y2_d_x3    d_y3_d_x3 d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1         0 -0.079174593         0         0 -0.14679438
2         0 -0.067129404         0         0 -0.07089597
3         0 -0.006504764         0         0 -0.06807061

, , d_y1_d_x2

    d_y1_d_x1 d_y2_d_x1 d_y3_d_x1  d_y1_d_x2 d_y2_d_x2 d_y3_d_x2   d_y1_d_x3
1 -0.08661131         0         0 0.08031764         0         0 -0.04382571
2 -0.05986199         0         0 0.15517620         0         0  0.06215841
3 -0.09902071         0         0 0.17981312         0         0 -0.13348402
  d_y2_d_x3 d_y3_d_x3   d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0  0.02673122         0         0
2         0         0 -0.04832676         0         0
3         0         0  0.06429149         0         0

, , d_y2_d_x2

  d_y1_d_x1   d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0 -0.04029736         0         0 0.1211364         0         0
2         0 -0.04364529         0         0 0.1022165         0         0
3         0 -0.02945168         0         0 0.1235233         0         0
    d_y2_d_x3 d_y3_d_x3 d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1 0.066772450         0         0  0.04860680         0
2 0.060257699         0         0  0.08046615         0
3 0.002315954         0         0 -0.06331141         0

, , d_y3_d_x2

  d_y1_d_x1 d_y2_d_x1     d_y3_d_x1 d_y1_d_x2 d_y2_d_x2  d_y3_d_x2 d_y1_d_x3
1         0         0  0.0001099928         0         0 0.10833600         0
2         0         0 -0.0239228542         0         0 0.09751318         0
3         0         0 -0.0261632905         0         0 0.12970073         0
  d_y2_d_x3   d_y3_d_x3 d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1         0  0.03465320         0         0 -0.01415125
2         0  0.05013794         0         0  0.05646477
3         0 -0.01224124         0         0 -0.07877912

, , d_y1_d_x3

    d_y1_d_x1 d_y2_d_x1 d_y3_d_x1   d_y1_d_x2 d_y2_d_x2 d_y3_d_x2  d_y1_d_x3
1  0.09745006         0         0 -0.04382571         0         0 0.05519428
2 -0.02843561         0         0  0.06215841         0         0 0.16853922
3  0.26025301         0         0 -0.13348402         0         0 0.43540458
  d_y2_d_x3 d_y3_d_x3   d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0 -0.03141844         0         0
2         0         0 -0.03511586         0         0
3         0         0 -0.20370677         0         0

, , d_y2_d_x3

  d_y1_d_x1    d_y2_d_x1 d_y3_d_x1 d_y1_d_x2   d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0 -0.097864360         0         0 0.066772450         0         0
2         0 -0.109431756         0         0 0.060257699         0         0
3         0  0.002384426         0         0 0.002315954         0         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1 0.1313341         0         0 0.1747352         0
2 0.2111337         0         0 0.1572311         0
3 0.2939648         0         0 0.4622561         0

, , d_y3_d_x3

  d_y1_d_x1 d_y2_d_x1    d_y3_d_x1 d_y1_d_x2 d_y2_d_x2   d_y3_d_x2 d_y1_d_x3
1         0         0 -0.079174593         0         0  0.03465320         0
2         0         0 -0.067129404         0         0  0.05013794         0
3         0         0 -0.006504764         0         0 -0.01224124         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0 0.1485878         0         0 0.1938073
2         0 0.1904044         0         0 0.1110330
3         0 0.2576453         0         0 0.3426052

, , d_y1_d_x4

    d_y1_d_x1 d_y2_d_x1 d_y3_d_x1   d_y1_d_x2 d_y2_d_x2 d_y3_d_x2   d_y1_d_x3
1 -0.05781656         0         0  0.02673122         0         0 -0.03141844
2  0.03660661         0         0 -0.04832676         0         0 -0.03511586
3 -0.13728355         0         0  0.06429149         0         0 -0.20370677
  d_y2_d_x3 d_y3_d_x3  d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0 0.02122641         0         0
2         0         0 0.18147422         0         0
3         0         0 0.14656887         0         0

, , d_y2_d_x4

  d_y1_d_x1   d_y2_d_x1 d_y3_d_x1 d_y1_d_x2   d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0 -0.26763695         0         0  0.04860680         0         0
2         0 -0.14561675         0         0  0.08046615         0         0
3         0 -0.06311792         0         0 -0.06331141         0         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1 0.1747352         0         0 0.5412714         0
2 0.1572311         0         0 0.3020058         0
3 0.4622561         0         0 0.9435647         0

, , d_y3_d_x4

  d_y1_d_x1 d_y2_d_x1   d_y3_d_x1 d_y1_d_x2 d_y2_d_x2   d_y3_d_x2 d_y1_d_x3
1         0         0 -0.14679438         0         0 -0.01415125         0
2         0         0 -0.07089597         0         0  0.05646477         0
3         0         0 -0.06807061         0         0 -0.07877912         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0 0.1938073         0         0 0.4115764
2         0 0.1110330         0         0 0.2012592
3         0 0.3426052         0         0 0.6088430

> print( drop( attr( margEffUnc, "vcov" )[ nObs, , ] ) )
              d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2   d_y2_d_x2
d_y1_d_x1  0.0001176217  0.00000000  0.00000000 -0.001145678  0.00000000
d_y2_d_x1  0.0000000000  0.25892667  0.00000000  0.000000000  0.08265483
d_y3_d_x1  0.0000000000  0.00000000  0.13368957  0.000000000  0.00000000
d_y1_d_x2 -0.0011456777  0.00000000  0.00000000  0.016169819  0.00000000
d_y2_d_x2  0.0000000000  0.08265483  0.00000000  0.000000000  0.12214353
d_y3_d_x2  0.0000000000  0.00000000  0.06144675  0.000000000  0.00000000
d_y1_d_x3  0.0004233938  0.00000000  0.00000000 -0.004124394  0.00000000
d_y2_d_x3  0.0000000000 -0.10504549  0.00000000  0.000000000 -0.06457314
d_y3_d_x3  0.0000000000  0.00000000 -0.06060813  0.000000000  0.00000000
d_y1_d_x4 -0.0002567171  0.00000000  0.00000000  0.002500751  0.00000000
d_y2_d_x4  0.0000000000 -0.19956343  0.00000000  0.000000000 -0.12267484
d_y3_d_x4  0.0000000000  0.00000000 -0.10146086  0.000000000  0.00000000
            d_y3_d_x2     d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4
d_y1_d_x1  0.00000000  0.0004233938  0.00000000  0.00000000 -0.0002567171
d_y2_d_x1  0.00000000  0.0000000000 -0.10504549  0.00000000  0.0000000000
d_y3_d_x1  0.06144675  0.0000000000  0.00000000 -0.06060813  0.0000000000
d_y1_d_x2  0.00000000 -0.0041243944  0.00000000  0.00000000  0.0025007512
d_y2_d_x2  0.00000000  0.0000000000 -0.06457314  0.00000000  0.0000000000
d_y3_d_x2  0.16593068  0.0000000000  0.00000000 -0.07054128  0.0000000000
d_y1_d_x3  0.00000000  0.0015429393  0.00000000  0.00000000 -0.0009158142
d_y2_d_x3  0.00000000  0.0000000000  0.08920869  0.00000000  0.0000000000
d_y3_d_x3 -0.07054128  0.0000000000  0.00000000  0.07844472  0.0000000000
d_y1_d_x4  0.00000000 -0.0009158142  0.00000000  0.00000000  0.0006021045
d_y2_d_x4  0.00000000  0.0000000000  0.15887999  0.00000000  0.0000000000
d_y3_d_x4 -0.11808941  0.0000000000  0.00000000  0.12015391  0.0000000000
           d_y2_d_x4  d_y3_d_x4
d_y1_d_x1  0.0000000  0.0000000
d_y2_d_x1 -0.1995634  0.0000000
d_y3_d_x1  0.0000000 -0.1014609
d_y1_d_x2  0.0000000  0.0000000
d_y2_d_x2 -0.1226748  0.0000000
d_y3_d_x2  0.0000000 -0.1180894
d_y1_d_x3  0.0000000  0.0000000
d_y2_d_x3  0.1588800  0.0000000
d_y3_d_x3  0.0000000  0.1201539
d_y1_d_x4  0.0000000  0.0000000
d_y2_d_x4  0.3122700  0.0000000
d_y3_d_x4  0.0000000  0.2148580
> summary( margEffUnc )
               Estimate Std. error z value Pr(> z)  
1: d_y1_d_x1   0.180673   0.506428   0.357   0.721  
1: d_y2_d_x1   0.219666   0.420176   0.523   0.601  
1: d_y3_d_x1  -0.122356   0.286500  -0.427   0.669  
1: d_y1_d_x2  -0.129203   0.283404  -0.456   0.648  
1: d_y2_d_x2   0.225810   0.348047   0.649   0.516  
1: d_y3_d_x2  -0.241208   0.329144  -0.733   0.464  
1: d_y1_d_x3   0.070273   0.234935   0.299   0.765  
1: d_y2_d_x3  -0.400098   0.362400  -1.104   0.270  
1: d_y3_d_x3   0.302437   0.385471   0.785   0.433  
1: d_y1_d_x4  -0.040156   0.145693  -0.276   0.783  
1: d_y2_d_x4  -0.533464   0.735711  -0.725   0.468  
1: d_y3_d_x4   0.329931   0.641542   0.514   0.607  
2: d_y1_d_x1   0.430122   0.317561   1.354   0.176  
2: d_y2_d_x1   0.190084   0.327883   0.580   0.562  
2: d_y3_d_x1  -0.131959   0.254364  -0.519   0.604  
2: d_y1_d_x2  -0.373654   0.393924  -0.949   0.343  
2: d_y2_d_x2   0.215256   0.319713   0.673   0.501  
2: d_y3_d_x2  -0.248972   0.312271  -0.797   0.425  
2: d_y1_d_x3   0.538657   0.410535   1.312   0.189  
2: d_y2_d_x3  -0.365765   0.459493  -0.796   0.426  
2: d_y3_d_x3   0.320224   0.436354   0.734   0.463  
2: d_y1_d_x4  -0.307804   0.425998  -0.723   0.470  
2: d_y2_d_x4  -0.487687   0.549551  -0.887   0.375  
2: d_y3_d_x4   0.349336   0.448619   0.779   0.436  
3: d_y1_d_x1   0.115233   0.409160   0.282   0.778  
3: d_y2_d_x1   0.367505   0.351286   1.046   0.295  
3: d_y3_d_x1  -0.203146   0.350334  -0.580   0.562  
3: d_y1_d_x2  -0.314837   0.424044  -0.742   0.458  
3: d_y2_d_x2   0.208986   0.351459   0.595   0.552  
3: d_y3_d_x2  -0.242199   0.360140  -0.673   0.501  
3: d_y1_d_x3   0.287480   0.659852   0.436   0.663  
3: d_y2_d_x3  -0.347907   0.542185  -0.642   0.521  
3: d_y3_d_x3   0.304625   0.507588   0.600   0.548  
3: d_y1_d_x4  -0.164274   0.382843  -0.429   0.668  
3: d_y2_d_x4  -0.463876   0.971373  -0.478   0.633  
3: d_y3_d_x4   0.332318   0.780284   0.426   0.670  
4: d_y1_d_x1   0.207611   0.540019   0.384   0.701  
4: d_y2_d_x1   0.382763   0.357810   1.070   0.285  
4: d_y3_d_x1  -0.228889   0.357614  -0.640   0.522  
4: d_y1_d_x2  -0.374273   0.337358  -1.109   0.267  
4: d_y2_d_x2   0.232552   0.363994   0.639   0.523  
4: d_y3_d_x2  -0.268560   0.355628  -0.755   0.450  
4: d_y1_d_x3   0.430074   0.609174   0.706   0.480  
4: d_y2_d_x3  -0.428740   0.443926  -0.966   0.334  
4: d_y3_d_x3   0.377649   0.445672   0.847   0.397  
4: d_y1_d_x4  -0.245757   0.366500  -0.671   0.503  
4: d_y2_d_x4  -0.571653   0.778465  -0.734   0.463  
4: d_y3_d_x4   0.411980   0.688066   0.599   0.549  
5: d_y1_d_x1   0.448007   0.365489   1.226   0.220  
5: d_y2_d_x1   0.312561   0.479915   0.651   0.515  
5: d_y3_d_x1  -0.209051   0.417286  -0.501   0.616  
5: d_y1_d_x2  -0.382741   0.346813  -1.104   0.270  
5: d_y2_d_x2   0.233731   0.366815   0.637   0.524  
5: d_y3_d_x2  -0.270658   0.358474  -0.755   0.450  
5: d_y1_d_x3   0.500660   0.632862   0.791   0.429  
5: d_y2_d_x3  -0.472298   0.460031  -1.027   0.305  
5: d_y3_d_x3   0.430288   0.466127   0.923   0.356  
5: d_y1_d_x4  -0.286091   0.511232  -0.560   0.576  
5: d_y2_d_x4  -0.629731   0.347579  -1.812   0.070 .
5: d_y3_d_x4   0.469405   0.346208   1.356   0.175  
6: d_y1_d_x1   0.026992   0.154501   0.175   0.861  
6: d_y2_d_x1   0.150920   0.460658   0.328   0.743  
6: d_y3_d_x1  -0.075837   0.270198  -0.281   0.779  
6: d_y1_d_x2  -0.152890   0.463512  -0.330   0.742  
6: d_y2_d_x2   0.065760   0.246988   0.266   0.790  
6: d_y3_d_x2  -0.095750   0.322528  -0.297   0.767  
6: d_y1_d_x3   0.089736   0.391283   0.229   0.819  
6: d_y2_d_x3  -0.075467   0.325632  -0.232   0.817  
6: d_y3_d_x3   0.082394   0.333304   0.247   0.805  
6: d_y1_d_x4  -0.051278   0.237104  -0.216   0.829  
6: d_y2_d_x4  -0.100623   0.506839  -0.199   0.843  
6: d_y3_d_x4   0.089885   0.439802   0.204   0.838  
7: d_y1_d_x1   0.256301   0.455234   0.563   0.573  
7: d_y2_d_x1   0.157029   0.440389   0.357   0.721  
7: d_y3_d_x1  -0.133023   0.380718  -0.349   0.727  
7: d_y1_d_x2  -0.038667   0.164698  -0.235   0.814  
7: d_y2_d_x2   0.118400   0.358181   0.331   0.741  
7: d_y3_d_x2  -0.147251   0.404268  -0.364   0.716  
7: d_y1_d_x3   0.125116   0.404070   0.310   0.757  
7: d_y2_d_x3  -0.321710   0.522570  -0.616   0.538  
7: d_y3_d_x3   0.322151   0.467820   0.689   0.491  
7: d_y1_d_x4  -0.071495   0.285526  -0.250   0.802  
7: d_y2_d_x4  -0.428947   0.738264  -0.581   0.561  
7: d_y3_d_x4   0.351437   0.549872   0.639   0.523  
8: d_y1_d_x1   0.131828   0.200736   0.657   0.511  
8: d_y2_d_x1   0.376948   0.385153   0.979   0.328  
8: d_y3_d_x1  -0.226111   0.404274  -0.559   0.576  
8: d_y1_d_x2  -0.330778   0.434486  -0.761   0.446  
8: d_y2_d_x2   0.219460   0.406098   0.540   0.589  
8: d_y3_d_x2  -0.265927   0.401733  -0.662   0.508  
8: d_y1_d_x3   0.317023   0.380555   0.833   0.405  
8: d_y2_d_x3  -0.378620   0.378870  -0.999   0.318  
8: d_y3_d_x3   0.367771   0.372121   0.988   0.323  
8: d_y1_d_x4  -0.181156   0.289907  -0.625   0.532  
8: d_y2_d_x4  -0.504827   0.485617  -1.040   0.299  
8: d_y3_d_x4   0.401205   0.424349   0.945   0.344  
9: d_y1_d_x1   0.302950   0.601313   0.504   0.614  
9: d_y2_d_x1   0.029627   0.119098   0.249   0.804  
9: d_y3_d_x1  -0.026668   0.103269  -0.258   0.796  
9: d_y1_d_x2  -0.230896   0.364964  -0.633   0.527  
9: d_y2_d_x2   0.072908   0.184501   0.395   0.693  
9: d_y3_d_x2  -0.097100   0.225089  -0.431   0.666  
9: d_y1_d_x3   0.168372   0.416529   0.404   0.686  
9: d_y2_d_x3  -0.085632   0.254682  -0.336   0.737  
9: d_y3_d_x3   0.083894   0.241358   0.348   0.728  
9: d_y1_d_x4  -0.096212   0.317277  -0.303   0.762  
9: d_y2_d_x4  -0.114176   0.384666  -0.297   0.767  
9: d_y3_d_x4   0.091521   0.303290   0.302   0.763  
10: d_y1_d_x1  0.002096   0.010845   0.193   0.847  
10: d_y2_d_x1  0.242659   0.508848   0.477   0.633  
10: d_y3_d_x1 -0.127937   0.365636  -0.350   0.726  
10: d_y1_d_x2 -0.029343   0.127161  -0.231   0.818  
10: d_y2_d_x2  0.117824   0.349490   0.337   0.736  
10: d_y3_d_x2 -0.157532   0.407346  -0.387   0.699  
10: d_y1_d_x3  0.009359   0.039280   0.238   0.812  
10: d_y2_d_x3 -0.156396   0.298678  -0.524   0.601  
10: d_y3_d_x3  0.159523   0.280080   0.570   0.569  
10: d_y1_d_x4 -0.005348   0.024538  -0.218   0.827  
10: d_y2_d_x4 -0.208528   0.558811  -0.373   0.709  
10: d_y3_d_x4  0.174025   0.463528   0.375   0.707  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
> margEffUncA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ), vcov = diag( 18 ) )
> all.equal( margEffUnc, margEffUncA )
[1] TRUE
> # now with explicitly specifying dummy variables
> margEffUncD <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ),
+    dummyVar = c( "x1", "x2" ) )
> all.equal( margEffUncD, margEffUnc )
[1] TRUE
> # now with seemingly no dummy variables
> margEffUncD0 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ),
+    dummyVar = NULL )
> summary( margEffUncD0 )
               Estimate Std. error z value Pr(> z)  
1: d_y1_d_x1   0.060234   0.229108   0.263   0.793  
1: d_y2_d_x1   0.333415   0.493646   0.675   0.499  
1: d_y3_d_x1  -0.164966   0.378021  -0.436   0.663  
1: d_y1_d_x2  -0.050195   0.164201  -0.306   0.760  
1: d_y2_d_x2   0.200049   0.281001   0.712   0.477  
1: d_y3_d_x2  -0.192460   0.275484  -0.699   0.485  
1: d_y1_d_x3   0.070273   0.234935   0.299   0.765  
1: d_y2_d_x3  -0.400098   0.362400  -1.104   0.270  
1: d_y3_d_x3   0.302437   0.385471   0.785   0.433  
1: d_y1_d_x4  -0.040156   0.145693  -0.276   0.783  
1: d_y2_d_x4  -0.533464   0.735711  -0.725   0.468  
1: d_y3_d_x4   0.329931   0.641542   0.514   0.607  
2: d_y1_d_x1   0.461706   0.425420   1.085   0.278  
2: d_y2_d_x1   0.304804   0.446891   0.682   0.495  
2: d_y3_d_x1  -0.174668   0.354664  -0.492   0.622  
2: d_y1_d_x2  -0.384755   0.302075  -1.274   0.203  
2: d_y2_d_x2   0.182883   0.222555   0.822   0.411  
2: d_y3_d_x2  -0.203779   0.215459  -0.946   0.344  
2: d_y1_d_x3   0.538657   0.410535   1.312   0.189  
2: d_y2_d_x3  -0.365765   0.459493  -0.796   0.426  
2: d_y3_d_x3   0.320224   0.436354   0.734   0.463  
2: d_y1_d_x4  -0.307804   0.425998  -0.723   0.470  
2: d_y2_d_x4  -0.487687   0.549551  -0.887   0.375  
2: d_y3_d_x4   0.349336   0.448619   0.779   0.436  
3: d_y1_d_x1   0.246411   0.741815   0.332   0.740  
3: d_y2_d_x1   0.289922   0.458618   0.632   0.527  
3: d_y3_d_x1  -0.166159   0.309677  -0.537   0.592  
3: d_y1_d_x2  -0.205343   0.465676  -0.441   0.659  
3: d_y2_d_x2   0.173953   0.311819   0.558   0.577  
3: d_y3_d_x2  -0.193852   0.343697  -0.564   0.573  
3: d_y1_d_x3   0.287480   0.659852   0.436   0.663  
3: d_y2_d_x3  -0.347907   0.542185  -0.642   0.521  
3: d_y3_d_x3   0.304625   0.507588   0.600   0.548  
3: d_y1_d_x4  -0.164274   0.382843  -0.429   0.668  
3: d_y2_d_x4  -0.463876   0.971373  -0.478   0.633  
3: d_y3_d_x4   0.332318   0.780284   0.426   0.670  
4: d_y1_d_x1   0.368635   0.750796   0.491   0.623  
4: d_y2_d_x1   0.357283   0.359055   0.995   0.320  
4: d_y3_d_x1  -0.205990   0.308528  -0.668   0.504  
4: d_y1_d_x2  -0.307196   0.412510  -0.745   0.456  
4: d_y2_d_x2   0.214370   0.315135   0.680   0.496  
4: d_y3_d_x2  -0.240322   0.319493  -0.752   0.452  
4: d_y1_d_x3   0.430074   0.609174   0.706   0.480  
4: d_y2_d_x3  -0.428740   0.443926  -0.966   0.334  
4: d_y3_d_x3   0.377649   0.445672   0.847   0.397  
4: d_y1_d_x4  -0.245757   0.366500  -0.671   0.503  
4: d_y2_d_x4  -0.571653   0.778465  -0.734   0.463  
4: d_y3_d_x4   0.411980   0.688066   0.599   0.549  
5: d_y1_d_x1   0.429137   0.328389   1.307   0.191  
5: d_y2_d_x1   0.393582   0.467655   0.842   0.400  
5: d_y3_d_x1  -0.234703   0.442903  -0.530   0.596  
5: d_y1_d_x2  -0.357614   0.462119  -0.774   0.439  
5: d_y2_d_x2   0.236149   0.399413   0.591   0.554  
5: d_y3_d_x2  -0.273820   0.402605  -0.680   0.496  
5: d_y1_d_x3   0.500660   0.632862   0.791   0.429  
5: d_y2_d_x3  -0.472298   0.460031  -1.027   0.305  
5: d_y3_d_x3   0.430288   0.466127   0.923   0.356  
5: d_y1_d_x4  -0.286091   0.511232  -0.560   0.576  
5: d_y2_d_x4  -0.629731   0.347579  -1.812   0.070 .
5: d_y3_d_x4   0.469405   0.346208   1.356   0.175  
6: d_y1_d_x1   0.076917   0.399613   0.192   0.847  
6: d_y2_d_x1   0.062889   0.284635   0.221   0.825  
6: d_y3_d_x1  -0.044942   0.189754  -0.237   0.813  
6: d_y1_d_x2  -0.064097   0.288689  -0.222   0.824  
6: d_y2_d_x2   0.037734   0.167485   0.225   0.822  
6: d_y3_d_x2  -0.052433   0.222212  -0.236   0.813  
6: d_y1_d_x3   0.089736   0.391283   0.229   0.819  
6: d_y2_d_x3  -0.075467   0.325632  -0.232   0.817  
6: d_y3_d_x3   0.082394   0.333304   0.247   0.805  
6: d_y1_d_x4  -0.051278   0.237104  -0.216   0.829  
6: d_y2_d_x4  -0.100623   0.506839  -0.199   0.843  
6: d_y3_d_x4   0.089885   0.439802   0.204   0.838  
7: d_y1_d_x1   0.107242   0.335747   0.319   0.749  
7: d_y2_d_x1   0.268092   0.655234   0.409   0.682  
7: d_y3_d_x1  -0.175718   0.493248  -0.356   0.722  
7: d_y1_d_x2  -0.089369   0.362442  -0.247   0.805  
7: d_y2_d_x2   0.160855   0.480950   0.334   0.738  
7: d_y3_d_x2  -0.205005   0.533324  -0.384   0.701  
7: d_y1_d_x3   0.125116   0.404070   0.310   0.757  
7: d_y2_d_x3  -0.321710   0.522570  -0.616   0.538  
7: d_y3_d_x3   0.322151   0.467820   0.689   0.491  
7: d_y1_d_x4  -0.071495   0.285526  -0.250   0.802  
7: d_y2_d_x4  -0.428947   0.738264  -0.581   0.561  
7: d_y3_d_x4   0.351437   0.549872   0.639   0.523  
8: d_y1_d_x1   0.271734   0.370440   0.734   0.463  
8: d_y2_d_x1   0.315517   0.384094   0.821   0.411  
8: d_y3_d_x1  -0.200603   0.355534  -0.564   0.573  
8: d_y1_d_x2  -0.226445   0.333112  -0.680   0.497  
8: d_y2_d_x2   0.189310   0.341793   0.554   0.580  
8: d_y3_d_x2  -0.234036   0.362884  -0.645   0.519  
8: d_y1_d_x3   0.317023   0.380555   0.833   0.405  
8: d_y2_d_x3  -0.378620   0.378870  -0.999   0.318  
8: d_y3_d_x3   0.367771   0.372121   0.988   0.323  
8: d_y1_d_x4  -0.181156   0.289907  -0.625   0.532  
8: d_y2_d_x4  -0.504827   0.485617  -1.040   0.299  
8: d_y3_d_x4   0.401205   0.424349   0.945   0.344  
9: d_y1_d_x1   0.144319   0.428654   0.337   0.736  
9: d_y2_d_x1   0.071360   0.254004   0.281   0.779  
9: d_y3_d_x1  -0.045760   0.171176  -0.267   0.789  
9: d_y1_d_x2  -0.120266   0.295330  -0.407   0.684  
9: d_y2_d_x2   0.042816   0.123059   0.348   0.728  
9: d_y3_d_x2  -0.053387   0.151551  -0.352   0.725  
9: d_y1_d_x3   0.168372   0.416529   0.404   0.686  
9: d_y2_d_x3  -0.085632   0.254682  -0.336   0.737  
9: d_y3_d_x3   0.083894   0.241358   0.348   0.728  
9: d_y1_d_x4  -0.096212   0.317277  -0.303   0.762  
9: d_y2_d_x4  -0.114176   0.384666  -0.297   0.767  
9: d_y3_d_x4   0.091521   0.303290   0.302   0.763  
10: d_y1_d_x1  0.008022   0.038409   0.209   0.835  
10: d_y2_d_x1  0.130330   0.346766   0.376   0.707  
10: d_y3_d_x1 -0.087012   0.250335  -0.348   0.728  
10: d_y1_d_x2 -0.006685   0.032220  -0.207   0.836  
10: d_y2_d_x2  0.078198   0.232723   0.336   0.737  
10: d_y3_d_x2 -0.101515   0.278753  -0.364   0.716  
10: d_y1_d_x3  0.009359   0.039280   0.238   0.812  
10: d_y2_d_x3 -0.156396   0.298678  -0.524   0.601  
10: d_y3_d_x3  0.159523   0.280080   0.570   0.569  
10: d_y1_d_x4 -0.005348   0.024538  -0.218   0.827  
10: d_y2_d_x4 -0.208528   0.558811  -0.373   0.709  
10: d_y3_d_x4  0.174025   0.463528   0.375   0.707  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
> # now with seemingly only dummy variables
> margEffUncDA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ),
+    dummyVar = c( "x1", "x2", "x3", "x4" ) )
> summary( margEffUncDA )
               Estimate Std. error z value Pr(> z)  
1: d_y1_d_x1   0.180673   0.506428   0.357  0.7213  
1: d_y2_d_x1   0.219666   0.420176   0.523  0.6011  
1: d_y3_d_x1  -0.122356   0.286500  -0.427  0.6693  
1: d_y1_d_x2  -0.129203   0.283404  -0.456  0.6485  
1: d_y2_d_x2   0.225810   0.348047   0.649  0.5165  
1: d_y3_d_x2  -0.241208   0.329144  -0.733  0.4637  
1: d_y1_d_x3   0.510588   0.293968   1.737  0.0824 .
1: d_y2_d_x3  -0.217616   0.372909  -0.584  0.5595  
1: d_y3_d_x3   0.298602   0.374009   0.798  0.4246  
1: d_y1_d_x4  -0.038743   0.137789  -0.281  0.7786  
1: d_y2_d_x4  -0.524961   0.523494  -1.003  0.3160  
1: d_y3_d_x4   0.346068   0.576168   0.601  0.5481  
2: d_y1_d_x1   0.430122   0.317561   1.354  0.1756  
2: d_y2_d_x1   0.190084   0.327883   0.580  0.5621  
2: d_y3_d_x1  -0.131959   0.254364  -0.519  0.6039  
2: d_y1_d_x2  -0.373654   0.393924  -0.949  0.3429  
2: d_y2_d_x2   0.215256   0.319713   0.673  0.5008  
2: d_y3_d_x2  -0.248972   0.312271  -0.797  0.4253  
2: d_y1_d_x3   0.410125   0.396819   1.034  0.3014  
2: d_y2_d_x3  -0.448236   0.314764  -1.424  0.1544  
2: d_y3_d_x3   0.417677   0.343720   1.215  0.2243  
2: d_y1_d_x4  -0.210803   0.309845  -0.680  0.4963  
2: d_y2_d_x4  -0.512795   0.357795  -1.433  0.1518  
2: d_y3_d_x4   0.446390   0.312268   1.430  0.1529  
3: d_y1_d_x1   0.115233   0.409160   0.282  0.7782  
3: d_y2_d_x1   0.367505   0.351286   1.046  0.2955  
3: d_y3_d_x1  -0.203146   0.350334  -0.580  0.5620  
3: d_y1_d_x2  -0.314837   0.424044  -0.742  0.4578  
3: d_y2_d_x2   0.208986   0.351459   0.595  0.5521  
3: d_y3_d_x2  -0.242199   0.360140  -0.673  0.5013  
3: d_y1_d_x3   0.342143   0.566956   0.603  0.5462  
3: d_y2_d_x3  -0.281479   0.514058  -0.548  0.5840  
3: d_y3_d_x3   0.307287   0.472745   0.650  0.5157  
3: d_y1_d_x4  -0.223117   0.401738  -0.555  0.5786  
3: d_y2_d_x4  -0.251119   0.675741  -0.372  0.7102  
3: d_y3_d_x4   0.206232   0.578378   0.357  0.7214  
4: d_y1_d_x1   0.207611   0.540019   0.384  0.7006  
4: d_y2_d_x1   0.382763   0.357810   1.070  0.2847  
4: d_y3_d_x1  -0.228889   0.357614  -0.640  0.5221  
4: d_y1_d_x2  -0.374273   0.337358  -1.109  0.2672  
4: d_y2_d_x2   0.232552   0.363994   0.639  0.5229  
4: d_y3_d_x2  -0.268560   0.355628  -0.755  0.4501  
4: d_y1_d_x3   0.338243   0.565710   0.598  0.5499  
4: d_y2_d_x3  -0.288488   0.512001  -0.563  0.5731  
4: d_y3_d_x3   0.311934   0.468322   0.666  0.5054  
4: d_y1_d_x4  -0.285863   0.356399  -0.802  0.4225  
4: d_y2_d_x4  -0.361366   0.706221  -0.512  0.6089  
4: d_y3_d_x4   0.289321   0.607781   0.476  0.6341  
5: d_y1_d_x1   0.448007   0.365489   1.226  0.2203  
5: d_y2_d_x1   0.312561   0.479915   0.651  0.5149  
5: d_y3_d_x1  -0.209051   0.417286  -0.501  0.6164  
5: d_y1_d_x2  -0.382741   0.346813  -1.104  0.2698  
5: d_y2_d_x2   0.233731   0.366815   0.637  0.5240  
5: d_y3_d_x2  -0.270658   0.358474  -0.755  0.4502  
5: d_y1_d_x3   0.086632   0.249892   0.347  0.7288  
5: d_y2_d_x3  -0.162984   0.362247  -0.450  0.6528  
5: d_y3_d_x3   0.164314   0.354266   0.464  0.6428  
5: d_y1_d_x4  -0.242305   0.457724  -0.529  0.5965  
5: d_y2_d_x4  -0.548566   0.432588  -1.268  0.2048  
5: d_y3_d_x4   0.444516   0.383787   1.158  0.2468  
6: d_y1_d_x1   0.026992   0.154501   0.175  0.8613  
6: d_y2_d_x1   0.150920   0.460658   0.328  0.7432  
6: d_y3_d_x1  -0.075837   0.270198  -0.281  0.7790  
6: d_y1_d_x2  -0.152890   0.463512  -0.330  0.7415  
6: d_y2_d_x2   0.065760   0.246988   0.266  0.7900  
6: d_y3_d_x2  -0.095750   0.322528  -0.297  0.7666  
6: d_y1_d_x3   0.294462   0.542545   0.543  0.5873  
6: d_y2_d_x3  -0.362960   0.454475  -0.799  0.4245  
6: d_y3_d_x3   0.359477   0.408133   0.881  0.3784  
6: d_y1_d_x4  -0.071365   0.291084  -0.245  0.8063  
6: d_y2_d_x4  -0.075971   0.369470  -0.206  0.8371  
6: d_y3_d_x4   0.068823   0.335898   0.205  0.8377  
7: d_y1_d_x1   0.256301   0.455234   0.563  0.5734  
7: d_y2_d_x1   0.157029   0.440389   0.357  0.7214  
7: d_y3_d_x1  -0.133023   0.380718  -0.349  0.7268  
7: d_y1_d_x2  -0.038667   0.164698  -0.235  0.8144  
7: d_y2_d_x2   0.118400   0.358181   0.331  0.7410  
7: d_y3_d_x2  -0.147251   0.404268  -0.364  0.7157  
7: d_y1_d_x3   0.263628   0.517690   0.509  0.6106  
7: d_y2_d_x3  -0.406595   0.387861  -1.048  0.2945  
7: d_y3_d_x3   0.386465   0.363439   1.063  0.2876  
7: d_y1_d_x4  -0.069998   0.274874  -0.255  0.7990  
7: d_y2_d_x4  -0.443659   0.566743  -0.783  0.4337  
7: d_y3_d_x4   0.358465   0.471789   0.760  0.4474  
8: d_y1_d_x1   0.131828   0.200736   0.657  0.5114  
8: d_y2_d_x1   0.376948   0.385153   0.979  0.3277  
8: d_y3_d_x1  -0.226111   0.404274  -0.559  0.5760  
8: d_y1_d_x2  -0.330778   0.434486  -0.761  0.4465  
8: d_y2_d_x2   0.219460   0.406098   0.540  0.5889  
8: d_y3_d_x2  -0.265927   0.401733  -0.662  0.5080  
8: d_y1_d_x3   0.185554   0.248831   0.746  0.4558  
8: d_y2_d_x3  -0.263729   0.275021  -0.959  0.3376  
8: d_y3_d_x3   0.271620   0.270641   1.004  0.3156  
8: d_y1_d_x4  -0.259873   0.418877  -0.620  0.5350  
8: d_y2_d_x4  -0.207944   0.274256  -0.758  0.4483  
8: d_y3_d_x4   0.221009   0.261751   0.844  0.3985  
9: d_y1_d_x1   0.302950   0.601313   0.504  0.6144  
9: d_y2_d_x1   0.029627   0.119098   0.249  0.8035  
9: d_y3_d_x1  -0.026668   0.103269  -0.258  0.7962  
9: d_y1_d_x2  -0.230896   0.364964  -0.633  0.5270  
9: d_y2_d_x2   0.072908   0.184501   0.395  0.6927  
9: d_y3_d_x2  -0.097100   0.225089  -0.431  0.6662  
9: d_y1_d_x3   0.407884   0.398941   1.022  0.3066  
9: d_y2_d_x3  -0.449061   0.316410  -1.419  0.1558  
9: d_y3_d_x3   0.417625   0.346271   1.206  0.2278  
9: d_y1_d_x4  -0.031703   0.120740  -0.263  0.7929  
9: d_y2_d_x4  -0.506593   0.571616  -0.886  0.3755  
9: d_y3_d_x4   0.327282   0.592565   0.552  0.5807  
10: d_y1_d_x1  0.002096   0.010845   0.193  0.8468  
10: d_y2_d_x1  0.242659   0.508848   0.477  0.6334  
10: d_y3_d_x1 -0.127937   0.365636  -0.350  0.7264  
10: d_y1_d_x2 -0.029343   0.127161  -0.231  0.8175  
10: d_y2_d_x2  0.117824   0.349490   0.337  0.7360  
10: d_y3_d_x2 -0.157532   0.407346  -0.387  0.6990  
10: d_y1_d_x3  0.128581   0.214119   0.601  0.5482  
10: d_y2_d_x3 -0.386714   0.292472  -1.322  0.1861  
10: d_y3_d_x3  0.356248   0.291286   1.223  0.2213  
10: d_y1_d_x4 -0.034296   0.141396  -0.243  0.8084  
10: d_y2_d_x4 -0.017558   0.069195  -0.254  0.7997  
10: d_y3_d_x4  0.029071   0.103923   0.280  0.7797  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
> # now with mean values of the marginal effects
> margEffUncM <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ), 
+    addMean = TRUE )
> all.equal( margEffUnc, margEffUncM[ 1:nObs, ], check.attributes = FALSE )
[1] TRUE
> print( margEffUncM[ nObs:(nObs+1), ] )
       d_y1_d_x1 d_y2_d_x1  d_y3_d_x1   d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
10   0.002095525 0.2426595 -0.1279373 -0.02934265 0.1178236 -0.1575317
mean 0.210181213 0.2429762 -0.1484976 -0.23572823 0.1710685 -0.2035156
       d_y1_d_x3  d_y2_d_x3 d_y3_d_x3    d_y1_d_x4  d_y2_d_x4 d_y3_d_x4
10   0.009358606 -0.1563963 0.1595228 -0.005347775 -0.2085284 0.1740249
mean 0.253674923 -0.3032635 0.2750956 -0.144957099 -0.4043513 0.3001043
> all.equal( attr( margEffUnc, "vcov" ), 
+    attr( margEffUncM, "vcov" )[ 1:nObs, , ] )
[1] TRUE
> print( attr( margEffUncM, "vcov" )[ nObs:(nObs+1), , ] )
, , d_y1_d_x1

        d_y1_d_x1 d_y2_d_x1 d_y3_d_x1    d_y1_d_x2 d_y2_d_x2 d_y3_d_x2
10   0.0001176217         0         0 -0.001145678         0         0
mean 0.0616473460         0         0 -0.014676234         0         0
        d_y1_d_x3 d_y2_d_x3 d_y3_d_x3     d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10   0.0004233938         0         0 -0.0002567171         0         0
mean 0.0131837139         0         0 -0.0135209675         0         0

, , d_y2_d_x1

     d_y1_d_x1  d_y2_d_x1 d_y3_d_x1 d_y1_d_x2    d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0 0.25892667         0         0  0.082654833         0         0
mean         0 0.06969919         0         0 -0.009436932         0         0
        d_y2_d_x3 d_y3_d_x3 d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
10   -0.105045489         0         0 -0.19956343         0
mean  0.008748776         0         0 -0.02749794         0

, , d_y3_d_x1

     d_y1_d_x1 d_y2_d_x1  d_y3_d_x1 d_y1_d_x2 d_y2_d_x2    d_y3_d_x2 d_y1_d_x3
10           0         0 0.13368957         0         0  0.061446755         0
mean         0         0 0.06562862         0         0 -0.007405409         0
     d_y2_d_x3    d_y3_d_x3 d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
10           0 -0.060608134         0         0 -0.10146086
mean         0  0.007401025         0         0 -0.01736225

, , d_y1_d_x2

        d_y1_d_x1 d_y2_d_x1 d_y3_d_x1  d_y1_d_x2 d_y2_d_x2 d_y3_d_x2
10   -0.001145678         0         0 0.01616982         0         0
mean -0.014676234         0         0 0.06142330         0         0
        d_y1_d_x3 d_y2_d_x3 d_y3_d_x3    d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10   -0.004124394         0         0  0.002500751         0         0
mean  0.022071548         0         0 -0.007583003         0         0

, , d_y2_d_x2

     d_y1_d_x1    d_y2_d_x1 d_y3_d_x1 d_y1_d_x2  d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0  0.082654833         0         0 0.12214353         0         0
mean         0 -0.009436932         0         0 0.08158337         0         0
       d_y2_d_x3 d_y3_d_x3 d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
10   -0.06457314         0         0 -0.12267484         0
mean  0.03244536         0         0  0.01069128         0

, , d_y3_d_x2

     d_y1_d_x1 d_y2_d_x1    d_y3_d_x1 d_y1_d_x2 d_y2_d_x2  d_y3_d_x2 d_y1_d_x3
10           0         0  0.061446755         0         0 0.16593068         0
mean         0         0 -0.007405409         0         0 0.08538425         0
     d_y2_d_x3   d_y3_d_x3 d_y1_d_x4 d_y2_d_x4    d_y3_d_x4
10           0 -0.07054128         0         0 -0.118089409
mean         0  0.03369255         0         0  0.001950265

, , d_y1_d_x3

        d_y1_d_x1 d_y2_d_x1 d_y3_d_x1    d_y1_d_x2 d_y2_d_x2 d_y3_d_x2
10   0.0004233938         0         0 -0.004124394         0         0
mean 0.0131837139         0         0  0.022071548         0         0
       d_y1_d_x3 d_y2_d_x3 d_y3_d_x3     d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10   0.001542939         0         0 -0.0009158142         0         0
mean 0.019914554         0         0 -0.0014542480         0         0

, , d_y2_d_x3

     d_y1_d_x1    d_y2_d_x1 d_y3_d_x1 d_y1_d_x2   d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0 -0.105045489         0         0 -0.06457314         0         0
mean         0  0.008748776         0         0  0.03244536         0         0
      d_y2_d_x3 d_y3_d_x3 d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
10   0.08920869         0         0 0.158879989         0
mean 0.02100430         0         0 0.009676448         0

, , d_y3_d_x3

     d_y1_d_x1 d_y2_d_x1    d_y3_d_x1 d_y1_d_x2 d_y2_d_x2   d_y3_d_x2 d_y1_d_x3
10           0         0 -0.060608134         0         0 -0.07054128         0
mean         0         0  0.007401025         0         0  0.03369255         0
     d_y2_d_x3  d_y3_d_x3 d_y1_d_x4 d_y2_d_x4  d_y3_d_x4
10           0 0.07844472         0         0 0.12015391
mean         0 0.02265176         0         0 0.01161896

, , d_y1_d_x4

         d_y1_d_x1 d_y2_d_x1 d_y3_d_x1    d_y1_d_x2 d_y2_d_x2 d_y3_d_x2
10   -0.0002567171         0         0  0.002500751         0         0
mean -0.0135209675         0         0 -0.007583003         0         0
         d_y1_d_x3 d_y2_d_x3 d_y3_d_x3    d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10   -0.0009158142         0         0 0.0006021045         0         0
mean -0.0014542480         0         0 0.0387121063         0         0

, , d_y2_d_x4

     d_y1_d_x1   d_y2_d_x1 d_y3_d_x1 d_y1_d_x2   d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0 -0.19956343         0         0 -0.12267484         0         0
mean         0 -0.02749794         0         0  0.01069128         0         0
       d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10   0.158879989         0         0 0.3122700         0
mean 0.009676448         0         0 0.1658717         0

, , d_y3_d_x4

     d_y1_d_x1 d_y2_d_x1   d_y3_d_x1 d_y1_d_x2 d_y2_d_x2    d_y3_d_x2 d_y1_d_x3
10           0         0 -0.10146086         0         0 -0.118089409         0
mean         0         0 -0.01736225         0         0  0.001950265         0
     d_y2_d_x3  d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0 0.12015391         0         0 0.2148580
mean         0 0.01161896         0         0 0.1353683

> print( drop( attr( margEffUncM, "vcov" )[ nObs+1, , ] ) )
            d_y1_d_x1    d_y2_d_x1    d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
d_y1_d_x1  0.06164735  0.000000000  0.000000000 -0.014676234  0.000000000
d_y2_d_x1  0.00000000  0.069699186  0.000000000  0.000000000 -0.009436932
d_y3_d_x1  0.00000000  0.000000000  0.065628617  0.000000000  0.000000000
d_y1_d_x2 -0.01467623  0.000000000  0.000000000  0.061423301  0.000000000
d_y2_d_x2  0.00000000 -0.009436932  0.000000000  0.000000000  0.081583371
d_y3_d_x2  0.00000000  0.000000000 -0.007405409  0.000000000  0.000000000
d_y1_d_x3  0.01318371  0.000000000  0.000000000  0.022071548  0.000000000
d_y2_d_x3  0.00000000  0.008748776  0.000000000  0.000000000  0.032445362
d_y3_d_x3  0.00000000  0.000000000  0.007401025  0.000000000  0.000000000
d_y1_d_x4 -0.01352097  0.000000000  0.000000000 -0.007583003  0.000000000
d_y2_d_x4  0.00000000 -0.027497938  0.000000000  0.000000000  0.010691278
d_y3_d_x4  0.00000000  0.000000000 -0.017362251  0.000000000  0.000000000
             d_y3_d_x2    d_y1_d_x3   d_y2_d_x3   d_y3_d_x3    d_y1_d_x4
d_y1_d_x1  0.000000000  0.013183714 0.000000000 0.000000000 -0.013520967
d_y2_d_x1  0.000000000  0.000000000 0.008748776 0.000000000  0.000000000
d_y3_d_x1 -0.007405409  0.000000000 0.000000000 0.007401025  0.000000000
d_y1_d_x2  0.000000000  0.022071548 0.000000000 0.000000000 -0.007583003
d_y2_d_x2  0.000000000  0.000000000 0.032445362 0.000000000  0.000000000
d_y3_d_x2  0.085384250  0.000000000 0.000000000 0.033692549  0.000000000
d_y1_d_x3  0.000000000  0.019914554 0.000000000 0.000000000 -0.001454248
d_y2_d_x3  0.000000000  0.000000000 0.021004297 0.000000000  0.000000000
d_y3_d_x3  0.033692549  0.000000000 0.000000000 0.022651757  0.000000000
d_y1_d_x4  0.000000000 -0.001454248 0.000000000 0.000000000  0.038712106
d_y2_d_x4  0.000000000  0.000000000 0.009676448 0.000000000  0.000000000
d_y3_d_x4  0.001950265  0.000000000 0.000000000 0.011618959  0.000000000
             d_y2_d_x4    d_y3_d_x4
d_y1_d_x1  0.000000000  0.000000000
d_y2_d_x1 -0.027497938  0.000000000
d_y3_d_x1  0.000000000 -0.017362251
d_y1_d_x2  0.000000000  0.000000000
d_y2_d_x2  0.010691278  0.000000000
d_y3_d_x2  0.000000000  0.001950265
d_y1_d_x3  0.000000000  0.000000000
d_y2_d_x3  0.009676448  0.000000000
d_y3_d_x3  0.000000000  0.011618959
d_y1_d_x4  0.000000000  0.000000000
d_y2_d_x4  0.165871700  0.000000000
d_y3_d_x4  0.000000000  0.135368309
> all.equal( summary( margEffUnc )[ , ], 
+    summary( margEffUncM )[ 1:( 12 * nObs ), ], check.attributes = FALSE )
[1] TRUE
> printCoefmat( summary( margEffUncM )[ -( 1:( 12 * (nObs-1) ) ), ] )
                  Estimate Std. error z value Pr(> z)  
10: d_y1_d_x1    0.0020955  0.0108454  0.1932 0.84679  
10: d_y2_d_x1    0.2426595  0.5088484  0.4769 0.63345  
10: d_y3_d_x1   -0.1279373  0.3656358 -0.3499 0.72641  
10: d_y1_d_x2   -0.0293426  0.1271606 -0.2308 0.81751  
10: d_y2_d_x2    0.1178236  0.3494904  0.3371 0.73602  
10: d_y3_d_x2   -0.1575317  0.4073459 -0.3867 0.69896  
10: d_y1_d_x3    0.0093586  0.0392803  0.2383 0.81169  
10: d_y2_d_x3   -0.1563963  0.2986782 -0.5236 0.60054  
10: d_y3_d_x3    0.1595228  0.2800799  0.5696 0.56897  
10: d_y1_d_x4   -0.0053478  0.0245378 -0.2179 0.82748  
10: d_y2_d_x4   -0.2085284  0.5588112 -0.3732 0.70903  
10: d_y3_d_x4    0.1740249  0.4635277  0.3754 0.70734  
mean: d_y1_d_x1  0.2101812  0.2482888  0.8465 0.39726  
mean: d_y2_d_x1  0.2429762  0.2640060  0.9203 0.35739  
mean: d_y3_d_x1 -0.1484976  0.2561808 -0.5797 0.56214  
mean: d_y1_d_x2 -0.2357282  0.2478372 -0.9511 0.34153  
mean: d_y2_d_x2  0.1710685  0.2856280  0.5989 0.54923  
mean: d_y3_d_x2 -0.2035156  0.2922058 -0.6965 0.48613  
mean: d_y1_d_x3  0.2536749  0.1411189  1.7976 0.07224 .
mean: d_y2_d_x3 -0.3032635  0.1449286 -2.0925 0.03639 *
mean: d_y3_d_x3  0.2750956  0.1505050  1.8278 0.06758 .
mean: d_y1_d_x4 -0.1449571  0.1967539 -0.7367 0.46128  
mean: d_y2_d_x4 -0.4043513  0.4072735 -0.9928 0.32080  
mean: d_y3_d_x4  0.3001043  0.3679243  0.8157 0.41469  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -0.5074569 -0.4007881  0.9870865 -1.2228328
> 
> # calculating marginal effects, conditional
> # (assuming that all other dependent variables are one)
> margEffCond <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz() )
> print( margEffCond )
      d_y1_d_x1  d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2  d_y3_d_x2
1  0.4118196285 0.11755425 -0.3603571 -0.229336023 0.24592945 -0.1258047
2  0.3072493886 0.16496098 -0.2207962 -0.251218729 0.23603249 -0.1732265
3  0.2668136514 0.22747911 -0.3834613 -0.358314743 0.23024729 -0.1482975
4  0.3739634546 0.27583243 -0.3555778 -0.346905711 0.26380199 -0.1562548
5  0.4391801486 0.27082731 -0.2615752 -0.320544987 0.26315436 -0.1630063
6  0.1333475202 0.05063076 -0.3842384 -0.271514059 0.05963121 -0.1100592
7  0.1186209608 0.14525007 -0.1602907 -0.008844268 0.11286656 -0.1545433
8  0.0479944760 0.35027624 -0.2340024 -0.203212079 0.23964177 -0.1769059
9  0.5485854658 0.01846945 -0.1161634 -0.323192759 0.07403491 -0.1034704
10 0.0002023317 0.23196959 -0.1301103 -0.005713415 0.11099101 -0.1661675
     d_y1_d_x3   d_y2_d_x3 d_y3_d_x3     d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  0.176511552 -0.35179286 0.2229842 -0.1468374650 -0.32872178 0.6037347
2  0.470625849 -0.39065433 0.2417527 -0.4007656059 -0.40480342 0.4969012
3  0.440547549 -0.33694170 0.2350549 -0.3803063472 -0.32464544 0.5721855
4  0.520056790 -0.45146105 0.2436830 -0.4144341596 -0.44879952 0.5673865
5  0.329853048 -0.50531263 0.2791236 -0.2238687970 -0.56755035 0.4883268
6  0.253508476 -0.05245314 0.1581382 -0.2782416392 -0.04810410 0.3860385
7  0.036015809 -0.30982533 0.2977379 -0.0217475812 -0.39933261 0.3574982
8  0.147285010 -0.38617280 0.2839412 -0.0911087353 -0.46686982 0.4072656
9  0.361307538 -0.07085862 0.1415298 -0.3929185216 -0.06647694 0.3342594
10 0.001136227 -0.14918719 0.1853440 -0.0006208183 -0.19920183 0.1994459
> margEffCondA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz() )
> all.equal( margEffCond, margEffCondA )
[1] TRUE
> # now with dummy variables specified explicitly
> margEffCondD <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    dummyVars = c( "x1", "x2" ), algorithm = GenzBretz() )
> all.equal( margEffCondD, margEffCond )
[1] TRUE
> # now with seemingly no dummy variables
> margEffCondD0 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    dummyVars = NULL, algorithm = GenzBretz() )
> print( margEffCondD0 )
      d_y1_d_x1  d_y2_d_x1   d_y3_d_x1     d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.1884635650 0.17102712 -0.42316725 -0.1258011311 0.18806310 -0.12892375
2  0.5099557824 0.22543984 -0.32620929 -0.3353288225 0.20402620 -0.14650352
3  0.4821673453 0.17270950 -0.39225087 -0.3148211010 0.17871508 -0.13835668
4  0.5392597435 0.24342496 -0.38415941 -0.3688050820 0.23826960 -0.14572352
5  0.3084532159 0.32945682 -0.30363340 -0.2310713585 0.26068085 -0.17458867
6  0.3290263250 0.02481757 -0.26612804 -0.1861210493 0.02795716 -0.09105967
7  0.0313559802 0.24700912 -0.18717169 -0.0250310818 0.15490110 -0.19216058
8  0.1301219440 0.28075214 -0.23379151 -0.1025547712 0.19614099 -0.18116028
9  0.4656624777 0.03483961 -0.22862972 -0.2647877107 0.03761669 -0.08212529
10 0.0009338784 0.12485332 -0.09718526 -0.0007862237 0.07414565 -0.12046481
     d_y1_d_x3   d_y2_d_x3 d_y3_d_x3     d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  0.176511552 -0.35179286 0.2229842 -0.1468374650 -0.32872178 0.6037347
2  0.470625849 -0.39065433 0.2417527 -0.4007656059 -0.40480342 0.4969012
3  0.440547549 -0.33694170 0.2350549 -0.3803063472 -0.32464544 0.5721855
4  0.520056790 -0.45146105 0.2436830 -0.4144341596 -0.44879952 0.5673865
5  0.329853048 -0.50531263 0.2791236 -0.2238687970 -0.56755035 0.4883268
6  0.253508476 -0.05245314 0.1581382 -0.2782416392 -0.04810410 0.3860385
7  0.036015809 -0.30982533 0.2977379 -0.0217475812 -0.39933261 0.3574982
8  0.147285010 -0.38617280 0.2839412 -0.0911087353 -0.46686982 0.4072656
9  0.361307538 -0.07085862 0.1415298 -0.3929185216 -0.06647694 0.3342594
10 0.001136227 -0.14918719 0.1853440 -0.0006208183 -0.19920183 0.1994459
> # now with seemingly only dummy variables
> margEffCondDA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    dummyVars = c( "x1", "x2", "x3", "x4" ), algorithm = GenzBretz() )
> print( margEffCondDA )
      d_y1_d_x1  d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2  d_y3_d_x2
1  0.4118196285 0.11755425 -0.3603571 -0.229336023 0.24592945 -0.1258047
2  0.3072493886 0.16496098 -0.2207962 -0.251218729 0.23603249 -0.1732265
3  0.2668136514 0.22747911 -0.3834613 -0.358314743 0.23024729 -0.1482975
4  0.3739634546 0.27583243 -0.3555778 -0.346905711 0.26380199 -0.1562548
5  0.4391801486 0.27082731 -0.2615752 -0.320544987 0.26315436 -0.1630063
6  0.1333475202 0.05063076 -0.3842384 -0.271514059 0.05963121 -0.1100592
7  0.1186209608 0.14525007 -0.1602907 -0.008844268 0.11286656 -0.1545433
8  0.0479944760 0.35027624 -0.2340024 -0.203212079 0.23964177 -0.1769059
9  0.5485854658 0.01846945 -0.1161634 -0.323192759 0.07403491 -0.1034704
10 0.0002023317 0.23196959 -0.1301103 -0.005713415 0.11099101 -0.1661675
    d_y1_d_x3  d_y2_d_x3 d_y3_d_x3    d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  0.43230239 -0.2692830 0.1631718 -0.142023260 -0.35837410 0.54369935
2  0.22403261 -0.4616019 0.3079839 -0.328013708 -0.49007825 0.43466606
3  0.18752328 -0.2979142 0.2321765 -0.446802359 -0.18313630 0.40395556
4  0.18354779 -0.3041504 0.2365840 -0.411875993 -0.29361935 0.44264675
5  0.02729896 -0.1606363 0.1716591 -0.165495636 -0.50776892 0.47200346
6  0.14155213 -0.3691322 0.2835271 -0.354045944 -0.03714082 0.29003164
7  0.11478735 -0.4063478 0.3124210 -0.021385692 -0.41570255 0.35971732
8  0.07449582 -0.2637046 0.2414374 -0.146174052 -0.20463223 0.23281447
9  0.22089519 -0.4620024 0.3090326 -0.126527306 -0.33025402 0.54904170
10 0.04081212 -0.3738552 0.3198510 -0.003924666 -0.01724742 0.04690532
> # now with integrals obtained by the Miwa algorithm, reduced precision
> margEffCond1 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = Miwa( steps = 32 ) )
> print( margEffCond1 )
      d_y1_d_x1  d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2  d_y3_d_x2
1  0.4118175441 0.11744761 -0.3604293 -0.229377392 0.24595064 -0.1258412
2  0.3072778362 0.16499571 -0.2207798 -0.251230455 0.23600462 -0.1732307
3  0.2668567540 0.22752895 -0.3835033 -0.358189399 0.23045343 -0.1481687
4  0.3740368431 0.27590804 -0.3555998 -0.346792914 0.26395440 -0.1561463
5  0.4391762270 0.27082379 -0.2615569 -0.320425619 0.26329930 -0.1629057
6  0.1333669207 0.05068089 -0.3842359 -0.271497048 0.05975710 -0.1100381
7  0.1186476441 0.14525164 -0.1602639 -0.008826922 0.11286814 -0.1545282
8  0.0479957196 0.35027704 -0.2340019 -0.203276650 0.23960011 -0.1769520
9  0.5485472106 0.01837404 -0.1161731 -0.323172242 0.07410392 -0.1034597
10 0.0002125689 0.23197009 -0.1301010 -0.005696324 0.11099282 -0.1661532
     d_y1_d_x3   d_y2_d_x3 d_y3_d_x3     d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  0.176546731 -0.35173837 0.2230884 -0.1468532997 -0.32870549 0.6038590
2  0.470508468 -0.39074154 0.2416959 -0.4008818185 -0.40494388 0.4968085
3  0.440643343 -0.33692357 0.2351269 -0.3803577016 -0.32467070 0.5722886
4  0.520191404 -0.45148369 0.2437674 -0.4144878625 -0.44884522 0.5675156
5  0.329930691 -0.50525720 0.2791793 -0.2238869512 -0.56754997 0.4882992
6  0.253546211 -0.05240629 0.1581628 -0.2782961085 -0.04819657 0.3860753
7  0.036014555 -0.30982678 0.2977379 -0.0217517288 -0.39933488 0.3574964
8  0.147297395 -0.38616972 0.2839504 -0.0911171908 -0.46687210 0.4072593
9  0.361303561 -0.07095789 0.1415239 -0.3929209851 -0.06636947 0.3342959
10 0.001077011 -0.14918942 0.1852891 -0.0006898554 -0.19920415 0.1993821
> all.equal( margEffCond, margEffCond1 )
 [1] "Component 1: Mean relative difference: 9.319688e-05" 
 [2] "Component 2: Mean relative difference: 0.0002259434" 
 [3] "Component 3: Mean relative difference: 8.422528e-05" 
 [4] "Component 4: Mean relative difference: 0.0002359585" 
 [5] "Component 5: Mean relative difference: 0.0004315704" 
 [6] "Component 6: Mean relative difference: 0.0003287333" 
 [7] "Component 7: Mean relative difference: 0.0002101602" 
 [8] "Component 8: Mean relative difference: 0.0001300577" 
 [9] "Component 9: Mean relative difference: 0.0002044689" 
[10] "Component 10: Mean relative difference: 0.0001675276"
[11] "Component 11: Mean relative difference: 0.000133631" 
[12] "Component 12: Mean relative difference: 0.0001409384"
> # now with integrals obtained by the GHK algorithm
> margEffCond2 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE )
> print( margEffCond2 )
      d_y1_d_x1  d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2  d_y3_d_x2
1  0.4120204907 0.12496054 -0.3601937 -0.229275444 0.24656096 -0.1264859
2  0.3105789512 0.17860492 -0.2207353 -0.252699622 0.23756523 -0.1745610
3  0.2665383992 0.23025645 -0.3837299 -0.358474059 0.23147649 -0.1489714
4  0.3737016708 0.27812532 -0.3561175 -0.347728634 0.26481716 -0.1576515
5  0.4399322754 0.27239142 -0.2624700 -0.321660167 0.26420615 -0.1646125
6  0.1334041757 0.05757852 -0.3838745 -0.271187377 0.06238751 -0.1099318
7  0.1211635205 0.14620921 -0.1616811 -0.009995845 0.11350228 -0.1592700
8  0.0497739112 0.35482588 -0.2353584 -0.205476715 0.24033985 -0.1801000
9  0.5582196873 0.04588147 -0.1163612 -0.322752953 0.07726908 -0.1033954
10 0.0006320436 0.23387574 -0.1340470 -0.006734245 0.11167712 -0.1708361
      d_y1_d_x3   d_y2_d_x3 d_y3_d_x3    d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  0.1763299123 -0.35336690 0.2233966 -0.146608979 -0.33322866 0.6039101
2  0.4709427047 -0.39474822 0.2424568 -0.401220332 -0.41533126 0.4972206
3  0.4403126688 -0.33958467 0.2354779 -0.380063995 -0.33216144 0.5723273
4  0.5203984318 -0.45373955 0.2448886 -0.414046787 -0.45507118 0.5682299
5  0.3330012383 -0.50703990 0.2835796 -0.224241440 -0.57213943 0.4910794
6  0.2532455357 -0.05821538 0.1579588 -0.279259652 -0.06532845 0.3858571
7  0.0390976689 -0.31144596 0.3059117 -0.022992332 -0.40247246 0.3630267
8  0.1510299748 -0.38761701 0.2909536 -0.092205017 -0.47013102 0.4115833
9  0.3606962490 -0.07810203 0.1413356 -0.395142892 -0.08668239 0.3341350
10 0.0008025037 -0.15020695 0.1921428 -0.002065602 -0.20061813 0.2067482
> all.equal( margEffCond, margEffCond2 )
 [1] "Component 1: Mean relative difference: 0.007274846" 
 [2] "Component 2: Mean relative difference: 0.03747971"  
 [3] "Component 3: Mean relative difference: 0.003518855" 
 [4] "Component 4: Mean relative difference: 0.003813365" 
 [5] "Component 5: Mean relative difference: 0.007335713" 
 [6] "Component 6: Mean relative difference: 0.01250843"  
 [7] "Component 7: Mean relative difference: 0.00447887"  
 [8] "Component 8: Mean relative difference: 0.009787098" 
 [9] "Component 9: Mean relative difference: 0.01291234"  
[10] "Component 10: Mean relative difference: 0.003706651"
[11] "Component 11: Mean relative difference: 0.02416914" 
[12] "Component 12: Mean relative difference: 0.004914306"
> all.equal( margEffCond1, margEffCond2 )
 [1] "Component 1: Mean relative difference: 0.007302638" 
 [2] "Component 2: Mean relative difference: 0.03747545"  
 [3] "Component 3: Mean relative difference: 0.003532005" 
 [4] "Component 4: Mean relative difference: 0.00395168"  
 [5] "Component 5: Mean relative difference: 0.006977384" 
 [6] "Component 6: Mean relative difference: 0.01267949"  
 [7] "Component 7: Mean relative difference: 0.004478344" 
 [8] "Component 8: Mean relative difference: 0.009775402" 
 [9] "Component 9: Mean relative difference: 0.01282564"  
[10] "Component 10: Mean relative difference: 0.003641363"
[11] "Component 11: Mean relative difference: 0.02411041" 
[12] "Component 12: Mean relative difference: 0.004893427"
> # now with integrals obtained by the GHK algorithm, reduced precision
> margEffCond3 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    nGHK = 100 )
> print( margEffCond3 )
    d_y1_d_x1   d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.35706025  0.07834237 -0.3573599 -0.217914737 0.24204995 -0.12187035
2  0.17842058  0.10430154 -0.2112069 -0.232255861 0.22509394 -0.16275834
3  0.24645348  0.20573628 -0.3913875 -0.333771538 0.22470462 -0.14101272
4  0.34468065  0.25552160 -0.3654151 -0.321372456 0.25714440 -0.14868069
5  0.39531390  0.25352172 -0.2730576 -0.296051054 0.25561012 -0.15513685
6  0.11925400  0.01643885 -0.3810721 -0.247448071 0.05157318 -0.10229342
7  0.10840916  0.13399605 -0.1617170 -0.005700740 0.10456385 -0.15496986
8  0.02747604  0.32724239 -0.2326725 -0.183705309 0.22932867 -0.16951149
9  0.37473790 -0.06742030 -0.1067990 -0.290665859 0.06543780 -0.09456364
10 0.02095092  0.21903350 -0.1224342 -0.005313354 0.10231193 -0.16701680
     d_y1_d_x3   d_y2_d_x3 d_y3_d_x3   d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1   0.16817105 -0.34301440 0.2182270 -0.13517345 -0.29642470 0.6083034
2   0.43073787 -0.37331845 0.2244791 -0.29583700 -0.34558621 0.4849186
3   0.41205924 -0.32545153 0.2246944 -0.32971272 -0.27984727 0.5686308
4   0.48497682 -0.43971853 0.2322381 -0.35294054 -0.40660307 0.5674606
5   0.30018498 -0.48736224 0.2677792 -0.16964583 -0.53095796 0.4937718
6   0.23046155 -0.03469405 0.1472323 -0.23448731  0.01830302 0.3692521
7   0.02676862 -0.28930258 0.2928207 -0.02104248 -0.37161973 0.3545769
8   0.12347183 -0.36592513 0.2741515 -0.06717796 -0.43590831 0.4095904
9   0.32456657 -0.05199359 0.1296053 -0.31719931  0.00867074 0.3163796
10 -0.02408396 -0.13771422 0.1783179 -0.04203884 -0.18421849 0.1853459
> all.equal( margEffCond, margEffCond3 )
 [1] "Component 1: Mean relative difference: 0.1950758"  
 [2] "Component 2: Mean relative difference: 0.1761965"  
 [3] "Component 3: Mean relative difference: 0.02485851" 
 [4] "Component 4: Mean relative difference: 0.0796093"  
 [5] "Component 5: Mean relative difference: 0.04275513" 
 [6] "Component 6: Mean relative difference: 0.04227655" 
 [7] "Component 7: Mean relative difference: 0.09482927" 
 [8] "Component 8: Mean relative difference: 0.05197425" 
 [9] "Component 9: Mean relative difference: 0.04356983" 
[10] "Component 10: Mean relative difference: 0.19926"   
[11] "Component 11: Mean relative difference: 0.1322209" 
[12] "Component 12: Mean relative difference: 0.01804595"
> all.equal( margEffCond2, margEffCond3 )
 [1] "Component 1: Mean relative difference: 0.2002449"  
 [2] "Component 2: Mean relative difference: 0.205957"   
 [3] "Component 3: Mean relative difference: 0.02547425" 
 [4] "Component 4: Mean relative difference: 0.0824537"  
 [5] "Component 5: Mean relative difference: 0.04972607" 
 [6] "Component 6: Mean relative difference: 0.05214635" 
 [7] "Component 7: Mean relative difference: 0.0977991"  
 [8] "Component 8: Mean relative difference: 0.06116275" 
 [9] "Component 9: Mean relative difference: 0.05545767" 
[10] "Component 10: Mean relative difference: 0.2004108" 
[11] "Component 11: Mean relative difference: 0.1526995" 
[12] "Component 12: Mean relative difference: 0.02031045"
> # now with variance covariance matrix and Jacobian
> margEffCondV <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    vcov = diag( 18 ), returnJacobian = TRUE, algorithm = GenzBretz() )
> print( attr( margEffCondV, "vcov" ) )
, , d_y1_d_x1

      d_y1_d_x1     d_y2_d_x1     d_y3_d_x1     d_y1_d_x2     d_y2_d_x2
1  9.750971e-01 -0.0030037423 -4.490045e-01 -0.2274334729  0.0068307492
5  2.912560e-01  0.0387204653 -5.823824e-02  0.0274927901 -0.0755630122
10 7.727996e-06  0.0001515647  5.378418e-05 -0.0001392449  0.0001042601
      d_y3_d_x2    d_y1_d_x3     d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1  0.1589283485 3.934913e-01 -0.0551360998 -0.2431539207 -4.943851e-01
5  0.0074691017 5.559145e-02  0.0922666787 -0.0209438968 -2.593822e-01
10 0.0002038302 3.956835e-05 -0.0001169437 -0.0002206918 -2.316957e-05
       d_y2_d_x4    d_y3_d_x4
1  -0.0188374345  0.270328853
5  -0.0399301204  0.081681433
10 -0.0001923111 -0.000241325

, , d_y2_d_x1

       d_y1_d_x1 d_y2_d_x1  d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.0030037423 0.3213086 0.08092957  0.089143004 -0.005045259 -0.05181404
5   0.0387204653 0.2564557 0.05195901 -0.032248624 -0.049598653 -0.03718387
10  0.0001515647 0.2634495 0.01979479 -0.003199861  0.088988794  0.02585722
      d_y1_d_x3  d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  -0.044427031 -0.3667550  0.03806791 -0.0186986576 -0.65426181 -0.05504100
5   0.111593955 -0.0907331  0.03541485 -0.1448499710 -0.08451449  0.05376516
10  0.001031063 -0.1089146 -0.03738140 -0.0002466476 -0.20173639 -0.04389582

, , d_y3_d_x1

       d_y1_d_x1  d_y2_d_x1 d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -4.490045e-01 0.08092957 0.7652168  0.066369491 -0.008445285 -0.38941393
5  -5.823824e-02 0.05195901 0.2587506 -0.104236832  0.007911417 -0.01687398
10  5.378418e-05 0.01979479 0.1390371 -0.001494665  0.005243041  0.05039549
       d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4    d_y2_d_x4   d_y3_d_x4
1  -0.0589949274 -0.077701852  0.47423595  0.189627098 -0.146882467 -0.37513506
5   0.2076679660 -0.049802098 -0.08350722 -0.071267404 -0.028543080 -0.06042803
10  0.0002019259 -0.005508186 -0.04781628 -0.000167342 -0.009577636 -0.09148118

, , d_y1_d_x2

       d_y1_d_x1    d_y2_d_x1    d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1  -0.2274334729  0.089143004  0.066369491 0.243352635 -0.051781028
5   0.0274927901 -0.032248624 -0.104236832 0.380620095 -0.066218734
10 -0.0001392449 -0.003199861 -0.001494665 0.002968057 -0.003344902
      d_y3_d_x2     d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4
1  -0.110923427 -0.1634860393 -0.065417875 0.034736249 0.1447065273
5  -0.072756702 -0.3656135275  0.064841504 0.004927934 0.1635478254
10 -0.006398513 -0.0007135702  0.002481104 0.004964602 0.0004091202
      d_y2_d_x4    d_y3_d_x4
1  -0.178619507 -0.031123121
5   0.005572462  0.023442576
10  0.004025707  0.005855566

, , d_y2_d_x2

       d_y1_d_x1    d_y2_d_x1    d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1   0.0068307492 -0.005045259 -0.008445285 -0.051781028 0.1206777 0.04231634
5  -0.0755630122 -0.049598653  0.007911417 -0.066218734 0.1807104 0.04028227
10  0.0001042601  0.088988794  0.005243041 -0.003344902 0.1238768 0.03178731
       d_y1_d_x3   d_y2_d_x3    d_y3_d_x3    d_y1_d_x4    d_y2_d_x4
1   0.0067421558  0.02461029 -0.007100758 -0.001683054 -0.004915436
5  -0.0055783709 -0.05095735 -0.002522731  0.088168991  0.003655392
10  0.0006847522 -0.06785055 -0.029702141 -0.000182194 -0.124354974
      d_y3_d_x4
1  -0.006969484
5  -0.003065135
10 -0.033881256

, , d_y3_d_x2

      d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1  0.1589283485 -0.05181404 -0.38941393 -0.110923427 0.04231634 0.3899346
5  0.0074691017 -0.03718387 -0.01687398 -0.072756702 0.04028227 0.2915086
10 0.0002038302  0.02585722  0.05039549 -0.006398513 0.03178731 0.1945990
      d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1   0.012307140  0.03663825 -0.25915624 -0.0683888638  0.10552589  0.14901568
5  -0.068977037  0.01307835 -0.14270346 -0.0175648413  0.06314878  0.01104703
10  0.000936581 -0.01954074 -0.09169794 -0.0006430461 -0.02874204 -0.14039647

, , d_y1_d_x3

      d_y1_d_x1    d_y2_d_x1     d_y3_d_x1     d_y1_d_x2     d_y2_d_x2
1  3.934913e-01 -0.044427031 -0.0589949274 -0.1634860393  0.0067421558
5  5.559145e-02  0.111593955  0.2076679660 -0.3656135275 -0.0055783709
10 3.956835e-05  0.001031063  0.0002019259 -0.0007135702  0.0006847522
      d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1   0.012307140 0.3041791387 -0.0153415475 -0.086915250 -0.2673497162
5  -0.068977037 0.8888133639 -0.1312317856 -0.084254369 -0.4883874931
10  0.000936581 0.0002049371 -0.0007564279 -0.001119009 -0.0001167076
      d_y2_d_x4    d_y3_d_x4
1   0.089085500  0.050521158
5  -0.040612577 -0.013889723
10 -0.001380156 -0.001070066

, , d_y2_d_x3

       d_y1_d_x1  d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  -0.0551360998 -0.3667550 -0.077701852 -0.065417875  0.02461029  0.03663825
5   0.0922666787 -0.0907331 -0.049802098  0.064841504 -0.05095735  0.01307835
10 -0.0001169437 -0.1089146 -0.005508186  0.002481104 -0.06785055 -0.01954074
       d_y1_d_x3  d_y2_d_x3  d_y3_d_x3     d_y1_d_x4  d_y2_d_x4   d_y3_d_x4
1  -0.0153415475 0.53571025 0.02858950  0.0502931362 0.78867418  0.08319167
5  -0.1312317856 0.36770203 0.02688757 -0.0435083937 0.04107823 -0.03027008
10 -0.0007564279 0.08985383 0.02939425  0.0002325527 0.15666266  0.03361876

, , d_y3_d_x3

       d_y1_d_x1   d_y2_d_x1   d_y3_d_x1   d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.2431539207  0.03806791  0.47423595 0.034736249 -0.007100758 -0.25915624
5  -0.0209438968  0.03541485 -0.08350722 0.004927934 -0.002522731 -0.14270346
10 -0.0002206918 -0.03738140 -0.04781628 0.004964602 -0.029702141 -0.09169794
      d_y1_d_x3  d_y2_d_x3 d_y3_d_x3    d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  -0.086915250 0.02858950 0.5430830 0.1173791359 -0.07875333 -0.18429040
5  -0.084254369 0.02688757 0.4427421 0.0917414656 -0.09290091  0.03875653
10 -0.001119009 0.02939425 0.1344230 0.0006774422  0.03900411  0.16897835

, , d_y1_d_x4

       d_y1_d_x1     d_y2_d_x1    d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1  -4.943851e-01 -0.0186986576  0.189627098 0.1447065273 -0.001683054
5  -2.593822e-01 -0.1448499710 -0.071267404 0.1635478254  0.088168991
10 -2.316957e-05 -0.0002466476 -0.000167342 0.0004091202 -0.000182194
       d_y3_d_x2     d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1  -0.0683888638 -0.2673497162  0.0502931362 0.1173791359 3.484787e-01
5  -0.0175648413 -0.4883874931 -0.0435083937 0.0917414656 6.538214e-01
10 -0.0006430461 -0.0001167076  0.0002325527 0.0006774422 7.263175e-05
      d_y2_d_x4     d_y3_d_x4
1  0.0237422937 -0.1867641107
5  0.0431861770 -0.1430103473
10 0.0002043577  0.0007809695

, , d_y2_d_x4

       d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.0188374345 -0.65426181 -0.146882467 -0.178619507 -0.004915436  0.10552589
5  -0.0399301204 -0.08451449 -0.028543080  0.005572462  0.003655392  0.06314878
10 -0.0001923111 -0.20173639 -0.009577636  0.004025707 -0.124354974 -0.02874204
      d_y1_d_x3  d_y2_d_x3   d_y3_d_x3    d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1   0.089085500 0.78867418 -0.07875333 0.0237422937 1.4556119  0.13436032
5  -0.040612577 0.04107823 -0.09290091 0.0431861770 0.2495913 -0.04532905
10 -0.001380156 0.15666266  0.03900411 0.0002043577 0.3032282  0.05086440

, , d_y3_d_x4

      d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1   0.270328853 -0.05504100 -0.37513506 -0.031123121 -0.006969484  0.14901568
5   0.081681433  0.05376516 -0.06042803  0.023442576 -0.003065135  0.01104703
10 -0.000241325 -0.04389582 -0.09148118  0.005855566 -0.033881256 -0.14039647
      d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1   0.050521158  0.08319167 -0.18429040 -0.1867641107  0.13436032 0.4426038
5  -0.013889723 -0.03027008  0.03875653 -0.1430103473 -0.04532905 0.2294027
10 -0.001070066  0.03361876  0.16897835  0.0007809695  0.05086440 0.2857090

> print( drop( attr( margEffCondV, "vcov" )[ 1, , ] ) )
             d_y1_d_x1    d_y2_d_x1    d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
d_y1_d_x1  0.975097136 -0.003003742 -0.449004490 -0.22743347  0.006830749
d_y2_d_x1 -0.003003742  0.321308613  0.080929573  0.08914300 -0.005045259
d_y3_d_x1 -0.449004490  0.080929573  0.765216773  0.06636949 -0.008445285
d_y1_d_x2 -0.227433473  0.089143004  0.066369491  0.24335263 -0.051781028
d_y2_d_x2  0.006830749 -0.005045259 -0.008445285 -0.05178103  0.120677689
d_y3_d_x2  0.158928348 -0.051814040 -0.389413930 -0.11092343  0.042316339
d_y1_d_x3  0.393491346 -0.044427031 -0.058994927 -0.16348604  0.006742156
d_y2_d_x3 -0.055136100 -0.366754971 -0.077701852 -0.06541787  0.024610287
d_y3_d_x3 -0.243153921  0.038067907  0.474235951  0.03473625 -0.007100758
d_y1_d_x4 -0.494385125 -0.018698658  0.189627098  0.14470653 -0.001683054
d_y2_d_x4 -0.018837435 -0.654261807 -0.146882467 -0.17861951 -0.004915436
d_y3_d_x4  0.270328853 -0.055040997 -0.375135057 -0.03112312 -0.006969484
            d_y3_d_x2    d_y1_d_x3   d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
d_y1_d_x1  0.15892835  0.393491346 -0.05513610 -0.243153921 -0.494385125
d_y2_d_x1 -0.05181404 -0.044427031 -0.36675497  0.038067907 -0.018698658
d_y3_d_x1 -0.38941393 -0.058994927 -0.07770185  0.474235951  0.189627098
d_y1_d_x2 -0.11092343 -0.163486039 -0.06541787  0.034736249  0.144706527
d_y2_d_x2  0.04231634  0.006742156  0.02461029 -0.007100758 -0.001683054
d_y3_d_x2  0.38993460  0.012307140  0.03663825 -0.259156241 -0.068388864
d_y1_d_x3  0.01230714  0.304179139 -0.01534155 -0.086915250 -0.267349716
d_y2_d_x3  0.03663825 -0.015341548  0.53571025  0.028589501  0.050293136
d_y3_d_x3 -0.25915624 -0.086915250  0.02858950  0.543083030  0.117379136
d_y1_d_x4 -0.06838886 -0.267349716  0.05029314  0.117379136  0.348478747
d_y2_d_x4  0.10552589  0.089085500  0.78867418 -0.078753327  0.023742294
d_y3_d_x4  0.14901568  0.050521158  0.08319167 -0.184290399 -0.186764111
             d_y2_d_x4    d_y3_d_x4
d_y1_d_x1 -0.018837435  0.270328853
d_y2_d_x1 -0.654261807 -0.055040997
d_y3_d_x1 -0.146882467 -0.375135057
d_y1_d_x2 -0.178619507 -0.031123121
d_y2_d_x2 -0.004915436 -0.006969484
d_y3_d_x2  0.105525894  0.149015681
d_y1_d_x3  0.089085500  0.050521158
d_y2_d_x3  0.788674183  0.083191666
d_y3_d_x3 -0.078753327 -0.184290399
d_y1_d_x4  0.023742294 -0.186764111
d_y2_d_x4  1.455611865  0.134360316
d_y3_d_x4  0.134360316  0.442603753
> print( attr( margEffCondV, "jacobian" ) )
, , b_1_0

       d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1   0.2844103081  0.0365935258  0.0780064050 -0.22745182  0.019380780
5  -0.1562244504 -0.0003601467 -0.0126554978  0.17568006 -0.017225469
10 -0.0008151563  0.0002331714  0.0007906753  0.01741561 -0.004668669
     d_y3_d_x2    d_y1_d_x3    d_y2_d_x3   d_y3_d_x3   d_y1_d_x4     d_y2_d_x4
1  -0.02311634  0.278693735 -0.067768013 0.013911094 -0.23325786 -6.892265e-02
5  -0.04385058 -0.365474317  0.050365268 0.088007379  0.24198421 -1.525446e-02
10 -0.01341462 -0.004107825  0.001389167 0.004463097  0.00204281 -3.885781e-05
       d_y3_d_x4
1  -0.0040412118
5  -0.0153210777
10 -0.0009769963

, , b_1_1

      d_y1_d_x1     d_y2_d_x1     d_y3_d_x1 d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  4.322723e-01 -1.904979e-02 -8.015547e-02 0.0000000  0.00000000  0.00000000
5  2.559760e-01 -4.309406e-02 -8.364006e-02 0.1756801 -0.01722547 -0.04385058
10 4.235501e-06 -6.254719e-06 -2.028966e-05 0.0000000  0.00000000  0.00000000
    d_y1_d_x3  d_y2_d_x3  d_y3_d_x3 d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1   0.0000000 0.00000000 0.00000000  0.000000  0.00000000  0.00000000
5  -0.3656297 0.05028755 0.08800738  0.242073 -0.01521006 -0.01532108
10  0.0000000 0.00000000 0.00000000  0.000000  0.00000000  0.00000000

, , b_1_2

   d_y1_d_x1  d_y2_d_x1  d_y3_d_x1 d_y1_d_x2    d_y2_d_x2   d_y3_d_x2 d_y1_d_x3
1  0.2844103 0.03659353 0.07800641  0.147862 -0.055643316 -0.15816188 0.2787715
5  0.0000000 0.00000000 0.00000000  0.431656 -0.060319529 -0.12749064 0.0000000
10 0.0000000 0.00000000 0.00000000  0.018235 -0.004908095 -0.01422558 0.0000000
     d_y2_d_x3  d_y3_d_x3  d_y1_d_x4   d_y2_d_x4    d_y3_d_x4
1  -0.06776801 0.01375566 -0.2333023 -0.06892265 -0.003952394
5   0.00000000 0.00000000  0.0000000  0.00000000  0.000000000
10  0.00000000 0.00000000  0.0000000  0.00000000  0.000000000

, , b_1_3

      d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1  -0.303700069 -0.0390754343 -0.0832970886  0.24287844 -0.020695256
5   0.097646416  0.0002251057  0.0079101828 -0.10980693  0.010766595
10 -0.001022055  0.0002923537  0.0009913604  0.02183595 -0.005853647
     d_y3_d_x2    d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1   0.02468417 -0.149844318  0.016887554 -0.173727207  0.249089638
5   0.02740834  0.484715209 -0.074546679 -0.138729325 -0.151567647
10 -0.01681944 -0.004587394  0.001521665  0.004795661  0.003241851
       d_y2_d_x4     d_y3_d_x4
1   7.305268e-02  0.0038191672
5   9.370282e-03  0.0091482377
10 -1.665335e-05 -0.0006661338

, , b_1_4

       d_y1_d_x1     d_y2_d_x1     d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1   0.1212908204  1.560583e-02  0.0332669405 -0.097000062  0.008265210
5  -0.1283510529 -2.958896e-04 -0.0103975173  0.144335412 -0.014152120
10  0.0003101437 -8.871495e-05 -0.0003008287 -0.006626135  0.001776293
      d_y3_d_x2   d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1  -0.009858291  0.11899232 -0.0286437540  0.006039613 4.838045e-02
5  -0.036026809 -0.30095926  0.0412836432  0.072242212 4.554608e-01
10  0.005103872  0.00184297 -0.0005273559 -0.001398881 2.003137e-05
       d_y2_d_x4     d_y3_d_x4
1  -0.0845979325 -1.595830e-01
5  -0.0554175360 -9.558606e-02
10 -0.0002172217 -1.160433e-05

, , b_2_0

       d_y1_d_x1  d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -0.0090414667 -0.1533759 -0.019587546  0.038823785 -0.14266410 -0.011727560
5   0.0329540419  0.1411774  0.009013214 -0.014887909 -0.04799001 -0.004653031
10  0.0001596092  0.2197046  0.006612413 -0.003257078  0.13273560  0.012840268
       d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4   d_y2_d_x4
1  -0.0426436664  0.35113024  0.030886405  0.0128785871  0.32804870
5   0.0463296068 -0.07983059 -0.002808864 -0.0527133892 -0.08200107
10  0.0007993606 -0.22631341 -0.018218760 -0.0007105427 -0.30195846
      d_y3_d_x4
1   0.029398706
5   0.009015011
10 -0.018163249

, , b_2_1

       d_y1_d_x1 d_y2_d_x1   d_y3_d_x1   d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -2.526525e-02 0.1025285 0.006560333  0.00000000  0.00000000  0.000000000
5  -4.130975e-02 0.4007844 0.037210326 -0.01488791 -0.04799001 -0.004653031
10 -6.115108e-07 0.3469243 0.022544747  0.00000000  0.00000000  0.000000000
   d_y1_d_x3   d_y2_d_x3    d_y3_d_x3   d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  0.0000000  0.00000000  0.000000000  0.00000000  0.00000000 0.000000000
5  0.0462963 -0.07984724 -0.002808864 -0.05249134 -0.08189005 0.009015011
10 0.0000000  0.00000000  0.000000000  0.00000000  0.00000000 0.000000000

, , b_2_2

      d_y1_d_x1  d_y2_d_x1   d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1  -0.009041467 -0.1533759 -0.01958755 -0.016223782 0.2559044 0.02614788
5   0.000000000  0.0000000  0.00000000 -0.056197656 0.3527944 0.03255729
10  0.000000000  0.0000000  0.00000000 -0.003417298 0.2599553 0.02877260
     d_y1_d_x3 d_y2_d_x3 d_y3_d_x3  d_y1_d_x4 d_y2_d_x4  d_y3_d_x4
1  -0.04264367 0.3511302 0.0308864 0.01287859 0.3280487 0.02939871
5   0.00000000 0.0000000 0.0000000 0.00000000 0.0000000 0.00000000
10  0.00000000 0.0000000 0.0000000 0.00000000 0.0000000 0.00000000

, , b_2_3

       d_y1_d_x1  d_y2_d_x1    d_y3_d_x1    d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1   0.0096546928  0.1637784  0.020916046 -0.041456959 0.15234011 0.012522967
5  -0.0205975703 -0.0882414 -0.005633612  0.009305528 0.02999564 0.002908327
10  0.0002001207  0.2754689  0.008290742 -0.004083772 0.16642588 0.016099320
      d_y1_d_x3  d_y2_d_x3    d_y3_d_x3     d_y1_d_x4   d_y2_d_x4    d_y3_d_x4
1   0.029296749 -0.1191511 -0.006581496 -0.0137168055 -0.35020875 -0.031086245
5  -0.071041520  0.4504392  0.038775741  0.0317079696  0.05082601 -0.006528111
10  0.001849283 -0.1565991 -0.006183308  0.0002220446 -0.37872483 -0.022382096

, , b_2_4

       d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -3.855862e-03 -0.06540932 -0.008353388  0.016556955 -0.06084113 -0.005001385
5   2.707442e-02  0.11598866  0.007405086 -0.012231624 -0.03942768 -0.003822842
10 -6.072676e-05 -0.08359122 -0.002515831  0.001239224 -0.05050205 -0.004885350
       d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4 d_y2_d_x4  d_y3_d_x4
1  -0.0182381887  0.14911405  0.012800871 -0.0107503829 0.3958369 0.03862679
5   0.0387800903 -0.06539214 -0.002231548 -0.0844308096 0.3331941 0.04462662
10 -0.0006883383  0.08605894  0.006772360 -0.0004266743 0.2420390 0.02241604

, , b_3_0

       d_y1_d_x1   d_y2_d_x1  d_y3_d_x1    d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1  -0.1036330469 -0.01581883 -0.1692854  0.058505811 -0.008350353 0.03177489
5   0.0092022346  0.01949003  0.1833577 -0.062146477  0.007141051 0.02361125
10  0.0001787653  0.01146679  0.1239592 -0.004659593  0.009654283 0.15087598
      d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  -0.079640461  0.03338441 -0.01467715  0.0833833003  0.02056133 -0.0338396
5   0.117450494 -0.02679523 -0.10076384 -0.0389466237 -0.01978417 -0.1405098
10  0.001176836 -0.01007111 -0.23079316 -0.0002664535 -0.01217360 -0.2470912

, , b_3_1

       d_y1_d_x1  d_y2_d_x1 d_y3_d_x1   d_y1_d_x2   d_y2_d_x2  d_y3_d_x2
1  -1.490547e-01 0.01435670 0.2632494  0.00000000 0.000000000 0.00000000
5  -7.098636e-02 0.03269126 0.4007928 -0.06214648 0.007141051 0.02361125
10 -5.949463e-06 0.01493196 0.3108666  0.00000000 0.000000000 0.00000000
   d_y1_d_x3   d_y2_d_x3 d_y3_d_x3   d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  0.0000000  0.00000000  0.000000  0.00000000  0.00000000  0.0000000
5  0.1173284 -0.02685629 -0.100886 -0.03907985 -0.01985079 -0.1406431
10 0.0000000  0.00000000  0.000000  0.00000000  0.00000000  0.0000000

, , b_3_2

   d_y1_d_x1   d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1  -0.103633 -0.01581883 -0.1692854 -0.045421607 0.03017553 0.4325348
5   0.000000  0.00000000  0.0000000 -0.133132832 0.03983231 0.4244040
10  0.000000  0.00000000  0.0000000 -0.004844308 0.01311946 0.3377834
     d_y1_d_x3  d_y2_d_x3   d_y3_d_x3 d_y1_d_x4  d_y2_d_x4  d_y3_d_x4
1  -0.07964046 0.03338441 -0.01467715 0.0833833 0.02056133 -0.0338396
5   0.00000000 0.00000000  0.00000000 0.0000000 0.00000000  0.0000000
10  0.00000000 0.00000000  0.00000000 0.0000000 0.00000000  0.0000000

, , b_3_3

       d_y1_d_x1   d_y2_d_x1  d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1   0.1106618239  0.01689172  0.1807669 -0.062473892  0.008916705 -0.03392998
5  -0.0057517577 -0.01218203 -0.1146057  0.038843988 -0.004463437 -0.01475796
10  0.0002241385  0.01437723  0.1554218 -0.005842267  0.012104684  0.18917056
       d_y1_d_x3    d_y2_d_x3  d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1   0.0396520083 -0.005284993  0.4483888 -0.0890953977 -0.02282619  0.03606004
5  -0.1431397494  0.050005190  0.4643419  0.0254463117  0.01276756  0.08828493
10  0.0003926011 -0.009184429 -0.1029607 -0.0008881784 -0.01529332 -0.31001868

, , b_3_4

       d_y1_d_x1    d_y2_d_x1   d_y3_d_x1   d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -4.419579e-02 -0.006746165 -0.07219415  0.02495064 -0.003561127  0.01355085
5   7.560382e-03  0.016012636  0.15064319 -0.05105837  0.005866952  0.01939856
10 -6.801493e-05 -0.004362780 -0.04716287  0.00177284 -0.003673175 -0.05740394
       d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  -0.0338507000  0.015776269 -0.005373479 -0.009716834 0.041055716 0.4192121
5   0.0949684775 -0.022731816 -0.083633100 -0.105358860 0.015305170 0.2836864
10 -0.0002109424  0.003856637  0.088229424  0.000392601 0.008144765 0.2815428

, , R_1_2

      d_y1_d_x1     d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1   0.012302106 -0.4730857642 -0.022865221 -0.23681944 0.035356899  0.04842374
5  -0.389154438 -0.1346716768  0.006126323 -0.02640070 0.200346660  0.03805750
10 -0.002199324 -0.0001412116  0.001882921  0.03400172 0.006272141 -0.02126043
     d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4    d_y2_d_x4    d_y3_d_x4
1   0.18776647  0.457101024 -0.036581849 -0.002109424 9.633183e-01  0.018873791
5  -0.13611334 -0.301597636 -0.033173464  0.512834220 1.146860e-01 -0.070166095
10 -0.01127987 -0.001033895  0.009137135  0.007105427 3.885781e-05 -0.002531308

, , R_1_3

       d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1   0.6779988895 -0.0439634712 -0.7518035113 -0.15287721  0.012866382
5   0.1100880665 -0.0272114692 -0.1341660789  0.25360526  0.002158135
10 -0.0008353512  0.0001322236 -0.0007461053  0.02054856 -0.003285345
    d_y3_d_x2    d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4    d_y2_d_x4
1  0.39436273  0.215620577 0.0115907284 -0.516731102 -0.389049903 0.0893507490
5  0.25411486 -0.444211334 0.0164201985 -0.312128101 -0.033884007 0.0416999768
10 0.01486094 -0.004884981 0.0008895662 -0.004019007  0.001776357 0.0002720046
     d_y3_d_x4
1  0.451949589
5  0.175415238
10 0.001687539

, , R_2_3

       d_y1_d_x1  d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2  d_y3_d_x2
1  -0.0295668558 -0.0324746 -0.083808061  0.09014664 -0.03836515 -0.1240072
5   0.0509223599  0.1790779  0.041843222 -0.03551199  0.05245643 -0.1427688
10  0.0004814612  0.1066395 -0.004474384 -0.01049811  0.08873839  0.1265591
      d_y1_d_x3   d_y2_d_x3  d_y3_d_x3    d_y1_d_x4    d_y2_d_x4  d_y3_d_x4
1  -0.101010866  0.17555957  0.2012612  0.036270986  0.005906386  0.1701750
5   0.110778053 -0.19941826  0.2445377 -0.116795462 -0.320721227  0.2324363
10  0.002531308 -0.08062023 -0.2494227 -0.001598721 -0.097905017 -0.2189360

> print( drop( attr( margEffCondV, "jacobian" )[ 1, , ] ) )
                 b_1_0       b_1_1        b_1_2        b_1_3        b_1_4
d_y1_d_x1  0.284410308  0.43227229  0.284410308 -0.303700069  0.121290820
d_y2_d_x1  0.036593526 -0.01904979  0.036593526 -0.039075434  0.015605829
d_y3_d_x1  0.078006405 -0.08015547  0.078006405 -0.083297089  0.033266940
d_y1_d_x2 -0.227451818  0.00000000  0.147861986  0.242878443 -0.097000062
d_y2_d_x2  0.019380780  0.00000000 -0.055643316 -0.020695256  0.008265210
d_y3_d_x2 -0.023116338  0.00000000 -0.158161880  0.024684173 -0.009858291
d_y1_d_x3  0.278693735  0.00000000  0.278771450 -0.149844318  0.118992316
d_y2_d_x3 -0.067768013  0.00000000 -0.067768013  0.016887554 -0.028643754
d_y3_d_x3  0.013911094  0.00000000  0.013755663 -0.173727207  0.006039613
d_y1_d_x4 -0.233257857  0.00000000 -0.233302266  0.249089638  0.048380452
d_y2_d_x4 -0.068922645  0.00000000 -0.068922645  0.073052675 -0.084597932
d_y3_d_x4 -0.004041212  0.00000000 -0.003952394  0.003819167 -0.159582965
                 b_2_0        b_2_1        b_2_2        b_2_3        b_2_4
d_y1_d_x1 -0.009041467 -0.025265249 -0.009041467  0.009654693 -0.003855862
d_y2_d_x1 -0.153375874  0.102528544 -0.153375874  0.163778394 -0.065409323
d_y3_d_x1 -0.019587546  0.006560333 -0.019587546  0.020916046 -0.008353388
d_y1_d_x2  0.038823785  0.000000000 -0.016223782 -0.041456959  0.016556955
d_y2_d_x2 -0.142664100  0.000000000  0.255904418  0.152340108 -0.060841134
d_y3_d_x2 -0.011727560  0.000000000  0.026147879  0.012522967 -0.005001385
d_y1_d_x3 -0.042643666  0.000000000 -0.042643666  0.029296749 -0.018238189
d_y2_d_x3  0.351130236  0.000000000  0.351130236 -0.119151125  0.149114054
d_y3_d_x3  0.030886405  0.000000000  0.030886405 -0.006581496  0.012800871
d_y1_d_x4  0.012878587  0.000000000  0.012878587 -0.013716805 -0.010750383
d_y2_d_x4  0.328048699  0.000000000  0.328048699 -0.350208751  0.395836928
d_y3_d_x4  0.029398706  0.000000000  0.029398706 -0.031086245  0.038626785
                 b_3_0      b_3_1       b_3_2        b_3_3        b_3_4
d_y1_d_x1 -0.103633047 -0.1490547 -0.10363305  0.110661824 -0.044195787
d_y2_d_x1 -0.015818829  0.0143567 -0.01581883  0.016891720 -0.006746165
d_y3_d_x1 -0.169285366  0.2632494 -0.16928537  0.180766927 -0.072194152
d_y1_d_x2  0.058505811  0.0000000 -0.04542161 -0.062473892  0.024950635
d_y2_d_x2 -0.008350353  0.0000000  0.03017553  0.008916705 -0.003561127
d_y3_d_x2  0.031774889  0.0000000  0.43253479 -0.033929980  0.013550854
d_y1_d_x3 -0.079640461  0.0000000 -0.07964046  0.039652008 -0.033850700
d_y2_d_x3  0.033384406  0.0000000  0.03338441 -0.005284993  0.015776269
d_y3_d_x3 -0.014677148  0.0000000 -0.01467715  0.448388779 -0.005373479
d_y1_d_x4  0.083383300  0.0000000  0.08338330 -0.089095398 -0.009716834
d_y2_d_x4  0.020561330  0.0000000  0.02056133 -0.022826185  0.041055716
d_y3_d_x4 -0.033839598  0.0000000 -0.03383960  0.036060044  0.419212118
                 R_1_2       R_1_3        R_2_3
d_y1_d_x1  0.012302106  0.67799889 -0.029566856
d_y2_d_x1 -0.473085764 -0.04396347 -0.032474601
d_y3_d_x1 -0.022865221 -0.75180351 -0.083808061
d_y1_d_x2 -0.236819439 -0.15287721  0.090146639
d_y2_d_x2  0.035356899  0.01286638 -0.038365155
d_y3_d_x2  0.048423740  0.39436273 -0.124007224
d_y1_d_x3  0.187766469  0.21562058 -0.101010866
d_y2_d_x3  0.457101024  0.01159073  0.175559567
d_y3_d_x3 -0.036581849 -0.51673110  0.201261230
d_y1_d_x4 -0.002109424 -0.38904990  0.036270986
d_y2_d_x4  0.963318314  0.08935075  0.005906386
d_y3_d_x4  0.018873791  0.45194959  0.170174985
> summary( margEffCondV )
               Estimate Std. error z value Pr(> z)
1: d_y1_d_x1  0.4118196  0.9874701   0.417   0.677
1: d_y2_d_x1  0.1175542  0.5668409   0.207   0.836
1: d_y3_d_x1 -0.3603571  0.8747667  -0.412   0.680
1: d_y1_d_x2 -0.2293360  0.4933079  -0.465   0.642
1: d_y2_d_x2  0.2459294  0.3473869   0.708   0.479
1: d_y3_d_x2 -0.1258047  0.6244474  -0.201   0.840
1: d_y1_d_x3  0.1765116  0.5515244   0.320   0.749
1: d_y2_d_x3 -0.3517929  0.7319223  -0.481   0.631
1: d_y3_d_x3  0.2229842  0.7369417   0.303   0.762
1: d_y1_d_x4 -0.1468375  0.5903209  -0.249   0.804
1: d_y2_d_x4 -0.3287218  1.2064874  -0.272   0.785
1: d_y3_d_x4  0.6037347  0.6652847   0.907   0.364
2: d_y1_d_x1  0.4391801  0.5396814   0.814   0.416
2: d_y2_d_x1  0.2708273  0.5064146   0.535   0.593
2: d_y3_d_x1 -0.2615752  0.5086753  -0.514   0.607
2: d_y1_d_x2 -0.3205450  0.6169442  -0.520   0.603
2: d_y2_d_x2  0.2631544  0.4251005   0.619   0.536
2: d_y3_d_x2 -0.1630063  0.5399154  -0.302   0.763
2: d_y1_d_x3  0.3298530  0.9427690   0.350   0.726
2: d_y2_d_x3 -0.5053126  0.6063844  -0.833   0.405
2: d_y3_d_x3  0.2791236  0.6653886   0.419   0.675
2: d_y1_d_x4 -0.2238688  0.8085922  -0.277   0.782
2: d_y2_d_x4 -0.5675504  0.4995911  -1.136   0.256
2: d_y3_d_x4  0.4883268  0.4789600   1.020   0.308
3: d_y1_d_x1  0.0002023  0.0027799   0.073   0.942
3: d_y2_d_x1  0.2319696  0.5132733   0.452   0.651
3: d_y3_d_x1 -0.1301103  0.3728767  -0.349   0.727
3: d_y1_d_x2 -0.0057134  0.0544799  -0.105   0.916
3: d_y2_d_x2  0.1109910  0.3519614   0.315   0.752
3: d_y3_d_x2 -0.1661675  0.4411338  -0.377   0.706
3: d_y1_d_x3  0.0011362  0.0143156   0.079   0.937
3: d_y2_d_x3 -0.1491872  0.2997563  -0.498   0.619
3: d_y3_d_x3  0.1853440  0.3666375   0.506   0.613
3: d_y1_d_x4 -0.0006208  0.0085224  -0.073   0.942
3: d_y2_d_x4 -0.1992018  0.5506616  -0.362   0.718
3: d_y3_d_x4  0.1994459  0.5345175   0.373   0.709
> margEffCondVA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    vcov = diag( 18 ), returnJacobian = TRUE, algorithm = GenzBretz() )
> all.equal( margEffCondV, margEffCondVA )
[1] TRUE
> # now with Jacobian but without variance covariance matrix
> margEffCondJac <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    returnJacobian = TRUE, algorithm = GenzBretz() )
> all.equal( attr( margEffCondJac, "jacobian" ), attr( margEffCondV, "jacobian" ) )
[1] TRUE
> # now with mean values of marginal effects
> margEffCondM <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    vcov = diag( 18 ), addMean = TRUE, returnJacobian = TRUE,
+    algorithm = GenzBretz() )
> all.equal( margEffCondV, margEffCondM[ 1:3, ], check.attributes = FALSE )
[1] TRUE
> print( margEffCondM )
        d_y1_d_x1 d_y2_d_x1  d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1    0.4118196285 0.1175542 -0.3603571 -0.229336023 0.2459294 -0.1258047
2    0.4391801486 0.2708273 -0.2615752 -0.320544987 0.2631544 -0.1630063
3    0.0002023317 0.2319696 -0.1301103 -0.005713415 0.1109910 -0.1661675
mean 0.2837340363 0.2067837 -0.2506808 -0.185198142 0.2066916 -0.1516595
       d_y1_d_x3  d_y2_d_x3 d_y3_d_x3     d_y1_d_x4  d_y2_d_x4 d_y3_d_x4
1    0.176511552 -0.3517929 0.2229842 -0.1468374650 -0.3287218 0.6037347
2    0.329853048 -0.5053126 0.2791236 -0.2238687970 -0.5675504 0.4883268
3    0.001136227 -0.1491872 0.1853440 -0.0006208183 -0.1992018 0.1994459
mean 0.169166943 -0.3354309 0.2291506 -0.1237756934 -0.3651580 0.4305025
> all.equal( attr( margEffCondV, "vcov" ), 
+    attr( margEffCondM, "vcov" )[ 1:3, , ] )
[1] TRUE
> print( attr( margEffCondM, "vcov" ) )
, , d_y1_d_x1

        d_y1_d_x1     d_y2_d_x1     d_y3_d_x1     d_y1_d_x2     d_y2_d_x2
1    9.750971e-01 -0.0030037423 -4.490045e-01 -0.2274334729  0.0068307492
5    2.912560e-01  0.0387204653 -5.823824e-02  0.0274927901 -0.0755630122
10   7.727996e-06  0.0001515647  5.378418e-05 -0.0001392449  0.0001042601
mean 1.626491e-01  0.0104253263 -1.058717e-01  0.0523851888 -0.0162192448
        d_y3_d_x2     d_y1_d_x3     d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1    0.1589283485  3.934913e-01 -0.0551360998 -0.2431539207 -4.943851e-01
5    0.0074691017  5.559145e-02  0.0922666787 -0.0209438968 -2.593822e-01
10   0.0002038302  3.956835e-05 -0.0001169437 -0.0002206918 -2.316957e-05
mean 0.0252988980 -5.399636e-02 -0.0001482806 -0.0383790235 -5.100716e-02
         d_y2_d_x4    d_y3_d_x4
1    -0.0188374345  0.270328853
5    -0.0399301204  0.081681433
10   -0.0001923111 -0.000241325
mean -0.0379985139  0.058420857

, , d_y2_d_x1

         d_y1_d_x1 d_y2_d_x1  d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1    -0.0030037423 0.3213086 0.08092957  0.089143004 -0.005045259 -0.05181404
5     0.0387204653 0.2564557 0.05195901 -0.032248624 -0.049598653 -0.03718387
10    0.0001515647 0.2634495 0.01979479 -0.003199861  0.088988794  0.02585722
mean  0.0104253263 0.1517178 0.02393939  0.014984015 -0.020431173 -0.01708688
        d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4
1    -0.044427031 -0.36675497  0.03806791 -0.0186986576 -0.65426181
5     0.111593955 -0.09073310  0.03541485 -0.1448499710 -0.08451449
10    0.001031063 -0.10891460 -0.03738140 -0.0002466476 -0.20173639
mean  0.005435604 -0.02050368  0.01837385 -0.0417118839 -0.13140706
         d_y3_d_x4
1    -5.504100e-02
5     5.376516e-02
10   -4.389582e-02
mean -2.400034e-05

, , d_y3_d_x1

         d_y1_d_x1  d_y2_d_x1 d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1    -4.490045e-01 0.08092957 0.7652168  0.066369491 -0.008445285 -0.38941393
5    -5.823824e-02 0.05195901 0.2587506 -0.104236832  0.007911417 -0.01687398
10    5.378418e-05 0.01979479 0.1390371 -0.001494665  0.005243041  0.05039549
mean -1.058717e-01 0.02393939 0.2095090 -0.015516234 -0.004223757 -0.08103704
         d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4    d_y2_d_x4
1    -0.0589949274 -0.077701852  0.47423595  0.189627098 -0.146882467
5     0.2076679660 -0.049802098 -0.08350722 -0.071267404 -0.028543080
10    0.0002019259 -0.005508186 -0.04781628 -0.000167342 -0.009577636
mean  0.0408929985 -0.007395746  0.08712130  0.027720262 -0.021115011
       d_y3_d_x4
1    -0.37513506
5    -0.06042803
10   -0.09148118
mean -0.08589753

, , d_y1_d_x2

         d_y1_d_x1    d_y2_d_x1    d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1    -0.2274334729  0.089143004  0.066369491 0.243352635 -0.051781028
5     0.0274927901 -0.032248624 -0.104236832 0.380620095 -0.066218734
10   -0.0001392449 -0.003199861 -0.001494665 0.002968057 -0.003344902
mean  0.0523851888  0.014984015 -0.015516234 0.058997209 -0.024817479
        d_y3_d_x2     d_y1_d_x3    d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1    -0.110923427 -0.1634860393 -0.065417875  0.034736249  0.1447065273
5    -0.072756702 -0.3656135275  0.064841504  0.004927934  0.1635478254
10   -0.006398513 -0.0007135702  0.002481104  0.004964602  0.0004091202
mean -0.039419377  0.0138966627 -0.012348059 -0.013100110 -0.0272599289
        d_y2_d_x4    d_y3_d_x4
1    -0.178619507 -0.031123121
5     0.005572462  0.023442576
10    0.004025707  0.005855566
mean -0.031269333  0.009408115

, , d_y2_d_x2

         d_y1_d_x1    d_y2_d_x1    d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1     0.0068307492 -0.005045259 -0.008445285 -0.051781028 0.1206777 0.04231634
5    -0.0755630122 -0.049598653  0.007911417 -0.066218734 0.1807104 0.04028227
10    0.0001042601  0.088988794  0.005243041 -0.003344902 0.1238768 0.03178731
mean -0.0162192448 -0.020431173 -0.004223757 -0.024817479 0.1107039 0.02655881
         d_y1_d_x3   d_y2_d_x3    d_y3_d_x3    d_y1_d_x4    d_y2_d_x4
1     0.0067421558  0.02461029 -0.007100758 -0.001683054 -0.004915436
5    -0.0055783709 -0.05095735 -0.002522731  0.088168991  0.003655392
10    0.0006847522 -0.06785055 -0.029702141 -0.000182194 -0.124354974
mean -0.0096692049  0.04220950  0.004248509  0.019465517  0.015358627
        d_y3_d_x4
1    -0.006969484
5    -0.003065135
10   -0.033881256
mean -0.001091776

, , d_y3_d_x2

        d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1    0.1589283485 -0.05181404 -0.38941393 -0.110923427 0.04231634 0.3899346
5    0.0074691017 -0.03718387 -0.01687398 -0.072756702 0.04028227 0.2915086
10   0.0002038302  0.02585722  0.05039549 -0.006398513 0.03178731 0.1945990
mean 0.0252988980 -0.01708688 -0.08103704 -0.039419377 0.02655881 0.2294239
        d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1     0.012307140  0.03663825 -0.25915624 -0.0683888638  0.10552589  0.14901568
5    -0.068977037  0.01307835 -0.14270346 -0.0175648413  0.06314878  0.01104703
10    0.000936581 -0.01954074 -0.09169794 -0.0006430461 -0.02874204 -0.14039647
mean -0.033447591  0.01539275 -0.06542044 -0.0097387319  0.02924573  0.02451390

, , d_y1_d_x3

         d_y1_d_x1    d_y2_d_x1     d_y3_d_x1     d_y1_d_x2     d_y2_d_x2
1     3.934913e-01 -0.044427031 -0.0589949274 -0.1634860393  0.0067421558
5     5.559145e-02  0.111593955  0.2076679660 -0.3656135275 -0.0055783709
10    3.956835e-05  0.001031063  0.0002019259 -0.0007135702  0.0006847522
mean -5.399636e-02  0.005435604  0.0408929985  0.0138966627 -0.0096692049
        d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1     0.012307140 0.3041791387 -0.0153415475 -0.086915250 -0.2673497162
5    -0.068977037 0.8888133639 -0.1312317856 -0.084254369 -0.4883874931
10    0.000936581 0.0002049371 -0.0007564279 -0.001119009 -0.0001167076
mean -0.033447591 0.0510464313 -0.0100229728 -0.007649437 -0.0121552766
        d_y2_d_x4    d_y3_d_x4
1     0.089085500  0.050521158
5    -0.040612577 -0.013889723
10   -0.001380156 -0.001070066
mean  0.009411025 -0.004199630

, , d_y2_d_x3

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2
1    -0.0551360998 -0.36675497 -0.077701852 -0.065417875  0.02461029
5     0.0922666787 -0.09073310 -0.049802098  0.064841504 -0.05095735
10   -0.0001169437 -0.10891460 -0.005508186  0.002481104 -0.06785055
mean -0.0001482806 -0.02050368 -0.007395746 -0.012348059  0.04220950
       d_y3_d_x2     d_y1_d_x3  d_y2_d_x3   d_y3_d_x3     d_y1_d_x4  d_y2_d_x4
1     0.03663825 -0.0153415475 0.53571025 0.028589501  0.0502931362 0.78867418
5     0.01307835 -0.1312317856 0.36770203 0.026887572 -0.0435083937 0.04107823
10   -0.01954074 -0.0007564279 0.08985383 0.029394250  0.0002325527 0.15666266
mean  0.01539275 -0.0100229728 0.02671574 0.001916145  0.0111372431 0.04201681
         d_y3_d_x4
1     8.319167e-02
5    -3.027008e-02
10    3.361876e-02
mean -9.363888e-05

, , d_y3_d_x3

         d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1    -0.2431539207  0.03806791  0.47423595  0.034736249 -0.007100758
5    -0.0209438968  0.03541485 -0.08350722  0.004927934 -0.002522731
10   -0.0002206918 -0.03738140 -0.04781628  0.004964602 -0.029702141
mean -0.0383790235  0.01837385  0.08712130 -0.013100110  0.004248509
       d_y3_d_x2    d_y1_d_x3   d_y2_d_x3 d_y3_d_x3    d_y1_d_x4   d_y2_d_x4
1    -0.25915624 -0.086915250 0.028589501 0.5430830 0.1173791359 -0.07875333
5    -0.14270346 -0.084254369 0.026887572 0.4427421 0.0917414656 -0.09290091
10   -0.09169794 -0.001119009 0.029394250 0.1344230 0.0006774422  0.03900411
mean -0.06542044 -0.007649437 0.001916145 0.1826420 0.0293832680 -0.03434150
       d_y3_d_x4
1    -0.18429040
5     0.03875653
10    0.16897835
mean -0.05563589

, , d_y1_d_x4

         d_y1_d_x1     d_y2_d_x1    d_y3_d_x1     d_y1_d_x2    d_y2_d_x2
1    -4.943851e-01 -0.0186986576  0.189627098  0.1447065273 -0.001683054
5    -2.593822e-01 -0.1448499710 -0.071267404  0.1635478254  0.088168991
10   -2.316957e-05 -0.0002466476 -0.000167342  0.0004091202 -0.000182194
mean -5.100716e-02 -0.0417118839  0.027720262 -0.0272599289  0.019465517
         d_y3_d_x2     d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1    -0.0683888638 -0.2673497162  0.0502931362 0.1173791359 3.484787e-01
5    -0.0175648413 -0.4883874931 -0.0435083937 0.0917414656 6.538214e-01
10   -0.0006430461 -0.0001167076  0.0002325527 0.0006774422 7.263175e-05
mean -0.0097387319 -0.0121552766  0.0111372431 0.0293832680 9.680299e-02
        d_y2_d_x4     d_y3_d_x4
1    0.0237422937 -0.1867641107
5    0.0431861770 -0.1430103473
10   0.0002043577  0.0007809695
mean 0.0430877156 -0.0630216808

, , d_y2_d_x4

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1    -0.0188374345 -0.65426181 -0.146882467 -0.178619507 -0.004915436
5    -0.0399301204 -0.08451449 -0.028543080  0.005572462  0.003655392
10   -0.0001923111 -0.20173639 -0.009577636  0.004025707 -0.124354974
mean -0.0379985139 -0.13140706 -0.021115011 -0.031269333  0.015358627
       d_y3_d_x2    d_y1_d_x3  d_y2_d_x3   d_y3_d_x3    d_y1_d_x4 d_y2_d_x4
1     0.10552589  0.089085500 0.78867418 -0.07875333 0.0237422937 1.4556119
5     0.06314878 -0.040612577 0.04107823 -0.09290091 0.0431861770 0.2495913
10   -0.02874204 -0.001380156 0.15666266  0.03900411 0.0002043577 0.3032282
mean  0.02924573  0.009411025 0.04201681 -0.03434150 0.0430877156 0.3238106
       d_y3_d_x4
1     0.13436032
5    -0.04532905
10    0.05086440
mean  0.02377482

, , d_y3_d_x4

        d_y1_d_x1     d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1     0.270328853 -5.504100e-02 -0.37513506 -0.031123121 -0.006969484
5     0.081681433  5.376516e-02 -0.06042803  0.023442576 -0.003065135
10   -0.000241325 -4.389582e-02 -0.09148118  0.005855566 -0.033881256
mean  0.058420857 -2.400034e-05 -0.08589753  0.009408115 -0.001091776
       d_y3_d_x2    d_y1_d_x3     d_y2_d_x3   d_y3_d_x3     d_y1_d_x4
1     0.14901568  0.050521158  8.319167e-02 -0.18429040 -0.1867641107
5     0.01104703 -0.013889723 -3.027008e-02  0.03875653 -0.1430103473
10   -0.14039647 -0.001070066  3.361876e-02  0.16897835  0.0007809695
mean  0.02451390 -0.004199630 -9.363888e-05 -0.05563589 -0.0630216808
       d_y2_d_x4 d_y3_d_x4
1     0.13436032 0.4426038
5    -0.04532905 0.2294027
10    0.05086440 0.2857090
mean  0.02377482 0.1907257

> print( drop( attr( margEffCondM, "vcov" )[ 4, , ] ) )
              d_y1_d_x1     d_y2_d_x1    d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
d_y1_d_x1  0.1626490560  1.042533e-02 -0.105871709  0.052385189 -0.016219245
d_y2_d_x1  0.0104253263  1.517178e-01  0.023939392  0.014984015 -0.020431173
d_y3_d_x1 -0.1058717093  2.393939e-02  0.209509037 -0.015516234 -0.004223757
d_y1_d_x2  0.0523851888  1.498401e-02 -0.015516234  0.058997209 -0.024817479
d_y2_d_x2 -0.0162192448 -2.043117e-02 -0.004223757 -0.024817479  0.110703946
d_y3_d_x2  0.0252988980 -1.708688e-02 -0.081037045 -0.039419377  0.026558814
d_y1_d_x3 -0.0539963555  5.435604e-03  0.040892998  0.013896663 -0.009669205
d_y2_d_x3 -0.0001482806 -2.050368e-02 -0.007395746 -0.012348059  0.042209499
d_y3_d_x3 -0.0383790235  1.837385e-02  0.087121303 -0.013100110  0.004248509
d_y1_d_x4 -0.0510071578 -4.171188e-02  0.027720262 -0.027259929  0.019465517
d_y2_d_x4 -0.0379985139 -1.314071e-01 -0.021115011 -0.031269333  0.015358627
d_y3_d_x4  0.0584208567 -2.400034e-05 -0.085897525  0.009408115 -0.001091776
             d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
d_y1_d_x1  0.025298898 -0.053996355 -1.482806e-04 -0.038379023 -0.051007158
d_y2_d_x1 -0.017086875  0.005435604 -2.050368e-02  0.018373848 -0.041711884
d_y3_d_x1 -0.081037045  0.040892998 -7.395746e-03  0.087121303  0.027720262
d_y1_d_x2 -0.039419377  0.013896663 -1.234806e-02 -0.013100110 -0.027259929
d_y2_d_x2  0.026558814 -0.009669205  4.220950e-02  0.004248509  0.019465517
d_y3_d_x2  0.229423945 -0.033447591  1.539275e-02 -0.065420443 -0.009738732
d_y1_d_x3 -0.033447591  0.051046431 -1.002297e-02 -0.007649437 -0.012155277
d_y2_d_x3  0.015392751 -0.010022973  2.671574e-02  0.001916145  0.011137243
d_y3_d_x3 -0.065420443 -0.007649437  1.916145e-03  0.182641990  0.029383268
d_y1_d_x4 -0.009738732 -0.012155277  1.113724e-02  0.029383268  0.096802988
d_y2_d_x4  0.029245729  0.009411025  4.201681e-02 -0.034341495  0.043087716
d_y3_d_x4  0.024513901 -0.004199630 -9.363888e-05 -0.055635892 -0.063021681
             d_y2_d_x4     d_y3_d_x4
d_y1_d_x1 -0.037998514  5.842086e-02
d_y2_d_x1 -0.131407058 -2.400034e-05
d_y3_d_x1 -0.021115011 -8.589753e-02
d_y1_d_x2 -0.031269333  9.408115e-03
d_y2_d_x2  0.015358627 -1.091776e-03
d_y3_d_x2  0.029245729  2.451390e-02
d_y1_d_x3  0.009411025 -4.199630e-03
d_y2_d_x3  0.042016814 -9.363888e-05
d_y3_d_x3 -0.034341495 -5.563589e-02
d_y1_d_x4  0.043087716 -6.302168e-02
d_y2_d_x4  0.323810632  2.377482e-02
d_y3_d_x4  0.023774823  1.907257e-01
> all.equal( attr( margEffCondV, "jacobian" ), 
+    attr( margEffCondM, "jacobian" )[ 1:3, , ] )
[1] TRUE
> print( attr( margEffCondM, "jacobian" ) )
, , b_1_0

         d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1     0.2844103081  0.0365935258  0.0780064050 -0.22745182  0.019380780
5    -0.1562244504 -0.0003601467 -0.0126554978  0.17568006 -0.017225469
10   -0.0008151563  0.0002331714  0.0007906753  0.01741561 -0.004668669
mean  0.0424569005  0.0121555168  0.0220471942 -0.01145205 -0.000837786
       d_y3_d_x2    d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4
1    -0.02311634  0.278693735 -0.067768013 0.013911094 -0.233257857
5    -0.04385058 -0.365474317  0.050365268 0.088007379  0.241984210
10   -0.01341462 -0.004107825  0.001389167 0.004463097  0.002042810
mean -0.02679385 -0.030296136 -0.005337860 0.035460523  0.003589721
         d_y2_d_x4     d_y3_d_x4
1    -6.892265e-02 -0.0040412118
5    -1.525446e-02 -0.0153210777
10   -3.885781e-05 -0.0009769963
mean -2.807199e-02 -0.0067797619

, , b_1_1

        d_y1_d_x1     d_y2_d_x1     d_y3_d_x1  d_y1_d_x2    d_y2_d_x2
1    4.322723e-01 -1.904979e-02 -8.015547e-02 0.00000000  0.000000000
5    2.559760e-01 -4.309406e-02 -8.364006e-02 0.17568006 -0.017225469
10   4.235501e-06 -6.254719e-06 -2.028966e-05 0.00000000  0.000000000
mean 2.294175e-01 -2.071670e-02 -5.460527e-02 0.05856002 -0.005741823
       d_y3_d_x2  d_y1_d_x3  d_y2_d_x3  d_y3_d_x3  d_y1_d_x4    d_y2_d_x4
1     0.00000000  0.0000000 0.00000000 0.00000000 0.00000000  0.000000000
5    -0.04385058 -0.3656297 0.05028755 0.08800738 0.24207303 -0.015210055
10    0.00000000  0.0000000 0.00000000 0.00000000 0.00000000  0.000000000
mean -0.01461686 -0.1218766 0.01676252 0.02933579 0.08069101 -0.005070018
        d_y3_d_x4
1     0.000000000
5    -0.015321078
10    0.000000000
mean -0.005107026

, , b_1_2

      d_y1_d_x1  d_y2_d_x1  d_y3_d_x1 d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1    0.28441031 0.03659353 0.07800641  0.147862 -0.055643316 -0.15816188
5    0.00000000 0.00000000 0.00000000  0.431656 -0.060319529 -0.12749064
10   0.00000000 0.00000000 0.00000000  0.018235 -0.004908095 -0.01422558
mean 0.09480344 0.01219784 0.02600214  0.199251 -0.040290314 -0.09995937
      d_y1_d_x3   d_y2_d_x3   d_y3_d_x3   d_y1_d_x4   d_y2_d_x4    d_y3_d_x4
1    0.27877145 -0.06776801 0.013755663 -0.23330227 -0.06892265 -0.003952394
5    0.00000000  0.00000000 0.000000000  0.00000000  0.00000000  0.000000000
10   0.00000000  0.00000000 0.000000000  0.00000000  0.00000000  0.000000000
mean 0.09292382 -0.02258934 0.004585221 -0.07776742 -0.02297422 -0.001317465

, , b_1_3

        d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1    -0.303700069 -0.0390754343 -0.0832970886  0.24287844 -0.020695256
5     0.097646416  0.0002251057  0.0079101828 -0.10980693  0.010766595
10   -0.001022055  0.0002923537  0.0009913604  0.02183595 -0.005853647
mean -0.069025236 -0.0128526583 -0.0247985151  0.05163582 -0.005260770
       d_y3_d_x2    d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1     0.02468417 -0.149844318  0.016887554 -0.173727207  0.249089638
5     0.02740834  0.484715209 -0.074546679 -0.138729325 -0.151567647
10   -0.01681944 -0.004587394  0.001521665  0.004795661  0.003241851
mean  0.01175769  0.110094499 -0.018712486 -0.102553623  0.033587947
         d_y2_d_x4     d_y3_d_x4
1     7.305268e-02  0.0038191672
5     9.370282e-03  0.0091482377
10   -1.665335e-05 -0.0006661338
mean  2.746877e-02  0.0041004237

, , b_1_4

         d_y1_d_x1     d_y2_d_x1     d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1     0.1212908204  1.560583e-02  0.0332669405 -0.097000062  0.008265210
5    -0.1283510529 -2.958896e-04 -0.0103975173  0.144335412 -0.014152120
10    0.0003101437 -8.871495e-05 -0.0003008287 -0.006626135  0.001776293
mean -0.0022500296  5.073742e-03  0.0075228648  0.013569738 -0.001370206
        d_y3_d_x2   d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1    -0.009858291  0.11899232 -0.0286437540  0.006039613 4.838045e-02
5    -0.036026809 -0.30095926  0.0412836432  0.072242212 4.554608e-01
10    0.005103872  0.00184297 -0.0005273559 -0.001398881 2.003137e-05
mean -0.013593743 -0.06004132  0.0040375111  0.025627648 1.679538e-01
         d_y2_d_x4     d_y3_d_x4
1    -0.0845979325 -1.595830e-01
5    -0.0554175360 -9.558606e-02
10   -0.0002172217 -1.160433e-05
mean -0.0467442301 -8.506021e-02

, , b_2_0

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2
1    -0.0090414667 -0.15337587 -0.019587546  0.038823785 -0.14266410
5     0.0329540419  0.14117738  0.009013214 -0.014887909 -0.04799001
10    0.0001596092  0.21970457  0.006612413 -0.003257078  0.13273560
mean  0.0080240615  0.06916869 -0.001320640  0.006892933 -0.01930617
        d_y3_d_x2     d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1    -0.011727560 -0.0426436664  0.35113024  0.030886405  0.0128785871
5    -0.004653031  0.0463296068 -0.07983059 -0.002808864 -0.0527133892
10    0.012840268  0.0007993606 -0.22631341 -0.018218760 -0.0007105427
mean -0.001180108  0.0014951003  0.01499541  0.003286260 -0.0135151150
       d_y2_d_x4    d_y3_d_x4
1     0.32804870  0.029398706
5    -0.08200107  0.009015011
10   -0.30195846 -0.018163249
mean -0.01863694  0.006750156

, , b_2_1

         d_y1_d_x1 d_y2_d_x1   d_y3_d_x1    d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1    -2.526525e-02 0.1025285 0.006560333  0.000000000  0.00000000  0.000000000
5    -4.130975e-02 0.4007844 0.037210326 -0.014887909 -0.04799001 -0.004653031
10   -6.115108e-07 0.3469243 0.022544747  0.000000000  0.00000000  0.000000000
mean -2.219187e-02 0.2834124 0.022105135 -0.004962636 -0.01599667 -0.001551010
     d_y1_d_x3   d_y2_d_x3     d_y3_d_x3   d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1    0.0000000  0.00000000  0.0000000000  0.00000000  0.00000000 0.000000000
5    0.0462963 -0.07984724 -0.0028088643 -0.05249134 -0.08189005 0.009015011
10   0.0000000  0.00000000  0.0000000000  0.00000000  0.00000000 0.000000000
mean 0.0154321 -0.02661575 -0.0009362881 -0.01749711 -0.02729668 0.003005004

, , b_2_2

        d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1    -0.009041467 -0.15337587 -0.019587546 -0.016223782 0.2559044 0.02614788
5     0.000000000  0.00000000  0.000000000 -0.056197656 0.3527944 0.03255729
10    0.000000000  0.00000000  0.000000000 -0.003417298 0.2599553 0.02877260
mean -0.003013822 -0.05112529 -0.006529182 -0.025279579 0.2895514 0.02915926
       d_y1_d_x3 d_y2_d_x3  d_y3_d_x3   d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1    -0.04264367 0.3511302 0.03088640 0.012878587 0.3280487 0.029398706
5     0.00000000 0.0000000 0.00000000 0.000000000 0.0000000 0.000000000
10    0.00000000 0.0000000 0.00000000 0.000000000 0.0000000 0.000000000
mean -0.01421456 0.1170434 0.01029547 0.004292862 0.1093496 0.009799569

, , b_2_3

         d_y1_d_x1  d_y2_d_x1    d_y3_d_x1    d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1     0.0096546928  0.1637784  0.020916046 -0.041456959 0.15234011 0.012522967
5    -0.0205975703 -0.0882414 -0.005633612  0.009305528 0.02999564 0.002908327
10    0.0002001207  0.2754689  0.008290742 -0.004083772 0.16642588 0.016099320
mean -0.0035809190  0.1170020  0.007857725 -0.012078401 0.11625388 0.010510205
        d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4   d_y2_d_x4
1     0.029296749 -0.11915112 -0.006581496 -0.0137168055 -0.35020875
5    -0.071041520  0.45043917  0.038775741  0.0317079696  0.05082601
10    0.001849283 -0.15659907 -0.006183308  0.0002220446 -0.37872483
mean -0.013298496  0.05822966  0.008670312  0.0060710696 -0.22603586
        d_y3_d_x4
1    -0.031086245
5    -0.006528111
10   -0.022382096
mean -0.019998817

, , b_2_4

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2
1    -3.855862e-03 -0.06540932 -0.008353388  0.016556955 -0.06084113
5     2.707442e-02  0.11598866  0.007405086 -0.012231624 -0.03942768
10   -6.072676e-05 -0.08359122 -0.002515831  0.001239224 -0.05050205
mean  7.719276e-03 -0.01100396 -0.001154711  0.001854851 -0.05025696
        d_y3_d_x2     d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1    -0.005001385 -0.0182381887  0.14911405  0.012800871 -0.0107503829
5    -0.003822842  0.0387800903 -0.06539214 -0.002231548 -0.0844308096
10   -0.004885350 -0.0006883383  0.08605894  0.006772360 -0.0004266743
mean -0.004569859  0.0066178544  0.05659362  0.005780561 -0.0318692889
     d_y2_d_x4  d_y3_d_x4
1    0.3958369 0.03862679
5    0.3331941 0.04462662
10   0.2420390 0.02241604
mean 0.3236900 0.03522315

, , b_3_0

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1    -0.1036330469 -0.015818829 -0.16928537  0.058505811 -0.008350353
5     0.0092022346  0.019490025  0.18335766 -0.062146477  0.007141051
10    0.0001787653  0.011466788  0.12395916 -0.004659593  0.009654283
mean -0.0314173490  0.005045995  0.04601049 -0.002766753  0.002814993
      d_y3_d_x2    d_y1_d_x3    d_y2_d_x3   d_y3_d_x3     d_y1_d_x4
1    0.03177489 -0.079640461  0.033384406 -0.01467715  0.0833833003
5    0.02361125  0.117450494 -0.026795233 -0.10076384 -0.0389466237
10   0.15087598  0.001176836 -0.010071111 -0.23079316 -0.0002664535
mean 0.06875404  0.012995623 -0.001160646 -0.11541138  0.0147234077
        d_y2_d_x4  d_y3_d_x4
1     0.020561330 -0.0338396
5    -0.019784174 -0.1405098
10   -0.012173595 -0.2470912
mean -0.003798813 -0.1404802

, , b_3_1

         d_y1_d_x1  d_y2_d_x1 d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1    -1.490547e-01 0.01435670 0.2632494  0.00000000 0.000000000 0.000000000
5    -7.098636e-02 0.03269126 0.4007928 -0.06214648 0.007141051 0.023611252
10   -5.949463e-06 0.01493196 0.3108666  0.00000000 0.000000000 0.000000000
mean -7.334899e-02 0.02065998 0.3249696 -0.02071549 0.002380350 0.007870417
      d_y1_d_x3    d_y2_d_x3   d_y3_d_x3   d_y1_d_x4    d_y2_d_x4   d_y3_d_x4
1    0.00000000  0.000000000  0.00000000  0.00000000  0.000000000  0.00000000
5    0.11732837 -0.026856295 -0.10088597 -0.03907985 -0.019850788 -0.14064305
10   0.00000000  0.000000000  0.00000000  0.00000000  0.000000000  0.00000000
mean 0.03910946 -0.008952098 -0.03362866 -0.01302662 -0.006616929 -0.04688102

, , b_3_2

       d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1    -0.10363305 -0.015818829 -0.16928537 -0.045421607 0.03017553 0.4325348
5     0.00000000  0.000000000  0.00000000 -0.133132832 0.03983231 0.4244040
10    0.00000000  0.000000000  0.00000000 -0.004844308 0.01311946 0.3377834
mean -0.03454435 -0.005272943 -0.05642846 -0.061132915 0.02770910 0.3982407
       d_y1_d_x3  d_y2_d_x3    d_y3_d_x3  d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1    -0.07964046 0.03338441 -0.014677148 0.08338330 0.020561330 -0.03383960
5     0.00000000 0.00000000  0.000000000 0.00000000 0.000000000  0.00000000
10    0.00000000 0.00000000  0.000000000 0.00000000 0.000000000  0.00000000
mean -0.02654682 0.01112814 -0.004892383 0.02779443 0.006853777 -0.01127987

, , b_3_3

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1     0.1106618239  0.016891720  0.18076693 -0.062473892  0.008916705
5    -0.0057517577 -0.012182031 -0.11460574  0.038843988 -0.004463437
10    0.0002241385  0.014377230  0.15542185 -0.005842267  0.012104684
mean  0.0350447349  0.006362306  0.07386101 -0.009824057  0.005519317
       d_y3_d_x2     d_y1_d_x3    d_y2_d_x3  d_y3_d_x3     d_y1_d_x4
1    -0.03392998  0.0396520083 -0.005284993  0.4483888 -0.0890953977
5    -0.01475796 -0.1431397494  0.050005190  0.4643419  0.0254463117
10    0.18917056  0.0003926011 -0.009184429 -0.1029607 -0.0008881784
mean  0.04682754 -0.0343650467  0.011845256  0.2699233 -0.0215124215
        d_y2_d_x4   d_y3_d_x4
1    -0.022826185  0.03606004
5     0.012767565  0.08828493
10   -0.015293322 -0.31001868
mean -0.008450648 -0.06189123

, , b_3_4

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
1    -4.419579e-02 -0.006746165 -0.07219415  0.024950635 -0.0035611268
5     7.560382e-03  0.016012636  0.15064319 -0.051058369  0.0058669520
10   -6.801493e-05 -0.004362780 -0.04716287  0.001772840 -0.0036731747
mean -1.223447e-02  0.001634564  0.01042872 -0.008111631 -0.0004557832
        d_y3_d_x2     d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1     0.013550854 -0.0338507000  0.015776269 -0.005373479 -0.009716834
5     0.019398558  0.0949684775 -0.022731816 -0.083633100 -0.105358860
10   -0.057403936 -0.0002109424  0.003856637  0.088229424  0.000392601
mean -0.008151508  0.0203022784 -0.001032970 -0.000259052 -0.038227698
       d_y2_d_x4 d_y3_d_x4
1    0.041055716 0.4192121
5    0.015305170 0.2836864
10   0.008144765 0.2815428
mean 0.021501883 0.3281471

, , R_1_2

        d_y1_d_x1     d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2
1     0.012302106 -0.4730857642 -0.022865221 -0.23681944 0.035356899
5    -0.389154438 -0.1346716768  0.006126323 -0.02640070 0.200346660
10   -0.002199324 -0.0001412116  0.001882921  0.03400172 0.006272141
mean -0.126350552 -0.2026328842 -0.004951992 -0.07640614 0.080658567
       d_y3_d_x2   d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1     0.04842374  0.18776647  0.457101024 -0.036581849 -0.002109424
5     0.03805750 -0.13611334 -0.301597636 -0.033173464  0.512834220
10   -0.02126043 -0.01127987 -0.001033895  0.009137135  0.007105427
mean  0.02174027  0.01345775  0.051489831 -0.020206059  0.172610074
        d_y2_d_x4    d_y3_d_x4
1    9.633183e-01  0.018873791
5    1.146860e-01 -0.070166095
10   3.885781e-05 -0.002531308
mean 3.593477e-01 -0.017941204

, , R_1_3

         d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1     0.6779988895 -0.0439634712 -0.7518035113 -0.15287721  0.012866382
5     0.1100880665 -0.0272114692 -0.1341660789  0.25360526  0.002158135
10   -0.0008353512  0.0001322236 -0.0007461053  0.02054856 -0.003285345
mean  0.2624172016 -0.0236809056 -0.2955718985  0.04042553  0.003913057
      d_y3_d_x2    d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1    0.39436273  0.215620577 0.0115907284 -0.516731102 -0.389049903
5    0.25411486 -0.444211334 0.0164201985 -0.312128101 -0.033884007
10   0.01486094 -0.004884981 0.0008895662 -0.004019007  0.001776357
mean 0.22111284 -0.077825246 0.0096334977 -0.277626070 -0.140385851
        d_y2_d_x4   d_y3_d_x4
1    0.0893507490 0.451949589
5    0.0416999768 0.175415238
10   0.0002720046 0.001687539
mean 0.0437742435 0.209684122

, , R_2_3

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1    -0.0295668558 -0.03247460 -0.083808061  0.09014664 -0.03836515 -0.12400722
5     0.0509223599  0.17907793  0.041843222 -0.03551199  0.05245643 -0.14276885
10    0.0004814612  0.10663947 -0.004474384 -0.01049811  0.08873839  0.12655913
mean  0.0072789884  0.08441427 -0.015479741  0.01471218  0.03427656 -0.04673898
        d_y1_d_x3   d_y2_d_x3   d_y3_d_x3    d_y1_d_x4    d_y2_d_x4  d_y3_d_x4
1    -0.101010866  0.17555957  0.20126123  0.036270986  0.005906386  0.1701750
5     0.110778053 -0.19941826  0.24453772 -0.116795462 -0.320721227  0.2324363
10    0.002531308 -0.08062023 -0.24942270 -0.001598721 -0.097905017 -0.2189360
mean  0.004099499 -0.03482631  0.06545875 -0.027374399 -0.137573286  0.0612251

> print( drop( attr( margEffCondM, "jacobian" )[ 4, , ] ) )
                 b_1_0        b_1_1        b_1_2        b_1_3        b_1_4
d_y1_d_x1  0.042456900  0.229417496  0.094803436 -0.069025236 -0.002250030
d_y2_d_x1  0.012155517 -0.020716702  0.012197842 -0.012852658  0.005073742
d_y3_d_x1  0.022047194 -0.054605274  0.026002135 -0.024798515  0.007522865
d_y1_d_x2 -0.011452050  0.058560019  0.199251001  0.051635820  0.013569738
d_y2_d_x2 -0.000837786 -0.005741823 -0.040290314 -0.005260770 -0.001370206
d_y3_d_x2 -0.026793845 -0.014616861 -0.099959367  0.011757689 -0.013593743
d_y1_d_x3 -0.030296136 -0.121876583  0.092923817  0.110094499 -0.060041324
d_y2_d_x3 -0.005337860  0.016762517 -0.022589338 -0.018712486  0.004037511
d_y3_d_x3  0.035460523  0.029335793  0.004585221 -0.102553623  0.025627648
d_y1_d_x4  0.003589721  0.080691009 -0.077767422  0.033587947  0.167953772
d_y2_d_x4 -0.028071989 -0.005070018 -0.022974215  0.027468768 -0.046744230
d_y3_d_x4 -0.006779762 -0.005107026 -0.001317465  0.004100424 -0.085060209
                 b_2_0         b_2_1        b_2_2        b_2_3        b_2_4
d_y1_d_x1  0.008024061 -0.0221918693 -0.003013822 -0.003580919  0.007719276
d_y2_d_x1  0.069168691  0.2834124319 -0.051125291  0.117001952 -0.011003959
d_y3_d_x1 -0.001320640  0.0221051354 -0.006529182  0.007857725 -0.001154711
d_y1_d_x2  0.006892933 -0.0049626362 -0.025279579 -0.012078401  0.001854851
d_y2_d_x2 -0.019306168 -0.0159966696  0.289551399  0.116253877 -0.050256955
d_y3_d_x2 -0.001180108 -0.0015510103  0.029159259  0.010510205 -0.004569859
d_y1_d_x3  0.001495100  0.0154321000 -0.014214555 -0.013298496  0.006617854
d_y2_d_x3  0.014995412 -0.0266157466  0.117043412  0.058229661  0.056593619
d_y3_d_x3  0.003286260 -0.0009362881  0.010295468  0.008670312  0.005780561
d_y1_d_x4 -0.013515115 -0.0174971149  0.004292862  0.006071070 -0.031869289
d_y2_d_x4 -0.018636944 -0.0272966834  0.109349566 -0.226035857  0.323689999
d_y3_d_x4  0.006750156  0.0030050037  0.009799569 -0.019998817  0.035223146
                 b_3_0        b_3_1        b_3_2        b_3_3         b_3_4
d_y1_d_x1 -0.031417349 -0.073348986 -0.034544349  0.035044735 -0.0122344733
d_y2_d_x1  0.005045995  0.020659975 -0.005272943  0.006362306  0.0016345637
d_y3_d_x1  0.046010486  0.324969581 -0.056428455  0.073861011  0.0104287230
d_y1_d_x2 -0.002766753 -0.020715492 -0.061132915 -0.009824057 -0.0081116315
d_y2_d_x2  0.002814993  0.002380350  0.027709100  0.005519317 -0.0004557832
d_y3_d_x2  0.068754042  0.007870417  0.398240728  0.046827540 -0.0081515083
d_y1_d_x3  0.012995623  0.039109456 -0.026546820 -0.034365047  0.0203022784
d_y2_d_x3 -0.001160646 -0.008952098  0.011128135  0.011845256 -0.0010329700
d_y3_d_x3 -0.115411384 -0.033628655 -0.004892383  0.269923323 -0.0002590520
d_y1_d_x4  0.014723408 -0.013026617  0.027794433 -0.021512421 -0.0382276976
d_y2_d_x4 -0.003798813 -0.006616929  0.006853777 -0.008450648  0.0215018835
d_y3_d_x4 -0.140480220 -0.046881018 -0.011279866 -0.061891233  0.3281471193
                 R_1_2        R_1_3        R_2_3
d_y1_d_x1 -0.126350552  0.262417202  0.007278988
d_y2_d_x1 -0.202632884 -0.023680906  0.084414267
d_y3_d_x1 -0.004951992 -0.295571898 -0.015479741
d_y1_d_x2 -0.076406139  0.040425534  0.014712178
d_y2_d_x2  0.080658567  0.003913057  0.034276557
d_y3_d_x2  0.021740271  0.221112842 -0.046738981
d_y1_d_x3  0.013457753 -0.077825246  0.004099499
d_y2_d_x3  0.051489831  0.009633498 -0.034826309
d_y3_d_x3 -0.020206059 -0.277626070  0.065458750
d_y1_d_x4  0.172610074 -0.140385851 -0.027374399
d_y2_d_x4  0.359347737  0.043774243 -0.137573286
d_y3_d_x4 -0.017941204  0.209684122  0.061225099
> all.equal( summary( margEffCondV )[ , ], summary( margEffCondM )[ 1:36, ],
+    check.attributes = FALSE ) 
[1] TRUE
> summary( margEffCondM )[ -( 1:24 ), ]
                     Estimate  Std. error     z value    Pr(> z)
3: d_y1_d_x1     0.0002023317 0.002779927  0.07278310 0.94197872
3: d_y2_d_x1     0.2319695899 0.513273328  0.45194164 0.65131103
3: d_y3_d_x1    -0.1301102884 0.372876730 -0.34893647 0.72713701
3: d_y1_d_x2    -0.0057134148 0.054479880 -0.10487201 0.91647737
3: d_y2_d_x2     0.1109910102 0.351961409  0.31534994 0.75249597
3: d_y3_d_x2    -0.1661674838 0.441133774 -0.37668275 0.70640938
3: d_y1_d_x3     0.0011362268 0.014315624  0.07936970 0.93673857
3: d_y2_d_x3    -0.1491871870 0.299756283 -0.49769495 0.61869907
3: d_y3_d_x3     0.1853439871 0.366637489  0.50552383 0.61319097
3: d_y1_d_x4    -0.0006208183 0.008522426 -0.07284525 0.94192926
3: d_y2_d_x4    -0.1992018262 0.550661621 -0.36174997 0.71753888
3: d_y3_d_x4     0.1994459163 0.534517512  0.37313261 0.70904975
mean: d_y1_d_x1  0.2837340363 0.403297726  0.70353493 0.48172245
mean: d_y2_d_x1  0.2067837152 0.389509697  0.53088207 0.59550050
mean: d_y3_d_x1 -0.2506808492 0.457721572 -0.54767104 0.58391780
mean: d_y1_d_x2 -0.1851981416 0.242893411 -0.76246672 0.44578150
mean: d_y2_d_x2  0.2066916063 0.332722026  0.62121408 0.53445878
mean: d_y3_d_x2 -0.1516595015 0.478982197 -0.31662868 0.75152537
mean: d_y1_d_x3  0.1691669425 0.225934573  0.74874306 0.45401209
mean: d_y2_d_x3 -0.3354308937 0.163449508 -2.05219886 0.04015034
mean: d_y3_d_x3  0.2291505770 0.427366342  0.53619238 0.59182560
mean: d_y1_d_x4 -0.1237756934 0.311131786 -0.39782401 0.69075992
mean: d_y2_d_x4 -0.3651579862 0.569043611 -0.64170475 0.52106491
mean: d_y3_d_x4  0.4305024659 0.436721569  0.98575957 0.32425111
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -0.6467480  0.2788967  0.1209011 -1.2689215
> 
> # calculating marginal effects, conditional
> # (assuming that all other dependent variables are as observed)
> margEffCondObs <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE, algorithm = GenzBretz() )
> print( margEffCondObs )
     d_y1_d_x1  d_y2_d_x1   d_y3_d_x1   d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.171996342 0.20541522 -0.12683723 -0.09565856 0.22331558 -0.17476430
2  0.453396093 0.18518138 -0.10369269 -0.37122660 0.26642211 -0.08533400
3  0.097176031 0.34345525 -0.20610297 -0.27712919 0.23015413 -0.12829301
4  0.182385396 0.22260219 -0.35557783 -0.34901909 0.24641930 -0.15625477
5  0.395976600 0.26512294 -0.22405904 -0.32295096 0.25167248 -0.13425075
6  0.024154154 0.14516735 -0.07341978 -0.13290567 0.06973857 -0.06173208
7  0.247513245 0.14525007 -0.14360427 -0.02638256 0.11286656 -0.12522160
8  0.105211089 0.35027624 -0.23759517 -0.28310921 0.23964177 -0.14829929
9  0.305110226 0.02953495 -0.02468951 -0.21064577 0.08273875 -0.05169793
10 0.001391671 0.23196959 -0.11609485 -0.01856668 0.11099101 -0.13781508
     d_y1_d_x3   d_y2_d_x3  d_y3_d_x3    d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  0.049373080 -0.38496241 0.24421037 -0.035714957 -0.50420545 0.30196558
2  0.517589266 -0.42553291 0.13198369 -0.342320508 -0.46820299 0.27400615
3  0.240569744 -0.35783882 0.19252916 -0.169610695 -0.43559110 0.30277572
4  0.379022298 -0.37335148 0.24368295 -0.263740488 -0.35581139 0.56738648
5  0.538960957 -0.52391216 0.23199224 -0.395069134 -0.53871278 0.45553038
6  0.077901262 -0.07597528 0.06504185 -0.052734091 -0.09824945 0.08501070
7  0.086147908 -0.30982533 0.25313942 -0.065574383 -0.39933261 0.33260130
8  0.252190242 -0.38617280 0.23690022 -0.184985860 -0.46686982 0.37848422
9  0.152442974 -0.08913371 0.05744710 -0.100419550 -0.11271554 0.08247915
10 0.005969436 -0.14918719 0.14822613 -0.004569508 -0.19920183 0.16554889
> margEffCondObsA <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE, algorithm = GenzBretz() )
> all.equal( margEffCondObs, margEffCondObsA )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm, reduced precision
> margEffCondObs1 <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = Miwa( steps = 32 ) )
> print( margEffCondObs1 )
     d_y1_d_x1  d_y2_d_x1   d_y3_d_x1   d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.171991465 0.20539502 -0.12685115 -0.09564462 0.22333831 -0.17480315
2  0.453396083 0.18521403 -0.10371605 -0.37117815 0.26642177 -0.08535933
3  0.097170705 0.34343671 -0.20609885 -0.27708251 0.23019994 -0.12833812
4  0.182370489 0.22262642 -0.35559976 -0.34891097 0.24647789 -0.15614626
5  0.396062172 0.26491181 -0.22410218 -0.32301776 0.25167518 -0.13429372
6  0.024153542 0.14525555 -0.07342138 -0.13290025 0.06986832 -0.06174283
7  0.247601640 0.14525164 -0.14353076 -0.02631610 0.11286814 -0.12516854
8  0.105068348 0.35027704 -0.23771705 -0.28313433 0.23960011 -0.14830372
9  0.305107739 0.02953581 -0.02469139 -0.21063612 0.08275916 -0.05170784
10 0.001376583 0.23197009 -0.11610897 -0.01850896 0.11099282 -0.13777067
     d_y1_d_x3   d_y2_d_x3  d_y3_d_x3    d_y1_d_x4  d_y2_d_x4  d_y3_d_x4
1  0.049369062 -0.38498413 0.24424901 -0.035714021 -0.5042087 0.30197976
2  0.517509460 -0.42554739 0.13203173 -0.342337487 -0.4682704 0.27407828
3  0.240548424 -0.35790074 0.19257697 -0.169608457 -0.4355710 0.30284445
4  0.378960324 -0.37343664 0.24376737 -0.263744039 -0.3558907 0.56751561
5  0.538996584 -0.52376449 0.23212450 -0.395145034 -0.5387374 0.45544566
6  0.077898816 -0.07584485 0.06505061 -0.052733734 -0.0983536 0.08502351
7  0.086045011 -0.30982678 0.25307025 -0.065460223 -0.3993349 0.33273176
8  0.252171647 -0.38616972 0.23688608 -0.184932693 -0.4668721 0.37861102
9  0.152437895 -0.08917606 0.05745498 -0.100419092 -0.1127594 0.08249152
10 0.005925195 -0.14918942 0.14818743 -0.004533173 -0.1992042 0.16558531
> all.equal( margEffCondObs, margEffCondObs1 )
 [1] "Component 1: Mean relative difference: 0.0001814309" 
 [2] "Component 2: Mean relative difference: 0.0001877033" 
 [3] "Component 3: Mean relative difference: 0.0001982085" 
 [4] "Component 4: Mean relative difference: 0.0002147753" 
 [5] "Component 5: Mean relative difference: 0.0001774133" 
 [6] "Component 6: Mean relative difference: 0.0003184793" 
 [7] "Component 7: Mean relative difference: 0.0001634685" 
 [8] "Component 8: Mean relative difference: 0.0001659605" 
 [9] "Component 9: Mean relative difference: 0.0002713412" 
[10] "Component 10: Mean relative difference: 0.0001883161"
[11] "Component 11: Mean relative difference: 9.769861e-05"
[12] "Component 12: Mean relative difference: 0.0002334697"
> # now with integrals obtained by the GHK algorithm
> margEffCondObs2 <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE )
> print( margEffCondObs2 )
     d_y1_d_x1  d_y2_d_x1   d_y3_d_x1   d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.171936166 0.20319620 -0.12385679 -0.09574408 0.22370224 -0.17465581
2  0.453157362 0.18439423 -0.10283446 -0.37163716 0.26656087 -0.08523642
3  0.097192904 0.34196383 -0.20081480 -0.27731868 0.23042466 -0.12837050
4  0.182458672 0.22196631 -0.35611755 -0.34922234 0.24661637 -0.15765146
5  0.393051825 0.26378595 -0.22398993 -0.32020864 0.25177381 -0.13460512
6  0.024141688 0.14342864 -0.07114934 -0.13289707 0.06960894 -0.06155653
7  0.250013279 0.14620921 -0.14248645 -0.02546471 0.11350228 -0.12521680
8  0.108800624 0.35482588 -0.23693885 -0.28378378 0.24033985 -0.14898713
9  0.305041489 0.02885883 -0.02407495 -0.21064980 0.08259898 -0.05162190
10 0.002907119 0.23387574 -0.11614252 -0.01743434 0.11167712 -0.13772572
     d_y1_d_x3   d_y2_d_x3  d_y3_d_x3    d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  0.049408838 -0.38510771 0.24239683 -0.035705096 -0.50160122 0.29597065
2  0.518101830 -0.42562594 0.13175546 -0.342035095 -0.46653180 0.27157938
3  0.240723824 -0.35806888 0.19221868 -0.169514598 -0.43268421 0.29865874
4  0.379363636 -0.37358331 0.24488856 -0.263632733 -0.35576345 0.56822990
5  0.531838528 -0.52280316 0.23325028 -0.392204561 -0.53736075 0.45497010
6  0.077871052 -0.07506461 0.06422631 -0.052702503 -0.09572552 0.08269845
7  0.085831917 -0.31144596 0.25442557 -0.069814275 -0.40247246 0.33165943
8  0.252832312 -0.38761701 0.23844919 -0.188497672 -0.47013102 0.37789393
9  0.152396701 -0.08874064 0.05695896 -0.100362821 -0.11068513 0.08053555
10 0.003382782 -0.15020695 0.14718417 -0.007893242 -0.20061813 0.16419322
> all.equal( margEffCondObs, margEffCondObs2 )
 [1] "Component 1: Mean relative difference: 0.005543512" 
 [2] "Component 2: Mean relative difference: 0.007674393" 
 [3] "Component 3: Mean relative difference: 0.008961165" 
 [4] "Component 4: Mean relative difference: 0.003050649" 
 [5] "Component 5: Mean relative difference: 0.00184501"  
 [6] "Component 6: Mean relative difference: 0.002549041" 
 [7] "Component 7: Mean relative difference: 0.005124569" 
 [8] "Component 8: Mean relative difference: 0.002339985" 
 [9] "Component 9: Mean relative difference: 0.005537836" 
[10] "Component 10: Mean relative difference: 0.008996781"
[11] "Component 11: Mean relative difference: 0.005854874"
[12] "Component 12: Mean relative difference: 0.007158029"
> all.equal( margEffCondObs1, margEffCondObs2 )
 [1] "Component 1: Mean relative difference: 0.005627834" 
 [2] "Component 2: Mean relative difference: 0.007624478" 
 [3] "Component 3: Mean relative difference: 0.009017387" 
 [4] "Component 4: Mean relative difference: 0.003117591" 
 [5] "Component 5: Mean relative difference: 0.001876911" 
 [6] "Component 6: Mean relative difference: 0.002632088" 
 [7] "Component 7: Mean relative difference: 0.00515424"  
 [8] "Component 8: Mean relative difference: 0.002203597" 
 [9] "Component 9: Mean relative difference: 0.005525479" 
[10] "Component 10: Mean relative difference: 0.009180788"
[11] "Component 11: Mean relative difference: 0.005936969"
[12] "Component 12: Mean relative difference: 0.007245039"
> # now with variance covariance matrix and Jacobian
> margEffCondObsV <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, 
+    data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, vcov = diag( 18 ), returnJacobian = TRUE,
+    algorithm = GenzBretz() )
> print( attr( margEffCondObsV, "vcov" ) )
, , d_y1_d_x1

      d_y1_d_x1    d_y2_d_x1     d_y3_d_x1     d_y1_d_x2    d_y2_d_x2
1  2.671114e-01 -0.001897659  0.0012381527 -0.0898724972 0.0111026042
5  4.804800e-01  0.066989903 -0.1865386538 -0.2400866050 0.0134390757
10 7.279534e-05  0.000104812  0.0002842754 -0.0007541722 0.0001431043
       d_y3_d_x2     d_y1_d_x3     d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1   0.0232684661  0.0871270271 -0.0173514905 -0.0453053466 -0.0615087519
5  -0.1876624140 -0.1072915448  0.1086954968  0.3284277562  0.0449074842
10  0.0005193529  0.0002695627 -0.0001024627 -0.0004071313 -0.0001952407
       d_y2_d_x4     d_y3_d_x4
1  -0.0069782753 -0.0251646531
5  -0.2420002118  0.1382809232
10 -0.0001539053 -0.0005932655

, , d_y2_d_x1

      d_y1_d_x1 d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -0.001897659 0.1706676  0.003222529 -0.007611475 -0.01922027 -0.015126608
5   0.066989903 0.3353120 -0.024244383 -0.023043764 -0.06623061 -0.137910505
10  0.000104812 0.2634495  0.006039631 -0.002325959  0.08898879  0.002116951
      d_y1_d_x3  d_y2_d_x3    d_y3_d_x3     d_y1_d_x4  d_y2_d_x4    d_y3_d_x4
1   0.007315706 -0.1185118  0.008347515 -1.435210e-03 -0.2778544  0.003016481
5  -0.091084366  0.0828829  0.178618168 -3.680357e-02 -0.1481576  0.087378268
10  0.000493143 -0.1089146 -0.001379843  5.835166e-05 -0.2017364 -0.005051618

, , d_y3_d_x1

       d_y1_d_x1    d_y2_d_x1 d_y3_d_x1    d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1   0.0012381527  0.003222529 0.1105299 -0.024097591 -0.014252445 0.02281127
5  -0.1865386538 -0.024244383 0.3072387  0.095206563 -0.060415748 0.12725063
10  0.0002842754  0.006039631 0.1376916 -0.003939484 -0.003951327 0.06569682
     d_y1_d_x3   d_y2_d_x3   d_y3_d_x3   d_y1_d_x4    d_y2_d_x4  d_y3_d_x4
1  0.018159097 0.009080067 -0.11249454 -0.00567175  0.002926144 -0.2101706
5  0.030100238 0.026173001 -0.30172442 -0.02254217  0.180444020 -0.2772860
10 0.001191273 0.002304536 -0.06426513 -0.00043647 -0.001457520 -0.1051227

, , d_y1_d_x2

       d_y1_d_x1    d_y2_d_x1    d_y3_d_x1  d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  -0.0898724972 -0.007611475 -0.024097591 0.10986178 -0.02228280 -0.02627183
5  -0.2400866050 -0.023043764  0.095206563 0.23267476 -0.05216925  0.06279416
10 -0.0007541722 -0.002325959 -0.003939484 0.01073828 -0.00361963 -0.01075533
      d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4  d_y2_d_x4    d_y3_d_x4
1  -0.058175429  0.013057235  0.019150077  0.030288171 0.01725109  0.044888881
5  -0.011462620 -0.018698589 -0.216184097 -0.156831775 0.11131507 -0.041557175
10 -0.002824503  0.002001756  0.005117699  0.001971316 0.00336347  0.008002528

, , d_y2_d_x2

      d_y1_d_x1   d_y2_d_x1    d_y3_d_x1   d_y1_d_x2 d_y2_d_x2     d_y3_d_x2
1  0.0111026042 -0.01922027 -0.014252445 -0.02228280 0.1473312 -0.0080961714
5  0.0134390757 -0.06623061 -0.060415748 -0.05216925 0.1886225 -0.0004257871
10 0.0001431043  0.08898879 -0.003951327 -0.00361963 0.1238768  0.0082323867
      d_y1_d_x3   d_y2_d_x3     d_y3_d_x3     d_y1_d_x4     d_y2_d_x4
1  0.0058099279  0.02936803  4.221189e-02 -0.0033222126  0.0008094348
5  0.0272786323 -0.08515210  8.360613e-02  0.0417908511 -0.1134354294
10 0.0005950015 -0.06785055 -8.549624e-05 -0.0001680563 -0.1243549737
      d_y3_d_x4
1   0.044052368
5   0.102497491
10 -0.002606281

, , d_y3_d_x2

       d_y1_d_x1    d_y2_d_x1  d_y3_d_x1   d_y1_d_x2     d_y2_d_x2 d_y3_d_x2
1   0.0232684661 -0.015126608 0.02281127 -0.02627183 -0.0080961714 0.1706051
5  -0.1876624140 -0.137910505 0.12725063  0.06279416 -0.0004257871 0.4303697
10  0.0005193529  0.002116951 0.06569682 -0.01075533  0.0082323867 0.1622181
     d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4    d_y2_d_x4   d_y3_d_x4
1  0.001140717  0.043384486 -0.04574026 -0.004963502  0.040292742 -0.08977236
5  0.024521697 -0.016429303 -0.33968675 -0.099438861  0.252703411 -0.15394458
10 0.001952299 -0.001624032 -0.07120353 -0.001192549 -0.006214361 -0.11685097

, , d_y1_d_x3

       d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1   0.0871270271  0.007315706 0.018159097 -0.058175429 0.0058099279 0.001140717
5  -0.1072915448 -0.091084366 0.030100238 -0.011462620 0.0272786323 0.024521697
10  0.0002695627  0.000493143 0.001191273 -0.002824503 0.0005950015 0.001952299
     d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4     d_y2_d_x4
1  0.052186445 -0.0151297513 -0.025646749 -0.029437198 -0.0148938303
5  0.351382199 -0.1650663379 -0.117904178  0.239711594  0.1159836760
10 0.001018486 -0.0004678488 -0.001726268 -0.000711753 -0.0006902437
      d_y3_d_x4
1  -0.033773829
5  -0.101137100
10 -0.002552456

, , d_y2_d_x3

       d_y1_d_x1  d_y2_d_x1   d_y3_d_x1    d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -0.0173514905 -0.1185118 0.009080067  0.013057235  0.02936803  0.043384486
5   0.1086954968  0.0828829 0.026173001 -0.018698589 -0.08515210 -0.016429303
10 -0.0001024627 -0.1089146 0.002304536  0.002001756 -0.06785055 -0.001624032
       d_y1_d_x3  d_y2_d_x3    d_y3_d_x3     d_y1_d_x4   d_y2_d_x4    d_y3_d_x4
1  -0.0151297513 0.18665206 -0.032581347  6.162623e-03 0.240208643 -0.039119566
5  -0.1650663379 0.33797782  0.037191700 -1.011780e-01 0.008438294 -0.075392389
10 -0.0004678488 0.08985383  0.001419168 -6.380649e-07 0.156662659  0.003899246

, , d_y3_d_x3

       d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
1  -0.0453053466  0.008347515 -0.11249454  0.019150077  4.221189e-02
5   0.3284277562  0.178618168 -0.30172442 -0.216184097  8.360613e-02
10 -0.0004071313 -0.001379843 -0.06426513  0.005117699 -8.549624e-05
     d_y3_d_x2    d_y1_d_x3    d_y2_d_x3  d_y3_d_x3    d_y1_d_x4   d_y2_d_x4
1  -0.04574026 -0.025646749 -0.032581347 0.22216933 0.0145684749 -0.03324667
5  -0.33968675 -0.117904178  0.037191700 0.70442886 0.1420128834 -0.39168643
10 -0.07120353 -0.001726268  0.001419168 0.07750353 0.0007830003  0.00510837
   d_y3_d_x4
1  0.2724130
5  0.3431578
10 0.1180128

, , d_y1_d_x4

       d_y1_d_x1     d_y2_d_x1   d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
1  -0.0615087519 -1.435210e-03 -0.00567175  0.030288171 -0.0033222126
5   0.0449074842 -3.680357e-02 -0.02254217 -0.156831775  0.0417908511
10 -0.0001952407  5.835166e-05 -0.00043647  0.001971316 -0.0001680563
      d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1  -0.004963502 -0.029437198  6.162623e-03 0.0145684749 0.0216792771
5  -0.099438861  0.239711594 -1.011780e-01 0.1420128834 0.5353957063
10 -0.001192549 -0.000711753 -6.380649e-07 0.0007830003 0.0005646205
       d_y2_d_x4     d_y3_d_x4
1   2.274581e-03  0.0090677567
5  -9.154354e-03 -0.1430645150
10 -6.782968e-05  0.0008214205

, , d_y2_d_x4

       d_y1_d_x1  d_y2_d_x1    d_y3_d_x1  d_y1_d_x2     d_y2_d_x2    d_y3_d_x2
1  -0.0069782753 -0.2778544  0.002926144 0.01725109  0.0008094348  0.040292742
5  -0.2420002118 -0.1481576  0.180444020 0.11131507 -0.1134354294  0.252703411
10 -0.0001539053 -0.2017364 -0.001457520 0.00336347 -0.1243549737 -0.006214361
       d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1  -0.0148938303 0.240208643 -0.03324667  2.274581e-03 0.6053376 -0.02029626
5   0.1159836760 0.008438294 -0.39168643 -9.154354e-03 0.5647923 -0.26212238
10 -0.0006902437 0.156662659  0.00510837 -6.782968e-05 0.3032282  0.01105439

, , d_y3_d_x4

       d_y1_d_x1    d_y2_d_x1  d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.0251646531  0.003016481 -0.2101706  0.044888881  0.044052368 -0.08977236
5   0.1382809232  0.087378268 -0.2772860 -0.041557175  0.102497491 -0.15394458
10 -0.0005932655 -0.005051618 -0.1051227  0.008002528 -0.002606281 -0.11685097
      d_y1_d_x3    d_y2_d_x3 d_y3_d_x3     d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  -0.033773829 -0.039119566 0.2724130  0.0090677567 -0.02029626 0.5218449
5  -0.101137100 -0.075392389 0.3431578 -0.1430645150 -0.26212238 0.4782605
10 -0.002552456  0.003899246 0.1180128  0.0008214205  0.01105439 0.2112263

> print( drop( attr( margEffCondObsV, "vcov" )[ 1, , ] ) )
             d_y1_d_x1    d_y2_d_x1    d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
d_y1_d_x1  0.267111405 -0.001897659  0.001238153 -0.089872497  0.0111026042
d_y2_d_x1 -0.001897659  0.170667630  0.003222529 -0.007611475 -0.0192202679
d_y3_d_x1  0.001238153  0.003222529  0.110529897 -0.024097591 -0.0142524454
d_y1_d_x2 -0.089872497 -0.007611475 -0.024097591  0.109861780 -0.0222828044
d_y2_d_x2  0.011102604 -0.019220268 -0.014252445 -0.022282804  0.1473311531
d_y3_d_x2  0.023268466 -0.015126608  0.022811267 -0.026271829 -0.0080961714
d_y1_d_x3  0.087127027  0.007315706  0.018159097 -0.058175429  0.0058099279
d_y2_d_x3 -0.017351490 -0.118511805  0.009080067  0.013057235  0.0293680342
d_y3_d_x3 -0.045305347  0.008347515 -0.112494538  0.019150077  0.0422118898
d_y1_d_x4 -0.061508752 -0.001435210 -0.005671750  0.030288171 -0.0033222126
d_y2_d_x4 -0.006978275 -0.277854366  0.002926144  0.017251086  0.0008094348
d_y3_d_x4 -0.025164653  0.003016481 -0.210170649  0.044888881  0.0440523685
             d_y3_d_x2    d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
d_y1_d_x1  0.023268466  0.087127027 -0.017351490 -0.045305347 -0.061508752
d_y2_d_x1 -0.015126608  0.007315706 -0.118511805  0.008347515 -0.001435210
d_y3_d_x1  0.022811267  0.018159097  0.009080067 -0.112494538 -0.005671750
d_y1_d_x2 -0.026271829 -0.058175429  0.013057235  0.019150077  0.030288171
d_y2_d_x2 -0.008096171  0.005809928  0.029368034  0.042211890 -0.003322213
d_y3_d_x2  0.170605098  0.001140717  0.043384486 -0.045740261 -0.004963502
d_y1_d_x3  0.001140717  0.052186445 -0.015129751 -0.025646749 -0.029437198
d_y2_d_x3  0.043384486 -0.015129751  0.186652060 -0.032581347  0.006162623
d_y3_d_x3 -0.045740261 -0.025646749 -0.032581347  0.222169334  0.014568475
d_y1_d_x4 -0.004963502 -0.029437198  0.006162623  0.014568475  0.021679277
d_y2_d_x4  0.040292742 -0.014893830  0.240208643 -0.033246673  0.002274581
d_y3_d_x4 -0.089772356 -0.033773829 -0.039119566  0.272412971  0.009067757
              d_y2_d_x4    d_y3_d_x4
d_y1_d_x1 -0.0069782753 -0.025164653
d_y2_d_x1 -0.2778543662  0.003016481
d_y3_d_x1  0.0029261437 -0.210170649
d_y1_d_x2  0.0172510865  0.044888881
d_y2_d_x2  0.0008094348  0.044052368
d_y3_d_x2  0.0402927423 -0.089772356
d_y1_d_x3 -0.0148938303 -0.033773829
d_y2_d_x3  0.2402086433 -0.039119566
d_y3_d_x3 -0.0332466734  0.272412971
d_y1_d_x4  0.0022745814  0.009067757
d_y2_d_x4  0.6053376120 -0.020296258
d_y3_d_x4 -0.0202962576  0.521844880
> print( attr( margEffCondObsV, "jacobian" ) )
, , b_1_0

      d_y1_d_x1     d_y2_d_x1    d_y3_d_x1   d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1   0.237119196 -0.0042905705 -0.004537520 -0.16362764  0.021246739  0.05309042
5   0.279256250  0.0130994340 -0.042653983 -0.18347254  0.006690779 -0.05041527
10 -0.004746446  0.0002331714  0.002017613  0.04644298 -0.004668669 -0.02071561
     d_y1_d_x3    d_y2_d_x3    d_y3_d_x3   d_y1_d_x4     d_y2_d_x4
1   0.11544880 -0.016286972 -0.049332760 -0.08098175  4.840572e-03
5   0.04682366  0.021016522  0.092581498 -0.02604583 -4.027889e-02
10 -0.01938449  0.001389167  0.008526513  0.01518785 -3.885781e-05
       d_y3_d_x4
1   0.0037525538
5   0.0331734640
10 -0.0007105427

, , b_1_1

      d_y1_d_x1     d_y2_d_x1     d_y3_d_x1  d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  2.760459e-01 -9.172312e-03 -2.164891e-02  0.0000000 0.000000000  0.00000000
5  4.300837e-01 -6.483072e-02 -9.133239e-02 -0.1834725 0.006690779 -0.05041527
10 3.416556e-05 -6.254719e-06 -8.454504e-05  0.0000000 0.000000000  0.00000000
    d_y1_d_x3  d_y2_d_x3  d_y3_d_x3   d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  0.00000000 0.00000000 0.00000000  0.00000000  0.00000000 0.00000000
5  0.04666822 0.02086109 0.09242607 -0.02595701 -0.04019007 0.03326228
10 0.00000000 0.00000000 0.00000000  0.00000000  0.00000000 0.00000000

, , b_1_2

   d_y1_d_x1   d_y2_d_x1   d_y3_d_x1  d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  0.2371192 -0.00429057 -0.00453752 0.03892668 -0.004881742 -0.01711139
5  0.0000000  0.00000000  0.00000000 0.24661116 -0.058139940 -0.14174766
10 0.0000000  0.00000000  0.00000000 0.05122359 -0.004908095 -0.02281777
   d_y1_d_x3   d_y2_d_x3   d_y3_d_x3   d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  0.1154731 -0.01628697 -0.04937162 -0.08099563 0.004840572 0.003774758
5  0.0000000  0.00000000  0.00000000  0.00000000 0.000000000 0.000000000
10 0.0000000  0.00000000  0.00000000  0.00000000 0.000000000 0.000000000

, , b_1_3

      d_y1_d_x1     d_y2_d_x1   d_y3_d_x1 d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.253201499  0.0045815729 0.004845272 0.1747255 -0.022687772 -0.05669121
5  -0.174546122 -0.0081876608 0.026660414 0.1146775 -0.004182000  0.03151152
10 -0.005951165  0.0002923537 0.002529713 0.0582309 -0.005853647 -0.02597354
     d_y1_d_x3    d_y2_d_x3    d_y3_d_x3  d_y1_d_x4     d_y2_d_x4    d_y3_d_x4
1  -0.08437642  0.014336219  0.035596448 0.08650164 -3.774758e-03 -0.004019007
5   0.40105691 -0.078108987 -0.149774526 0.01605382  2.540190e-02 -0.020961011
10 -0.01912249  0.001521665  0.008955663 0.01736389 -1.665335e-05 -0.001598721

, , b_1_4

     d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  0.101122853 -1.829775e-03 -0.0019350901 -0.06978133 0.009060974  0.02264117
5  0.229431652  1.076225e-02 -0.0350437055 -0.15073756 0.005497018 -0.04142023
10 0.001805885 -8.871495e-05 -0.0007676428 -0.01767021 0.001776293  0.00788169
     d_y1_d_x3     d_y2_d_x3    d_y3_d_x3     d_y1_d_x4     d_y2_d_x4
1  0.049267708 -0.0072386541 -0.021049829  0.0043827839 -0.0029277489
5  0.037997383  0.0179078974  0.077016171  0.4085231613 -0.0980041830
10 0.006949996 -0.0005273559 -0.003608225 -0.0008149126 -0.0002172217
      d_y3_d_x4
1  -0.015335034
5  -0.063576810
10 -0.001968931

, , b_2_0

       d_y1_d_x1  d_y2_d_x1   d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  -0.0067049148 -0.2093069 -0.01110603  0.02359868 -0.07427991 -0.01969025
5  -0.0468176067  0.0601708  0.02411969  0.01982570 -0.11310591  0.01951730
10  0.0001492367  0.2197046  0.01077585 -0.00348749  0.13273560  0.01049971
       d_y1_d_x3   d_y2_d_x3   d_y3_d_x3    d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  -0.0138023273  0.24398261  0.02654821 0.0034493242  0.31725733  0.02616796
5   0.0206390460  0.05356826 -0.03760325 0.0322852856  0.06363798 -0.03708145
10  0.0008881784 -0.22631341 -0.01020295 0.0003552714 -0.30195846 -0.01167955

, , b_2_1

       d_y1_d_x1 d_y2_d_x1   d_y3_d_x1 d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1  -1.019913e-02 0.1193442 0.003567316 0.0000000  0.0000000 0.0000000
5  -6.151580e-02 0.4058003 0.034744322 0.0198257 -0.1131059 0.0195173
10 -2.590150e-06 0.3469243 0.014366785 0.0000000  0.0000000 0.0000000
    d_y1_d_x3  d_y2_d_x3   d_y3_d_x3  d_y1_d_x4  d_y2_d_x4   d_y3_d_x4
1  0.00000000 0.00000000  0.00000000 0.00000000 0.00000000  0.00000000
5  0.02082223 0.05372369 -0.03748113 0.03248513 0.06354917 -0.03694822
10 0.00000000 0.00000000  0.00000000 0.00000000 0.00000000  0.00000000

, , b_2_2

      d_y1_d_x1  d_y2_d_x1   d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1  -0.006704915 -0.2093069 -0.01110603 -0.003494220 0.3286511 0.01467335
5   0.000000000  0.0000000  0.00000000 -0.041690108 0.2926944 0.05426163
10  0.000000000  0.0000000  0.00000000 -0.003639317 0.2599553 0.01409065
     d_y1_d_x3 d_y2_d_x3  d_y3_d_x3   d_y1_d_x4 d_y2_d_x4  d_y3_d_x4
1  -0.01380233 0.2439826 0.02654821 0.003449324 0.3172573 0.02616796
5   0.00000000 0.0000000 0.00000000 0.000000000 0.0000000 0.00000000
10  0.00000000 0.0000000 0.00000000 0.000000000 0.0000000 0.00000000

, , b_2_3

      d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.0071596671  0.22350287  0.01185928 -0.025199228 0.07931785  0.02102572
5  0.0292628426 -0.03760911 -0.01507576 -0.012391838 0.07069564 -0.01219908
10 0.0001871152  0.27546887  0.01351092 -0.004372667 0.16642588  0.01316469
       d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1   0.0112602974  0.06748226 -0.013584606 -3.665124e-03 -0.33981706 -0.02776668
5  -0.0745276181  0.37223831  0.057614917 -1.989520e-02 -0.03903544  0.02291500
10  0.0008473737 -0.15659907 -0.009309854  8.881784e-05 -0.37872483 -0.01501022

, , b_2_4

       d_y1_d_x1   d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -2.859406e-03 -0.08926191 -0.004736324 0.010063992 -0.03167772 -0.008397188
5  -3.846446e-02  0.04943519  0.019816285 0.016288417 -0.09292568  0.016035047
10 -5.678036e-05 -0.08359122 -0.004099898 0.001326889 -0.05050205 -0.003994835
       d_y1_d_x3  d_y2_d_x3    d_y3_d_x3     d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1  -5.891121e-03 0.10417223  0.011429746 -0.0020287253 0.4646756 0.025842189
5   1.678657e-02 0.04400924 -0.031175063 -0.0350480873 0.4574923 0.003835713
10 -2.220446e-05 0.08605894  0.004107825  0.0001146264 0.2420390 0.008298283

, , b_3_0

       d_y1_d_x1    d_y2_d_x1  d_y3_d_x1   d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.0232567722 -0.011015572 -0.1591526  0.04568840 -0.015580858 -0.12588268
5  -0.0739470342 -0.007314459  0.2213006  0.06229383 -0.013690362  0.05968877
10  0.0008188513  0.011466788  0.1311974 -0.01094591  0.009654283  0.15417144
      d_y1_d_x3    d_y2_d_x3  d_y3_d_x3   d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  -0.028605590  0.025801583  0.2423811  0.01173783  0.02504663  0.2854494
5  -0.035038639  0.003830269 -0.1468270 -0.03392842  0.03166356 -0.2554845
10  0.004118927 -0.010071111 -0.2165268 -0.00164313 -0.01217360 -0.2394085

, , b_3_1

       d_y1_d_x1   d_y2_d_x1 d_y3_d_x1  d_y1_d_x2   d_y2_d_x2  d_y3_d_x2
1  -3.172708e-02 0.003760221 0.1006422 0.00000000  0.00000000 0.00000000
5  -1.245229e-01 0.048919331 0.3650462 0.06229383 -0.01369036 0.05968877
10 -4.433343e-06 0.014931963 0.2725413 0.00000000  0.00000000 0.00000000
     d_y1_d_x3   d_y2_d_x3 d_y3_d_x3   d_y1_d_x4  d_y2_d_x4  d_y3_d_x4
1   0.00000000 0.000000000  0.000000  0.00000000 0.00000000  0.0000000
5  -0.03503864 0.003830269 -0.146827 -0.03392842 0.03166356 -0.2554845
10  0.00000000 0.000000000  0.000000  0.00000000 0.00000000  0.0000000

, , b_3_2

     d_y1_d_x1   d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1  -0.02325677 -0.01101557 -0.1591526 -0.008470304 0.01477579 0.2597948
5   0.00000000  0.00000000  0.0000000 -0.062229064 0.03522897 0.4247349
10  0.00000000  0.00000000  0.0000000 -0.011769193 0.01311946 0.2955153
     d_y1_d_x3  d_y2_d_x3 d_y3_d_x3  d_y1_d_x4  d_y2_d_x4 d_y3_d_x4
1  -0.02860559 0.02580158 0.2423811 0.01173783 0.02504663 0.2854494
5   0.00000000 0.00000000 0.0000000 0.00000000 0.00000000 0.0000000
10  0.00000000 0.00000000 0.0000000 0.00000000 0.00000000 0.0000000

, , b_3_3

     d_y1_d_x1   d_y2_d_x1  d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  0.024834133 0.011762689  0.1699469 -0.04878715 0.016637610  0.13442051
5  0.046219800 0.004571824 -0.1383216 -0.03893609 0.008557013 -0.03730783
10 0.001026687 0.014377230  0.1644973 -0.01372414 0.012104684  0.19330245
      d_y1_d_x3    d_y2_d_x3     d_y3_d_x3    d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1   0.022109401 -0.011103506  0.0008464317 -0.012528867 -0.02535749 -0.3048228
5  -0.102906847  0.045699685  0.4576054475  0.020916602 -0.02069456  0.1606271
10  0.003317847 -0.009184429 -0.1307384724 -0.001909584 -0.01529332 -0.2999823

, , b_3_4

       d_y1_d_x1    d_y2_d_x1   d_y3_d_x1  d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.0099181812 -0.004697747 -0.06787290 0.01948447 -0.006644679 -0.05368446
5  -0.0607534844 -0.006009421  0.18181638 0.05117943 -0.011247742  0.04903917
10 -0.0003115491 -0.004362780 -0.04991682 0.00416460 -0.003673175 -0.05865776
      d_y1_d_x3   d_y2_d_x3   d_y3_d_x3    d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  -0.012217484 0.010580425  0.10349777 -0.003483321 0.025478343 0.3815752
5  -0.029048985 0.003463896 -0.12043699 -0.152433896 0.074854141 0.1554360
10 -0.002065015 0.003856637  0.08169021 -0.000556831 0.008144765 0.2322045

, , R_1_2

       d_y1_d_x1     d_y2_d_x1    d_y3_d_x1     d_y1_d_x2   d_y2_d_x2
1   0.0119593147 -0.0174661633 2.470719e-03 -0.1075036372 0.060236172
5  -0.2627469940 -0.3102622052 5.436432e-02  0.0008249927 0.141162941
10  0.0002986817 -0.0001412116 5.869527e-06 -0.0079378150 0.006272141
     d_y3_d_x2   d_y1_d_x3    d_y2_d_x3    d_y3_d_x3     d_y1_d_x4    d_y2_d_x4
1  0.057426766 0.044659935 -0.029354297 -0.031555314 -0.0024487357 7.283063e-03
5  0.165725303 0.360245167 -0.353705953 -0.202970973  0.3657518732 2.865708e-01
10 0.005869358 0.001720846 -0.001033895 -0.000577316  0.0004884981 3.885781e-05
       d_y3_d_x4
1  -0.0082711615
5  -0.1066702282
10 -0.0001776357

, , R_1_3

     d_y1_d_x1     d_y2_d_x1    d_y3_d_x1  d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1  -0.03036766 -0.0028628581 -0.046038902 0.16796613 -0.014779641 0.11986384
5  -0.13515076 -0.1522331795 -0.008299913 0.21839363 -0.004554075 0.33427476
10 -0.00310063  0.0001322236 -0.002880124 0.04099705 -0.003285345 0.03256694
     d_y1_d_x3     d_y2_d_x3   d_y3_d_x3    d_y1_d_x4    d_y2_d_x4   d_y3_d_x4
1  -0.10554595  0.0111022302 -0.08223699  0.023814978 0.0021316282 0.030409009
5  -0.17422175 -0.0339173134 -0.40351056 -0.447486492 0.1727062937 0.091260333
10 -0.01385558  0.0008895662 -0.01219025  0.004973799 0.0002720046 0.005240253

, , R_2_3

       d_y1_d_x1 d_y2_d_x1  d_y3_d_x1     d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  -4.065696e-04 0.1000440 -0.1147518  0.0134169502 0.14424394 -0.20173175
5   1.095618e-01 0.1914696 -0.2351233 -0.0474577987 0.19609338 -0.26047393
10 -5.019252e-05 0.1066395 -0.1269163  0.0005696241 0.08873839 -0.08386716
       d_y1_d_x3   d_y2_d_x3  d_y3_d_x3     d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  -0.0050676477 -0.22102320 0.27909619 -0.0002144118 -0.26449953 0.34100500
5  -0.0632993657 -0.23672175 0.42520432 -0.0563771252 -0.46087578 0.51776361
10 -0.0002664535 -0.08062023 0.07956968  0.0000000000 -0.09790502 0.09765522

> print( drop( attr( margEffCondObsV, "jacobian" )[ 1, , ] ) )
                 b_1_0        b_1_1        b_1_2        b_1_3        b_1_4
d_y1_d_x1  0.237119196  0.276045875  0.237119196 -0.253201499  0.101122853
d_y2_d_x1 -0.004290570 -0.009172312 -0.004290570  0.004581573 -0.001829775
d_y3_d_x1 -0.004537520 -0.021648911 -0.004537520  0.004845272 -0.001935090
d_y1_d_x2 -0.163627640  0.000000000  0.038926679  0.174725473 -0.069781334
d_y2_d_x2  0.021246739  0.000000000 -0.004881742 -0.022687772  0.009060974
d_y3_d_x2  0.053090421  0.000000000 -0.017111390 -0.056691210  0.022641165
d_y1_d_x3  0.115448796  0.000000000  0.115473082 -0.084376424  0.049267708
d_y2_d_x3 -0.016286972  0.000000000 -0.016286972  0.014336219 -0.007238654
d_y3_d_x3 -0.049332760  0.000000000 -0.049371618  0.035596448 -0.021049829
d_y1_d_x4 -0.080981749  0.000000000 -0.080995627  0.086501639  0.004382784
d_y2_d_x4  0.004840572  0.000000000  0.004840572 -0.003774758 -0.002927749
d_y3_d_x4  0.003752554  0.000000000  0.003774758 -0.004019007 -0.015335034
                 b_2_0        b_2_1        b_2_2        b_2_3        b_2_4
d_y1_d_x1 -0.006704915 -0.010199135 -0.006704915  0.007159667 -0.002859406
d_y2_d_x1 -0.209306903  0.119344221 -0.209306903  0.223502872 -0.089261905
d_y3_d_x1 -0.011106030  0.003567316 -0.011106030  0.011859282 -0.004736324
d_y1_d_x2  0.023598678  0.000000000 -0.003494220 -0.025199228  0.010063992
d_y2_d_x2 -0.074279907  0.000000000  0.328651123  0.079317846 -0.031677723
d_y3_d_x2 -0.019690253  0.000000000  0.014673346  0.021025719 -0.008397188
d_y1_d_x3 -0.013802327  0.000000000 -0.013802327  0.011260297 -0.005891121
d_y2_d_x3  0.243982612  0.000000000  0.243982612  0.067482259  0.104172226
d_y3_d_x3  0.026548208  0.000000000  0.026548208 -0.013584606  0.011429746
d_y1_d_x4  0.003449324  0.000000000  0.003449324 -0.003665124 -0.002028725
d_y2_d_x4  0.317257332  0.000000000  0.317257332 -0.339817063  0.464675648
d_y3_d_x4  0.026167957  0.000000000  0.026167957 -0.027766678  0.025842189
                b_3_0        b_3_1        b_3_2         b_3_3        b_3_4
d_y1_d_x1 -0.02325677 -0.031727076 -0.023256772  0.0248341329 -0.009918181
d_y2_d_x1 -0.01101557  0.003760221 -0.011015572  0.0117626887 -0.004697747
d_y3_d_x1 -0.15915262  0.100642233 -0.159152617  0.1699469374 -0.067872897
d_y1_d_x2  0.04568840  0.000000000 -0.008470304 -0.0487871517  0.019484466
d_y2_d_x2 -0.01558086  0.000000000  0.014775793  0.0166376095 -0.006644679
d_y3_d_x2 -0.12588268  0.000000000  0.259794850  0.1344205127 -0.053684460
d_y1_d_x3 -0.02860559  0.000000000 -0.028605590  0.0221094014 -0.012217484
d_y2_d_x3  0.02580158  0.000000000  0.025801583 -0.0111035056  0.010580425
d_y3_d_x3  0.24238112  0.000000000  0.242381115  0.0008464317  0.103497766
d_y1_d_x4  0.01173783  0.000000000  0.011737833 -0.0125288668 -0.003483321
d_y2_d_x4  0.02504663  0.000000000  0.025046631 -0.0253574939  0.025478343
d_y3_d_x4  0.28544944  0.000000000  0.285449442 -0.3048228336  0.381575213
                 R_1_2        R_1_3         R_2_3
d_y1_d_x1  0.011959315 -0.030367660 -0.0004065696
d_y2_d_x1 -0.017466163 -0.002862858  0.1000439964
d_y3_d_x1  0.002470719 -0.046038902 -0.1147518488
d_y1_d_x2 -0.107503637  0.167966125  0.0134169502
d_y2_d_x2  0.060236172 -0.014779641  0.1442439395
d_y3_d_x2  0.057426766  0.119863838 -0.2017317546
d_y1_d_x3  0.044659935 -0.105545954 -0.0050676477
d_y2_d_x3 -0.029354297  0.011102230 -0.2210231997
d_y3_d_x3 -0.031555314 -0.082236995  0.2790961906
d_y1_d_x4 -0.002448736  0.023814978 -0.0002144118
d_y2_d_x4  0.007283063  0.002131628 -0.2644995334
d_y3_d_x4 -0.008271162  0.030409009  0.3410050020
> summary( margEffCondObsV )
              Estimate Std. error z value Pr(> z)
1: d_y1_d_x1  0.171996   0.516828   0.333   0.739
1: d_y2_d_x1  0.205415   0.413119   0.497   0.619
1: d_y3_d_x1 -0.126837   0.332460  -0.382   0.703
1: d_y1_d_x2 -0.095659   0.331454  -0.289   0.773
1: d_y2_d_x2  0.223316   0.383837   0.582   0.561
1: d_y3_d_x2 -0.174764   0.413044  -0.423   0.672
1: d_y1_d_x3  0.049373   0.228444   0.216   0.829
1: d_y2_d_x3 -0.384962   0.432032  -0.891   0.373
1: d_y3_d_x3  0.244210   0.471348   0.518   0.604
1: d_y1_d_x4 -0.035715   0.147239  -0.243   0.808
1: d_y2_d_x4 -0.504205   0.778034  -0.648   0.517
1: d_y3_d_x4  0.301966   0.722388   0.418   0.676
2: d_y1_d_x1  0.395977   0.693167   0.571   0.568
2: d_y2_d_x1  0.265123   0.579061   0.458   0.647
2: d_y3_d_x1 -0.224059   0.554291  -0.404   0.686
2: d_y1_d_x2 -0.322951   0.482364  -0.670   0.503
2: d_y2_d_x2  0.251672   0.434307   0.579   0.562
2: d_y3_d_x2 -0.134251   0.656026  -0.205   0.838
2: d_y1_d_x3  0.538961   0.592775   0.909   0.363
2: d_y2_d_x3 -0.523912   0.581359  -0.901   0.367
2: d_y3_d_x3  0.231992   0.839303   0.276   0.782
2: d_y1_d_x4 -0.395069   0.731707  -0.540   0.589
2: d_y2_d_x4 -0.538713   0.751527  -0.717   0.473
2: d_y3_d_x4  0.455530   0.691564   0.659   0.510
3: d_y1_d_x1  0.001392   0.008532   0.163   0.870
3: d_y2_d_x1  0.231970   0.513273   0.452   0.651
3: d_y3_d_x1 -0.116095   0.371068  -0.313   0.754
3: d_y1_d_x2 -0.018567   0.103626  -0.179   0.858
3: d_y2_d_x2  0.110991   0.351961   0.315   0.752
3: d_y3_d_x2 -0.137815   0.402763  -0.342   0.732
3: d_y1_d_x3  0.005969   0.031914   0.187   0.852
3: d_y2_d_x3 -0.149187   0.299756  -0.498   0.619
3: d_y3_d_x3  0.148226   0.278395   0.532   0.594
3: d_y1_d_x4 -0.004570   0.023762  -0.192   0.848
3: d_y2_d_x4 -0.199202   0.550662  -0.362   0.718
3: d_y3_d_x4  0.165549   0.459594   0.360   0.719
> margEffCondObsVA <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, vcov = diag( 18 ), returnJacobian = TRUE,
+    algorithm = GenzBretz() )
> all.equal( margEffCondObs, margEffCondObsA )
[1] TRUE
> # now with Jacobian but without variance covariance matrix
> margEffCondObsJac <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, 
+    data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, returnJacobian = TRUE, algorithm = GenzBretz() )
> all.equal( attr( margEffCondObsJac, "jacobian" ), 
+    attr( margEffCondObsV, "jacobian" ) )
[1] TRUE
> # now with mean values of marginal effects
> margEffCondObsM <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, 
+    data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, vcov = diag( 18 ), addMean = TRUE, returnJacobian = TRUE,
+    algorithm = GenzBretz() )
> all.equal( margEffCondObsV, margEffCondObsM[ 1:3, ], check.attributes = FALSE )
[1] TRUE
> print( margEffCondObsM )
       d_y1_d_x1 d_y2_d_x1  d_y3_d_x1   d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1    0.171996342 0.2054152 -0.1268372 -0.09565856 0.2233156 -0.1747643
2    0.395976600 0.2651229 -0.2240590 -0.32295096 0.2516725 -0.1342508
3    0.001391671 0.2319696 -0.1160949 -0.01856668 0.1109910 -0.1378151
mean 0.189788204 0.2341692 -0.1556637 -0.14572540 0.1953264 -0.1489434
       d_y1_d_x3  d_y2_d_x3 d_y3_d_x3    d_y1_d_x4  d_y2_d_x4 d_y3_d_x4
1    0.049373080 -0.3849624 0.2442104 -0.035714957 -0.5042055 0.3019656
2    0.538960957 -0.5239122 0.2319922 -0.395069134 -0.5387128 0.4555304
3    0.005969436 -0.1491872 0.1482261 -0.004569508 -0.1992018 0.1655489
mean 0.198101158 -0.3526873 0.2081429 -0.145117866 -0.4140400 0.3076816
> all.equal( attr( margEffCondObsV, "vcov" ), 
+    attr( margEffCondObsM, "vcov" )[ 1:3, , ] )
[1] TRUE
> print( attr( margEffCondObsM, "vcov" ) )
, , d_y1_d_x1

        d_y1_d_x1    d_y2_d_x1     d_y3_d_x1     d_y1_d_x2    d_y2_d_x2
1    2.671114e-01 -0.001897659  0.0012381527 -0.0898724972 0.0111026042
5    4.804800e-01  0.066989903 -0.1865386538 -0.2400866050 0.0134390757
10   7.279534e-05  0.000104812  0.0002842754 -0.0007541722 0.0001431043
mean 1.415407e-01  0.006460991 -0.0348547378 -0.0573521650 0.0054981909
         d_y3_d_x2     d_y1_d_x3     d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1     0.0232684661  0.0871270271 -0.0173514905 -0.0453053466 -0.0615087519
5    -0.1876624140 -0.1072915448  0.1086954968  0.3284277562  0.0449074842
10    0.0005193529  0.0002695627 -0.0001024627 -0.0004071313 -0.0001952407
mean -0.0317096952 -0.0021453299  0.0082663373  0.0472242051 -0.0012198391
         d_y2_d_x4     d_y3_d_x4
1    -0.0069782753 -0.0251646531
5    -0.2420002118  0.1382809232
10   -0.0001539053 -0.0005932655
mean -0.0433438979  0.0119531378

, , d_y2_d_x1

        d_y1_d_x1 d_y2_d_x1    d_y3_d_x1    d_y1_d_x2    d_y2_d_x2    d_y3_d_x2
1    -0.001897659 0.1706676  0.003222529 -0.007611475 -0.019220268 -0.015126608
5     0.066989903 0.3353120 -0.024244383 -0.023043764 -0.066230609 -0.137910505
10    0.000104812 0.2634495  0.006039631 -0.002325959  0.088988794  0.002116951
mean  0.006460991 0.1487773 -0.009259879 -0.003117154 -0.001428115 -0.038992651
        d_y1_d_x3    d_y2_d_x3    d_y3_d_x3     d_y1_d_x4  d_y2_d_x4
1     0.007315706 -0.118511805  0.008347515 -1.435210e-03 -0.2778544
5    -0.091084366  0.082882900  0.178618168 -3.680357e-02 -0.1481576
10    0.000493143 -0.108914604 -0.001379843  5.835166e-05 -0.2017364
mean -0.014430630  0.001858887  0.048502770 -5.339526e-03 -0.1055772
        d_y3_d_x4
1     0.003016481
5     0.087378268
10   -0.005051618
mean  0.033193948

, , d_y3_d_x1

         d_y1_d_x1    d_y2_d_x1 d_y3_d_x1    d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1     0.0012381527  0.003222529 0.1105299 -0.024097591 -0.014252445 0.02281127
5    -0.1865386538 -0.024244383 0.3072387  0.095206563 -0.060415748 0.12725063
10    0.0002842754  0.006039631 0.1376916 -0.003939484 -0.003951327 0.06569682
mean -0.0348547378 -0.009259879 0.1005792  0.011532132 -0.025381502 0.02335124
       d_y1_d_x3   d_y2_d_x3   d_y3_d_x3    d_y1_d_x4    d_y2_d_x4   d_y3_d_x4
1    0.018159097 0.009080067 -0.11249454 -0.005671750  0.002926144 -0.21017065
5    0.030100238 0.026173001 -0.30172442 -0.022542174  0.180444020 -0.27728605
10   0.001191273 0.002304536 -0.06426513 -0.000436470 -0.001457520 -0.10512274
mean 0.001896839 0.027442481 -0.05347400  0.003245395  0.048833017 -0.08756019

, , d_y1_d_x2

         d_y1_d_x1    d_y2_d_x1    d_y3_d_x1  d_y1_d_x2   d_y2_d_x2
1    -0.0898724972 -0.007611475 -0.024097591 0.10986178 -0.02228280
5    -0.2400866050 -0.023043764  0.095206563 0.23267476 -0.05216925
10   -0.0007541722 -0.002325959 -0.003939484 0.01073828 -0.00361963
mean -0.0573521650 -0.003117154  0.011532132 0.07275856 -0.01923728
        d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1    -0.026271829 -0.058175429  0.0130572355  0.019150077  0.030288171
5     0.062794165 -0.011462620 -0.0186985886 -0.216184097 -0.156831775
10   -0.010755334 -0.002824503  0.0020017559  0.005117699  0.001971316
mean  0.003498611 -0.010899192  0.0003151392 -0.042704521 -0.031776232
      d_y2_d_x4    d_y3_d_x4
1    0.01725109  0.044888881
5    0.11131507 -0.041557175
10   0.00336347  0.008002528
mean 0.02127647  0.007948404

, , d_y2_d_x2

        d_y1_d_x1    d_y2_d_x1    d_y3_d_x1   d_y1_d_x2 d_y2_d_x2     d_y3_d_x2
1    0.0111026042 -0.019220268 -0.014252445 -0.02228280 0.1473312 -0.0080961714
5    0.0134390757 -0.066230609 -0.060415748 -0.05216925 0.1886225 -0.0004257871
10   0.0001431043  0.088988794 -0.003951327 -0.00361963 0.1238768  0.0082323867
mean 0.0054981909 -0.001428115 -0.025381502 -0.01923728 0.1293292 -0.0040483856
        d_y1_d_x3    d_y2_d_x3     d_y3_d_x3     d_y1_d_x4     d_y2_d_x4
1    0.0058099279  0.029368034  4.221189e-02 -0.0033222126  0.0008094348
5    0.0272786323 -0.085152095  8.360613e-02  0.0417908511 -0.1134354294
10   0.0005950015 -0.067850555 -8.549624e-05 -0.0001680563 -0.1243549737
mean 0.0011689709 -0.005699656  4.236526e-02  0.0076070322 -0.0533113765
        d_y3_d_x4
1     0.044052368
5     0.102497491
10   -0.002606281
mean  0.043551983

, , d_y3_d_x2

         d_y1_d_x1    d_y2_d_x1  d_y3_d_x1    d_y1_d_x2     d_y2_d_x2 d_y3_d_x2
1     0.0232684661 -0.015126608 0.02281127 -0.026271829 -0.0080961714 0.1706051
5    -0.1876624140 -0.137910505 0.12725063  0.062794165 -0.0004257871 0.4303697
10    0.0005193529  0.002116951 0.06569682 -0.010755334  0.0082323867 0.1622181
mean -0.0317096952 -0.038992651 0.02335124  0.003498611 -0.0040483856 0.1882394
        d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4    d_y2_d_x4
1     0.001140717  0.043384486 -0.04574026 -0.004963502  0.040292742
5     0.024521697 -0.016429303 -0.33968675 -0.099438861  0.252703411
10    0.001952299 -0.001624032 -0.07120353 -0.001192549 -0.006214361
mean -0.012397157  0.029202646 -0.04498710 -0.006966362  0.069504315
       d_y3_d_x4
1    -0.08977236
5    -0.15394458
10   -0.11685097
mean -0.04648243

, , d_y1_d_x3

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1     0.0871270271  0.007315706 0.018159097 -0.058175429 0.0058099279
5    -0.1072915448 -0.091084366 0.030100238 -0.011462620 0.0272786323
10    0.0002695627  0.000493143 0.001191273 -0.002824503 0.0005950015
mean -0.0021453299 -0.014430630 0.001896839 -0.010899192 0.0011689709
        d_y3_d_x2   d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1     0.001140717 0.052186445 -0.0151297513 -0.025646749 -0.029437198
5     0.024521697 0.351382199 -0.1650663379 -0.117904178  0.239711594
10    0.001952299 0.001018486 -0.0004678488 -0.001726268 -0.000711753
mean -0.012397157 0.045309355 -0.0168889836 -0.005554718  0.037343626
         d_y2_d_x4    d_y3_d_x4
1    -0.0148938303 -0.033773829
5     0.1159836760 -0.101137100
10   -0.0006902437 -0.002552456
mean  0.0186870720 -0.015933106

, , d_y2_d_x3

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1     d_y1_d_x2    d_y2_d_x2
1    -0.0173514905 -0.118511805 0.009080067  0.0130572355  0.029368034
5     0.1086954968  0.082882900 0.026173001 -0.0186985886 -0.085152095
10   -0.0001024627 -0.108914604 0.002304536  0.0020017559 -0.067850555
mean  0.0082663373  0.001858887 0.027442481  0.0003151392 -0.005699656
        d_y3_d_x2     d_y1_d_x3  d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1     0.043384486 -0.0151297513 0.18665206 -0.032581347  6.162623e-03
5    -0.016429303 -0.1650663379 0.33797782  0.037191700 -1.011780e-01
10   -0.001624032 -0.0004678488 0.08985383  0.001419168 -6.380649e-07
mean  0.029202646 -0.0168889836 0.07190068 -0.032081138 -1.291427e-02
       d_y2_d_x4    d_y3_d_x4
1    0.240208643 -0.039119566
5    0.008438294 -0.075392389
10   0.156662659  0.003899246
mean 0.052186706 -0.051216532

, , d_y3_d_x3

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
1    -0.0453053466  0.008347515 -0.11249454  0.019150077  4.221189e-02
5     0.3284277562  0.178618168 -0.30172442 -0.216184097  8.360613e-02
10   -0.0004071313 -0.001379843 -0.06426513  0.005117699 -8.549624e-05
mean  0.0472242051  0.048502770 -0.05347400 -0.042704521  4.236526e-02
       d_y3_d_x2    d_y1_d_x3    d_y2_d_x3  d_y3_d_x3    d_y1_d_x4   d_y2_d_x4
1    -0.04574026 -0.025646749 -0.032581347 0.22216933 0.0145684749 -0.03324667
5    -0.33968675 -0.117904178  0.037191700 0.70442886 0.1420128834 -0.39168643
10   -0.07120353 -0.001726268  0.001419168 0.07750353 0.0007830003  0.00510837
mean -0.04498710 -0.005554718 -0.032081138 0.12840930 0.0094411092 -0.09690955
      d_y3_d_x4
1    0.27241297
5    0.34315784
10   0.11801276
mean 0.08382957

, , d_y1_d_x4

         d_y1_d_x1     d_y2_d_x1    d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
1    -0.0615087519 -1.435210e-03 -0.005671750  0.030288171 -0.0033222126
5     0.0449074842 -3.680357e-02 -0.022542174 -0.156831775  0.0417908511
10   -0.0001952407  5.835166e-05 -0.000436470  0.001971316 -0.0001680563
mean -0.0012198391 -5.339526e-03  0.003245395 -0.031776232  0.0076070322
        d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1    -0.004963502 -0.029437198  6.162623e-03 0.0145684749 0.0216792771
5    -0.099438861  0.239711594 -1.011780e-01 0.1420128834 0.5353957063
10   -0.001192549 -0.000711753 -6.380649e-07 0.0007830003 0.0005646205
mean -0.006966362  0.037343626 -1.291427e-02 0.0094411092 0.0601547586
         d_y2_d_x4     d_y3_d_x4
1     2.274581e-03  0.0090677567
5    -9.154354e-03 -0.1430645150
10   -6.782968e-05  0.0008214205
mean  7.278704e-04 -0.0332495963

, , d_y2_d_x4

         d_y1_d_x1  d_y2_d_x1    d_y3_d_x1  d_y1_d_x2     d_y2_d_x2
1    -0.0069782753 -0.2778544  0.002926144 0.01725109  0.0008094348
5    -0.2420002118 -0.1481576  0.180444020 0.11131507 -0.1134354294
10   -0.0001539053 -0.2017364 -0.001457520 0.00336347 -0.1243549737
mean -0.0433438979 -0.1055772  0.048833017 0.02127647 -0.0533113765
        d_y3_d_x2     d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4 d_y2_d_x4
1     0.040292742 -0.0148938303 0.240208643 -0.03324667  2.274581e-03 0.6053376
5     0.252703411  0.1159836760 0.008438294 -0.39168643 -9.154354e-03 0.5647923
10   -0.006214361 -0.0006902437 0.156662659  0.00510837 -6.782968e-05 0.3032282
mean  0.069504315  0.0186870720 0.052186706 -0.09690955  7.278704e-04 0.3186433
       d_y3_d_x4
1    -0.02029626
5    -0.26212238
10    0.01105439
mean -0.07001765

, , d_y3_d_x4

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1    -0.0251646531  0.003016481 -0.21017065  0.044888881  0.044052368
5     0.1382809232  0.087378268 -0.27728605 -0.041557175  0.102497491
10   -0.0005932655 -0.005051618 -0.10512274  0.008002528 -0.002606281
mean  0.0119531378  0.033193948 -0.08756019  0.007948404  0.043551983
       d_y3_d_x2    d_y1_d_x3    d_y2_d_x3  d_y3_d_x3     d_y1_d_x4   d_y2_d_x4
1    -0.08977236 -0.033773829 -0.039119566 0.27241297  0.0090677567 -0.02029626
5    -0.15394458 -0.101137100 -0.075392389 0.34315784 -0.1430645150 -0.26212238
10   -0.11685097 -0.002552456  0.003899246 0.11801276  0.0008214205  0.01105439
mean -0.04648243 -0.015933106 -0.051216532 0.08382957 -0.0332495963 -0.07001765
     d_y3_d_x4
1    0.5218449
5    0.4782605
10   0.2112263
mean 0.2153100

> print( drop( attr( margEffCondObsM, "vcov" )[ 4, , ] ) )
             d_y1_d_x1    d_y2_d_x1    d_y3_d_x1     d_y1_d_x2    d_y2_d_x2
d_y1_d_x1  0.141540706  0.006460991 -0.034854738 -0.0573521650  0.005498191
d_y2_d_x1  0.006460991  0.148777309 -0.009259879 -0.0031171538 -0.001428115
d_y3_d_x1 -0.034854738 -0.009259879  0.100579205  0.0115321321 -0.025381502
d_y1_d_x2 -0.057352165 -0.003117154  0.011532132  0.0727585583 -0.019237283
d_y2_d_x2  0.005498191 -0.001428115 -0.025381502 -0.0192372835  0.129329235
d_y3_d_x2 -0.031709695 -0.038992651  0.023351239  0.0034986111 -0.004048386
d_y1_d_x3 -0.002145330 -0.014430630  0.001896839 -0.0108991920  0.001168971
d_y2_d_x3  0.008266337  0.001858887  0.027442481  0.0003151392 -0.005699656
d_y3_d_x3  0.047224205  0.048502770 -0.053474002 -0.0427045208  0.042365258
d_y1_d_x4 -0.001219839 -0.005339526  0.003245395 -0.0317762324  0.007607032
d_y2_d_x4 -0.043343898 -0.105577209  0.048833017  0.0212764688 -0.053311376
d_y3_d_x4  0.011953138  0.033193948 -0.087560193  0.0079484035  0.043551983
             d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
d_y1_d_x1 -0.031709695 -0.002145330  0.0082663373  0.047224205 -0.0012198391
d_y2_d_x1 -0.038992651 -0.014430630  0.0018588875  0.048502770 -0.0053395257
d_y3_d_x1  0.023351239  0.001896839  0.0274424813 -0.053474002  0.0032453946
d_y1_d_x2  0.003498611 -0.010899192  0.0003151392 -0.042704521 -0.0317762324
d_y2_d_x2 -0.004048386  0.001168971 -0.0056996564  0.042365258  0.0076070322
d_y3_d_x2  0.188239422 -0.012397157  0.0292026461 -0.044987100 -0.0069663622
d_y1_d_x3 -0.012397157  0.045309355 -0.0168889836 -0.005554718  0.0373436258
d_y2_d_x3  0.029202646 -0.016888984  0.0719006837 -0.032081138 -0.0129142719
d_y3_d_x3 -0.044987100 -0.005554718 -0.0320811379  0.128409299  0.0094411092
d_y1_d_x4 -0.006966362  0.037343626 -0.0129142719  0.009441109  0.0601547586
d_y2_d_x4  0.069504315  0.018687072  0.0521867055 -0.096909554  0.0007278704
d_y3_d_x4 -0.046482427 -0.015933106 -0.0512165316  0.083829573 -0.0332495963
              d_y2_d_x4    d_y3_d_x4
d_y1_d_x1 -0.0433438979  0.011953138
d_y2_d_x1 -0.1055772087  0.033193948
d_y3_d_x1  0.0488330170 -0.087560193
d_y1_d_x2  0.0212764688  0.007948404
d_y2_d_x2 -0.0533113765  0.043551983
d_y3_d_x2  0.0695043150 -0.046482427
d_y1_d_x3  0.0186870720 -0.015933106
d_y2_d_x3  0.0521867055 -0.051216532
d_y3_d_x3 -0.0969095539  0.083829573
d_y1_d_x4  0.0007278704 -0.033249596
d_y2_d_x4  0.3186432682 -0.070017645
d_y3_d_x4 -0.0700176450  0.215309973
> all.equal( attr( margEffCondObsV, "jacobian" ), 
+    attr( margEffCondObsM, "jacobian" )[ 1:3, , ] )
[1] TRUE
> print( attr( margEffCondObsM, "jacobian" ) )
, , b_1_0

        d_y1_d_x1     d_y2_d_x1    d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1     0.237119196 -0.0042905705 -0.004537520 -0.16362764  0.021246739
5     0.279256250  0.0130994340 -0.042653983 -0.18347254  0.006690779
10   -0.004746446  0.0002331714  0.002017613  0.04644298 -0.004668669
mean  0.170543000  0.0030140117 -0.015057964 -0.10021907  0.007756283
        d_y3_d_x2   d_y1_d_x3    d_y2_d_x3    d_y3_d_x3   d_y1_d_x4
1     0.053090421  0.11544880 -0.016286972 -0.049332760 -0.08098175
5    -0.050415270  0.04682366  0.021016522  0.092581498 -0.02604583
10   -0.020715613 -0.01938449  0.001389167  0.008526513  0.01518785
mean -0.006013487  0.04762932  0.002039572  0.017258417 -0.03061324
         d_y2_d_x4     d_y3_d_x4
1     4.840572e-03  0.0037525538
5    -4.027889e-02  0.0331734640
10   -3.885781e-05 -0.0007105427
mean -1.182573e-02  0.0120718250

, , b_1_1

        d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2   d_y2_d_x2
1    2.760459e-01 -9.172312e-03 -2.164891e-02  0.00000000 0.000000000
5    4.300837e-01 -6.483072e-02 -9.133239e-02 -0.18347254 0.006690779
10   3.416556e-05 -6.254719e-06 -8.454504e-05  0.00000000 0.000000000
mean 2.353879e-01 -2.466976e-02 -3.768861e-02 -0.06115751 0.002230260
       d_y3_d_x2  d_y1_d_x3   d_y2_d_x3  d_y3_d_x3    d_y1_d_x4   d_y2_d_x4
1     0.00000000 0.00000000 0.000000000 0.00000000  0.000000000  0.00000000
5    -0.05041527 0.04666822 0.020861091 0.09242607 -0.025957014 -0.04019007
10    0.00000000 0.00000000 0.000000000 0.00000000  0.000000000  0.00000000
mean -0.01680509 0.01555607 0.006953697 0.03080869 -0.008652338 -0.01339669
      d_y3_d_x4
1    0.00000000
5    0.03326228
10   0.00000000
mean 0.01108743

, , b_1_2

      d_y1_d_x1   d_y2_d_x1    d_y3_d_x1  d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1    0.23711920 -0.00429057 -0.004537520 0.03892668 -0.004881742 -0.01711139
5    0.00000000  0.00000000  0.000000000 0.24661116 -0.058139940 -0.14174766
10   0.00000000  0.00000000  0.000000000 0.05122359 -0.004908095 -0.02281777
mean 0.07903973 -0.00143019 -0.001512507 0.11225381 -0.022643259 -0.06055894
      d_y1_d_x3    d_y2_d_x3   d_y3_d_x3   d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1    0.11547308 -0.016286972 -0.04937162 -0.08099563 0.004840572 0.003774758
5    0.00000000  0.000000000  0.00000000  0.00000000 0.000000000 0.000000000
10   0.00000000  0.000000000  0.00000000  0.00000000 0.000000000 0.000000000
mean 0.03849103 -0.005428991 -0.01645721 -0.02699854 0.001613524 0.001258253

, , b_1_3

        d_y1_d_x1     d_y2_d_x1   d_y3_d_x1 d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1    -0.253201499  0.0045815729 0.004845272 0.1747255 -0.022687772 -0.05669121
5    -0.174546122 -0.0081876608 0.026660414 0.1146775 -0.004182000  0.03151152
10   -0.005951165  0.0002923537 0.002529713 0.0582309 -0.005853647 -0.02597354
mean -0.144566262 -0.0011045781 0.011345133 0.1158780 -0.010907806 -0.01705108
       d_y1_d_x3    d_y2_d_x3    d_y3_d_x3  d_y1_d_x4     d_y2_d_x4
1    -0.08437642  0.014336219  0.035596448 0.08650164 -3.774758e-03
5     0.40105691 -0.078108987 -0.149774526 0.01605382  2.540190e-02
10   -0.01912249  0.001521665  0.008955663 0.01736389 -1.665335e-05
mean  0.09918600 -0.020750368 -0.035074138 0.03997312  7.203497e-03
        d_y3_d_x4
1    -0.004019007
5    -0.020961011
10   -0.001598721
mean -0.008859580

, , b_1_4

       d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2   d_y2_d_x2
1    0.101122853 -1.829775e-03 -0.0019350901 -0.06978133 0.009060974
5    0.229431652  1.076225e-02 -0.0350437055 -0.15073756 0.005497018
10   0.001805885 -8.871495e-05 -0.0007676428 -0.01767021 0.001776293
mean 0.110786797  2.947919e-03 -0.0125821461 -0.07939637 0.005444762
        d_y3_d_x2   d_y1_d_x3     d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1     0.022641165 0.049267708 -0.0072386541 -0.021049829  0.0043827839
5    -0.041420232 0.037997383  0.0179078974  0.077016171  0.4085231613
10    0.007881690 0.006949996 -0.0005273559 -0.003608225 -0.0008149126
mean -0.003632459 0.031405029  0.0033806291  0.017452706  0.1373636775
         d_y2_d_x4    d_y3_d_x4
1    -0.0029277489 -0.015335034
5    -0.0980041830 -0.063576810
10   -0.0002172217 -0.001968931
mean -0.0337163845 -0.026960258

, , b_2_0

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2
1    -0.0067049148 -0.20930690 -0.011106030  0.02359868 -0.07427991
5    -0.0468176067  0.06017080  0.024119695  0.01982570 -0.11310591
10    0.0001492367  0.21970457  0.010775848 -0.00348749  0.13273560
mean -0.0177910949  0.02352282  0.007929838  0.01331229 -0.01821674
        d_y3_d_x2     d_y1_d_x3   d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1    -0.019690253 -0.0138023273  0.24398261  0.026548208 0.0034493242
5     0.019517303  0.0206390460  0.05356826 -0.037603254 0.0322852856
10    0.010499709  0.0008881784 -0.22631341 -0.010202950 0.0003552714
mean  0.003442253  0.0025749657  0.02374582 -0.007085998 0.0120299604
       d_y2_d_x4    d_y3_d_x4
1     0.31725733  0.026167957
5     0.06363798 -0.037081449
10   -0.30195846 -0.011679546
mean  0.02631229 -0.007531013

, , b_2_1

         d_y1_d_x1 d_y2_d_x1   d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1    -1.019913e-02 0.1193442 0.003567316 0.000000000  0.00000000 0.000000000
5    -6.151580e-02 0.4058003 0.034744322 0.019825696 -0.11310591 0.019517303
10   -2.590150e-06 0.3469243 0.014366785 0.000000000  0.00000000 0.000000000
mean -2.390584e-02 0.2906896 0.017559475 0.006608565 -0.03770197 0.006505768
       d_y1_d_x3  d_y2_d_x3   d_y3_d_x3  d_y1_d_x4  d_y2_d_x4   d_y3_d_x4
1    0.000000000 0.00000000  0.00000000 0.00000000 0.00000000  0.00000000
5    0.020822233 0.05372369 -0.03748113 0.03248513 0.06354917 -0.03694822
10   0.000000000 0.00000000  0.00000000 0.00000000 0.00000000  0.00000000
mean 0.006940744 0.01790790 -0.01249371 0.01082838 0.02118306 -0.01231607

, , b_2_2

        d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1    -0.006704915 -0.20930690 -0.01110603 -0.003494220 0.3286511 0.01467335
5     0.000000000  0.00000000  0.00000000 -0.041690108 0.2926944 0.05426163
10    0.000000000  0.00000000  0.00000000 -0.003639317 0.2599553 0.01409065
mean -0.002234972 -0.06976897 -0.00370201 -0.016274548 0.2937670 0.02767521
        d_y1_d_x3  d_y2_d_x3   d_y3_d_x3   d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1    -0.013802327 0.24398261 0.026548208 0.003449324 0.3172573 0.026167957
5     0.000000000 0.00000000 0.000000000 0.000000000 0.0000000 0.000000000
10    0.000000000 0.00000000 0.000000000 0.000000000 0.0000000 0.000000000
mean -0.004600776 0.08132754 0.008849403 0.001149775 0.1057524 0.008722652

, , b_2_3

        d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2  d_y2_d_x2    d_y3_d_x2
1    0.0071596671  0.22350287  0.011859282 -0.025199228 0.07931785  0.021025719
5    0.0292628426 -0.03760911 -0.015075756 -0.012391838 0.07069564 -0.012199081
10   0.0001871152  0.27546887  0.013510919 -0.004372667 0.16642588  0.013164692
mean 0.0122032083  0.15378754  0.003431481 -0.013987911 0.10547979  0.007330444
         d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4   d_y2_d_x4
1     0.0112602974  0.06748226 -0.013584606 -3.665124e-03 -0.33981706
5    -0.0745276181  0.37223831  0.057614917 -1.989520e-02 -0.03903544
10    0.0008473737 -0.15659907 -0.009309854  8.881784e-05 -0.37872483
mean -0.0208066490  0.09437383  0.011573486 -7.823834e-03 -0.25252578
       d_y3_d_x4
1    -0.02776668
5     0.02291500
10   -0.01501022
mean -0.00662063

, , b_2_4

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2
1    -2.859406e-03 -0.08926191 -0.004736324 0.010063992 -0.03167772
5    -3.846446e-02  0.04943519  0.019816285 0.016288417 -0.09292568
10   -5.678036e-05 -0.08359122 -0.004099898 0.001326889 -0.05050205
mean -1.379355e-02 -0.04113931  0.003660021 0.009226432 -0.05836848
        d_y3_d_x2     d_y1_d_x3  d_y2_d_x3    d_y3_d_x3     d_y1_d_x4 d_y2_d_x4
1    -0.008397188 -5.891121e-03 0.10417223  0.011429746 -0.0020287253 0.4646756
5     0.016035047  1.678657e-02 0.04400924 -0.031175063 -0.0350480873 0.4574923
10   -0.003994835 -2.220446e-05 0.08605894  0.004107825  0.0001146264 0.2420390
mean  0.001214341  3.624416e-03 0.07808013 -0.005212497 -0.0123207287 0.3880690
       d_y3_d_x4
1    0.025842189
5    0.003835713
10   0.008298283
mean 0.012658728

, , b_3_0

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1    -0.0232567722 -0.011015572 -0.15915262  0.04568840 -0.015580858
5    -0.0739470342 -0.007314459  0.22130059  0.06229383 -0.013690362
10    0.0008188513  0.011466788  0.13119743 -0.01094591  0.009654283
mean -0.0321283184 -0.002287747  0.06444847  0.03234544 -0.006538979
       d_y3_d_x2    d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4   d_y2_d_x4
1    -0.12588268 -0.028605590  0.025801583  0.24238112  0.011737833  0.02504663
5     0.05968877 -0.035038639  0.003830269 -0.14682700 -0.033928416  0.03166356
10    0.15417144  0.004118927 -0.010071111 -0.21652680 -0.001643130 -0.01217360
mean  0.02932584 -0.019841767  0.006520247 -0.04032423 -0.007944571  0.01484553
       d_y3_d_x4
1     0.28544944
5    -0.25548452
10   -0.23940849
mean -0.06981452

, , b_3_1

         d_y1_d_x1   d_y2_d_x1 d_y3_d_x1  d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1    -3.172708e-02 0.003760221 0.1006422 0.00000000  0.000000000 0.00000000
5    -1.245229e-01 0.048919331 0.3650462 0.06229383 -0.013690362 0.05968877
10   -4.433343e-06 0.014931963 0.2725413 0.00000000  0.000000000 0.00000000
mean -5.208480e-02 0.022537172 0.2460766 0.02076461 -0.004563454 0.01989626
       d_y1_d_x3   d_y2_d_x3   d_y3_d_x3   d_y1_d_x4  d_y2_d_x4   d_y3_d_x4
1     0.00000000 0.000000000  0.00000000  0.00000000 0.00000000  0.00000000
5    -0.03503864 0.003830269 -0.14682700 -0.03392842 0.03166356 -0.25548452
10    0.00000000 0.000000000  0.00000000  0.00000000 0.00000000  0.00000000
mean -0.01167955 0.001276756 -0.04894233 -0.01130947 0.01055452 -0.08516151

, , b_3_2

        d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1    -0.023256772 -0.011015572 -0.15915262 -0.008470304 0.01477579 0.2597948
5     0.000000000  0.000000000  0.00000000 -0.062229064 0.03522897 0.4247349
10    0.000000000  0.000000000  0.00000000 -0.011769193 0.01311946 0.2955153
mean -0.007752257 -0.003671857 -0.05305087 -0.027489520 0.02104141 0.3266817
        d_y1_d_x3   d_y2_d_x3  d_y3_d_x3   d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1    -0.028605590 0.025801583 0.24238112 0.011737833 0.025046631 0.28544944
5     0.000000000 0.000000000 0.00000000 0.000000000 0.000000000 0.00000000
10    0.000000000 0.000000000 0.00000000 0.000000000 0.000000000 0.00000000
mean -0.009535197 0.008600528 0.08079371 0.003912611 0.008348877 0.09514981

, , b_3_3

       d_y1_d_x1   d_y2_d_x1   d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1    0.024834133 0.011762689  0.16994694 -0.04878715 0.016637610  0.13442051
5    0.046219800 0.004571824 -0.13832156 -0.03893609 0.008557013 -0.03730783
10   0.001026687 0.014377230  0.16449729 -0.01372414 0.012104684  0.19330245
mean 0.024026873 0.010237248  0.06537422 -0.03381579 0.012433102  0.09680504
        d_y1_d_x3    d_y2_d_x3     d_y3_d_x3    d_y1_d_x4   d_y2_d_x4
1     0.022109401 -0.011103506  0.0008464317 -0.012528867 -0.02535749
5    -0.102906847  0.045699685  0.4576054475  0.020916602 -0.02069456
10    0.003317847 -0.009184429 -0.1307384724 -0.001909584 -0.01529332
mean -0.025826533  0.008470583  0.1092378023  0.002159384 -0.02044846
      d_y3_d_x4
1    -0.3048228
5     0.1606271
10   -0.2999823
mean -0.1480593

, , b_3_4

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1  d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1    -0.0099181812 -0.004697747 -0.06787290 0.01948447 -0.006644679 -0.05368446
5    -0.0607534844 -0.006009421  0.18181638 0.05117943 -0.011247742  0.04903917
10   -0.0003115491 -0.004362780 -0.04991682 0.00416460 -0.003673175 -0.05865776
mean -0.0236610716 -0.005023316  0.02134222 0.02494283 -0.007188532 -0.02110102
        d_y1_d_x3   d_y2_d_x3   d_y3_d_x3    d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1    -0.012217484 0.010580425  0.10349777 -0.003483321 0.025478343 0.3815752
5    -0.029048985 0.003463896 -0.12043699 -0.152433896 0.074854141 0.1554360
10   -0.002065015 0.003856637  0.08169021 -0.000556831 0.008144765 0.2322045
mean -0.014443828 0.005966986  0.02158366 -0.052158016 0.036159083 0.2564053

, , R_1_2

         d_y1_d_x1     d_y2_d_x1    d_y3_d_x1     d_y1_d_x2   d_y2_d_x2
1     0.0119593147 -0.0174661633 2.470719e-03 -0.1075036372 0.060236172
5    -0.2627469940 -0.3102622052 5.436432e-02  0.0008249927 0.141162941
10    0.0002986817 -0.0001412116 5.869527e-06 -0.0079378150 0.006272141
mean -0.0834963325 -0.1092898600 1.894697e-02 -0.0382054865 0.069223751
       d_y3_d_x2   d_y1_d_x3    d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1    0.057426766 0.044659935 -0.029354297 -0.031555314 -0.0024487357
5    0.165725303 0.360245167 -0.353705953 -0.202970973  0.3657518732
10   0.005869358 0.001720846 -0.001033895 -0.000577316  0.0004884981
mean 0.076340476 0.135541983 -0.128031382 -0.078367868  0.1212638786
        d_y2_d_x4     d_y3_d_x4
1    7.283063e-03 -0.0082711615
5    2.865708e-01 -0.1066702282
10   3.885781e-05 -0.0001776357
mean 9.796423e-02 -0.0383730085

, , R_1_3

       d_y1_d_x1     d_y2_d_x1    d_y3_d_x1  d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1    -0.03036766 -0.0028628581 -0.046038902 0.16796613 -0.014779641 0.11986384
5    -0.13515076 -0.1522331795 -0.008299913 0.21839363 -0.004554075 0.33427476
10   -0.00310063  0.0001322236 -0.002880124 0.04099705 -0.003285345 0.03256694
mean -0.05620635 -0.0516546046 -0.019072980 0.14245227 -0.007539687 0.16223518
       d_y1_d_x3     d_y2_d_x3   d_y3_d_x3    d_y1_d_x4    d_y2_d_x4
1    -0.10554595  0.0111022302 -0.08223699  0.023814978 0.0021316282
5    -0.17422175 -0.0339173134 -0.40351056 -0.447486492 0.1727062937
10   -0.01385558  0.0008895662 -0.01219025  0.004973799 0.0002720046
mean -0.09787443 -0.0073085057 -0.16597927 -0.139565905 0.0583699755
       d_y3_d_x4
1    0.030409009
5    0.091260333
10   0.005240253
mean 0.042303198

, , R_2_3

         d_y1_d_x1 d_y2_d_x1  d_y3_d_x1     d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1    -4.065696e-04 0.1000440 -0.1147518  0.0134169502 0.14424394 -0.20173175
5     1.095618e-01 0.1914696 -0.2351233 -0.0474577987 0.19609338 -0.26047393
10   -5.019252e-05 0.1066395 -0.1269163  0.0005696241 0.08873839 -0.08386716
mean  3.636834e-02 0.1327177 -0.1589305 -0.0111570748 0.14302524 -0.18202428
         d_y1_d_x3   d_y2_d_x3  d_y3_d_x3     d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1    -0.0050676477 -0.22102320 0.27909619 -0.0002144118 -0.26449953 0.34100500
5    -0.0632993657 -0.23672175 0.42520432 -0.0563771252 -0.46087578 0.51776361
10   -0.0002664535 -0.08062023 0.07956968  0.0000000000 -0.09790502 0.09765522
mean -0.0228778223 -0.17945506 0.26129006 -0.0188638457 -0.27442678 0.31880794

> print( drop( attr( margEffCondObsM, "jacobian" )[ 4, , ] ) )
                 b_1_0        b_1_1        b_1_2        b_1_3        b_1_4
d_y1_d_x1  0.170543000  0.235387911  0.079039732 -0.144566262  0.110786797
d_y2_d_x1  0.003014012 -0.024669762 -0.001430190 -0.001104578  0.002947919
d_y3_d_x1 -0.015057964 -0.037688614 -0.001512507  0.011345133 -0.012582146
d_y1_d_x2 -0.100219066 -0.061157512  0.112253808  0.115877971 -0.079396369
d_y2_d_x2  0.007756283  0.002230260 -0.022643259 -0.010907806  0.005444762
d_y3_d_x2 -0.006013487 -0.016805090 -0.060558939 -0.017051077 -0.003632459
d_y1_d_x3  0.047629319  0.015556075  0.038491027  0.099185999  0.031405029
d_y2_d_x3  0.002039572  0.006953697 -0.005428991 -0.020750368  0.003380629
d_y3_d_x3  0.017258417  0.030808689 -0.016457206 -0.035074138  0.017452706
d_y1_d_x4 -0.030613243 -0.008652338 -0.026998542  0.039973117  0.137363678
d_y2_d_x4 -0.011825726 -0.013396691  0.001613524  0.007203497 -0.033716385
d_y3_d_x4  0.012071825  0.011087427  0.001258253 -0.008859580 -0.026960258
                 b_2_0        b_2_1        b_2_2        b_2_3        b_2_4
d_y1_d_x1 -0.017791095 -0.023905843 -0.002234972  0.012203208 -0.013793549
d_y2_d_x1  0.023522821  0.290689624 -0.069768968  0.153787542 -0.041139311
d_y3_d_x1  0.007929838  0.017559475 -0.003702010  0.003431481  0.003660021
d_y1_d_x2  0.013312295  0.006608565 -0.016274548 -0.013987911  0.009226432
d_y2_d_x2 -0.018216738 -0.037701971  0.293766966  0.105479788 -0.058368483
d_y3_d_x2  0.003442253  0.006505768  0.027675206  0.007330444  0.001214341
d_y1_d_x3  0.002574966  0.006940744 -0.004600776 -0.020806649  0.003624416
d_y2_d_x3  0.023745820  0.017907897  0.081327537  0.094373833  0.078080135
d_y3_d_x3 -0.007085998 -0.012493710  0.008849403  0.011573486 -0.005212497
d_y1_d_x4  0.012029960  0.010828375  0.001149775 -0.007823834 -0.012320729
d_y2_d_x4  0.026312286  0.021183055  0.105752444 -0.252525778  0.388068994
d_y3_d_x4 -0.007531013 -0.012316074  0.008722652 -0.006620630  0.012658728
                 b_3_0        b_3_1        b_3_2        b_3_3        b_3_4
d_y1_d_x1 -0.032128318 -0.052084800 -0.007752257  0.024026873 -0.023661072
d_y2_d_x1 -0.002287747  0.022537172 -0.003671857  0.010237248 -0.005023316
d_y3_d_x1  0.064448467  0.246076566 -0.053050872  0.065374224  0.021342222
d_y1_d_x2  0.032345438  0.020764608 -0.027489520 -0.033815794  0.024942832
d_y2_d_x2 -0.006538979 -0.004563454  0.021041407  0.012433102 -0.007188532
d_y3_d_x2  0.029325843  0.019896258  0.326681700  0.096805045 -0.021101018
d_y1_d_x3 -0.019841767 -0.011679546 -0.009535197 -0.025826533 -0.014443828
d_y2_d_x3  0.006520247  0.001276756  0.008600528  0.008470583  0.005966986
d_y3_d_x3 -0.040324225 -0.048942332  0.080793705  0.109237802  0.021583661
d_y1_d_x4 -0.007944571 -0.011309472  0.003912611  0.002159384 -0.052158016
d_y2_d_x4  0.014845532  0.010554520  0.008348877 -0.020448458  0.036159083
d_y3_d_x4 -0.069814525 -0.085161507  0.095149814 -0.148059343  0.256405266
                R_1_2        R_1_3       R_2_3
d_y1_d_x1 -0.08349633 -0.056206349  0.03636834
d_y2_d_x1 -0.10928986 -0.051654605  0.13271769
d_y3_d_x1  0.01894697 -0.019072980 -0.15893051
d_y1_d_x2 -0.03820549  0.142452268 -0.01115707
d_y2_d_x2  0.06922375 -0.007539687  0.14302524
d_y3_d_x2  0.07634048  0.162235178 -0.18202428
d_y1_d_x3  0.13554198 -0.097874428 -0.02287782
d_y2_d_x3 -0.12803138 -0.007308506 -0.17945506
d_y3_d_x3 -0.07836787 -0.165979267  0.26129006
d_y1_d_x4  0.12126388 -0.139565905 -0.01886385
d_y2_d_x4  0.09796423  0.058369976 -0.27442678
d_y3_d_x4 -0.03837301  0.042303198  0.31880794
> all.equal( summary( margEffCondObsV )[ , ], summary( margEffCondObsM )[ 1:36, ],
+    check.attributes = FALSE )
[1] TRUE
> summary( margEffCondObsM )[ -( 1:24 ), ]
                    Estimate  Std. error    z value   Pr(> z)
3: d_y1_d_x1     0.001391671 0.008532018  0.1631116 0.8704305
3: d_y2_d_x1     0.231969590 0.513273328  0.4519416 0.6513110
3: d_y3_d_x1    -0.116094853 0.371068155 -0.3128667 0.7543820
3: d_y1_d_x2    -0.018566681 0.103625684 -0.1791707 0.8578037
3: d_y2_d_x2     0.110991010 0.351961409  0.3153499 0.7524960
3: d_y3_d_x2    -0.137815080 0.402763024 -0.3421741 0.7322199
3: d_y1_d_x3     0.005969436 0.031913720  0.1870492 0.8516221
3: d_y2_d_x3    -0.149187187 0.299756283 -0.4976949 0.6186991
3: d_y3_d_x3     0.148226127 0.278394567  0.5324318 0.5944269
3: d_y1_d_x4    -0.004569508 0.023761745 -0.1923052 0.8475031
3: d_y2_d_x4    -0.199201826 0.550661621 -0.3617500 0.7175389
3: d_y3_d_x4     0.165548888 0.459593604  0.3602071 0.7186923
mean: d_y1_d_x1  0.189788204 0.376218960  0.5044621 0.6139367
mean: d_y2_d_x1  0.234169248 0.385716618  0.6071018 0.5437834
mean: d_y3_d_x1 -0.155663711 0.317142247 -0.4908325 0.6235449
mean: d_y1_d_x2 -0.145725401 0.269737944 -0.5402481 0.5890260
mean: d_y2_d_x2  0.195326359 0.359623741  0.5431409 0.5870328
mean: d_y3_d_x2 -0.148943376 0.433865673 -0.3432938 0.7313775
mean: d_y1_d_x3  0.198101158 0.212859941  0.9306643 0.3520272
mean: d_y2_d_x3 -0.352687254 0.268143028 -1.3152953 0.1884107
mean: d_y3_d_x3  0.208142914 0.358342432  0.5808492 0.5613421
mean: d_y1_d_x4 -0.145117866 0.245264670 -0.5916786 0.5540658
mean: d_y2_d_x4 -0.414040021 0.564484958 -0.7334828 0.4632640
mean: d_y3_d_x4  0.307681615 0.464015057  0.6630854 0.5072759
> 
> # for testing state of random number generator
> rnorm( 4 )
[1]  0.1870145  0.3303074 -1.2090711  1.9202205
> 
> 
