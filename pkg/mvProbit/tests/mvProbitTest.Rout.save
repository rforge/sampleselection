
R version 2.13.2 (2011-09-30)
Copyright (C) 2011 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: i686-pc-linux-gnu (32-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library( "mvProbit" )
Loading required package: mvtnorm
Loading required package: maxLik
Loading required package: miscTools
Loading required package: bayesm
Loading required package: abind
> 
> ## generate a simulated data set
> set.seed( 123 )
> # number of observations
> nObs <- 10
> 
> # generate explanatory variables
> xMat <- cbind( 
+    const = rep( 1, nObs ),
+    x1 = as.numeric( rnorm( nObs ) > 0 ),
+    x2 = as.numeric( rnorm( nObs ) > 0 ),
+    x3 = rnorm( nObs ),
+    x4 = rnorm( nObs ) )
> 
> # model coefficients
> beta <- cbind( c(  0.8,  1.2, -1.0,  1.4, -0.8 ),
+                c( -0.6,  1.0,  0.6, -1.2, -1.6 ),
+                c(  0.5, -0.6, -0.7,  1.1,  1.2 ) )
> 
> # covariance matrix of error terms
> sigma <- symMatrix( c( 1, 0.2, 0.4, 1, -0.1, 1 ) )
> 
> # all parameters in a vector
> allCoef <- c( c( beta ), sigma[ lower.tri( sigma ) ] )
> 
> # generate dependent variables
> yMatLin <- xMat %*% beta 
> yMat <- ( yMatLin + rmvnorm( nObs, sigma = sigma ) ) > 0
> colnames( yMat ) <- paste( "y", 1:3, sep = "" )
> # (yMatLin > 0 )== yMat
> 
> # unconditional expectations of dependent variables
> yExp <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ) )
> print( yExp )
           V1         V2         V3
1  0.02086892 0.72542879 0.19411024
2  0.39392340 0.76842941 0.21363900
3  0.12455645 0.78785603 0.19642672
4  0.23485392 0.68069956 0.29183903
5  0.67999333 0.43467562 0.57861599
6  0.02791996 0.97271018 0.03370023
7  0.95816411 0.18630028 0.78414444
8  0.85639266 0.24667543 0.72388317
9  0.06073636 0.96822363 0.03444764
10 0.99787991 0.06734972 0.92257845
> yExpA <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ) )
> all.equal( yExp, yExpA )
[1] TRUE
> yExp2 <- pnorm( yMatLin )
> all.equal( yExp, as.data.frame( yExp2 ) )
[1] TRUE
> 
> 
> # conditional expectations of dependent variables
> # (assuming that all other dependent variables are one)
> yExpCond <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE )
> print( yExpCond )
           V1         V2        V3
1  0.07187274 0.83441226 0.5236193
2  0.66023348 0.77856855 0.3142187
3  0.29709617 0.83846471 0.3994699
4  0.44823829 0.72724816 0.4608874
5  0.84677186 0.44247741 0.6176247
6  0.13901197 0.98492618 0.1616680
7  0.99080074 0.17880919 0.7487862
8  0.95048885 0.24377749 0.7104822
9  0.24434181 0.97834900 0.1330594
10 0.99980223 0.06515097 0.8917154
> yExpCondA <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ), cond = TRUE )
> all.equal( yExpCond, yExpCondA )
[1] TRUE
> yExpCond2 <- matrix( NA, nrow = nObs, ncol = ncol( yMat ) )
> for( i in 1:nObs ) {
+    for( k in 1:ncol( yMat ) ) {
+       set.seed( 123 )
+       numerator <- pmvnorm( upper = yMatLin[ i, ], sigma = sigma )
+       set.seed( 123 )
+       denominator <- pmvnorm( upper = yMatLin[ i, -k ], sigma = sigma[ -k, -k ] )
+       yExpCond2[ i, k ] <- numerator / denominator
+    }
+ }
> all.equal( yExpCond, as.data.frame( yExpCond2 ) )
[1] TRUE
> # now with explicitly specifying the algorithm
> yExpCond3 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz )
> all.equal( yExpCond, yExpCond3 )
[1] TRUE
> identical( yExpCond, yExpCond3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm
> yExpCond4 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = Miwa )
> all.equal( yExpCond, yExpCond4 )
[1] "Component 1: Mean relative difference: 4.435478e-05"
[2] "Component 2: Mean relative difference: 0.0001002261"
[3] "Component 3: Mean relative difference: 5.938566e-05"
> # now with integrals obtained by the Miwa algorithm, less precise
> yExpCond5 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = Miwa( steps = 32 ) )
> all.equal( yExpCond4, yExpCond5 )
[1] "Component 1: Mean relative difference: 1.014946e-05"
[2] "Component 2: Mean relative difference: 1.070674e-05"
[3] "Component 3: Mean relative difference: 9.286508e-06"
> # now with integrals obtained by the TVPACK algorithm
> yExpCond6 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = TVPACK )
> all.equal( yExpCond, yExpCond6 )
[1] "Component 1: Mean relative difference: 4.435948e-05"
[2] "Component 2: Mean relative difference: 0.0001002157"
[3] "Component 3: Mean relative difference: 5.938604e-05"
> # now with integrals obtained by the TVPACK algorithm, less precise
> yExpCond7 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = TVPACK( abseps = 0.5 ) )
> all.equal( yExpCond6, yExpCond7 )
[1] "Component 1: Mean relative difference: 0.03017515"
[2] "Component 2: Mean relative difference: 0.04273065"
[3] "Component 3: Mean relative difference: 0.0424229" 
> # now with integrals obtained by the GHK algorithm
> yExpCond8 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = "GHK" )
> all.equal( yExpCond, yExpCond8 )
[1] "Component 1: Mean relative difference: 0.002370084"
[2] "Component 2: Mean relative difference: 0.005788364"
[3] "Component 3: Mean relative difference: 0.005552991"
> # now with integrals obtained by the GHK algorithm, less precise
> yExpCond9 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = "GHK", nGHK = 100 )
> all.equal( yExpCond8, yExpCond9 )
[1] "Component 1: Mean relative difference: 0.089207"  
[2] "Component 2: Mean relative difference: 0.05716181"
[3] "Component 3: Mean relative difference: 0.0646556" 
> 
> 
> # conditional expectations of dependent variables
> # (assuming that all other dependent variables are as observed)
> yExpCondObs <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE )
> print( yExpCondObs )
           y1         y2         y3
1  0.01446330 0.73515489 0.17239140
2  0.36422466 0.74444655 0.11898201
3  0.10197280 0.78808436 0.15158540
4  0.19744044 0.81305670 0.46088740
5  0.46887344 0.54232735 0.70688505
6  0.02469662 0.97269183 0.02935400
7  0.97137607 0.17880919 0.80927845
8  0.88954588 0.24377749 0.78280394
9  0.05566761 0.96764681 0.02721613
10 0.99859830 0.06515097 0.92560102
> yExpCondObsA <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE )
> all.equal( yExpCondObs, yExpCondObsA )
[1] TRUE
> yExpCondObs2 <- matrix( NA, nrow = nObs, ncol = ncol( yMat ) )
> for( i in 1:nObs ){
+    for( k in 1:ncol( yMat ) ) {
+       ySign <- 2 * yMat[ i, ] - 1
+       ySign[ k ] <- 1
+       yLinTmp <- yMatLin[ i, ] * ySign
+       sigmaTmp <- diag( ySign ) %*% sigma %*% diag( ySign )
+       set.seed( 123 )
+       numerator <- pmvnorm( upper = yLinTmp, sigma = sigmaTmp )
+       set.seed( 123 )
+       denominator <- pmvnorm( upper = yLinTmp[ -k ], sigma = sigmaTmp[ -k, -k ] )
+       yExpCondObs2[ i, k ] <- numerator / denominator
+    }
+ }
> all.equal( yExpCondObs, as.data.frame( yExpCondObs2 ) )
[1] "Names: 3 string mismatches"
> # now with explicitly specifying the algorithm
> yExpCondObs3 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = GenzBretz )
> all.equal( yExpCondObs, yExpCondObs3 )
[1] TRUE
> identical( yExpCondObs, yExpCondObs3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm
> yExpCondObs4 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = Miwa )
> all.equal( yExpCondObs, yExpCondObs4 )
[1] "Component 1: Mean relative difference: 9.258897e-05"
[2] "Component 2: Mean relative difference: 5.029085e-05"
[3] "Component 3: Mean relative difference: 0.0001009532"
> # now with integrals obtained by the Miwa algorithm, less precise
> yExpCondObs5 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = Miwa( steps = 32 ) )
> all.equal( yExpCondObs4, yExpCondObs5 )
[1] "Component 1: Mean relative difference: 4.471818e-06"
[2] "Component 2: Mean relative difference: 3.954285e-06"
[3] "Component 3: Mean relative difference: 4.758699e-06"
> # now with integrals obtained by the TVPACK algorithm
> yExpCondObs6 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = TVPACK )
> all.equal( yExpCondObs, yExpCondObs6 )
[1] "Component 1: Mean relative difference: 9.258463e-05"
[2] "Component 2: Mean relative difference: 5.028616e-05"
[3] "Component 3: Mean relative difference: 0.0001009503"
> # now with integrals obtained by the TVPACK algorithm, less precise
> yExpCondObs7 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = TVPACK( abseps = 0.5 ) )
> all.equal( yExpCondObs6, yExpCondObs7 )
[1] "Component 1: Mean relative difference: 0.05130138"
[2] "Component 2: Mean relative difference: 0.04744355"
[3] "Component 3: Mean relative difference: 0.02586555"
> # now with integrals obtained by the GHK algorithm
> yExpCondObs8 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = "GHK" )
> all.equal( yExpCondObs, yExpCondObs8 )
[1] "Component 1: Mean relative difference: 0.002650961"
[2] "Component 2: Mean relative difference: 0.002438056"
[3] "Component 3: Mean relative difference: 0.00287644" 
> # now with integrals obtained by the GHK algorithm, less precise
> yExpCondObs9 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = "GHK", nGHK = 100 )
> all.equal( yExpCondObs8, yExpCondObs9 )
[1] "Component 1: Mean relative difference: 0.01486969"
[2] "Component 2: Mean relative difference: 0.0173985" 
[3] "Component 3: Mean relative difference: 0.01629308"
> 
> 
> # unconditional expectations of dependent variables by simulation
> nSim <- 10000
> ySim <- array( NA, c( nObs, ncol( yMat ), nSim ) )
> for( s in 1:nSim ) {
+    ySim[ , , s ] <- ( yMatLin + rmvnorm( nObs, sigma = sigma ) ) > 0
+ }
> yExpSim <- matrix( NA, nrow = nObs, ncol = ncol( yMat ) )
> for( i in 1:nObs ) {
+    yExpSim[ i, ] <- rowSums( ySim[ i, , ] ) / nSim
+ }
> print( yExpSim )
        [,1]   [,2]   [,3]
 [1,] 0.0192 0.7292 0.1974
 [2,] 0.4004 0.7599 0.2151
 [3,] 0.1185 0.7867 0.1978
 [4,] 0.2374 0.6843 0.2992
 [5,] 0.6817 0.4368 0.5779
 [6,] 0.0275 0.9709 0.0356
 [7,] 0.9580 0.1843 0.7872
 [8,] 0.8551 0.2551 0.7156
 [9,] 0.0624 0.9697 0.0332
[10,] 0.9984 0.0636 0.9231
> print( yExpSim - as.matrix( yExp ) )
                 V1           V2            V3
 [1,] -0.0016689243  0.003771207  0.0032897559
 [2,]  0.0064765951 -0.008529406  0.0014610027
 [3,] -0.0060564475 -0.001156035  0.0013732843
 [4,]  0.0025460841  0.003600442  0.0073609724
 [5,]  0.0017066657  0.002124382 -0.0007159879
 [6,] -0.0004199629 -0.001810177  0.0018997717
 [7,] -0.0001641098 -0.002000281  0.0030555602
 [8,] -0.0012926616  0.008424570 -0.0082831712
 [9,]  0.0016636425  0.001476372 -0.0012476431
[10,]  0.0005200914 -0.003749723  0.0005215455
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -0.07304505  0.71128820  0.08262612 -1.11816720
> 
> # calculating log likelihood value(s)
> logLikVal <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ) )
> print( logLikVal )
 [1] -0.53540368 -0.94155840 -0.55161623 -2.32656485 -2.25902218 -0.08645378
 [7] -0.46570791 -0.70386950 -0.12392314 -0.14927833
> logLikValA <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ) )
> all.equal( logLikVal, logLikValA )
[1] TRUE
> # now with explicitly specifying the algorithm
> logLikVal3 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = GenzBretz )
> all.equal( logLikVal, logLikVal3 )
[1] TRUE
> identical( logLikVal, logLikVal3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm
> logLikVal4 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = Miwa )
> all.equal( logLikVal, logLikVal4 )
[1] "Mean relative difference: 8.840686e-05"
> # now with integrals obtained by the Miwa algorithm, less precise
> logLikVal5 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = Miwa( steps = 32 ) )
> all.equal( logLikVal4, logLikVal5 )
[1] "Mean relative difference: 4.53253e-06"
> # now with integrals obtained by the TVPACK algorithm
> logLikVal6 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = TVPACK )
> all.equal( logLikVal, logLikVal6 )
[1] "Mean relative difference: 8.840067e-05"
> # now with integrals obtained by the TVPACK algorithm, less precise
> logLikVal7 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = TVPACK( abseps = 0.5 ) )
> all.equal( logLikVal6, logLikVal7 )
[1] "Mean relative difference: 0.05527167"
> # now with integrals obtained by the GHK algorithm
> logLikVal8 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = "GHK" )
> all.equal( logLikVal, logLikVal8 )
[1] "Mean relative difference: 0.002220837"
> # now with integrals obtained by the GHK algorithm, less precise
> logLikVal9 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = "GHK", nGHK = 100 )
> all.equal( logLikVal8, logLikVal9 )
[1] "Mean relative difference: 0.01480876"
> 
> # calculating log likelihood value(s) with one-sided gradients
> logLikValGrad <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    oneSidedGrad = TRUE )
> print( logLikValGrad )
 [1] -0.53540368 -0.94155840 -0.55161623 -2.32656485 -2.25902218 -0.08645378
 [7] -0.46570791 -0.70386950 -0.12392314 -0.14927833
attr(,"gradient")
             b_1_0       b_1_1       b_1_2        b_1_3        b_1_4
 [1,] -0.039483841  0.00000000 -0.03948384  0.042161678 -0.016838434
 [2,] -0.620181812  0.00000000 -0.62018181  0.135183996  0.182997851
 [3,] -0.208837065 -0.20883706 -0.20883706  0.214267423 -0.186935400
 [4,]  1.493926467  1.49392647  1.49392647 -1.088910460  1.311866906
 [5,]  0.917269941  0.91726994  0.00000000 -0.573330124  0.753611686
 [6,] -0.060924129 -0.06092413 -0.06092413  0.102760036 -0.041954794
 [7,]  0.071223816  0.07122382  0.07122382  0.059670401  0.039452148
 [8,]  0.224807263  0.00000000  0.00000000  0.034479413 -0.013918213
 [9,] -0.121700445  0.00000000 -0.12170044  0.138511513  0.037235750
[10,]  0.004787314  0.00000000  0.00000000  0.006002404 -0.001821438
            b_2_0      b_2_1       b_2_2       b_2_3       b_2_4       b_3_0
 [1,]  0.44704993  0.0000000  0.44704993 -0.47737105  0.19065086 -0.31393241
 [2,]  0.43840786  0.0000000  0.43840786 -0.09556198 -0.12936175 -0.24068300
 [3,]  0.37076298  0.3707630  0.37076298 -0.38040492  0.33187948 -0.28829263
 [4,]  0.33970605  0.3397061  0.33970605 -0.24760903  0.29830728 -0.79100711
 [5,] -0.88642408 -0.8864241  0.00000000  0.55404951 -0.72826921 -1.24501533
 [6,]  0.06467570  0.0646757  0.06467570 -0.10908836  0.04453830 -0.07038947
 [7,] -0.31973919 -0.3197392 -0.31973919 -0.26787333 -0.17710913  0.34377267
 [8,] -0.41846140  0.0000000  0.00000000 -0.06418070  0.02590765  0.39132057
 [9,]  0.07517436  0.0000000  0.07517436 -0.08555889 -0.02300058 -0.06658594
[10,] -0.13608740  0.0000000  0.00000000 -0.17062845  0.05177725  0.15270486
            b_3_1       b_3_2      b_3_3       b_3_4         R_1_2        R_1_3
 [1,]  0.00000000 -0.31393241 0.33522403 -0.13388089 -0.0089522200  0.031648334
 [2,]  0.00000000 -0.24068300 0.05246281  0.07101862 -0.2109161681  0.242606606
 [3,] -0.28829263 -0.28829263 0.29578911 -0.25805811 -0.0489604016  0.118484255
 [4,] -0.79100711 -0.79100711 0.57655770 -0.69460979  0.5931737070 -0.947273870
 [5,] -1.24501533  0.00000000 0.77818304 -1.02288098 -0.6958962371 -0.901556093
 [6,] -0.07038947 -0.07038947 0.11872513 -0.04847301 -0.0020805973  0.015112572
 [7,]  0.34377267  0.34377267 0.28800831  0.19042180 -0.0121688745  0.055215327
 [8,]  0.00000000  0.00000000 0.06001809 -0.02422734 -0.0620710172  0.159552938
 [9,]  0.00000000 -0.06658594 0.07578375  0.02037278 -0.0038911046  0.024566263
[10,]  0.00000000  0.00000000 0.19146359 -0.05809983 -0.0003026088  0.003157443
             R_2_3
 [1,] -0.161540001
 [2,] -0.132532626
 [3,] -0.129196504
 [4,] -0.319508443
 [5,]  1.016442887
 [6,] -0.006549753
 [7,] -0.129101410
 [8,] -0.192174063
 [9,] -0.007700663
[10,] -0.026654477
> logLikValGradA <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ),
+    oneSidedGrad = TRUE )
> all.equal( logLikValGrad, logLikValGradA )
[1] TRUE
> 
> # calculating log likelihood value(s) with two-sided gradients
> llTmp <- function( coef ) {
+    betaTmp <- coef[ 1:15 ]
+    sigmaTmp <- diag( 3 )
+    sigmaTmp[ lower.tri( sigmaTmp ) ] <- coef[ -(1:15) ]
+    sigmaTmp[ upper.tri( sigmaTmp ) ] <- t( sigmaTmp )[ upper.tri( sigmaTmp ) ]
+    result <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+       coef = betaTmp, sigma = sigmaTmp, 
+       data = as.data.frame( cbind( xMat, yMat ) ) )
+    return( result )
+ }
> logLikValGrad2 <- numericGradient( llTmp, allCoef )
> print( logLikValGrad2 )
              [,1]        [,2]        [,3]         [,4]         [,5]
 [1,] -0.039483794  0.00000000 -0.03948379  0.042161731 -0.016838426
 [2,] -0.620181508  0.00000000 -0.62018151  0.135184012  0.182997877
 [3,] -0.208836904 -0.20883690 -0.20883690  0.214267592 -0.186935271
 [4,]  1.493926913  1.49392691  1.49392691 -1.088910224  1.311867250
 [5,]  0.917270326  0.91727033  0.00000000 -0.573329973  0.753611947
 [6,] -0.060924066 -0.06092407 -0.06092407  0.102760215 -0.041954764
 [7,]  0.071223890  0.07122389  0.07122389  0.059670453  0.039452170
 [8,]  0.224807433  0.00000000  0.00000000  0.034479417 -0.013918213
 [9,] -0.121700338  0.00000000 -0.12170034  0.138511650  0.037235760
[10,]  0.004787322  0.00000000  0.00000000  0.006002416 -0.001821437
             [,6]        [,7]        [,8]        [,9]       [,10]       [,11]
 [1,]  0.44705018  0.00000000  0.44705018 -0.47737078  0.19065091 -0.31393221
 [2,]  0.43840810  0.00000000  0.43840810 -0.09556197 -0.12936173 -0.24068282
 [3,]  0.37076320  0.37076320  0.37076320 -0.38040469  0.33187965 -0.28829243
 [4,]  0.33970627  0.33970627  0.33970627 -0.24760892  0.29830745 -0.79100675
 [5,] -0.88642374 -0.88642374  0.00000000  0.55404964 -0.72826897 -1.24501491
 [6,]  0.06467576  0.06467576  0.06467576 -0.10908818  0.04453834 -0.07038940
 [7,] -0.31973900 -0.31973900 -0.31973900 -0.26787319 -0.17710907  0.34377288
 [8,] -0.41846116  0.00000000  0.00000000 -0.06418069  0.02590765  0.39132081
 [9,]  0.07517443  0.00000000  0.07517443 -0.08555880 -0.02300057 -0.06658587
[10,] -0.13608729  0.00000000  0.00000000 -0.17062827  0.05177727  0.15270498
           [,12]       [,13]      [,14]       [,15]         [,16]        [,17]
 [1,]  0.0000000 -0.31393221 0.33522426 -0.13388086 -0.0089522338  0.031648323
 [2,]  0.0000000 -0.24068282 0.05246282  0.07101864 -0.2109161814  0.242606594
 [3,] -0.2882924 -0.28829243 0.29578932 -0.25805795 -0.0489604439  0.118484204
 [4,] -0.7910068 -0.79100675 0.57655789 -0.69460952  0.5931740810 -0.947273090
 [5,] -1.2450149  0.00000000 0.77818321 -1.02288070 -0.6958959089 -0.901555435
 [6,] -0.0703894 -0.07038940 0.11872533 -0.04847297 -0.0020805997  0.015112555
 [7,]  0.3437729  0.34377288 0.28800846  0.19042187 -0.0121688919  0.055215307
 [8,]  0.0000000  0.00000000 0.06001809 -0.02422734 -0.0620710620  0.159552892
 [9,]  0.0000000 -0.06658587 0.07578384  0.02037279 -0.0038911139  0.024566240
[10,]  0.0000000  0.00000000 0.19146378 -0.05809982 -0.0003026087  0.003157441
             [,18]
 [1,] -0.161540032
 [2,] -0.132532661
 [3,] -0.129196543
 [4,] -0.319508409
 [5,]  1.016443490
 [6,] -0.006549763
 [7,] -0.129101448
 [8,] -0.192174094
 [9,] -0.007700674
[10,] -0.026654501
> attr( logLikValGrad, "gradient" ) / logLikValGrad2 - 1
              b_1_0         b_1_1         b_1_2         b_1_3         b_1_4
 [1,]  1.169727e-06           NaN  1.169727e-06 -1.248160e-06  5.010976e-07
 [2,]  4.905034e-07           NaN  4.905034e-07 -1.125137e-07 -1.462114e-07
 [3,]  7.713836e-07  7.713836e-07  7.713836e-07 -7.906937e-07  6.907147e-07
 [4,] -2.984521e-07 -2.984521e-07 -2.984521e-07  2.173729e-07 -2.620121e-07
 [5,] -4.202354e-07 -4.202354e-07           NaN  2.625822e-07 -3.453187e-07
 [6,]  1.037576e-06  1.037576e-06  1.037576e-06 -1.742823e-06  7.131612e-07
 [7,] -1.035809e-06 -1.035809e-06 -1.035809e-06 -8.716868e-07 -5.740761e-07
 [8,] -7.585615e-07           NaN           NaN -1.159185e-07  6.381412e-08
 [9,]  8.733745e-07           NaN  8.733745e-07 -9.937063e-07 -2.716987e-07
[10,] -1.623363e-06           NaN           NaN -1.955981e-06  5.638164e-07
              b_2_0         b_2_1         b_2_2         b_2_3         b_2_4
 [1,] -5.396519e-07           NaN -5.396519e-07  5.758443e-07 -2.294392e-07
 [2,] -5.538351e-07           NaN -5.538351e-07  1.254726e-07  1.647804e-07
 [3,] -5.893031e-07 -5.893031e-07 -5.893031e-07  6.047197e-07 -5.272126e-07
 [4,] -6.248770e-07 -6.248770e-07 -6.248770e-07  4.573452e-07 -5.523063e-07
 [5,]  3.897700e-07  3.897700e-07           NaN -2.436661e-07  3.201384e-07
 [6,] -9.979873e-07 -9.979873e-07 -9.979873e-07  1.682308e-06 -6.879951e-07
 [7,]  6.222324e-07  6.222324e-07  6.222324e-07  5.195236e-07  3.422647e-07
 [8,]  5.603366e-07           NaN           NaN  8.649198e-08 -4.285310e-08
 [9,] -9.653143e-07           NaN -9.653143e-07  1.097295e-06  2.956499e-07
[10,]  8.286660e-07           NaN           NaN  1.037164e-06 -3.194901e-07
              b_3_0         b_3_1         b_3_2         b_3_3         b_3_4
 [1,]  6.348028e-07           NaN  6.348028e-07 -6.779421e-07  2.695101e-07
 [2,]  7.486583e-07           NaN  7.486583e-07 -1.756454e-07 -2.266762e-07
 [3,]  6.754708e-07  6.754708e-07  6.754708e-07 -6.940083e-07  6.066135e-07
 [4,]  4.508225e-07  4.508225e-07  4.508225e-07 -3.288934e-07  3.951099e-07
 [5,]  3.381458e-07  3.381458e-07           NaN -2.122909e-07  2.774253e-07
 [6,]  1.001559e-06  1.001559e-06  1.001559e-06 -1.686604e-06  6.934174e-07
 [7,] -6.152245e-07 -6.152245e-07 -6.152245e-07 -5.155832e-07 -3.419491e-07
 [8,] -5.986317e-07           NaN           NaN -9.434051e-08  4.124269e-08
 [9,]  1.026049e-06           NaN  1.026049e-06 -1.165397e-06 -3.119861e-07
[10,] -8.031951e-07           NaN           NaN -1.005913e-06  3.086086e-07
              R_1_2        R_1_3         R_2_3
 [1,] -1.550204e-06 3.543080e-07 -1.876259e-07
 [2,] -6.316574e-08 4.713515e-08 -2.680633e-07
 [3,] -8.639525e-07 4.254080e-07 -2.990464e-07
 [4,] -6.303767e-07 8.236957e-07  1.056335e-07
 [5,]  4.715963e-07 7.295127e-07 -5.933169e-07
 [6,] -1.107235e-06 1.105627e-06 -1.567929e-06
 [7,] -1.432382e-06 3.538860e-07 -2.906671e-07
 [8,] -7.208188e-07 2.901627e-07 -1.606054e-07
 [9,] -2.389577e-06 9.292818e-07 -1.400272e-06
[10,]  3.668841e-07 6.856613e-07 -9.048976e-07
> range( attr( logLikValGrad, "gradient" ) / logLikValGrad2 - 1, na.rm = TRUE )
[1] -2.389577e-06  1.682308e-06
> attr( logLikValGrad, "gradient" ) - logLikValGrad2
              b_1_0         b_1_1         b_1_2         b_1_3         b_1_4
 [1,] -4.618528e-08  0.000000e+00 -4.618528e-08 -5.262457e-08 -8.437695e-09
 [2,] -3.042011e-07  0.000000e+00 -3.042011e-07 -1.521006e-08 -2.675637e-08
 [3,] -1.610934e-07 -1.610934e-07 -1.610934e-07 -1.694200e-07 -1.291189e-07
 [4,] -4.458656e-07 -4.458656e-07 -4.458656e-07 -2.366995e-07 -3.437250e-07
 [5,] -3.854694e-07 -3.854694e-07  0.000000e+00 -1.505462e-07 -2.602363e-07
 [6,] -6.321332e-08 -6.321332e-08 -6.321332e-08 -1.790929e-07 -2.992051e-08
 [7,] -7.377432e-08 -7.377432e-08 -7.377432e-08 -5.201395e-08 -2.264855e-08
 [8,] -1.705303e-07  0.000000e+00  0.000000e+00 -3.996803e-09 -8.881784e-10
 [9,] -1.062900e-07  0.000000e+00 -1.062900e-07 -1.376399e-07 -1.011691e-08
[10,] -7.771561e-09  0.000000e+00  0.000000e+00 -1.174061e-08 -1.026956e-09
              b_2_0         b_2_1         b_2_2         b_2_3         b_2_4
 [1,] -2.412515e-07  0.000000e+00 -2.412515e-07 -2.748912e-07 -4.374279e-08
 [2,] -2.428058e-07  0.000000e+00 -2.428058e-07 -1.199041e-08 -2.131628e-08
 [3,] -2.184919e-07 -2.184919e-07 -2.184919e-07 -2.300382e-07 -1.749711e-07
 [4,] -2.122746e-07 -2.122746e-07 -2.122746e-07 -1.132427e-07 -1.647571e-07
 [5,] -3.455014e-07 -3.455014e-07  0.000000e+00 -1.350031e-07 -2.331468e-07
 [6,] -6.454559e-08 -6.454559e-08 -6.454559e-08 -1.835199e-07 -3.064216e-08
 [7,] -1.989520e-07 -1.989520e-07 -1.989520e-07 -1.391665e-07 -6.061818e-08
 [8,] -2.344791e-07  0.000000e+00  0.000000e+00 -5.551115e-09 -1.110223e-09
 [9,] -7.256695e-08  0.000000e+00 -7.256695e-08 -9.388323e-08 -6.800116e-09
[10,] -1.127709e-07  0.000000e+00  0.000000e+00 -1.769696e-07 -1.654232e-08
              b_3_0         b_3_1         b_3_2         b_3_3         b_3_4
 [1,] -1.992850e-07  0.000000e+00 -1.992850e-07 -2.272627e-07 -3.608225e-08
 [2,] -1.801892e-07  0.000000e+00 -1.801892e-07 -9.214851e-09 -1.609823e-08
 [3,] -1.947331e-07 -1.947331e-07 -1.947331e-07 -2.052802e-07 -1.565414e-07
 [4,] -3.566036e-07 -3.566036e-07 -3.566036e-07 -1.896261e-07 -2.744471e-07
 [5,] -4.209966e-07 -4.209966e-07  0.000000e+00 -1.652012e-07 -2.837730e-07
 [6,] -7.049916e-08 -7.049916e-08 -7.049916e-08 -2.002426e-07 -3.361200e-08
 [7,] -2.114975e-07 -2.114975e-07 -2.114975e-07 -1.484923e-07 -6.511458e-08
 [8,] -2.342571e-07  0.000000e+00  0.000000e+00 -5.662137e-09 -9.992007e-10
 [9,] -6.832035e-08  0.000000e+00 -6.832035e-08 -8.831824e-08 -6.356027e-09
[10,] -1.226519e-07  0.000000e+00  0.000000e+00 -1.925959e-07 -1.793010e-08
              R_1_2         R_1_3         R_2_3
 [1,]  1.387779e-08  1.121325e-08  3.030909e-08
 [2,]  1.332268e-08  1.143530e-08  3.552714e-08
 [3,]  4.229950e-08  5.040413e-08  3.863576e-08
 [4,] -3.739231e-07 -7.802647e-07 -3.375078e-08
 [5,] -3.281819e-07 -6.576961e-07 -6.030731e-07
 [6,]  2.303713e-09  1.670886e-08  1.026956e-08
 [7,]  1.743050e-08  1.953993e-08  3.752554e-08
 [8,]  4.474199e-08  4.629630e-08  3.086420e-08
 [9,]  9.298118e-09  2.282896e-08  1.078304e-08
[10,] -1.110223e-10  2.164935e-09  2.411960e-08
> range( attr( logLikValGrad, "gradient" ) - logLikValGrad2 )
[1] -7.802647e-07  5.040413e-08
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -1.3162070  0.7625245  0.9035873  1.6774175
> 
> # calculating marginal effects, unconditional
> margEffUnc <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ) )
> print( margEffUnc )
     d_y1_d_x1  d_y2_d_x1   d_y3_d_x1   d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.180673491 0.21966598 -0.12235589 -0.12920309 0.22580951 -0.24120841
2  0.430121958 0.19008353 -0.13195878 -0.37365413 0.21525553 -0.24897191
3  0.115232772 0.36750507 -0.20314566 -0.31483718 0.20898573 -0.24219913
4  0.207611034 0.38276287 -0.22888859 -0.37427350 0.23255246 -0.26855955
5  0.448006648 0.31256137 -0.20905150 -0.38274109 0.23373092 -0.27065767
6  0.026991730 0.15092034 -0.07583674 -0.15288996 0.06575970 -0.09574988
7  0.256300597 0.15702898 -0.13302286 -0.03866694 0.11839993 -0.14725130
8  0.131828020 0.37694792 -0.22611070 -0.33077755 0.21945964 -0.26592681
9  0.302950354 0.02962659 -0.02666829 -0.23089623 0.07290773 -0.09709985
10 0.002095525 0.24265946 -0.12793733 -0.02934265 0.11782358 -0.15753170
     d_y1_d_x3   d_y2_d_x3  d_y3_d_x3    d_y1_d_x4  d_y2_d_x4  d_y3_d_x4
1  0.070272979 -0.40009837 0.30243692 -0.040155988 -0.5334645 0.32993118
2  0.538657270 -0.36576535 0.32022425 -0.307804155 -0.4876871 0.34933554
3  0.287479936 -0.34790671 0.30462485 -0.164274249 -0.4638756 0.33231802
4  0.430074036 -0.42873970 0.37764850 -0.245756592 -0.5716529 0.41198018
5  0.500659694 -0.47229842 0.43028800 -0.286091254 -0.6297312 0.46940509
6  0.089736371 -0.07546714 0.08239434 -0.051277926 -0.1006229 0.08988474
7  0.125115932 -0.32171038 0.32215058 -0.071494819 -0.4289472 0.35143700
8  0.317022613 -0.37862010 0.36777139 -0.181155779 -0.5048268 0.40120515
9  0.168371792 -0.08563215 0.08389399 -0.096212453 -0.1141762 0.09152071
10 0.009358606 -0.15639629 0.15952285 -0.005347775 -0.2085284 0.17402492
> print( attr( margEffUnc, "vcov" )[ 1:3, , ] )
, , d_y1_d_x1

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1   d_y1_d_x2 d_y2_d_x2 d_y3_d_x2   d_y1_d_x3
1 0.2564698         0         0 -0.08661131         0         0  0.09744905
2 0.1008447         0         0 -0.05986199         0         0 -0.02844159
3 0.1674119         0         0 -0.09902071         0         0  0.26023601
  d_y2_d_x3 d_y3_d_x3   d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0 -0.05781657         0         0
2         0         0  0.03659348         0         0
3         0         0 -0.13728858         0         0

, , d_y2_d_x1

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2   d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0 0.1765481         0         0 -0.04029736         0         0
2         0 0.1075070         0         0 -0.04364529         0         0
3         0 0.1234019         0         0 -0.02945168         0         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1 -0.097915801         0         0 -0.26769461         0
2 -0.109336365         0         0 -0.14558760         0
3  0.002432325         0         0 -0.06309096         0

, , d_y3_d_x1

  d_y1_d_x1 d_y2_d_x1  d_y3_d_x1 d_y1_d_x2 d_y2_d_x2     d_y3_d_x2 d_y1_d_x3
1         0         0 0.08208219         0         0  0.0001099928         0
2         0         0 0.06470109         0         0 -0.0239228542         0
3         0         0 0.12273407         0         0 -0.0261632905         0
  d_y2_d_x3    d_y3_d_x3 d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1         0 -0.079194188         0         0 -0.14680413
2         0 -0.067131884         0         0 -0.07088253
3         0 -0.006506468         0         0 -0.06807511

, , d_y1_d_x2

    d_y1_d_x1 d_y2_d_x1 d_y3_d_x1  d_y1_d_x2 d_y2_d_x2 d_y3_d_x2   d_y1_d_x3
1 -0.08661131         0         0 0.08031764         0         0 -0.04382394
2 -0.05986199         0         0 0.15517620         0         0  0.06217912
3 -0.09902071         0         0 0.17981312         0         0 -0.13346502
  d_y2_d_x3 d_y3_d_x3   d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0  0.02673009         0         0
2         0         0 -0.04830155         0         0
3         0         0  0.06428859         0         0

, , d_y2_d_x2

  d_y1_d_x1   d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0 -0.04029736         0         0 0.1211364         0         0
2         0 -0.04364529         0         0 0.1022165         0         0
3         0 -0.02945168         0         0 0.1235233         0         0
    d_y2_d_x3 d_y3_d_x3 d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1 0.066766147         0         0  0.04861638         0
2 0.060209903         0         0  0.08043447         0
3 0.002311839         0         0 -0.06335383         0

, , d_y3_d_x2

  d_y1_d_x1 d_y2_d_x1     d_y3_d_x1 d_y1_d_x2 d_y2_d_x2  d_y3_d_x2 d_y1_d_x3
1         0         0  0.0001099928         0         0 0.10833600         0
2         0         0 -0.0239228542         0         0 0.09751318         0
3         0         0 -0.0261632905         0         0 0.12970073         0
  d_y2_d_x3   d_y3_d_x3 d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1         0  0.03463963         0         0 -0.01415309
2         0  0.05014047         0         0  0.05646171
3         0 -0.01224217         0         0 -0.07878328

, , d_y1_d_x3

    d_y1_d_x1 d_y2_d_x1 d_y3_d_x1   d_y1_d_x2 d_y2_d_x2 d_y3_d_x2  d_y1_d_x3
1  0.09744905         0         0 -0.04382394         0         0 0.05519444
2 -0.02844159         0         0  0.06217912         0         0 0.16858145
3  0.26023601         0         0 -0.13346502         0         0 0.43536172
  d_y2_d_x3 d_y3_d_x3   d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0 -0.03141958         0         0
2         0         0 -0.03511751         0         0
3         0         0 -0.20370174         0         0

, , d_y2_d_x3

  d_y1_d_x1    d_y2_d_x1 d_y3_d_x1 d_y1_d_x2   d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0 -0.097915801         0         0 0.066766147         0         0
2         0 -0.109336365         0         0 0.060209903         0         0
3         0  0.002432325         0         0 0.002311839         0         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1 0.1313756         0         0 0.1749157         0
2 0.2109079         0         0 0.1569556         0
3 0.2937223         0         0 0.4618055         0

, , d_y3_d_x3

  d_y1_d_x1 d_y2_d_x1    d_y3_d_x1 d_y1_d_x2 d_y2_d_x2   d_y3_d_x2 d_y1_d_x3
1         0         0 -0.079194188         0         0  0.03463963         0
2         0         0 -0.067131884         0         0  0.05014047         0
3         0         0 -0.006506468         0         0 -0.01224217         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0 0.1486290         0         0 0.1938577
2         0 0.1904320         0         0 0.1110289
3         0 0.2575761         0         0 0.3425420

, , d_y1_d_x4

    d_y1_d_x1 d_y2_d_x1 d_y3_d_x1   d_y1_d_x2 d_y2_d_x2 d_y3_d_x2   d_y1_d_x3
1 -0.05781657         0         0  0.02673009         0         0 -0.03141958
2  0.03659348         0         0 -0.04830155         0         0 -0.03511751
3 -0.13728858         0         0  0.06428859         0         0 -0.20370174
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0 0.0212286         0         0
2         0         0 0.1814940         0         0
3         0         0 0.1465652         0         0

, , d_y2_d_x4

  d_y1_d_x1   d_y2_d_x1 d_y3_d_x1 d_y1_d_x2   d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0 -0.26769461         0         0  0.04861638         0         0
2         0 -0.14558760         0         0  0.08043447         0         0
3         0 -0.06309096         0         0 -0.06335383         0         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1 0.1749157         0         0 0.5415602         0
2 0.1569556         0         0 0.3018392         0
3 0.4618055         0         0 0.9430112         0

, , d_y3_d_x4

  d_y1_d_x1 d_y2_d_x1   d_y3_d_x1 d_y1_d_x2 d_y2_d_x2   d_y3_d_x2 d_y1_d_x3
1         0         0 -0.14680413         0         0 -0.01415309         0
2         0         0 -0.07088253         0         0  0.05646171         0
3         0         0 -0.06807511         0         0 -0.07878328         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0 0.1938577         0         0 0.4116036
2         0 0.1110289         0         0 0.2012376
3         0 0.3425420         0         0 0.6088070

> print( drop( attr( margEffUnc, "vcov" )[ nObs, , ] ) )
              d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2   d_y2_d_x2
d_y1_d_x1  0.0001176217  0.00000000  0.00000000 -0.001145678  0.00000000
d_y2_d_x1  0.0000000000  0.25892667  0.00000000  0.000000000  0.08265483
d_y3_d_x1  0.0000000000  0.00000000  0.13368957  0.000000000  0.00000000
d_y1_d_x2 -0.0011456777  0.00000000  0.00000000  0.016169819  0.00000000
d_y2_d_x2  0.0000000000  0.08265483  0.00000000  0.000000000  0.12214353
d_y3_d_x2  0.0000000000  0.00000000  0.06144675  0.000000000  0.00000000
d_y1_d_x3  0.0004241711  0.00000000  0.00000000 -0.004131967  0.00000000
d_y2_d_x3  0.0000000000 -0.10505796  0.00000000  0.000000000 -0.06458081
d_y3_d_x3  0.0000000000  0.00000000 -0.06060693  0.000000000  0.00000000
d_y1_d_x4 -0.0002561128  0.00000000  0.00000000  0.002494864  0.00000000
d_y2_d_x4  0.0000000000 -0.19954825  0.00000000  0.000000000 -0.12266551
d_y3_d_x4  0.0000000000  0.00000000 -0.10147712  0.000000000  0.00000000
            d_y3_d_x2     d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4
d_y1_d_x1  0.00000000  0.0004241711  0.00000000  0.00000000 -0.0002561128
d_y2_d_x1  0.00000000  0.0000000000 -0.10505796  0.00000000  0.0000000000
d_y3_d_x1  0.06144675  0.0000000000  0.00000000 -0.06060693  0.0000000000
d_y1_d_x2  0.00000000 -0.0041319665  0.00000000  0.00000000  0.0024948643
d_y2_d_x2  0.00000000  0.0000000000 -0.06458081  0.00000000  0.0000000000
d_y3_d_x2  0.16593068  0.0000000000  0.00000000 -0.07053988  0.0000000000
d_y1_d_x3  0.00000000  0.0015480656  0.00000000  0.00000000 -0.0009160401
d_y2_d_x3  0.00000000  0.0000000000  0.08924980  0.00000000  0.0000000000
d_y3_d_x3 -0.07053988  0.0000000000  0.00000000  0.07843335  0.0000000000
d_y1_d_x4  0.00000000 -0.0009160401  0.00000000  0.00000000  0.0006001752
d_y2_d_x4  0.00000000  0.0000000000  0.15889452  0.00000000  0.0000000000
d_y3_d_x4 -0.11810834  0.0000000000  0.00000000  0.12018467  0.0000000000
           d_y2_d_x4  d_y3_d_x4
d_y1_d_x1  0.0000000  0.0000000
d_y2_d_x1 -0.1995483  0.0000000
d_y3_d_x1  0.0000000 -0.1014771
d_y1_d_x2  0.0000000  0.0000000
d_y2_d_x2 -0.1226655  0.0000000
d_y3_d_x2  0.0000000 -0.1181083
d_y1_d_x3  0.0000000  0.0000000
d_y2_d_x3  0.1588945  0.0000000
d_y3_d_x3  0.0000000  0.1201847
d_y1_d_x4  0.0000000  0.0000000
d_y2_d_x4  0.3122228  0.0000000
d_y3_d_x4  0.0000000  0.2149662
> summary( margEffUnc )
               Estimate Std. error z value Pr(> z)  
1: d_y1_d_x1   0.180673   0.506428   0.357   0.721  
1: d_y2_d_x1   0.219666   0.420176   0.523   0.601  
1: d_y3_d_x1  -0.122356   0.286500  -0.427   0.669  
1: d_y1_d_x2  -0.129203   0.283404  -0.456   0.648  
1: d_y2_d_x2   0.225810   0.348047   0.649   0.516  
1: d_y3_d_x2  -0.241208   0.329144  -0.733   0.464  
1: d_y1_d_x3   0.070273   0.234935   0.299   0.765  
1: d_y2_d_x3  -0.400098   0.362458  -1.104   0.270  
1: d_y3_d_x3   0.302437   0.385524   0.784   0.433  
1: d_y1_d_x4  -0.040156   0.145700  -0.276   0.783  
1: d_y2_d_x4  -0.533464   0.735908  -0.725   0.469  
1: d_y3_d_x4   0.329931   0.641563   0.514   0.607  
2: d_y1_d_x1   0.430122   0.317561   1.354   0.176  
2: d_y2_d_x1   0.190084   0.327883   0.580   0.562  
2: d_y3_d_x1  -0.131959   0.254364  -0.519   0.604  
2: d_y1_d_x2  -0.373654   0.393924  -0.949   0.343  
2: d_y2_d_x2   0.215256   0.319713   0.673   0.501  
2: d_y3_d_x2  -0.248972   0.312271  -0.797   0.425  
2: d_y1_d_x3   0.538657   0.410587   1.312   0.190  
2: d_y2_d_x3  -0.365765   0.459247  -0.796   0.426  
2: d_y3_d_x3   0.320224   0.436385   0.734   0.463  
2: d_y1_d_x4  -0.307804   0.426021  -0.723   0.470  
2: d_y2_d_x4  -0.487687   0.549399  -0.888   0.375  
2: d_y3_d_x4   0.349336   0.448595   0.779   0.436  
3: d_y1_d_x1   0.115233   0.409160   0.282   0.778  
3: d_y2_d_x1   0.367505   0.351286   1.046   0.295  
3: d_y3_d_x1  -0.203146   0.350334  -0.580   0.562  
3: d_y1_d_x2  -0.314837   0.424044  -0.742   0.458  
3: d_y2_d_x2   0.208986   0.351459   0.595   0.552  
3: d_y3_d_x2  -0.242199   0.360140  -0.673   0.501  
3: d_y1_d_x3   0.287480   0.659819   0.436   0.663  
3: d_y2_d_x3  -0.347907   0.541962  -0.642   0.521  
3: d_y3_d_x3   0.304625   0.507520   0.600   0.548  
3: d_y1_d_x4  -0.164274   0.382838  -0.429   0.668  
3: d_y2_d_x4  -0.463876   0.971088  -0.478   0.633  
3: d_y3_d_x4   0.332318   0.780261   0.426   0.670  
4: d_y1_d_x1   0.207611   0.540019   0.384   0.701  
4: d_y2_d_x1   0.382763   0.357810   1.070   0.285  
4: d_y3_d_x1  -0.228889   0.357614  -0.640   0.522  
4: d_y1_d_x2  -0.374273   0.337358  -1.109   0.267  
4: d_y2_d_x2   0.232552   0.363994   0.639   0.523  
4: d_y3_d_x2  -0.268560   0.355628  -0.755   0.450  
4: d_y1_d_x3   0.430074   0.609214   0.706   0.480  
4: d_y2_d_x3  -0.428740   0.444104  -0.965   0.334  
4: d_y3_d_x3   0.377649   0.445589   0.848   0.397  
4: d_y1_d_x4  -0.245757   0.366437  -0.671   0.502  
4: d_y2_d_x4  -0.571653   0.778425  -0.734   0.463  
4: d_y3_d_x4   0.411980   0.688004   0.599   0.549  
5: d_y1_d_x1   0.448007   0.365489   1.226   0.220  
5: d_y2_d_x1   0.312561   0.479915   0.651   0.515  
5: d_y3_d_x1  -0.209051   0.417286  -0.501   0.616  
5: d_y1_d_x2  -0.382741   0.346813  -1.104   0.270  
5: d_y2_d_x2   0.233731   0.366815   0.637   0.524  
5: d_y3_d_x2  -0.270658   0.358474  -0.755   0.450  
5: d_y1_d_x3   0.500660   0.632994   0.791   0.429  
5: d_y2_d_x3  -0.472298   0.459957  -1.027   0.304  
5: d_y3_d_x3   0.430288   0.465952   0.923   0.356  
5: d_y1_d_x4  -0.286091   0.511228  -0.560   0.576  
5: d_y2_d_x4  -0.629731   0.347555  -1.812   0.070 .
5: d_y3_d_x4   0.469405   0.345966   1.357   0.175  
6: d_y1_d_x1   0.026992   0.154501   0.175   0.861  
6: d_y2_d_x1   0.150920   0.460658   0.328   0.743  
6: d_y3_d_x1  -0.075837   0.270198  -0.281   0.779  
6: d_y1_d_x2  -0.152890   0.463512  -0.330   0.742  
6: d_y2_d_x2   0.065760   0.246988   0.266   0.790  
6: d_y3_d_x2  -0.095750   0.322528  -0.297   0.767  
6: d_y1_d_x3   0.089736   0.391258   0.229   0.819  
6: d_y2_d_x3  -0.075467   0.326066  -0.231   0.817  
6: d_y3_d_x3   0.082394   0.333282   0.247   0.805  
6: d_y1_d_x4  -0.051278   0.237101  -0.216   0.829  
6: d_y2_d_x4  -0.100623   0.507000  -0.198   0.843  
6: d_y3_d_x4   0.089885   0.439729   0.204   0.838  
7: d_y1_d_x1   0.256301   0.455234   0.563   0.573  
7: d_y2_d_x1   0.157029   0.440389   0.357   0.721  
7: d_y3_d_x1  -0.133023   0.380718  -0.349   0.727  
7: d_y1_d_x2  -0.038667   0.164698  -0.235   0.814  
7: d_y2_d_x2   0.118400   0.358181   0.331   0.741  
7: d_y3_d_x2  -0.147251   0.404268  -0.364   0.716  
7: d_y1_d_x3   0.125116   0.404119   0.310   0.757  
7: d_y2_d_x3  -0.321710   0.522323  -0.616   0.538  
7: d_y3_d_x3   0.322151   0.467677   0.689   0.491  
7: d_y1_d_x4  -0.071495   0.285496  -0.250   0.802  
7: d_y2_d_x4  -0.428947   0.738010  -0.581   0.561  
7: d_y3_d_x4   0.351437   0.549545   0.640   0.522  
8: d_y1_d_x1   0.131828   0.200736   0.657   0.511  
8: d_y2_d_x1   0.376948   0.385153   0.979   0.328  
8: d_y3_d_x1  -0.226111   0.404274  -0.559   0.576  
8: d_y1_d_x2  -0.330778   0.434486  -0.761   0.446  
8: d_y2_d_x2   0.219460   0.406098   0.540   0.589  
8: d_y3_d_x2  -0.265927   0.401733  -0.662   0.508  
8: d_y1_d_x3   0.317023   0.380545   0.833   0.405  
8: d_y2_d_x3  -0.378620   0.378950  -0.999   0.318  
8: d_y3_d_x3   0.367771   0.372058   0.988   0.323  
8: d_y1_d_x4  -0.181156   0.289948  -0.625   0.532  
8: d_y2_d_x4  -0.504827   0.485712  -1.039   0.299  
8: d_y3_d_x4   0.401205   0.424416   0.945   0.345  
9: d_y1_d_x1   0.302950   0.601313   0.504   0.614  
9: d_y2_d_x1   0.029627   0.119098   0.249   0.804  
9: d_y3_d_x1  -0.026668   0.103269  -0.258   0.796  
9: d_y1_d_x2  -0.230896   0.364964  -0.633   0.527  
9: d_y2_d_x2   0.072908   0.184501   0.395   0.693  
9: d_y3_d_x2  -0.097100   0.225089  -0.431   0.666  
9: d_y1_d_x3   0.168372   0.416525   0.404   0.686  
9: d_y2_d_x3  -0.085632   0.254616  -0.336   0.737  
9: d_y3_d_x3   0.083894   0.241361   0.348   0.728  
9: d_y1_d_x4  -0.096212   0.317276  -0.303   0.762  
9: d_y2_d_x4  -0.114176   0.384623  -0.297   0.767  
9: d_y3_d_x4   0.091521   0.303285   0.302   0.763  
10: d_y1_d_x1  0.002096   0.010845   0.193   0.847  
10: d_y2_d_x1  0.242659   0.508848   0.477   0.633  
10: d_y3_d_x1 -0.127937   0.365636  -0.350   0.726  
10: d_y1_d_x2 -0.029343   0.127161  -0.231   0.818  
10: d_y2_d_x2  0.117824   0.349490   0.337   0.736  
10: d_y3_d_x2 -0.157532   0.407346  -0.387   0.699  
10: d_y1_d_x3  0.009359   0.039345   0.238   0.812  
10: d_y2_d_x3 -0.156396   0.298747  -0.524   0.601  
10: d_y3_d_x3  0.159523   0.280060   0.570   0.569  
10: d_y1_d_x4 -0.005348   0.024498  -0.218   0.827  
10: d_y2_d_x4 -0.208528   0.558769  -0.373   0.709  
10: d_y3_d_x4  0.174025   0.463645   0.375   0.707  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
> margEffUncA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ), vcov = diag( 18 ) )
> all.equal( margEffUnc, margEffUncA )
[1] TRUE
> # now with explicitly specifying dummy variables
> margEffUncD <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ),
+    dummyVar = c( "x1", "x2" ) )
> all.equal( margEffUncD, margEffUnc )
[1] TRUE
> # now with seemingly no dummy variables
> margEffUncD0 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ),
+    dummyVar = NULL )
> summary( margEffUncD0 )
               Estimate Std. error z value Pr(> z)  
1: d_y1_d_x1   0.060234   0.229101   0.263   0.793  
1: d_y2_d_x1   0.333415   0.493635   0.675   0.499  
1: d_y3_d_x1  -0.164966   0.377977  -0.436   0.663  
1: d_y1_d_x2  -0.050195   0.164206  -0.306   0.760  
1: d_y2_d_x2   0.200049   0.280933   0.712   0.476  
1: d_y3_d_x2  -0.192460   0.275543  -0.698   0.485  
1: d_y1_d_x3   0.070273   0.234935   0.299   0.765  
1: d_y2_d_x3  -0.400098   0.362458  -1.104   0.270  
1: d_y3_d_x3   0.302437   0.385524   0.784   0.433  
1: d_y1_d_x4  -0.040156   0.145700  -0.276   0.783  
1: d_y2_d_x4  -0.533464   0.735908  -0.725   0.469  
1: d_y3_d_x4   0.329931   0.641563   0.514   0.607  
2: d_y1_d_x1   0.461706   0.425462   1.085   0.278  
2: d_y2_d_x1   0.304804   0.446858   0.682   0.495  
2: d_y3_d_x1  -0.174668   0.354594  -0.493   0.622  
2: d_y1_d_x2  -0.384755   0.302022  -1.274   0.203  
2: d_y2_d_x2   0.182883   0.222565   0.822   0.411  
2: d_y3_d_x2  -0.203779   0.215415  -0.946   0.344  
2: d_y1_d_x3   0.538657   0.410587   1.312   0.190  
2: d_y2_d_x3  -0.365765   0.459247  -0.796   0.426  
2: d_y3_d_x3   0.320224   0.436385   0.734   0.463  
2: d_y1_d_x4  -0.307804   0.426021  -0.723   0.470  
2: d_y2_d_x4  -0.487687   0.549399  -0.888   0.375  
2: d_y3_d_x4   0.349336   0.448595   0.779   0.436  
3: d_y1_d_x1   0.246411   0.741792   0.332   0.740  
3: d_y2_d_x1   0.289922   0.458514   0.632   0.527  
3: d_y3_d_x1  -0.166159   0.309709  -0.536   0.592  
3: d_y1_d_x2  -0.205343   0.465658  -0.441   0.659  
3: d_y2_d_x2   0.173953   0.311861   0.558   0.577  
3: d_y3_d_x2  -0.193852   0.343725  -0.564   0.573  
3: d_y1_d_x3   0.287480   0.659819   0.436   0.663  
3: d_y2_d_x3  -0.347907   0.541962  -0.642   0.521  
3: d_y3_d_x3   0.304625   0.507520   0.600   0.548  
3: d_y1_d_x4  -0.164274   0.382838  -0.429   0.668  
3: d_y2_d_x4  -0.463876   0.971088  -0.478   0.633  
3: d_y3_d_x4   0.332318   0.780261   0.426   0.670  
4: d_y1_d_x1   0.368635   0.750763   0.491   0.623  
4: d_y2_d_x1   0.357283   0.358944   0.995   0.320  
4: d_y3_d_x1  -0.205990   0.308545  -0.668   0.504  
4: d_y1_d_x2  -0.307196   0.412464  -0.745   0.456  
4: d_y2_d_x2   0.214370   0.315087   0.680   0.496  
4: d_y3_d_x2  -0.240322   0.319516  -0.752   0.452  
4: d_y1_d_x3   0.430074   0.609214   0.706   0.480  
4: d_y2_d_x3  -0.428740   0.444104  -0.965   0.334  
4: d_y3_d_x3   0.377649   0.445589   0.848   0.397  
4: d_y1_d_x4  -0.245757   0.366437  -0.671   0.502  
4: d_y2_d_x4  -0.571653   0.778425  -0.734   0.463  
4: d_y3_d_x4   0.411980   0.688004   0.599   0.549  
5: d_y1_d_x1   0.429137   0.328385   1.307   0.191  
5: d_y2_d_x1   0.393582   0.467767   0.841   0.400  
5: d_y3_d_x1  -0.234703   0.442737  -0.530   0.596  
5: d_y1_d_x2  -0.357614   0.462196  -0.774   0.439  
5: d_y2_d_x2   0.236149   0.399410   0.591   0.554  
5: d_y3_d_x2  -0.273820   0.402514  -0.680   0.496  
5: d_y1_d_x3   0.500660   0.632994   0.791   0.429  
5: d_y2_d_x3  -0.472298   0.459957  -1.027   0.304  
5: d_y3_d_x3   0.430288   0.465952   0.923   0.356  
5: d_y1_d_x4  -0.286091   0.511228  -0.560   0.576  
5: d_y2_d_x4  -0.629731   0.347555  -1.812   0.070 .
5: d_y3_d_x4   0.469405   0.345966   1.357   0.175  
6: d_y1_d_x1   0.076917   0.399596   0.192   0.847  
6: d_y2_d_x1   0.062889   0.284645   0.221   0.825  
6: d_y3_d_x1  -0.044942   0.189662  -0.237   0.813  
6: d_y1_d_x2  -0.064097   0.288693  -0.222   0.824  
6: d_y2_d_x2   0.037734   0.167562   0.225   0.822  
6: d_y3_d_x2  -0.052433   0.222228  -0.236   0.813  
6: d_y1_d_x3   0.089736   0.391258   0.229   0.819  
6: d_y2_d_x3  -0.075467   0.326066  -0.231   0.817  
6: d_y3_d_x3   0.082394   0.333282   0.247   0.805  
6: d_y1_d_x4  -0.051278   0.237101  -0.216   0.829  
6: d_y2_d_x4  -0.100623   0.507000  -0.198   0.843  
6: d_y3_d_x4   0.089885   0.439729   0.204   0.838  
7: d_y1_d_x1   0.107242   0.335884   0.319   0.750  
7: d_y2_d_x1   0.268092   0.655209   0.409   0.682  
7: d_y3_d_x1  -0.175718   0.493202  -0.356   0.722  
7: d_y1_d_x2  -0.089369   0.362444  -0.247   0.805  
7: d_y2_d_x2   0.160855   0.480850   0.335   0.738  
7: d_y3_d_x2  -0.205005   0.533184  -0.384   0.701  
7: d_y1_d_x3   0.125116   0.404119   0.310   0.757  
7: d_y2_d_x3  -0.321710   0.522323  -0.616   0.538  
7: d_y3_d_x3   0.322151   0.467677   0.689   0.491  
7: d_y1_d_x4  -0.071495   0.285496  -0.250   0.802  
7: d_y2_d_x4  -0.428947   0.738010  -0.581   0.561  
7: d_y3_d_x4   0.351437   0.549545   0.640   0.522  
8: d_y1_d_x1   0.271734   0.370299   0.734   0.463  
8: d_y2_d_x1   0.315517   0.384055   0.822   0.411  
8: d_y3_d_x1  -0.200603   0.355601  -0.564   0.573  
8: d_y1_d_x2  -0.226445   0.333065  -0.680   0.497  
8: d_y2_d_x2   0.189310   0.341731   0.554   0.580  
8: d_y3_d_x2  -0.234036   0.362712  -0.645   0.519  
8: d_y1_d_x3   0.317023   0.380545   0.833   0.405  
8: d_y2_d_x3  -0.378620   0.378950  -0.999   0.318  
8: d_y3_d_x3   0.367771   0.372058   0.988   0.323  
8: d_y1_d_x4  -0.181156   0.289948  -0.625   0.532  
8: d_y2_d_x4  -0.504827   0.485712  -1.039   0.299  
8: d_y3_d_x4   0.401205   0.424416   0.945   0.345  
9: d_y1_d_x1   0.144319   0.428652   0.337   0.736  
9: d_y2_d_x1   0.071360   0.254011   0.281   0.779  
9: d_y3_d_x1  -0.045760   0.171173  -0.267   0.789  
9: d_y1_d_x2  -0.120266   0.295349  -0.407   0.684  
9: d_y2_d_x2   0.042816   0.123116   0.348   0.728  
9: d_y3_d_x2  -0.053387   0.151556  -0.352   0.725  
9: d_y1_d_x3   0.168372   0.416525   0.404   0.686  
9: d_y2_d_x3  -0.085632   0.254616  -0.336   0.737  
9: d_y3_d_x3   0.083894   0.241361   0.348   0.728  
9: d_y1_d_x4  -0.096212   0.317276  -0.303   0.762  
9: d_y2_d_x4  -0.114176   0.384623  -0.297   0.767  
9: d_y3_d_x4   0.091521   0.303285   0.302   0.763  
10: d_y1_d_x1  0.008022   0.038397   0.209   0.835  
10: d_y2_d_x1  0.130330   0.346770   0.376   0.707  
10: d_y3_d_x1 -0.087012   0.250375  -0.348   0.728  
10: d_y1_d_x2 -0.006685   0.032238  -0.207   0.836  
10: d_y2_d_x2  0.078198   0.232727   0.336   0.737  
10: d_y3_d_x2 -0.101515   0.278797  -0.364   0.716  
10: d_y1_d_x3  0.009359   0.039345   0.238   0.812  
10: d_y2_d_x3 -0.156396   0.298747  -0.524   0.601  
10: d_y3_d_x3  0.159523   0.280060   0.570   0.569  
10: d_y1_d_x4 -0.005348   0.024498  -0.218   0.827  
10: d_y2_d_x4 -0.208528   0.558769  -0.373   0.709  
10: d_y3_d_x4  0.174025   0.463645   0.375   0.707  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
> # now with seemingly only dummy variables
> margEffUncDA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ),
+    dummyVar = c( "x1", "x2", "x3", "x4" ) )
> summary( margEffUncDA )
               Estimate Std. error z value Pr(> z)  
1: d_y1_d_x1   0.180673   0.506428   0.357  0.7213  
1: d_y2_d_x1   0.219666   0.420176   0.523  0.6011  
1: d_y3_d_x1  -0.122356   0.286500  -0.427  0.6693  
1: d_y1_d_x2  -0.129203   0.283404  -0.456  0.6485  
1: d_y2_d_x2   0.225810   0.348047   0.649  0.5165  
1: d_y3_d_x2  -0.241208   0.329144  -0.733  0.4637  
1: d_y1_d_x3   0.510588   0.293968   1.737  0.0824 .
1: d_y2_d_x3  -0.217616   0.372909  -0.584  0.5595  
1: d_y3_d_x3   0.298602   0.374009   0.798  0.4246  
1: d_y1_d_x4  -0.038743   0.137789  -0.281  0.7786  
1: d_y2_d_x4  -0.524961   0.523494  -1.003  0.3160  
1: d_y3_d_x4   0.346068   0.576168   0.601  0.5481  
2: d_y1_d_x1   0.430122   0.317561   1.354  0.1756  
2: d_y2_d_x1   0.190084   0.327883   0.580  0.5621  
2: d_y3_d_x1  -0.131959   0.254364  -0.519  0.6039  
2: d_y1_d_x2  -0.373654   0.393924  -0.949  0.3429  
2: d_y2_d_x2   0.215256   0.319713   0.673  0.5008  
2: d_y3_d_x2  -0.248972   0.312271  -0.797  0.4253  
2: d_y1_d_x3   0.410125   0.396819   1.034  0.3014  
2: d_y2_d_x3  -0.448236   0.314764  -1.424  0.1544  
2: d_y3_d_x3   0.417677   0.343720   1.215  0.2243  
2: d_y1_d_x4  -0.210803   0.309845  -0.680  0.4963  
2: d_y2_d_x4  -0.512795   0.357795  -1.433  0.1518  
2: d_y3_d_x4   0.446390   0.312268   1.430  0.1529  
3: d_y1_d_x1   0.115233   0.409160   0.282  0.7782  
3: d_y2_d_x1   0.367505   0.351286   1.046  0.2955  
3: d_y3_d_x1  -0.203146   0.350334  -0.580  0.5620  
3: d_y1_d_x2  -0.314837   0.424044  -0.742  0.4578  
3: d_y2_d_x2   0.208986   0.351459   0.595  0.5521  
3: d_y3_d_x2  -0.242199   0.360140  -0.673  0.5013  
3: d_y1_d_x3   0.342143   0.566956   0.603  0.5462  
3: d_y2_d_x3  -0.281479   0.514058  -0.548  0.5840  
3: d_y3_d_x3   0.307287   0.472745   0.650  0.5157  
3: d_y1_d_x4  -0.223117   0.401738  -0.555  0.5786  
3: d_y2_d_x4  -0.251119   0.675741  -0.372  0.7102  
3: d_y3_d_x4   0.206232   0.578378   0.357  0.7214  
4: d_y1_d_x1   0.207611   0.540019   0.384  0.7006  
4: d_y2_d_x1   0.382763   0.357810   1.070  0.2847  
4: d_y3_d_x1  -0.228889   0.357614  -0.640  0.5221  
4: d_y1_d_x2  -0.374273   0.337358  -1.109  0.2672  
4: d_y2_d_x2   0.232552   0.363994   0.639  0.5229  
4: d_y3_d_x2  -0.268560   0.355628  -0.755  0.4501  
4: d_y1_d_x3   0.338243   0.565710   0.598  0.5499  
4: d_y2_d_x3  -0.288488   0.512001  -0.563  0.5731  
4: d_y3_d_x3   0.311934   0.468322   0.666  0.5054  
4: d_y1_d_x4  -0.285863   0.356399  -0.802  0.4225  
4: d_y2_d_x4  -0.361366   0.706221  -0.512  0.6089  
4: d_y3_d_x4   0.289321   0.607781   0.476  0.6341  
5: d_y1_d_x1   0.448007   0.365489   1.226  0.2203  
5: d_y2_d_x1   0.312561   0.479915   0.651  0.5149  
5: d_y3_d_x1  -0.209051   0.417286  -0.501  0.6164  
5: d_y1_d_x2  -0.382741   0.346813  -1.104  0.2698  
5: d_y2_d_x2   0.233731   0.366815   0.637  0.5240  
5: d_y3_d_x2  -0.270658   0.358474  -0.755  0.4502  
5: d_y1_d_x3   0.086632   0.249892   0.347  0.7288  
5: d_y2_d_x3  -0.162984   0.362247  -0.450  0.6528  
5: d_y3_d_x3   0.164314   0.354266   0.464  0.6428  
5: d_y1_d_x4  -0.242305   0.457724  -0.529  0.5965  
5: d_y2_d_x4  -0.548566   0.432588  -1.268  0.2048  
5: d_y3_d_x4   0.444516   0.383787   1.158  0.2468  
6: d_y1_d_x1   0.026992   0.154501   0.175  0.8613  
6: d_y2_d_x1   0.150920   0.460658   0.328  0.7432  
6: d_y3_d_x1  -0.075837   0.270198  -0.281  0.7790  
6: d_y1_d_x2  -0.152890   0.463512  -0.330  0.7415  
6: d_y2_d_x2   0.065760   0.246988   0.266  0.7900  
6: d_y3_d_x2  -0.095750   0.322528  -0.297  0.7666  
6: d_y1_d_x3   0.294462   0.542545   0.543  0.5873  
6: d_y2_d_x3  -0.362960   0.454475  -0.799  0.4245  
6: d_y3_d_x3   0.359477   0.408133   0.881  0.3784  
6: d_y1_d_x4  -0.071365   0.291084  -0.245  0.8063  
6: d_y2_d_x4  -0.075971   0.369470  -0.206  0.8371  
6: d_y3_d_x4   0.068823   0.335898   0.205  0.8377  
7: d_y1_d_x1   0.256301   0.455234   0.563  0.5734  
7: d_y2_d_x1   0.157029   0.440389   0.357  0.7214  
7: d_y3_d_x1  -0.133023   0.380718  -0.349  0.7268  
7: d_y1_d_x2  -0.038667   0.164698  -0.235  0.8144  
7: d_y2_d_x2   0.118400   0.358181   0.331  0.7410  
7: d_y3_d_x2  -0.147251   0.404268  -0.364  0.7157  
7: d_y1_d_x3   0.263628   0.517690   0.509  0.6106  
7: d_y2_d_x3  -0.406595   0.387861  -1.048  0.2945  
7: d_y3_d_x3   0.386465   0.363439   1.063  0.2876  
7: d_y1_d_x4  -0.069998   0.274874  -0.255  0.7990  
7: d_y2_d_x4  -0.443659   0.566743  -0.783  0.4337  
7: d_y3_d_x4   0.358465   0.471789   0.760  0.4474  
8: d_y1_d_x1   0.131828   0.200736   0.657  0.5114  
8: d_y2_d_x1   0.376948   0.385153   0.979  0.3277  
8: d_y3_d_x1  -0.226111   0.404274  -0.559  0.5760  
8: d_y1_d_x2  -0.330778   0.434486  -0.761  0.4465  
8: d_y2_d_x2   0.219460   0.406098   0.540  0.5889  
8: d_y3_d_x2  -0.265927   0.401733  -0.662  0.5080  
8: d_y1_d_x3   0.185554   0.248831   0.746  0.4558  
8: d_y2_d_x3  -0.263729   0.275021  -0.959  0.3376  
8: d_y3_d_x3   0.271620   0.270641   1.004  0.3156  
8: d_y1_d_x4  -0.259873   0.418877  -0.620  0.5350  
8: d_y2_d_x4  -0.207944   0.274256  -0.758  0.4483  
8: d_y3_d_x4   0.221009   0.261751   0.844  0.3985  
9: d_y1_d_x1   0.302950   0.601313   0.504  0.6144  
9: d_y2_d_x1   0.029627   0.119098   0.249  0.8035  
9: d_y3_d_x1  -0.026668   0.103269  -0.258  0.7962  
9: d_y1_d_x2  -0.230896   0.364964  -0.633  0.5270  
9: d_y2_d_x2   0.072908   0.184501   0.395  0.6927  
9: d_y3_d_x2  -0.097100   0.225089  -0.431  0.6662  
9: d_y1_d_x3   0.407884   0.398941   1.022  0.3066  
9: d_y2_d_x3  -0.449061   0.316410  -1.419  0.1558  
9: d_y3_d_x3   0.417625   0.346271   1.206  0.2278  
9: d_y1_d_x4  -0.031703   0.120740  -0.263  0.7929  
9: d_y2_d_x4  -0.506593   0.571616  -0.886  0.3755  
9: d_y3_d_x4   0.327282   0.592565   0.552  0.5807  
10: d_y1_d_x1  0.002096   0.010845   0.193  0.8468  
10: d_y2_d_x1  0.242659   0.508848   0.477  0.6334  
10: d_y3_d_x1 -0.127937   0.365636  -0.350  0.7264  
10: d_y1_d_x2 -0.029343   0.127161  -0.231  0.8175  
10: d_y2_d_x2  0.117824   0.349490   0.337  0.7360  
10: d_y3_d_x2 -0.157532   0.407346  -0.387  0.6990  
10: d_y1_d_x3  0.128581   0.214119   0.601  0.5482  
10: d_y2_d_x3 -0.386714   0.292472  -1.322  0.1861  
10: d_y3_d_x3  0.356248   0.291286   1.223  0.2213  
10: d_y1_d_x4 -0.034296   0.141396  -0.243  0.8084  
10: d_y2_d_x4 -0.017558   0.069195  -0.254  0.7997  
10: d_y3_d_x4  0.029071   0.103923   0.280  0.7797  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
> # now with mean values of the marginal effects
> margEffUncM <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ), 
+    addMean = TRUE )
> all.equal( margEffUnc, margEffUncM[ 1:nObs, ], check.attributes = FALSE )
[1] TRUE
> print( margEffUncM[ nObs:(nObs+1), ] )
       d_y1_d_x1 d_y2_d_x1  d_y3_d_x1   d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
10   0.002095525 0.2426595 -0.1279373 -0.02934265 0.1178236 -0.1575317
mean 0.210181213 0.2429762 -0.1484976 -0.23572823 0.1710685 -0.2035156
       d_y1_d_x3  d_y2_d_x3 d_y3_d_x3    d_y1_d_x4  d_y2_d_x4 d_y3_d_x4
10   0.009358606 -0.1563963 0.1595228 -0.005347775 -0.2085284 0.1740249
mean 0.253674923 -0.3032635 0.2750956 -0.144957099 -0.4043513 0.3001043
> all.equal( attr( margEffUnc, "vcov" ), 
+    attr( margEffUncM, "vcov" )[ 1:nObs, , ] )
[1] TRUE
> print( attr( margEffUncM, "vcov" )[ nObs:(nObs+1), , ] )
, , d_y1_d_x1

        d_y1_d_x1 d_y2_d_x1 d_y3_d_x1    d_y1_d_x2 d_y2_d_x2 d_y3_d_x2
10   0.0001176217         0         0 -0.001145678         0         0
mean 0.0616473460         0         0 -0.014676234         0         0
        d_y1_d_x3 d_y2_d_x3 d_y3_d_x3     d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10   0.0004241711         0         0 -0.0002561128         0         0
mean 0.0131810000         0         0 -0.0135142638         0         0

, , d_y2_d_x1

     d_y1_d_x1  d_y2_d_x1 d_y3_d_x1 d_y1_d_x2    d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0 0.25892667         0         0  0.082654833         0         0
mean         0 0.06969919         0         0 -0.009436932         0         0
        d_y2_d_x3 d_y3_d_x3 d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
10   -0.105057960         0         0 -0.19954825         0
mean  0.008760349         0         0 -0.02749139         0

, , d_y3_d_x1

     d_y1_d_x1 d_y2_d_x1  d_y3_d_x1 d_y1_d_x2 d_y2_d_x2    d_y3_d_x2 d_y1_d_x3
10           0         0 0.13368957         0         0  0.061446755         0
mean         0         0 0.06562862         0         0 -0.007405409         0
     d_y2_d_x3    d_y3_d_x3 d_y1_d_x4 d_y2_d_x4  d_y3_d_x4
10           0 -0.060606931         0         0 -0.1014771
mean         0  0.007399307         0         0 -0.0173568

, , d_y1_d_x2

        d_y1_d_x1 d_y2_d_x1 d_y3_d_x1  d_y1_d_x2 d_y2_d_x2 d_y3_d_x2
10   -0.001145678         0         0 0.01616982         0         0
mean -0.014676234         0         0 0.06142330         0         0
        d_y1_d_x3 d_y2_d_x3 d_y3_d_x3    d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10   -0.004131967         0         0  0.002494864         0         0
mean  0.022074003         0         0 -0.007585865         0         0

, , d_y2_d_x2

     d_y1_d_x1    d_y2_d_x1 d_y3_d_x1 d_y1_d_x2  d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0  0.082654833         0         0 0.12214353         0         0
mean         0 -0.009436932         0         0 0.08158337         0         0
       d_y2_d_x3 d_y3_d_x3 d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
10   -0.06458081         0         0 -0.12266551         0
mean  0.03244535         0         0  0.01068184         0

, , d_y3_d_x2

     d_y1_d_x1 d_y2_d_x1    d_y3_d_x1 d_y1_d_x2 d_y2_d_x2  d_y3_d_x2 d_y1_d_x3
10           0         0  0.061446755         0         0 0.16593068         0
mean         0         0 -0.007405409         0         0 0.08538425         0
     d_y2_d_x3   d_y3_d_x3 d_y1_d_x4 d_y2_d_x4    d_y3_d_x4
10           0 -0.07053988         0         0 -0.118108336
mean         0  0.03368649         0         0  0.001948314

, , d_y1_d_x3

        d_y1_d_x1 d_y2_d_x1 d_y3_d_x1    d_y1_d_x2 d_y2_d_x2 d_y3_d_x2
10   0.0004241711         0         0 -0.004131967         0         0
mean 0.0131810000         0         0  0.022074003         0         0
       d_y1_d_x3 d_y2_d_x3 d_y3_d_x3     d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10   0.001548066         0         0 -0.0009160401         0         0
mean 0.019911399         0         0 -0.0014506491         0         0

, , d_y2_d_x3

     d_y1_d_x1    d_y2_d_x1 d_y3_d_x1 d_y1_d_x2   d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0 -0.105057960         0         0 -0.06458081         0         0
mean         0  0.008760349         0         0  0.03244535         0         0
      d_y2_d_x3 d_y3_d_x3 d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
10   0.08924980         0         0 0.158894524         0
mean 0.02100709         0         0 0.009677652         0

, , d_y3_d_x3

     d_y1_d_x1 d_y2_d_x1    d_y3_d_x1 d_y1_d_x2 d_y2_d_x2   d_y3_d_x2 d_y1_d_x3
10           0         0 -0.060606931         0         0 -0.07053988         0
mean         0         0  0.007399307         0         0  0.03368649         0
     d_y2_d_x3  d_y3_d_x3 d_y1_d_x4 d_y2_d_x4  d_y3_d_x4
10           0 0.07843335         0         0 0.12018467
mean         0 0.02265397         0         0 0.01163993

, , d_y1_d_x4

         d_y1_d_x1 d_y2_d_x1 d_y3_d_x1    d_y1_d_x2 d_y2_d_x2 d_y3_d_x2
10   -0.0002561128         0         0  0.002494864         0         0
mean -0.0135142638         0         0 -0.007585865         0         0
         d_y1_d_x3 d_y2_d_x3 d_y3_d_x3    d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10   -0.0009160401         0         0 0.0006001752         0         0
mean -0.0014506491         0         0 0.0387012722         0         0

, , d_y2_d_x4

     d_y1_d_x1   d_y2_d_x1 d_y3_d_x1 d_y1_d_x2   d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0 -0.19954825         0         0 -0.12266551         0         0
mean         0 -0.02749139         0         0  0.01068184         0         0
       d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10   0.158894524         0         0 0.3122228         0
mean 0.009677652         0         0 0.1658766         0

, , d_y3_d_x4

     d_y1_d_x1 d_y2_d_x1  d_y3_d_x1 d_y1_d_x2 d_y2_d_x2    d_y3_d_x2 d_y1_d_x3
10           0         0 -0.1014771         0         0 -0.118108336         0
mean         0         0 -0.0173568         0         0  0.001948314         0
     d_y2_d_x3  d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0 0.12018467         0         0 0.2149662
mean         0 0.01163993         0         0 0.1354084

> print( drop( attr( margEffUncM, "vcov" )[ nObs+1, , ] ) )
            d_y1_d_x1    d_y2_d_x1    d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
d_y1_d_x1  0.06164735  0.000000000  0.000000000 -0.014676234  0.000000000
d_y2_d_x1  0.00000000  0.069699186  0.000000000  0.000000000 -0.009436932
d_y3_d_x1  0.00000000  0.000000000  0.065628617  0.000000000  0.000000000
d_y1_d_x2 -0.01467623  0.000000000  0.000000000  0.061423301  0.000000000
d_y2_d_x2  0.00000000 -0.009436932  0.000000000  0.000000000  0.081583371
d_y3_d_x2  0.00000000  0.000000000 -0.007405409  0.000000000  0.000000000
d_y1_d_x3  0.01318100  0.000000000  0.000000000  0.022074003  0.000000000
d_y2_d_x3  0.00000000  0.008760349  0.000000000  0.000000000  0.032445350
d_y3_d_x3  0.00000000  0.000000000  0.007399307  0.000000000  0.000000000
d_y1_d_x4 -0.01351426  0.000000000  0.000000000 -0.007585865  0.000000000
d_y2_d_x4  0.00000000 -0.027491394  0.000000000  0.000000000  0.010681844
d_y3_d_x4  0.00000000  0.000000000 -0.017356802  0.000000000  0.000000000
             d_y3_d_x2    d_y1_d_x3   d_y2_d_x3   d_y3_d_x3    d_y1_d_x4
d_y1_d_x1  0.000000000  0.013181000 0.000000000 0.000000000 -0.013514264
d_y2_d_x1  0.000000000  0.000000000 0.008760349 0.000000000  0.000000000
d_y3_d_x1 -0.007405409  0.000000000 0.000000000 0.007399307  0.000000000
d_y1_d_x2  0.000000000  0.022074003 0.000000000 0.000000000 -0.007585865
d_y2_d_x2  0.000000000  0.000000000 0.032445350 0.000000000  0.000000000
d_y3_d_x2  0.085384250  0.000000000 0.000000000 0.033686493  0.000000000
d_y1_d_x3  0.000000000  0.019911399 0.000000000 0.000000000 -0.001450649
d_y2_d_x3  0.000000000  0.000000000 0.021007087 0.000000000  0.000000000
d_y3_d_x3  0.033686493  0.000000000 0.000000000 0.022653972  0.000000000
d_y1_d_x4  0.000000000 -0.001450649 0.000000000 0.000000000  0.038701272
d_y2_d_x4  0.000000000  0.000000000 0.009677652 0.000000000  0.000000000
d_y3_d_x4  0.001948314  0.000000000 0.000000000 0.011639930  0.000000000
             d_y2_d_x4    d_y3_d_x4
d_y1_d_x1  0.000000000  0.000000000
d_y2_d_x1 -0.027491394  0.000000000
d_y3_d_x1  0.000000000 -0.017356802
d_y1_d_x2  0.000000000  0.000000000
d_y2_d_x2  0.010681844  0.000000000
d_y3_d_x2  0.000000000  0.001948314
d_y1_d_x3  0.000000000  0.000000000
d_y2_d_x3  0.009677652  0.000000000
d_y3_d_x3  0.000000000  0.011639930
d_y1_d_x4  0.000000000  0.000000000
d_y2_d_x4  0.165876601  0.000000000
d_y3_d_x4  0.000000000  0.135408416
> all.equal( summary( margEffUnc )[ , ], 
+    summary( margEffUncM )[ 1:( 12 * nObs ), ], check.attributes = FALSE )
[1] TRUE
> printCoefmat( summary( margEffUncM )[ -( 1:( 12 * (nObs-1) ) ), ] )
                  Estimate Std. error z value Pr(> z)  
10: d_y1_d_x1    0.0020955  0.0108454  0.1932 0.84679  
10: d_y2_d_x1    0.2426595  0.5088484  0.4769 0.63345  
10: d_y3_d_x1   -0.1279373  0.3656358 -0.3499 0.72641  
10: d_y1_d_x2   -0.0293426  0.1271606 -0.2308 0.81751  
10: d_y2_d_x2    0.1178236  0.3494904  0.3371 0.73602  
10: d_y3_d_x2   -0.1575317  0.4073459 -0.3867 0.69896  
10: d_y1_d_x3    0.0093586  0.0393455  0.2379 0.81199  
10: d_y2_d_x3   -0.1563963  0.2987471 -0.5235 0.60062  
10: d_y3_d_x3    0.1595228  0.2800595  0.5696 0.56895  
10: d_y1_d_x4   -0.0053478  0.0244985 -0.2183 0.82720  
10: d_y2_d_x4   -0.2085284  0.5587690 -0.3732 0.70901  
10: d_y3_d_x4    0.1740249  0.4636445  0.3753 0.70741  
mean: d_y1_d_x1  0.2101812  0.2482888  0.8465 0.39726  
mean: d_y2_d_x1  0.2429762  0.2640060  0.9203 0.35739  
mean: d_y3_d_x1 -0.1484976  0.2561808 -0.5797 0.56214  
mean: d_y1_d_x2 -0.2357282  0.2478372 -0.9511 0.34153  
mean: d_y2_d_x2  0.1710685  0.2856280  0.5989 0.54923  
mean: d_y3_d_x2 -0.2035156  0.2922058 -0.6965 0.48613  
mean: d_y1_d_x3  0.2536749  0.1411078  1.7977 0.07222 .
mean: d_y2_d_x3 -0.3032635  0.1449382 -2.0924 0.03641 *
mean: d_y3_d_x3  0.2750956  0.1505124  1.8277 0.06759 .
mean: d_y1_d_x4 -0.1449571  0.1967264 -0.7368 0.46122  
mean: d_y2_d_x4 -0.4043513  0.4072795 -0.9928 0.32080  
mean: d_y3_d_x4  0.3001043  0.3679788  0.8155 0.41476  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -0.5074569 -0.4007881  0.9870865 -1.2228328
> 
> # calculating marginal effects, conditional
> # (assuming that all other dependent variables are one)
> margEffCond <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE )
> print( margEffCond )
      d_y1_d_x1  d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2  d_y3_d_x2
1  0.4118196285 0.11755425 -0.3603571 -0.229336023 0.24592945 -0.1258047
2  0.3072493886 0.16496098 -0.2207962 -0.251218729 0.23603249 -0.1732265
3  0.2668136514 0.22747911 -0.3834613 -0.358314743 0.23024729 -0.1482975
4  0.3739634546 0.27583243 -0.3555778 -0.346905711 0.26380199 -0.1562548
5  0.4391801486 0.27082731 -0.2615752 -0.320544987 0.26315436 -0.1630063
6  0.1333475202 0.05063076 -0.3842384 -0.271514059 0.05963121 -0.1100592
7  0.1186209608 0.14525007 -0.1602907 -0.008844268 0.11286656 -0.1545433
8  0.0479944760 0.35027624 -0.2340024 -0.203212079 0.23964177 -0.1769059
9  0.5485854658 0.01846945 -0.1161634 -0.323192759 0.07403491 -0.1034704
10 0.0002023317 0.23196959 -0.1301103 -0.005713415 0.11099101 -0.1661675
     d_y1_d_x3   d_y2_d_x3 d_y3_d_x3    d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  0.176511553 -0.35179286 0.2229842 -0.146837465 -0.32872178 0.6037347
2  0.470625850 -0.39065433 0.2417527 -0.400765605 -0.40480342 0.4969012
3  0.440547549 -0.33694170 0.2350549 -0.380306347 -0.32464544 0.5721855
4  0.520056790 -0.45146105 0.2436830 -0.414434159 -0.44879952 0.5673865
5  0.329853048 -0.50531263 0.2791236 -0.223868797 -0.56755035 0.4883268
6  0.253508476 -0.05245314 0.1581382 -0.278241639 -0.04810410 0.3860385
7  0.036015809 -0.30982533 0.2977379 -0.021747581 -0.39933261 0.3574982
8  0.147285010 -0.38617280 0.2839412 -0.091108736 -0.46686983 0.4072656
9  0.361307538 -0.07085862 0.1415298 -0.392918522 -0.06647694 0.3342594
10 0.001136227 -0.14918719 0.1853440 -0.000620818 -0.19920183 0.1994459
> margEffCondA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ), cond = TRUE )
> all.equal( margEffCond, margEffCondA )
[1] TRUE
> # now with dummy variables specified explicitly
> margEffCondD <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    dummyVars = c( "x1", "x2" ) )
> all.equal( margEffCondD, margEffCond )
[1] TRUE
> # now with seemingly no dummy variables
> margEffCondD0 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    dummyVars = NULL )
> print( margEffCondD0 )
      d_y1_d_x1  d_y2_d_x1   d_y3_d_x1    d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.1884635651 0.17102712 -0.42316725 -0.125801131 0.18806310 -0.12892375
2  0.5099557822 0.22543984 -0.32620929 -0.335328823 0.20402620 -0.14650352
3  0.4821673452 0.17270950 -0.39225087 -0.314821101 0.17871508 -0.13835668
4  0.5392597429 0.24342496 -0.38415941 -0.368805082 0.23826960 -0.14572352
5  0.3084532160 0.32945682 -0.30363340 -0.231071359 0.26068085 -0.17458867
6  0.3290263249 0.02481757 -0.26612804 -0.186121049 0.02795716 -0.09105967
7  0.0313559799 0.24700912 -0.18717169 -0.025031082 0.15490110 -0.19216058
8  0.1301219446 0.28075214 -0.23379151 -0.102554771 0.19614099 -0.18116028
9  0.4656624777 0.03483961 -0.22862972 -0.264787711 0.03761668 -0.08212529
10 0.0009338783 0.12485332 -0.09718526 -0.000786224 0.07414565 -0.12046481
     d_y1_d_x3   d_y2_d_x3 d_y3_d_x3    d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  0.176511553 -0.35179286 0.2229842 -0.146837465 -0.32872178 0.6037347
2  0.470625850 -0.39065433 0.2417527 -0.400765605 -0.40480342 0.4969012
3  0.440547549 -0.33694170 0.2350549 -0.380306347 -0.32464544 0.5721855
4  0.520056790 -0.45146105 0.2436830 -0.414434159 -0.44879952 0.5673865
5  0.329853048 -0.50531263 0.2791236 -0.223868797 -0.56755035 0.4883268
6  0.253508476 -0.05245314 0.1581382 -0.278241639 -0.04810410 0.3860385
7  0.036015809 -0.30982533 0.2977379 -0.021747581 -0.39933261 0.3574982
8  0.147285010 -0.38617280 0.2839412 -0.091108736 -0.46686983 0.4072656
9  0.361307538 -0.07085862 0.1415298 -0.392918522 -0.06647694 0.3342594
10 0.001136227 -0.14918719 0.1853440 -0.000620818 -0.19920183 0.1994459
> # now with seemingly only dummy variables
> margEffCondDA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    dummyVars = c( "x1", "x2", "x3", "x4" ) )
> print( margEffCondDA )
      d_y1_d_x1  d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2  d_y3_d_x2
1  0.4118196285 0.11755425 -0.3603571 -0.229336023 0.24592945 -0.1258047
2  0.3072493886 0.16496098 -0.2207962 -0.251218729 0.23603249 -0.1732265
3  0.2668136514 0.22747911 -0.3834613 -0.358314743 0.23024729 -0.1482975
4  0.3739634546 0.27583243 -0.3555778 -0.346905711 0.26380199 -0.1562548
5  0.4391801486 0.27082731 -0.2615752 -0.320544987 0.26315436 -0.1630063
6  0.1333475202 0.05063076 -0.3842384 -0.271514059 0.05963121 -0.1100592
7  0.1186209608 0.14525007 -0.1602907 -0.008844268 0.11286656 -0.1545433
8  0.0479944760 0.35027624 -0.2340024 -0.203212079 0.23964177 -0.1769059
9  0.5485854658 0.01846945 -0.1161634 -0.323192759 0.07403491 -0.1034704
10 0.0002023317 0.23196959 -0.1301103 -0.005713415 0.11099101 -0.1661675
    d_y1_d_x3  d_y2_d_x3 d_y3_d_x3    d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  0.43230239 -0.2692830 0.1631718 -0.142023260 -0.35837410 0.54369935
2  0.22403261 -0.4616019 0.3079839 -0.328013708 -0.49007825 0.43466606
3  0.18752328 -0.2979142 0.2321765 -0.446802359 -0.18313630 0.40395556
4  0.18354779 -0.3041504 0.2365840 -0.411875993 -0.29361935 0.44264675
5  0.02729896 -0.1606363 0.1716591 -0.165495636 -0.50776892 0.47200346
6  0.14155213 -0.3691322 0.2835271 -0.354045944 -0.03714082 0.29003164
7  0.11478735 -0.4063478 0.3124210 -0.021385692 -0.41570255 0.35971732
8  0.07449582 -0.2637046 0.2414374 -0.146174052 -0.20463223 0.23281447
9  0.22089519 -0.4620024 0.3090326 -0.126527306 -0.33025402 0.54904170
10 0.04081212 -0.3738552 0.3198510 -0.003924666 -0.01724742 0.04690532
> # now with integrals obtained by the Miwa algorithm, reduced precision
> margEffCond1 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = Miwa( steps = 32 ) )
> print( margEffCond1 )
      d_y1_d_x1  d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2  d_y3_d_x2
1  0.4118175441 0.11744761 -0.3604293 -0.229377392 0.24595064 -0.1258412
2  0.3072778362 0.16499571 -0.2207798 -0.251230455 0.23600462 -0.1732307
3  0.2668567540 0.22752895 -0.3835033 -0.358189399 0.23045343 -0.1481687
4  0.3740368431 0.27590804 -0.3555998 -0.346792914 0.26395440 -0.1561463
5  0.4391762270 0.27082379 -0.2615569 -0.320425619 0.26329930 -0.1629057
6  0.1333669207 0.05068089 -0.3842359 -0.271497048 0.05975710 -0.1100381
7  0.1186476441 0.14525164 -0.1602639 -0.008826922 0.11286814 -0.1545282
8  0.0479957196 0.35027704 -0.2340019 -0.203276650 0.23960011 -0.1769520
9  0.5485472106 0.01837404 -0.1161731 -0.323172242 0.07410392 -0.1034597
10 0.0002125689 0.23197009 -0.1301010 -0.005696324 0.11099282 -0.1661532
    d_y1_d_x3   d_y2_d_x3 d_y3_d_x3    d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  0.17654673 -0.35173836 0.2230884 -0.146853300 -0.32870549 0.6038590
2  0.47050847 -0.39074154 0.2416959 -0.400881819 -0.40494388 0.4968085
3  0.44064334 -0.33692357 0.2351269 -0.380357702 -0.32467070 0.5722886
4  0.52019140 -0.45148369 0.2437674 -0.414487863 -0.44884522 0.5675156
5  0.32993069 -0.50525720 0.2791793 -0.223886951 -0.56754997 0.4882992
6  0.25354621 -0.05240628 0.1581628 -0.278296108 -0.04819657 0.3860753
7  0.03601456 -0.30982678 0.2977379 -0.021751728 -0.39933488 0.3574964
8  0.14729740 -0.38616972 0.2839504 -0.091117191 -0.46687210 0.4072593
9  0.36130356 -0.07095788 0.1415239 -0.392920984 -0.06636947 0.3342959
10 0.00107701 -0.14918942 0.1852891 -0.000689856 -0.19920415 0.1993821
> all.equal( margEffCond, margEffCond1 )
 [1] "Component 1: Mean relative difference: 9.319688e-05" 
 [2] "Component 2: Mean relative difference: 0.0002259434" 
 [3] "Component 3: Mean relative difference: 8.422528e-05" 
 [4] "Component 4: Mean relative difference: 0.0002359585" 
 [5] "Component 5: Mean relative difference: 0.0004315704" 
 [6] "Component 6: Mean relative difference: 0.0003287333" 
 [7] "Component 7: Mean relative difference: 0.0002101605" 
 [8] "Component 8: Mean relative difference: 0.0001300584" 
 [9] "Component 9: Mean relative difference: 0.0002044692" 
[10] "Component 10: Mean relative difference: 0.0001675277"
[11] "Component 11: Mean relative difference: 0.0001336327"
[12] "Component 12: Mean relative difference: 0.0001409385"
> # now with integrals obtained by the GHK algorithm
> margEffCond2 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = "GHK" )
> print( margEffCond2 )
      d_y1_d_x1  d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2  d_y3_d_x2
1  0.4120204907 0.12496054 -0.3601937 -0.229275444 0.24656096 -0.1264859
2  0.3105789512 0.17860492 -0.2207353 -0.252699622 0.23756523 -0.1745610
3  0.2665383992 0.23025645 -0.3837299 -0.358474059 0.23147649 -0.1489714
4  0.3737016708 0.27812532 -0.3561175 -0.347728634 0.26481716 -0.1576515
5  0.4399322754 0.27239142 -0.2624700 -0.321660167 0.26420615 -0.1646125
6  0.1334041757 0.05757852 -0.3838745 -0.271187377 0.06238751 -0.1099318
7  0.1211635205 0.14620921 -0.1616811 -0.009995845 0.11350228 -0.1592700
8  0.0497739112 0.35482588 -0.2353584 -0.205476715 0.24033985 -0.1801000
9  0.5582196873 0.04588147 -0.1163612 -0.322752953 0.07726908 -0.1033954
10 0.0006320436 0.23387574 -0.1340470 -0.006734245 0.11167712 -0.1708361
      d_y1_d_x3   d_y2_d_x3 d_y3_d_x3    d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  0.1763299124 -0.35336690 0.2233966 -0.146608979 -0.33322866 0.6039101
2  0.4709427048 -0.39474822 0.2424568 -0.401220334 -0.41533126 0.4972206
3  0.4403126676 -0.33958467 0.2354779 -0.380063996 -0.33216145 0.5723273
4  0.5203984290 -0.45373956 0.2448886 -0.414046787 -0.45507118 0.5682299
5  0.3330012417 -0.50703990 0.2835796 -0.224241436 -0.57213943 0.4910794
6  0.2532455360 -0.05821538 0.1579588 -0.279259651 -0.06532844 0.3858571
7  0.0390976682 -0.31144596 0.3059117 -0.022992332 -0.40247246 0.3630267
8  0.1510299701 -0.38761700 0.2909536 -0.092205023 -0.47013102 0.4115833
9  0.3606962506 -0.07810202 0.1413356 -0.395142890 -0.08668238 0.3341350
10 0.0008025023 -0.15020695 0.1921428 -0.002065605 -0.20061813 0.2067482
> all.equal( margEffCond, margEffCond2 )
 [1] "Component 1: Mean relative difference: 0.007274846" 
 [2] "Component 2: Mean relative difference: 0.03747971"  
 [3] "Component 3: Mean relative difference: 0.003518855" 
 [4] "Component 4: Mean relative difference: 0.003813365" 
 [5] "Component 5: Mean relative difference: 0.007335713" 
 [6] "Component 6: Mean relative difference: 0.01250843"  
 [7] "Component 7: Mean relative difference: 0.004478868" 
 [8] "Component 8: Mean relative difference: 0.009787095" 
 [9] "Component 9: Mean relative difference: 0.01291233"  
[10] "Component 10: Mean relative difference: 0.003706652"
[11] "Component 11: Mean relative difference: 0.02416913" 
[12] "Component 12: Mean relative difference: 0.004914305"
> all.equal( margEffCond1, margEffCond2 )
 [1] "Component 1: Mean relative difference: 0.007302638" 
 [2] "Component 2: Mean relative difference: 0.03747545"  
 [3] "Component 3: Mean relative difference: 0.003532005" 
 [4] "Component 4: Mean relative difference: 0.00395168"  
 [5] "Component 5: Mean relative difference: 0.006977384" 
 [6] "Component 6: Mean relative difference: 0.01267949"  
 [7] "Component 7: Mean relative difference: 0.004478342" 
 [8] "Component 8: Mean relative difference: 0.009775401" 
 [9] "Component 9: Mean relative difference: 0.01282563"  
[10] "Component 10: Mean relative difference: 0.003641365"
[11] "Component 11: Mean relative difference: 0.02411041" 
[12] "Component 12: Mean relative difference: 0.004893426"
> # now with integrals obtained by the GHK algorithm, reduced precision
> margEffCond3 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = "GHK", nGHK = 100 )
> print( margEffCond3 )
    d_y1_d_x1   d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.35706025  0.07834237 -0.3573599 -0.217914737 0.24204995 -0.12187035
2  0.17842058  0.10430154 -0.2112069 -0.232255861 0.22509394 -0.16275834
3  0.24645348  0.20573628 -0.3913875 -0.333771538 0.22470462 -0.14101272
4  0.34468065  0.25552160 -0.3654151 -0.321372456 0.25714440 -0.14868069
5  0.39531390  0.25352172 -0.2730576 -0.296051054 0.25561012 -0.15513685
6  0.11925400  0.01643885 -0.3810721 -0.247448071 0.05157318 -0.10229342
7  0.10840916  0.13399605 -0.1617170 -0.005700740 0.10456385 -0.15496986
8  0.02747604  0.32724239 -0.2326725 -0.183705309 0.22932867 -0.16951149
9  0.37473790 -0.06742030 -0.1067990 -0.290665859 0.06543780 -0.09456364
10 0.02095092  0.21903350 -0.1224342 -0.005313354 0.10231193 -0.16701680
     d_y1_d_x3   d_y2_d_x3 d_y3_d_x3   d_y1_d_x4    d_y2_d_x4 d_y3_d_x4
1   0.16817105 -0.34301441 0.2182270 -0.13517345 -0.296424705 0.6083034
2   0.43073787 -0.37331845 0.2244791 -0.29583700 -0.345586212 0.4849186
3   0.41205924 -0.32545153 0.2246944 -0.32971272 -0.279847270 0.5686308
4   0.48497682 -0.43971853 0.2322381 -0.35294054 -0.406603074 0.5674606
5   0.30018498 -0.48736224 0.2677792 -0.16964584 -0.530957962 0.4937718
6   0.23046155 -0.03469404 0.1472323 -0.23448731  0.018303024 0.3692521
7   0.02676862 -0.28930258 0.2928207 -0.02104248 -0.371619725 0.3545769
8   0.12347183 -0.36592513 0.2741515 -0.06717796 -0.435908310 0.4095904
9   0.32456657 -0.05199358 0.1296053 -0.31719931  0.008670741 0.3163796
10 -0.02408396 -0.13771422 0.1783179 -0.04203884 -0.184218486 0.1853459
> all.equal( margEffCond, margEffCond3 )
 [1] "Component 1: Mean relative difference: 0.1950758"  
 [2] "Component 2: Mean relative difference: 0.1761965"  
 [3] "Component 3: Mean relative difference: 0.02485851" 
 [4] "Component 4: Mean relative difference: 0.0796093"  
 [5] "Component 5: Mean relative difference: 0.04275513" 
 [6] "Component 6: Mean relative difference: 0.04227655" 
 [7] "Component 7: Mean relative difference: 0.09482927" 
 [8] "Component 8: Mean relative difference: 0.05197425" 
 [9] "Component 9: Mean relative difference: 0.04356983" 
[10] "Component 10: Mean relative difference: 0.19926"   
[11] "Component 11: Mean relative difference: 0.1322209" 
[12] "Component 12: Mean relative difference: 0.01804595"
> all.equal( margEffCond2, margEffCond3 )
 [1] "Component 1: Mean relative difference: 0.2002449"  
 [2] "Component 2: Mean relative difference: 0.205957"   
 [3] "Component 3: Mean relative difference: 0.02547425" 
 [4] "Component 4: Mean relative difference: 0.0824537"  
 [5] "Component 5: Mean relative difference: 0.04972607" 
 [6] "Component 6: Mean relative difference: 0.05214635" 
 [7] "Component 7: Mean relative difference: 0.0977991"  
 [8] "Component 8: Mean relative difference: 0.06116274" 
 [9] "Component 9: Mean relative difference: 0.05545767" 
[10] "Component 10: Mean relative difference: 0.2004108" 
[11] "Component 11: Mean relative difference: 0.1526995" 
[12] "Component 12: Mean relative difference: 0.02031045"
> # now with variance covariance matrix and Jacobian
> margEffCondV <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    vcov = diag( 18 ), returnJacobian = TRUE )
> print( attr( margEffCondV, "vcov" ) )
, , d_y1_d_x1

      d_y1_d_x1     d_y2_d_x1     d_y3_d_x1     d_y1_d_x2     d_y2_d_x2
1  9.750971e-01 -0.0030037423 -4.490045e-01 -0.2274334729  0.0068307492
5  2.912560e-01  0.0387204653 -5.823824e-02  0.0274927901 -0.0755630122
10 7.727996e-06  0.0001515647  5.378418e-05 -0.0001392449  0.0001042601
      d_y3_d_x2    d_y1_d_x3     d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1  0.1589283485 3.933900e-01 -0.0552681731 -0.2435898286 -4.945653e-01
5  0.0074691017 5.549692e-02  0.0922901614 -0.0211174083 -2.592969e-01
10 0.0002038302 3.768571e-05 -0.0001168923 -0.0002204885 -2.295846e-05
       d_y2_d_x4    d_y3_d_x4
1  -0.0204518927  0.269167837
5  -0.0399057003  0.081775059
10 -0.0001922025 -0.000239746

, , d_y2_d_x1

       d_y1_d_x1 d_y2_d_x1  d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.0030037423 0.3213086 0.08092957  0.089143004 -0.005045259 -0.05181404
5   0.0387204653 0.2564557 0.05195901 -0.032248624 -0.049598653 -0.03718387
10  0.0001515647 0.2634495 0.01979479 -0.003199861  0.088988794  0.02585722
       d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  -0.0444362635 -0.36640625  0.03804685 -0.0186954029 -0.65420788 -0.05516782
5   0.1118097454 -0.09074377  0.03547869 -0.1446390047 -0.08451527  0.05401841
10  0.0007386353 -0.10891137 -0.03761912 -0.0004670105 -0.20172481 -0.04392355

, , d_y3_d_x1

       d_y1_d_x1  d_y2_d_x1 d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -4.490045e-01 0.08092957 0.7652168  0.066369491 -0.008445285 -0.38941393
5  -5.823824e-02 0.05195901 0.2587506 -0.104236832  0.007911417 -0.01687398
10  5.378418e-05 0.01979479 0.1390371 -0.001494665  0.005243041  0.05039549
       d_y1_d_x3    d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  -0.0590156685 -0.077316740  0.47418771  0.1896379588 -0.14715095 -0.37498921
5   0.2073141841 -0.050093007 -0.08385162 -0.0721162000 -0.02900221 -0.06113302
10  0.0002592459 -0.005505227 -0.04774053 -0.0001016765 -0.00957396 -0.09144691

, , d_y1_d_x2

       d_y1_d_x1    d_y2_d_x1    d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1  -0.2274334729  0.089143004  0.066369491 0.243352635 -0.051781028
5   0.0274927901 -0.032248624 -0.104236832 0.380620095 -0.066218734
10 -0.0001392449 -0.003199861 -0.001494665 0.002968057 -0.003344902
      d_y3_d_x2     d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4
1  -0.110923427 -0.1634697830 -0.065674287 0.034896850 0.1447657345
5  -0.072756702 -0.3659913197  0.064668683 0.004837285 0.1638953109
10 -0.006398513 -0.0006844744  0.002479845 0.004958476 0.0004000892
      d_y2_d_x4    d_y3_d_x4
1  -0.177947659 -0.030710562
5   0.005786187  0.023795675
10  0.004023381  0.005823626

, , d_y2_d_x2

       d_y1_d_x1    d_y2_d_x1    d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1   0.0068307492 -0.005045259 -0.008445285 -0.051781028 0.1206777 0.04231634
5  -0.0755630122 -0.049598653  0.007911417 -0.066218734 0.1807104 0.04028227
10  0.0001042601  0.088988794  0.005243041 -0.003344902 0.1238768 0.03178731
       d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4    d_y2_d_x4
1   0.0067441826  0.02465192 -0.007198251 -0.0016801785 -0.004841556
5  -0.0054777688 -0.05093188 -0.002462829  0.0880749319  0.003619709
10  0.0005236167 -0.06784746 -0.029834489 -0.0003024923 -0.124347695
      d_y3_d_x4
1  -0.007015898
5  -0.003173176
10 -0.033883568

, , d_y3_d_x2

      d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1  0.1589283485 -0.05181404 -0.38941393 -0.110923427 0.04231634 0.3899346
5  0.0074691017 -0.03718387 -0.01687398 -0.072756702 0.04028227 0.2915086
10 0.0002038302  0.02585722  0.05039549 -0.006398513 0.03178731 0.1945990
      d_y1_d_x3   d_y2_d_x3  d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1   0.012348034  0.03680767 -0.2589552 -0.0683506485  0.10619381  0.14914537
5  -0.068990000  0.01306164 -0.1426762 -0.0176022174  0.06317946  0.01109935
10  0.001031903 -0.01953273 -0.0915693 -0.0005374509 -0.02873767 -0.14028833

, , d_y1_d_x3

      d_y1_d_x1     d_y2_d_x1     d_y3_d_x1     d_y1_d_x2     d_y2_d_x2
1  3.933900e-01 -0.0444362635 -0.0590156685 -0.1634697830  0.0067441826
5  5.549692e-02  0.1118097454  0.2073141841 -0.3659913197 -0.0054777688
10 3.768571e-05  0.0007386353  0.0002592459 -0.0006844744  0.0005236167
      d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1   0.012348034 0.3040714772 -0.0151625553 -0.087044527 -0.2673824317
5  -0.068990000 0.8905486381 -0.1310648760 -0.084355744 -0.4895552325
10  0.001031903 0.0001851111 -0.0005655208 -0.001242974 -0.0001109089
       d_y2_d_x4    d_y3_d_x4
1   0.0880096320  0.049793717
5  -0.0412674340 -0.014055628
10 -0.0008578677 -0.001300721

, , d_y2_d_x3

       d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  -0.0552681731 -0.36640625 -0.077316740 -0.065674287  0.02465192  0.03680767
5   0.0922901614 -0.09074377 -0.050093007  0.064668683 -0.05093188  0.01306164
10 -0.0001168923 -0.10891137 -0.005505227  0.002479845 -0.06784746 -0.01953273
       d_y1_d_x3  d_y2_d_x3  d_y3_d_x3     d_y1_d_x4  d_y2_d_x4   d_y3_d_x4
1  -0.0151625553 0.53411858 0.02817869  0.0503698350 0.78799250  0.08202687
5  -0.1310648760 0.36750199 0.02651079 -0.0434248946 0.04125263 -0.02987101
10 -0.0005655208 0.08986723 0.02954985  0.0003547671 0.15667029  0.03359214

, , d_y3_d_x3

       d_y1_d_x1   d_y2_d_x1   d_y3_d_x1   d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1  -0.2435898286  0.03804685  0.47418771 0.034896850 -0.007198251 -0.2589552
5  -0.0211174083  0.03547869 -0.08385162 0.004837285 -0.002462829 -0.1426762
10 -0.0002204885 -0.03761912 -0.04774053 0.004958476 -0.029834489 -0.0915693
      d_y1_d_x3  d_y2_d_x3 d_y3_d_x3    d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  -0.087044527 0.02817869 0.5423403 0.1177033549 -0.07893961 -0.18501075
5  -0.084355744 0.02651079 0.4425267 0.0919139188 -0.09262264  0.03898671
10 -0.001242974 0.02954985 0.1341219 0.0005213385  0.03939931  0.16845676

, , d_y1_d_x4

       d_y1_d_x1     d_y2_d_x1     d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
1  -4.945653e-01 -0.0186954029  0.1896379588 0.1447657345 -0.0016801785
5  -2.592969e-01 -0.1446390047 -0.0721162000 0.1638953109  0.0880749319
10 -2.295846e-05 -0.0004670105 -0.0001016765 0.0004000892 -0.0003024923
       d_y3_d_x2     d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1  -0.0683506485 -0.2673824317  0.0503698350 0.1177033549 3.487397e-01
5  -0.0176022174 -0.4895552325 -0.0434248946 0.0919139188 6.544726e-01
10 -0.0005374509 -0.0001109089  0.0003547671 0.0005213385 7.174936e-05
      d_y2_d_x4     d_y3_d_x4
1  0.0248710294 -0.1860859628
5  0.0436733057 -0.1419025799
10 0.0005876367  0.0004626546

, , d_y2_d_x4

       d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.0204518927 -0.65420788 -0.14715095 -0.177947659 -0.004841556  0.10619381
5  -0.0399057003 -0.08451527 -0.02900221  0.005786187  0.003619709  0.06317946
10 -0.0001922025 -0.20172481 -0.00957396  0.004023381 -0.124347695 -0.02873767
       d_y1_d_x3  d_y2_d_x3   d_y3_d_x3    d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1   0.0880096320 0.78799250 -0.07893961 0.0248710294 1.4554167  0.13380512
5  -0.0412674340 0.04125263 -0.09262264 0.0436733057 0.2499748 -0.04459537
10 -0.0008578677 0.15667029  0.03939931 0.0005876367 0.3032179  0.05096402

, , d_y3_d_x4

      d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1   0.269167837 -0.05516782 -0.37498921 -0.030710562 -0.007015898  0.14914537
5   0.081775059  0.05401841 -0.06113302  0.023795675 -0.003173176  0.01109935
10 -0.000239746 -0.04392355 -0.09144691  0.005823626 -0.033883568 -0.14028833
      d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1   0.049793717  0.08202687 -0.18501075 -0.1860859628  0.13380512 0.4411872
5  -0.014055628 -0.02987101  0.03898671 -0.1419025799 -0.04459537 0.2304625
10 -0.001300721  0.03359214  0.16845676  0.0004626546  0.05096402 0.2850578

> print( drop( attr( margEffCondV, "vcov" )[ 1, , ] ) )
             d_y1_d_x1    d_y2_d_x1    d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
d_y1_d_x1  0.975097136 -0.003003742 -0.449004490 -0.22743347  0.006830749
d_y2_d_x1 -0.003003742  0.321308613  0.080929573  0.08914300 -0.005045259
d_y3_d_x1 -0.449004490  0.080929573  0.765216773  0.06636949 -0.008445285
d_y1_d_x2 -0.227433473  0.089143004  0.066369491  0.24335263 -0.051781028
d_y2_d_x2  0.006830749 -0.005045259 -0.008445285 -0.05178103  0.120677689
d_y3_d_x2  0.158928348 -0.051814040 -0.389413930 -0.11092343  0.042316339
d_y1_d_x3  0.393390048 -0.044436263 -0.059015669 -0.16346978  0.006744183
d_y2_d_x3 -0.055268173 -0.366406246 -0.077316740 -0.06567429  0.024651923
d_y3_d_x3 -0.243589829  0.038046846  0.474187708  0.03489685 -0.007198251
d_y1_d_x4 -0.494565340 -0.018695403  0.189637959  0.14476573 -0.001680179
d_y2_d_x4 -0.020451893 -0.654207884 -0.147150953 -0.17794766 -0.004841556
d_y3_d_x4  0.269167837 -0.055167820 -0.374989209 -0.03071056 -0.007015898
            d_y3_d_x2    d_y1_d_x3   d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
d_y1_d_x1  0.15892835  0.393390048 -0.05526817 -0.243589829 -0.494565340
d_y2_d_x1 -0.05181404 -0.044436263 -0.36640625  0.038046846 -0.018695403
d_y3_d_x1 -0.38941393 -0.059015669 -0.07731674  0.474187708  0.189637959
d_y1_d_x2 -0.11092343 -0.163469783 -0.06567429  0.034896850  0.144765735
d_y2_d_x2  0.04231634  0.006744183  0.02465192 -0.007198251 -0.001680179
d_y3_d_x2  0.38993460  0.012348034  0.03680767 -0.258955161 -0.068350649
d_y1_d_x3  0.01234803  0.304071477 -0.01516256 -0.087044527 -0.267382432
d_y2_d_x3  0.03680767 -0.015162555  0.53411858  0.028178691  0.050369835
d_y3_d_x3 -0.25895516 -0.087044527  0.02817869  0.542340332  0.117703355
d_y1_d_x4 -0.06835065 -0.267382432  0.05036983  0.117703355  0.348739672
d_y2_d_x4  0.10619381  0.088009632  0.78799250 -0.078939610  0.024871029
d_y3_d_x4  0.14914537  0.049793717  0.08202687 -0.185010747 -0.186085963
             d_y2_d_x4    d_y3_d_x4
d_y1_d_x1 -0.020451893  0.269167837
d_y2_d_x1 -0.654207884 -0.055167820
d_y3_d_x1 -0.147150953 -0.374989209
d_y1_d_x2 -0.177947659 -0.030710562
d_y2_d_x2 -0.004841556 -0.007015898
d_y3_d_x2  0.106193814  0.149145367
d_y1_d_x3  0.088009632  0.049793717
d_y2_d_x3  0.787992505  0.082026866
d_y3_d_x3 -0.078939610 -0.185010747
d_y1_d_x4  0.024871029 -0.186085963
d_y2_d_x4  1.455416668  0.133805120
d_y3_d_x4  0.133805120  0.441187175
> print( attr( margEffCondV, "jacobian" ) )
, , b_1_0

       d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1   0.2844103081  0.0365935258  0.0780064050 -0.22745182  0.019380780
5  -0.1562244504 -0.0003601467 -0.0126554978  0.17568006 -0.017225469
10 -0.0008151563  0.0002331714  0.0007906753  0.01741561 -0.004668669
     d_y3_d_x2   d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4     d_y2_d_x4
1  -0.02311634  0.27862435 -0.067501560 0.013988810 -0.233368880 -6.972201e-02
5  -0.04385058 -0.36659564  0.049904525 0.087707619  0.242694753 -1.498801e-02
10 -0.01341462 -0.00432987  0.001387779 0.004218847  0.002109424 -4.163336e-05
      d_y3_d_x4
1  -0.004440892
5  -0.014654944
10 -0.001110223

, , b_1_1

      d_y1_d_x1     d_y2_d_x1     d_y3_d_x1 d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  4.322723e-01 -1.904979e-02 -8.015547e-02 0.0000000  0.00000000  0.00000000
5  2.559760e-01 -4.309406e-02 -8.364006e-02 0.1756801 -0.01722547 -0.04385058
10 4.235501e-06 -6.254719e-06 -2.028966e-05 0.0000000  0.00000000  0.00000000
    d_y1_d_x3  d_y2_d_x3  d_y3_d_x3 d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1   0.0000000 0.00000000 0.00000000 0.0000000  0.00000000  0.00000000
5  -0.3665956 0.04990452 0.08770762 0.2426948 -0.01498801 -0.01465494
10  0.0000000 0.00000000 0.00000000 0.0000000  0.00000000  0.00000000

, , b_1_2

   d_y1_d_x1  d_y2_d_x1  d_y3_d_x1 d_y1_d_x2    d_y2_d_x2   d_y3_d_x2 d_y1_d_x3
1  0.2844103 0.03659353 0.07800641  0.147862 -0.055643316 -0.15816188 0.2786799
5  0.0000000 0.00000000 0.00000000  0.431656 -0.060319529 -0.12749064 0.0000000
10 0.0000000 0.00000000 0.00000000  0.018235 -0.004908095 -0.01422558 0.0000000
     d_y2_d_x3  d_y3_d_x3  d_y1_d_x4   d_y2_d_x4    d_y3_d_x4
1  -0.06783463 0.01387779 -0.2333689 -0.06972201 -0.004440892
5   0.00000000 0.00000000  0.0000000  0.00000000  0.000000000
10  0.00000000 0.00000000  0.0000000  0.00000000  0.000000000

, , b_1_3

      d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1  -0.303700069 -0.0390754343 -0.0832970886  0.24287844 -0.020695256
5   0.097646416  0.0002251057  0.0079101828 -0.10980693  0.010766595
10 -0.001022055  0.0002923537  0.0009913604  0.02183595 -0.005853647
     d_y3_d_x2    d_y1_d_x3    d_y2_d_x3    d_y3_d_x3   d_y1_d_x4     d_y2_d_x4
1   0.02468417 -0.149755208  0.016653345 -0.172861725  0.24920344  7.482903e-02
5   0.02740834  0.484945417 -0.074329431 -0.138555833 -0.15143442  9.436896e-03
10 -0.01681944 -0.004662937  0.001484923  0.004551914  0.00288658 -4.163336e-05
      d_y3_d_x4
1   0.004773959
5   0.009436896
10 -0.001110223

, , b_1_4

       d_y1_d_x1     d_y2_d_x1     d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1   0.1212908204  1.560583e-02  0.0332669405 -0.097000062  0.008265210
5  -0.1283510529 -2.958896e-04 -0.0103975173  0.144335412 -0.014152120
10  0.0003101437 -8.871495e-05 -0.0003008287 -0.006626135  0.001776293
      d_y3_d_x2   d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1  -0.009858291  0.11889101 -0.0288657986  0.005884182 0.0483363349
5  -0.036026809 -0.30109248  0.0410782519  0.072164497 0.4554134847
10  0.005103872  0.00144329 -0.0005412337 -0.001776357 0.0002220446
       d_y2_d_x4     d_y3_d_x4
1  -0.0858202398 -0.1602051825
5  -0.0552891066 -0.0957012247
10 -0.0002081668 -0.0001110223

, , b_2_0

       d_y1_d_x1  d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -0.0090414667 -0.1533759 -0.019587546  0.038823785 -0.14266410 -0.011727560
5   0.0329540419  0.1411774  0.009013214 -0.014887909 -0.04799001 -0.004653031
10  0.0001596092  0.2197046  0.006612413 -0.003257078  0.13273560  0.012840268
       d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4  d_y2_d_x4    d_y3_d_x4
1  -0.0427158309  0.35016434  0.030309089  0.0128508315  0.3280709  0.029420910
5   0.0467403893 -0.07982504 -0.002553513 -0.0517363929 -0.0816569  0.009880985
10  0.0007771561 -0.22637447 -0.018429702 -0.0005551115 -0.3019945 -0.017874591

, , b_2_1

       d_y1_d_x1 d_y2_d_x1   d_y3_d_x1   d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -2.526525e-02 0.1025285 0.006560333  0.00000000  0.00000000  0.000000000
5  -4.130975e-02 0.4007844 0.037210326 -0.01488791 -0.04799001 -0.004653031
10 -6.115108e-07 0.3469243 0.022544747  0.00000000  0.00000000  0.000000000
    d_y1_d_x3   d_y2_d_x3    d_y3_d_x3   d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  0.00000000  0.00000000  0.000000000  0.00000000  0.00000000 0.000000000
5  0.04674039 -0.07982504 -0.002553513 -0.05173639 -0.08171241 0.009880985
10 0.00000000  0.00000000  0.000000000  0.00000000  0.00000000 0.000000000

, , b_2_2

      d_y1_d_x1  d_y2_d_x1   d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1  -0.009041467 -0.1533759 -0.01958755 -0.016223782 0.2559044 0.02614788
5   0.000000000  0.0000000  0.00000000 -0.056197656 0.3527944 0.03255729
10  0.000000000  0.0000000  0.00000000 -0.003417298 0.2599553 0.02877260
     d_y1_d_x3 d_y2_d_x3  d_y3_d_x3  d_y1_d_x4 d_y2_d_x4  d_y3_d_x4
1  -0.04271583 0.3501643 0.03030909 0.01285083 0.3280709 0.02942091
5   0.00000000 0.0000000 0.00000000 0.00000000 0.0000000 0.00000000
10  0.00000000 0.0000000 0.00000000 0.00000000 0.0000000 0.00000000

, , b_2_3

       d_y1_d_x1  d_y2_d_x1    d_y3_d_x1    d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1   0.0096546928  0.1637784  0.020916046 -0.041456959 0.15234011 0.012522967
5  -0.0205975703 -0.0882414 -0.005633612  0.009305528 0.02999564 0.002908327
10  0.0002001207  0.2754689  0.008290742 -0.004083772 0.16642588 0.016099320
       d_y1_d_x3  d_y2_d_x3    d_y3_d_x3     d_y1_d_x4   d_y2_d_x4    d_y3_d_x4
1   0.0293376434 -0.1184608 -0.006772360 -0.0136834988 -0.34983128 -0.031308289
5  -0.0708322290  0.4503620  0.038524739  0.0325295346  0.05112577 -0.006106227
10  0.0008881784 -0.1565276 -0.006883383 -0.0006661338 -0.37862768 -0.022759572

, , b_2_4

       d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -3.855862e-03 -0.06540932 -0.008353388  0.016556955 -0.06084113 -0.005001385
5   2.707442e-02  0.11598866  0.007405086 -0.012231624 -0.03942768 -0.003822842
10 -6.072676e-05 -0.08359122 -0.002515831  0.001239224 -0.05050205 -0.004885350
       d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4 d_y2_d_x4  d_y3_d_x4
1  -0.0182076576  0.14943602  0.012989609 -0.0107414078 0.3959055 0.03896883
5   0.0384137167 -0.06550316 -0.001998401 -0.0840438830 0.3334000 0.04507505
10  0.0001110223  0.08613943  0.007216450  0.0001110223 0.2421258 0.02287059

, , b_3_0

       d_y1_d_x1   d_y2_d_x1  d_y3_d_x1    d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1  -0.1036330469 -0.01581883 -0.1692854  0.058505811 -0.008350353 0.03177489
5   0.0092022346  0.01949003  0.1833577 -0.062146477  0.007141051 0.02361125
10  0.0001787653  0.01146679  0.1239592 -0.004659593  0.009654283 0.15087598
      d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  -0.079616869  0.03386180 -0.01409983  0.0835026492  0.02187139 -0.03330669
5   0.116129328 -0.02753353 -0.10158541 -0.0408562073 -0.02070566 -0.14188650
10  0.001110223 -0.01007527 -0.23081537 -0.0002220446 -0.01218470 -0.24702462

, , b_3_1

       d_y1_d_x1  d_y2_d_x1 d_y3_d_x1   d_y1_d_x2   d_y2_d_x2  d_y3_d_x2
1  -1.490547e-01 0.01435670 0.2632494  0.00000000 0.000000000 0.00000000
5  -7.098636e-02 0.03269126 0.4007928 -0.06214648 0.007141051 0.02361125
10 -5.949463e-06 0.01493196 0.3108666  0.00000000 0.000000000 0.00000000
   d_y1_d_x3   d_y2_d_x3  d_y3_d_x3   d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  0.0000000  0.00000000  0.0000000  0.00000000  0.00000000  0.0000000
5  0.1162404 -0.02753353 -0.1015854 -0.04085621 -0.02070566 -0.1418865
10 0.0000000  0.00000000  0.0000000  0.00000000  0.00000000  0.0000000

, , b_3_2

   d_y1_d_x1   d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1  -0.103633 -0.01581883 -0.1692854 -0.045421607 0.03017553 0.4325348
5   0.000000  0.00000000  0.0000000 -0.133132832 0.03983231 0.4244040
10  0.000000  0.00000000  0.0000000 -0.004844308 0.01311946 0.3377834
     d_y1_d_x3 d_y2_d_x3   d_y3_d_x3  d_y1_d_x4  d_y2_d_x4   d_y3_d_x4
1  -0.07960299 0.0338618 -0.01421085 0.08350265 0.02187139 -0.03330669
5   0.00000000 0.0000000  0.00000000 0.00000000 0.00000000  0.00000000
10  0.00000000 0.0000000  0.00000000 0.00000000 0.00000000  0.00000000

, , b_3_3

       d_y1_d_x1   d_y2_d_x1  d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1   0.1106618239  0.01689172  0.1807669 -0.062473892  0.008916705 -0.03392998
5  -0.0057517577 -0.01218203 -0.1146057  0.038843988 -0.004463437 -0.01475796
10  0.0002241385  0.01437723  0.1554218 -0.005842267  0.012104684  0.18917056
       d_y1_d_x3    d_y2_d_x3  d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1   0.0395655730 -0.005551115  0.4479750 -0.0891647867 -0.02287059  0.03563816
5  -0.1439959263  0.049737992  0.4640732  0.0250910404  0.01287859  0.08837375
10  0.0007771561 -0.009173218 -0.1025846 -0.0006661338 -0.01527944 -0.31008529

, , b_3_4

       d_y1_d_x1    d_y2_d_x1   d_y3_d_x1   d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -4.419579e-02 -0.006746165 -0.07219415  0.02495064 -0.003561127  0.01355085
5   7.560382e-03  0.016012636  0.15064319 -0.05105837  0.005866952  0.01939856
10 -6.801493e-05 -0.004362780 -0.04716287  0.00177284 -0.003673175 -0.05740394
       d_y1_d_x3    d_y2_d_x3    d_y3_d_x3     d_y1_d_x4  d_y2_d_x4 d_y3_d_x4
1  -0.0339867023  0.013544721 -0.006439294 -0.0098671071 0.03930190 0.4181100
5   0.0954791801 -0.022593039 -0.083599794 -0.1039168751 0.01604272 0.2845502
10 -0.0005551115  0.003816392  0.087596597 -0.0003330669 0.00809075 0.2806644

, , R_1_2

      d_y1_d_x1     d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1   0.012302106 -0.4730857642 -0.022865221 -0.23681944 0.035356899  0.04842374
5  -0.389154438 -0.1346716768  0.006126323 -0.02640070 0.200346660  0.03805750
10 -0.002199324 -0.0001412116  0.001882921  0.03400172 0.006272141 -0.02126043
    d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4    d_y2_d_x4    d_y3_d_x4
1   0.1878220  0.457300864 -0.036304293 -0.002109424 9.630075e-01  0.018873791
5  -0.1357803 -0.301536573 -0.032640557  0.513034060 1.147971e-01 -0.069944051
10 -0.0104361 -0.001026956  0.009214851  0.007327472 2.775558e-05 -0.002775558

, , R_1_3

       d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1   0.6779988895 -0.0439634712 -0.7518035113 -0.15287721  0.012866382
5   0.1100880665 -0.0272114692 -0.1341660789  0.25360526  0.002158135
10 -0.0008353512  0.0001322236 -0.0007461053  0.02054856 -0.003285345
    d_y3_d_x2    d_y1_d_x3    d_y2_d_x3    d_y3_d_x3   d_y1_d_x4    d_y2_d_x4
1  0.39436273  0.215605311 0.0112132525 -0.516919840 -0.38914705 0.0889288643
5  0.25411486 -0.444311254 0.0162647673 -0.312194715 -0.03386180 0.0418554080
10 0.01486094 -0.004662937 0.0008743006 -0.003996803  0.00144329 0.0002220446
     d_y3_d_x4
1  0.451305660
5  0.175637282
10 0.001332268

, , R_2_3

       d_y1_d_x1  d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2  d_y3_d_x2
1  -0.0295668558 -0.0324746 -0.083808061  0.09014664 -0.03836515 -0.1240072
5   0.0509223599  0.1790779  0.041843222 -0.03551199  0.05245643 -0.1427688
10  0.0004814612  0.1066395 -0.004474384 -0.01049811  0.08873839  0.1265591
     d_y1_d_x3   d_y2_d_x3  d_y3_d_x3    d_y1_d_x4    d_y2_d_x4  d_y3_d_x4
1  -0.10107193  0.17463808  0.2008393  0.036234904  0.005440093  0.1699751
5   0.11124435 -0.19939606  0.2443601 -0.117239551 -0.321020988  0.2318146
10  0.00288658 -0.08058831 -0.2491340 -0.001332268 -0.097907793 -0.2184919

> print( drop( attr( margEffCondV, "jacobian" )[ 1, , ] ) )
                 b_1_0       b_1_1        b_1_2        b_1_3        b_1_4
d_y1_d_x1  0.284410308  0.43227229  0.284410308 -0.303700069  0.121290820
d_y2_d_x1  0.036593526 -0.01904979  0.036593526 -0.039075434  0.015605829
d_y3_d_x1  0.078006405 -0.08015547  0.078006405 -0.083297089  0.033266940
d_y1_d_x2 -0.227451818  0.00000000  0.147861986  0.242878443 -0.097000062
d_y2_d_x2  0.019380780  0.00000000 -0.055643316 -0.020695256  0.008265210
d_y3_d_x2 -0.023116338  0.00000000 -0.158161880  0.024684173 -0.009858291
d_y1_d_x3  0.278624346  0.00000000  0.278679857 -0.149755208  0.118891008
d_y2_d_x3 -0.067501560  0.00000000 -0.067834627  0.016653345 -0.028865799
d_y3_d_x3  0.013988810  0.00000000  0.013877788 -0.172861725  0.005884182
d_y1_d_x4 -0.233368880  0.00000000 -0.233368880  0.249203436  0.048336335
d_y2_d_x4 -0.069722006  0.00000000 -0.069722006  0.074829032 -0.085820240
d_y3_d_x4 -0.004440892  0.00000000 -0.004440892  0.004773959 -0.160205182
                 b_2_0        b_2_1        b_2_2        b_2_3        b_2_4
d_y1_d_x1 -0.009041467 -0.025265249 -0.009041467  0.009654693 -0.003855862
d_y2_d_x1 -0.153375874  0.102528544 -0.153375874  0.163778394 -0.065409323
d_y3_d_x1 -0.019587546  0.006560333 -0.019587546  0.020916046 -0.008353388
d_y1_d_x2  0.038823785  0.000000000 -0.016223782 -0.041456959  0.016556955
d_y2_d_x2 -0.142664100  0.000000000  0.255904418  0.152340108 -0.060841134
d_y3_d_x2 -0.011727560  0.000000000  0.026147879  0.012522967 -0.005001385
d_y1_d_x3 -0.042715831  0.000000000 -0.042715831  0.029337643 -0.018207658
d_y2_d_x3  0.350164342  0.000000000  0.350164342 -0.118460797  0.149436019
d_y3_d_x3  0.030309089  0.000000000  0.030309089 -0.006772360  0.012989609
d_y1_d_x4  0.012850832  0.000000000  0.012850832 -0.013683499 -0.010741408
d_y2_d_x4  0.328070904  0.000000000  0.328070904 -0.349831275  0.395905531
d_y3_d_x4  0.029420910  0.000000000  0.029420910 -0.031308289  0.038968828
                 b_3_0      b_3_1       b_3_2        b_3_3        b_3_4
d_y1_d_x1 -0.103633047 -0.1490547 -0.10363305  0.110661824 -0.044195787
d_y2_d_x1 -0.015818829  0.0143567 -0.01581883  0.016891720 -0.006746165
d_y3_d_x1 -0.169285366  0.2632494 -0.16928537  0.180766927 -0.072194152
d_y1_d_x2  0.058505811  0.0000000 -0.04542161 -0.062473892  0.024950635
d_y2_d_x2 -0.008350353  0.0000000  0.03017553  0.008916705 -0.003561127
d_y3_d_x2  0.031774889  0.0000000  0.43253479 -0.033929980  0.013550854
d_y1_d_x3 -0.079616869  0.0000000 -0.07960299  0.039565573 -0.033986702
d_y2_d_x3  0.033861802  0.0000000  0.03386180 -0.005551115  0.013544721
d_y3_d_x3 -0.014099832  0.0000000 -0.01421085  0.447974990 -0.006439294
d_y1_d_x4  0.083502649  0.0000000  0.08350265 -0.089164787 -0.009867107
d_y2_d_x4  0.021871394  0.0000000  0.02187139 -0.022870594  0.039301895
d_y3_d_x4 -0.033306691  0.0000000 -0.03330669  0.035638159  0.418109991
                 R_1_2       R_1_3        R_2_3
d_y1_d_x1  0.012302106  0.67799889 -0.029566856
d_y2_d_x1 -0.473085764 -0.04396347 -0.032474601
d_y3_d_x1 -0.022865221 -0.75180351 -0.083808061
d_y1_d_x2 -0.236819439 -0.15287721  0.090146639
d_y2_d_x2  0.035356899  0.01286638 -0.038365155
d_y3_d_x2  0.048423740  0.39436273 -0.124007224
d_y1_d_x3  0.187821980  0.21560531 -0.101071929
d_y2_d_x3  0.457300864  0.01121325  0.174638082
d_y3_d_x3 -0.036304293 -0.51691984  0.200839345
d_y1_d_x4 -0.002109424 -0.38914705  0.036234904
d_y2_d_x4  0.963007452  0.08892886  0.005440093
d_y3_d_x4  0.018873791  0.45130566  0.169975145
> summary( margEffCondV )
               Estimate Std. error z value Pr(> z)
1: d_y1_d_x1  0.4118196  0.9874701   0.417   0.677
1: d_y2_d_x1  0.1175542  0.5668409   0.207   0.836
1: d_y3_d_x1 -0.3603571  0.8747667  -0.412   0.680
1: d_y1_d_x2 -0.2293360  0.4933079  -0.465   0.642
1: d_y2_d_x2  0.2459294  0.3473869   0.708   0.479
1: d_y3_d_x2 -0.1258047  0.6244474  -0.201   0.840
1: d_y1_d_x3  0.1765116  0.5514268   0.320   0.749
1: d_y2_d_x3 -0.3517929  0.7308342  -0.481   0.630
1: d_y3_d_x3  0.2229842  0.7364376   0.303   0.762
1: d_y1_d_x4 -0.1468375  0.5905418  -0.249   0.804
1: d_y2_d_x4 -0.3287218  1.2064065  -0.272   0.785
1: d_y3_d_x4  0.6037347  0.6642192   0.909   0.363
2: d_y1_d_x1  0.4391801  0.5396814   0.814   0.416
2: d_y2_d_x1  0.2708273  0.5064146   0.535   0.593
2: d_y3_d_x1 -0.2615752  0.5086753  -0.514   0.607
2: d_y1_d_x2 -0.3205450  0.6169442  -0.520   0.603
2: d_y2_d_x2  0.2631544  0.4251005   0.619   0.536
2: d_y3_d_x2 -0.1630063  0.5399154  -0.302   0.763
2: d_y1_d_x3  0.3298530  0.9436888   0.350   0.727
2: d_y2_d_x3 -0.5053126  0.6062194  -0.834   0.405
2: d_y3_d_x3  0.2791236  0.6652268   0.420   0.675
2: d_y1_d_x4 -0.2238688  0.8089948  -0.277   0.782
2: d_y2_d_x4 -0.5675504  0.4999748  -1.135   0.256
2: d_y3_d_x4  0.4883268  0.4800651   1.017   0.309
3: d_y1_d_x1  0.0002023  0.0027799   0.073   0.942
3: d_y2_d_x1  0.2319696  0.5132733   0.452   0.651
3: d_y3_d_x1 -0.1301103  0.3728767  -0.349   0.727
3: d_y1_d_x2 -0.0057134  0.0544799  -0.105   0.916
3: d_y2_d_x2  0.1109910  0.3519614   0.315   0.752
3: d_y3_d_x2 -0.1661675  0.4411338  -0.377   0.706
3: d_y1_d_x3  0.0011362  0.0136056   0.084   0.933
3: d_y2_d_x3 -0.1491872  0.2997786  -0.498   0.619
3: d_y3_d_x3  0.1853440  0.3662266   0.506   0.613
3: d_y1_d_x4 -0.0006208  0.0084705  -0.073   0.942
3: d_y2_d_x4 -0.1992018  0.5506523  -0.362   0.718
3: d_y3_d_x4  0.1994459  0.5339080   0.374   0.709
> margEffCondVA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    vcov = diag( 18 ), returnJacobian = TRUE )
> all.equal( margEffCondV, margEffCondVA )
[1] TRUE
> # now with Jacobian but without variance covariance matrix
> margEffCondJac <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    returnJacobian = TRUE )
> all.equal( attr( margEffCondJac, "jacobian" ), attr( margEffCondV, "jacobian" ) )
[1] TRUE
> # now with mean values of marginal effects
> margEffCondM <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    vcov = diag( 18 ), addMean = TRUE, returnJacobian = TRUE )
> all.equal( margEffCondV, margEffCondM[ 1:3, ], check.attributes = FALSE )
[1] TRUE
> print( margEffCondM )
        d_y1_d_x1 d_y2_d_x1  d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1    0.4118196285 0.1175542 -0.3603571 -0.229336023 0.2459294 -0.1258047
2    0.4391801486 0.2708273 -0.2615752 -0.320544987 0.2631544 -0.1630063
3    0.0002023317 0.2319696 -0.1301103 -0.005713415 0.1109910 -0.1661675
mean 0.2837340363 0.2067837 -0.2506808 -0.185198142 0.2066916 -0.1516595
       d_y1_d_x3  d_y2_d_x3 d_y3_d_x3    d_y1_d_x4  d_y2_d_x4 d_y3_d_x4
1    0.176511553 -0.3517929 0.2229842 -0.146837465 -0.3287218 0.6037347
2    0.329853048 -0.5053126 0.2791236 -0.223868797 -0.5675504 0.4883268
3    0.001136227 -0.1491872 0.1853440 -0.000620818 -0.1992018 0.1994459
mean 0.169166943 -0.3354309 0.2291506 -0.123775693 -0.3651580 0.4305025
> all.equal( attr( margEffCondV, "vcov" ), 
+    attr( margEffCondM, "vcov" )[ 1:3, , ] )
[1] TRUE
> print( attr( margEffCondM, "vcov" ) )
, , d_y1_d_x1

        d_y1_d_x1     d_y2_d_x1     d_y3_d_x1     d_y1_d_x2     d_y2_d_x2
1    9.750971e-01 -0.0030037423 -4.490045e-01 -0.2274334729  0.0068307492
5    2.912560e-01  0.0387204653 -5.823824e-02  0.0274927901 -0.0755630122
10   7.727996e-06  0.0001515647  5.378418e-05 -0.0001392449  0.0001042601
mean 1.626491e-01  0.0104253263 -1.058717e-01  0.0523851888 -0.0162192448
        d_y3_d_x2     d_y1_d_x3     d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1    0.1589283485  3.933900e-01 -0.0552681731 -0.2435898286 -4.945653e-01
5    0.0074691017  5.549692e-02  0.0922901614 -0.0211174083 -2.592969e-01
10   0.0002038302  3.768571e-05 -0.0001168923 -0.0002204885 -2.295846e-05
mean 0.0252988980 -5.410546e-02 -0.0002277709 -0.0384624892 -5.094835e-02
         d_y2_d_x4    d_y3_d_x4
1    -0.0204518927  0.269167837
5    -0.0399057003  0.081775059
10   -0.0001922025 -0.000239746
mean -0.0380693290  0.058404946

, , d_y2_d_x1

         d_y1_d_x1 d_y2_d_x1  d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1    -0.0030037423 0.3213086 0.08092957  0.089143004 -0.005045259 -0.05181404
5     0.0387204653 0.2564557 0.05195901 -0.032248624 -0.049598653 -0.03718387
10    0.0001515647 0.2634495 0.01979479 -0.003199861  0.088988794  0.02585722
mean  0.0104253263 0.1517178 0.02393939  0.014984015 -0.020431173 -0.01708688
         d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4
1    -0.0444362635 -0.36640625  0.03804685 -0.0186954029 -0.65420788
5     0.1118097454 -0.09074377  0.03547869 -0.1446390047 -0.08451527
10    0.0007386353 -0.10891137 -0.03761912 -0.0004670105 -0.20172481
mean  0.0053814099 -0.02052836  0.01826951 -0.0416673479 -0.13138360
         d_y3_d_x4
1    -5.516782e-02
5     5.401841e-02
10   -4.392355e-02
mean  4.693266e-05

, , d_y3_d_x1

         d_y1_d_x1  d_y2_d_x1 d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1    -4.490045e-01 0.08092957 0.7652168  0.066369491 -0.008445285 -0.38941393
5    -5.823824e-02 0.05195901 0.2587506 -0.104236832  0.007911417 -0.01687398
10    5.378418e-05 0.01979479 0.1390371 -0.001494665  0.005243041  0.05039549
mean -1.058717e-01 0.02393939 0.2095090 -0.015516234 -0.004223757 -0.08103704
         d_y1_d_x3    d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4
1    -0.0590156685 -0.077316740  0.47418771  0.1896379588 -0.14715095
5     0.2073141841 -0.050093007 -0.08385162 -0.0721162000 -0.02900221
10    0.0002592459 -0.005505227 -0.04774053 -0.0001016765 -0.00957396
mean  0.0407274425 -0.007435689  0.08703749  0.0275352692 -0.02122237
       d_y3_d_x4
1    -0.37498921
5    -0.06113302
10   -0.09144691
mean -0.08600855

, , d_y1_d_x2

         d_y1_d_x1    d_y2_d_x1    d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1    -0.2274334729  0.089143004  0.066369491 0.243352635 -0.051781028
5     0.0274927901 -0.032248624 -0.104236832 0.380620095 -0.066218734
10   -0.0001392449 -0.003199861 -0.001494665 0.002968057 -0.003344902
mean  0.0523851888  0.014984015 -0.015516234 0.058997209 -0.024817479
        d_y3_d_x2     d_y1_d_x3    d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1    -0.110923427 -0.1634697830 -0.065674287  0.034896850  0.1447657345
5    -0.072756702 -0.3659913197  0.064668683  0.004837285  0.1638953109
10   -0.006398513 -0.0006844744  0.002479845  0.004958476  0.0004000892
mean -0.039419377  0.0138657302 -0.012374746 -0.013103001 -0.0272606024
        d_y2_d_x4    d_y3_d_x4
1    -0.177947659 -0.030710562
5     0.005786187  0.023795675
10    0.004023381  0.005823626
mean -0.031313450  0.009391722

, , d_y2_d_x2

         d_y1_d_x1    d_y2_d_x1    d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1     0.0068307492 -0.005045259 -0.008445285 -0.051781028 0.1206777 0.04231634
5    -0.0755630122 -0.049598653  0.007911417 -0.066218734 0.1807104 0.04028227
10    0.0001042601  0.088988794  0.005243041 -0.003344902 0.1238768 0.03178731
mean -0.0162192448 -0.020431173 -0.004223757 -0.024817479 0.1107039 0.02655881
         d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4    d_y2_d_x4
1     0.0067441826  0.02465192 -0.007198251 -0.0016801785 -0.004841556
5    -0.0054777688 -0.05093188 -0.002462829  0.0880749319  0.003619709
10    0.0005236167 -0.06784746 -0.029834489 -0.0003024923 -0.124347695
mean -0.0096734197  0.04214592  0.004157261  0.0194403957  0.015386640
        d_y3_d_x4
1    -0.007015898
5    -0.003173176
10   -0.033883568
mean -0.001128619

, , d_y3_d_x2

        d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1    0.1589283485 -0.05181404 -0.38941393 -0.110923427 0.04231634 0.3899346
5    0.0074691017 -0.03718387 -0.01687398 -0.072756702 0.04028227 0.2915086
10   0.0002038302  0.02585722  0.05039549 -0.006398513 0.03178731 0.1945990
mean 0.0252988980 -0.01708688 -0.08103704 -0.039419377 0.02655881 0.2294239
        d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1     0.012348034  0.03680767 -0.25895516 -0.0683506485  0.10619381  0.14914537
5    -0.068990000  0.01306164 -0.14267620 -0.0176022174  0.06317946  0.01109935
10    0.001031903 -0.01953273 -0.09156930 -0.0005374509 -0.02873767 -0.14028833
mean -0.033460619  0.01542155 -0.06537606 -0.0098062631  0.02946187  0.02452436

, , d_y1_d_x3

         d_y1_d_x1     d_y2_d_x1     d_y3_d_x1     d_y1_d_x2     d_y2_d_x2
1     3.933900e-01 -0.0444362635 -0.0590156685 -0.1634697830  0.0067441826
5     5.549692e-02  0.1118097454  0.2073141841 -0.3659913197 -0.0054777688
10    3.768571e-05  0.0007386353  0.0002592459 -0.0006844744  0.0005236167
mean -5.410546e-02  0.0053814099  0.0407274425  0.0138657302 -0.0096734197
        d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1     0.012348034 0.3040714772 -0.0151625553 -0.087044527 -0.2673824317
5    -0.068990000 0.8905486381 -0.1310648760 -0.084355744 -0.4895552325
10    0.001031903 0.0001851111 -0.0005655208 -0.001242974 -0.0001109089
mean -0.033460619 0.0511860030 -0.0100075558 -0.007617053 -0.0122093019
         d_y2_d_x4    d_y3_d_x4
1     0.0880096320  0.049793717
5    -0.0412674340 -0.014055628
10   -0.0008578677 -0.001300721
mean  0.0096893901 -0.004050431

, , d_y2_d_x3

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2
1    -0.0552681731 -0.36640625 -0.077316740 -0.065674287  0.02465192
5     0.0922901614 -0.09074377 -0.050093007  0.064668683 -0.05093188
10   -0.0001168923 -0.10891137 -0.005505227  0.002479845 -0.06784746
mean -0.0002277709 -0.02052836 -0.007435689 -0.012374746  0.04214592
       d_y3_d_x2     d_y1_d_x3  d_y2_d_x3   d_y3_d_x3     d_y1_d_x4  d_y2_d_x4
1     0.03680767 -0.0151625553 0.53411858 0.028178691  0.0503698350 0.78799250
5     0.01306164 -0.1310648760 0.36750199 0.026510792 -0.0434248946 0.04125263
10   -0.01953273 -0.0005655208 0.08986723 0.029549847  0.0003547671 0.15667029
mean  0.01542155 -0.0100075558 0.02669626 0.001887607  0.0112226139 0.04206093
         d_y3_d_x4
1     0.0820268663
5    -0.0298710132
10    0.0335921363
mean -0.0003187364

, , d_y3_d_x3

         d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1    -0.2435898286  0.03804685  0.47418771  0.034896850 -0.007198251
5    -0.0211174083  0.03547869 -0.08385162  0.004837285 -0.002462829
10   -0.0002204885 -0.03761912 -0.04774053  0.004958476 -0.029834489
mean -0.0384624892  0.01826951  0.08703749 -0.013103001  0.004157261
       d_y3_d_x2    d_y1_d_x3   d_y2_d_x3 d_y3_d_x3    d_y1_d_x4   d_y2_d_x4
1    -0.25895516 -0.087044527 0.028178691 0.5423403 0.1177033549 -0.07893961
5    -0.14267620 -0.084355744 0.026510792 0.4425267 0.0919139188 -0.09262264
10   -0.09156930 -0.001242974 0.029549847 0.1341219 0.0005213385  0.03939931
mean -0.06537606 -0.007617053 0.001887607 0.1825505 0.0295491598 -0.03411103
       d_y3_d_x4
1    -0.18501075
5     0.03898671
10    0.16845676
mean -0.05573580

, , d_y1_d_x4

         d_y1_d_x1     d_y2_d_x1     d_y3_d_x1     d_y1_d_x2     d_y2_d_x2
1    -4.945653e-01 -0.0186954029  0.1896379588  0.1447657345 -0.0016801785
5    -2.592969e-01 -0.1446390047 -0.0721162000  0.1638953109  0.0880749319
10   -2.295846e-05 -0.0004670105 -0.0001016765  0.0004000892 -0.0003024923
mean -5.094835e-02 -0.0416673479  0.0275352692 -0.0272606024  0.0194403957
         d_y3_d_x2     d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1    -0.0683506485 -0.2673824317  0.0503698350 0.1177033549 3.487397e-01
5    -0.0176022174 -0.4895552325 -0.0434248946 0.0919139188 6.544726e-01
10   -0.0005374509 -0.0001109089  0.0003547671 0.0005213385 7.174936e-05
mean -0.0098062631 -0.0122093019  0.0112226139 0.0295491598 9.689341e-02
        d_y2_d_x4     d_y3_d_x4
1    0.0248710294 -0.1860859628
5    0.0436733057 -0.1419025799
10   0.0005876367  0.0004626546
mean 0.0432535988 -0.0628415482

, , d_y2_d_x4

         d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1    -0.0204518927 -0.65420788 -0.14715095 -0.177947659 -0.004841556
5    -0.0399057003 -0.08451527 -0.02900221  0.005786187  0.003619709
10   -0.0001922025 -0.20172481 -0.00957396  0.004023381 -0.124347695
mean -0.0380693290 -0.13138360 -0.02122237 -0.031313450  0.015386640
       d_y3_d_x2     d_y1_d_x3  d_y2_d_x3   d_y3_d_x3    d_y1_d_x4 d_y2_d_x4
1     0.10619381  0.0880096320 0.78799250 -0.07893961 0.0248710294 1.4554167
5     0.06317946 -0.0412674340 0.04125263 -0.09262264 0.0436733057 0.2499748
10   -0.02873767 -0.0008578677 0.15667029  0.03939931 0.0005876367 0.3032179
mean  0.02946187  0.0096893901 0.04206093 -0.03411103 0.0432535988 0.3238597
       d_y3_d_x4
1     0.13380512
5    -0.04459537
10    0.05096402
mean  0.02380201

, , d_y3_d_x4

        d_y1_d_x1     d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1     0.269167837 -5.516782e-02 -0.37498921 -0.030710562 -0.007015898
5     0.081775059  5.401841e-02 -0.06113302  0.023795675 -0.003173176
10   -0.000239746 -4.392355e-02 -0.09144691  0.005823626 -0.033883568
mean  0.058404946  4.693266e-05 -0.08600855  0.009391722 -0.001128619
       d_y3_d_x2    d_y1_d_x3     d_y2_d_x3   d_y3_d_x3     d_y1_d_x4
1     0.14914537  0.049793717  0.0820268663 -0.18501075 -0.1860859628
5     0.01109935 -0.014055628 -0.0298710132  0.03898671 -0.1419025799
10   -0.14028833 -0.001300721  0.0335921363  0.16845676  0.0004626546
mean  0.02452436 -0.004050431 -0.0003187364 -0.05573580 -0.0628415482
       d_y2_d_x4 d_y3_d_x4
1     0.13380512 0.4411872
5    -0.04459537 0.2304625
10    0.05096402 0.2850578
mean  0.02380201 0.1905689

> print( drop( attr( margEffCondM, "vcov" )[ 4, , ] ) )
              d_y1_d_x1     d_y2_d_x1    d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
d_y1_d_x1  0.1626490560  1.042533e-02 -0.105871709  0.052385189 -0.016219245
d_y2_d_x1  0.0104253263  1.517178e-01  0.023939392  0.014984015 -0.020431173
d_y3_d_x1 -0.1058717093  2.393939e-02  0.209509037 -0.015516234 -0.004223757
d_y1_d_x2  0.0523851888  1.498401e-02 -0.015516234  0.058997209 -0.024817479
d_y2_d_x2 -0.0162192448 -2.043117e-02 -0.004223757 -0.024817479  0.110703946
d_y3_d_x2  0.0252988980 -1.708688e-02 -0.081037045 -0.039419377  0.026558814
d_y1_d_x3 -0.0541054633  5.381410e-03  0.040727443  0.013865730 -0.009673420
d_y2_d_x3 -0.0002277709 -2.052836e-02 -0.007435689 -0.012374746  0.042145917
d_y3_d_x3 -0.0384624892  1.826951e-02  0.087037488 -0.013103001  0.004157261
d_y1_d_x4 -0.0509483546 -4.166735e-02  0.027535269 -0.027260602  0.019440396
d_y2_d_x4 -0.0380693290 -1.313836e-01 -0.021222365 -0.031313450  0.015386640
d_y3_d_x4  0.0584049463  4.693266e-05 -0.086008548  0.009391722 -0.001128619
             d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
d_y1_d_x1  0.025298898 -0.054105463 -0.0002277709 -0.038462489 -0.050948355
d_y2_d_x1 -0.017086875  0.005381410 -0.0205283614  0.018269508 -0.041667348
d_y3_d_x1 -0.081037045  0.040727443 -0.0074356889  0.087037488  0.027535269
d_y1_d_x2 -0.039419377  0.013865730 -0.0123747463 -0.013103001 -0.027260602
d_y2_d_x2  0.026558814 -0.009673420  0.0421459174  0.004157261  0.019440396
d_y3_d_x2  0.229423945 -0.033460619  0.0154215496 -0.065376061 -0.009806263
d_y1_d_x3 -0.033460619  0.051186003 -0.0100075558 -0.007617053 -0.012209302
d_y2_d_x3  0.015421550 -0.010007556  0.0266962577  0.001887607  0.011222614
d_y3_d_x3 -0.065376061 -0.007617053  0.0018876068  0.182550525  0.029549160
d_y1_d_x4 -0.009806263 -0.012209302  0.0112226139  0.029549160  0.096893407
d_y2_d_x4  0.029461871  0.009689390  0.0420609274 -0.034111028  0.043253599
d_y3_d_x4  0.024524358 -0.004050431 -0.0003187364 -0.055735796 -0.062841548
            d_y2_d_x4     d_y3_d_x4
d_y1_d_x1 -0.03806933  5.840495e-02
d_y2_d_x1 -0.13138360  4.693266e-05
d_y3_d_x1 -0.02122237 -8.600855e-02
d_y1_d_x2 -0.03131345  9.391722e-03
d_y2_d_x2  0.01538664 -1.128619e-03
d_y3_d_x2  0.02946187  2.452436e-02
d_y1_d_x3  0.00968939 -4.050431e-03
d_y2_d_x3  0.04206093 -3.187364e-04
d_y3_d_x3 -0.03411103 -5.573580e-02
d_y1_d_x4  0.04325360 -6.284155e-02
d_y2_d_x4  0.32385975  2.380201e-02
d_y3_d_x4  0.02380201  1.905689e-01
> all.equal( attr( margEffCondV, "jacobian" ), 
+    attr( margEffCondM, "jacobian" )[ 1:3, , ] )
[1] TRUE
> print( attr( margEffCondM, "jacobian" ) )
, , b_1_0

         d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1     0.2844103081  0.0365935258  0.0780064050 -0.22745182  0.019380780
5    -0.1562244504 -0.0003601467 -0.0126554978  0.17568006 -0.017225469
10   -0.0008151563  0.0002331714  0.0007906753  0.01741561 -0.004668669
mean  0.0424569005  0.0121555168  0.0220471942 -0.01145205 -0.000837786
       d_y3_d_x2   d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4
1    -0.02311634  0.27862435 -0.067501560 0.013988810 -0.233368880
5    -0.04385058 -0.36659564  0.049904525 0.087707619  0.242694753
10   -0.01341462 -0.00432987  0.001387779 0.004218847  0.002109424
mean -0.02679385 -0.03076706 -0.005403085 0.035305092  0.003811766
         d_y2_d_x4    d_y3_d_x4
1    -6.972201e-02 -0.004440892
5    -1.498801e-02 -0.014654944
10   -4.163336e-05 -0.001110223
mean -2.825055e-02 -0.006735353

, , b_1_1

        d_y1_d_x1     d_y2_d_x1     d_y3_d_x1  d_y1_d_x2    d_y2_d_x2
1    4.322723e-01 -1.904979e-02 -8.015547e-02 0.00000000  0.000000000
5    2.559760e-01 -4.309406e-02 -8.364006e-02 0.17568006 -0.017225469
10   4.235501e-06 -6.254719e-06 -2.028966e-05 0.00000000  0.000000000
mean 2.294175e-01 -2.071670e-02 -5.460527e-02 0.05856002 -0.005741823
       d_y3_d_x2  d_y1_d_x3  d_y2_d_x3  d_y3_d_x3  d_y1_d_x4    d_y2_d_x4
1     0.00000000  0.0000000 0.00000000 0.00000000 0.00000000  0.000000000
5    -0.04385058 -0.3665956 0.04990452 0.08770762 0.24269475 -0.014988011
10    0.00000000  0.0000000 0.00000000 0.00000000 0.00000000  0.000000000
mean -0.01461686 -0.1221985 0.01663484 0.02923587 0.08089825 -0.004996004
        d_y3_d_x4
1     0.000000000
5    -0.014654944
10    0.000000000
mean -0.004884981

, , b_1_2

      d_y1_d_x1  d_y2_d_x1  d_y3_d_x1 d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1    0.28441031 0.03659353 0.07800641  0.147862 -0.055643316 -0.15816188
5    0.00000000 0.00000000 0.00000000  0.431656 -0.060319529 -0.12749064
10   0.00000000 0.00000000 0.00000000  0.018235 -0.004908095 -0.01422558
mean 0.09480344 0.01219784 0.02600214  0.199251 -0.040290314 -0.09995937
      d_y1_d_x3   d_y2_d_x3   d_y3_d_x3   d_y1_d_x4   d_y2_d_x4    d_y3_d_x4
1    0.27867986 -0.06783463 0.013877788 -0.23336888 -0.06972201 -0.004440892
5    0.00000000  0.00000000 0.000000000  0.00000000  0.00000000  0.000000000
10   0.00000000  0.00000000 0.000000000  0.00000000  0.00000000  0.000000000
mean 0.09289329 -0.02261154 0.004625929 -0.07778963 -0.02324067 -0.001480297

, , b_1_3

        d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1    -0.303700069 -0.0390754343 -0.0832970886  0.24287844 -0.020695256
5     0.097646416  0.0002251057  0.0079101828 -0.10980693  0.010766595
10   -0.001022055  0.0002923537  0.0009913604  0.02183595 -0.005853647
mean -0.069025236 -0.0128526583 -0.0247985151  0.05163582 -0.005260770
       d_y3_d_x2    d_y1_d_x3    d_y2_d_x3    d_y3_d_x3   d_y1_d_x4
1     0.02468417 -0.149755208  0.016653345 -0.172861725  0.24920344
5     0.02740834  0.484945417 -0.074329431 -0.138555833 -0.15143442
10   -0.01681944 -0.004662937  0.001484923  0.004551914  0.00288658
mean  0.01175769  0.110175757 -0.018730388 -0.102288548  0.03355186
         d_y2_d_x4    d_y3_d_x4
1     7.482903e-02  0.004773959
5     9.436896e-03  0.009436896
10   -4.163336e-05 -0.001110223
mean  2.807476e-02  0.004366877

, , b_1_4

         d_y1_d_x1     d_y2_d_x1     d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1     0.1212908204  1.560583e-02  0.0332669405 -0.097000062  0.008265210
5    -0.1283510529 -2.958896e-04 -0.0103975173  0.144335412 -0.014152120
10    0.0003101437 -8.871495e-05 -0.0003008287 -0.006626135  0.001776293
mean -0.0022500296  5.073742e-03  0.0075228648  0.013569738 -0.001370206
        d_y3_d_x2   d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1    -0.009858291  0.11889101 -0.0288657986  0.005884182 0.0483363349
5    -0.036026809 -0.30109248  0.0410782519  0.072164497 0.4554134847
10    0.005103872  0.00144329 -0.0005412337 -0.001776357 0.0002220446
mean -0.013593743 -0.06025273  0.0038904065  0.025424107 0.1679906214
         d_y2_d_x4     d_y3_d_x4
1    -0.0858202398 -0.1602051825
5    -0.0552891066 -0.0957012247
10   -0.0002081668 -0.0001110223
mean -0.0471058377 -0.0853391432

, , b_2_0

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2
1    -0.0090414667 -0.15337587 -0.019587546  0.038823785 -0.14266410
5     0.0329540419  0.14117738  0.009013214 -0.014887909 -0.04799001
10    0.0001596092  0.21970457  0.006612413 -0.003257078  0.13273560
mean  0.0080240615  0.06916869 -0.001320640  0.006892933 -0.01930617
        d_y3_d_x2     d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1    -0.011727560 -0.0427158309  0.35016434  0.030309089  0.0128508315
5    -0.004653031  0.0467403893 -0.07982504 -0.002553513 -0.0517363929
10    0.012840268  0.0007771561 -0.22637447 -0.018429702 -0.0005551115
mean -0.001180108  0.0016005715  0.01465494  0.003108624 -0.0131468910
       d_y2_d_x4    d_y3_d_x4
1     0.32807090  0.029420910
5    -0.08165690  0.009880985
10   -0.30199454 -0.017874591
mean -0.01852685  0.007142435

, , b_2_1

         d_y1_d_x1 d_y2_d_x1   d_y3_d_x1    d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1    -2.526525e-02 0.1025285 0.006560333  0.000000000  0.00000000  0.000000000
5    -4.130975e-02 0.4007844 0.037210326 -0.014887909 -0.04799001 -0.004653031
10   -6.115108e-07 0.3469243 0.022544747  0.000000000  0.00000000  0.000000000
mean -2.219187e-02 0.2834124 0.022105135 -0.004962636 -0.01599667 -0.001551010
      d_y1_d_x3   d_y2_d_x3    d_y3_d_x3   d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1    0.00000000  0.00000000  0.000000000  0.00000000  0.00000000 0.000000000
5    0.04674039 -0.07982504 -0.002553513 -0.05173639 -0.08171241 0.009880985
10   0.00000000  0.00000000  0.000000000  0.00000000  0.00000000 0.000000000
mean 0.01558013 -0.02660835 -0.000851171 -0.01724546 -0.02723747 0.003293662

, , b_2_2

        d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1    -0.009041467 -0.15337587 -0.019587546 -0.016223782 0.2559044 0.02614788
5     0.000000000  0.00000000  0.000000000 -0.056197656 0.3527944 0.03255729
10    0.000000000  0.00000000  0.000000000 -0.003417298 0.2599553 0.02877260
mean -0.003013822 -0.05112529 -0.006529182 -0.025279579 0.2895514 0.02915926
       d_y1_d_x3 d_y2_d_x3  d_y3_d_x3   d_y1_d_x4 d_y2_d_x4  d_y3_d_x4
1    -0.04271583 0.3501643 0.03030909 0.012850832 0.3280709 0.02942091
5     0.00000000 0.0000000 0.00000000 0.000000000 0.0000000 0.00000000
10    0.00000000 0.0000000 0.00000000 0.000000000 0.0000000 0.00000000
mean -0.01423861 0.1167214 0.01010303 0.004283611 0.1093570 0.00980697

, , b_2_3

         d_y1_d_x1  d_y2_d_x1    d_y3_d_x1    d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1     0.0096546928  0.1637784  0.020916046 -0.041456959 0.15234011 0.012522967
5    -0.0205975703 -0.0882414 -0.005633612  0.009305528 0.02999564 0.002908327
10    0.0002001207  0.2754689  0.008290742 -0.004083772 0.16642588 0.016099320
mean -0.0035809190  0.1170020  0.007857725 -0.012078401 0.11625388 0.010510205
         d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4   d_y2_d_x4
1     0.0293376434 -0.11846080 -0.006772360 -0.0136834988 -0.34983128
5    -0.0708322290  0.45036197  0.038524739  0.0325295346  0.05112577
10    0.0008881784 -0.15652757 -0.006883383 -0.0006661338 -0.37862768
mean -0.0135354690  0.05845787  0.008289665  0.0060599673 -0.22577773
        d_y3_d_x4
1    -0.031308289
5    -0.006106227
10   -0.022759572
mean -0.020058029

, , b_2_4

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2
1    -3.855862e-03 -0.06540932 -0.008353388  0.016556955 -0.06084113
5     2.707442e-02  0.11598866  0.007405086 -0.012231624 -0.03942768
10   -6.072676e-05 -0.08359122 -0.002515831  0.001239224 -0.05050205
mean  7.719276e-03 -0.01100396 -0.001154711  0.001854851 -0.05025696
        d_y3_d_x2     d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1    -0.005001385 -0.0182076576  0.14943602  0.012989609 -0.0107414078
5    -0.003822842  0.0384137167 -0.06550316 -0.001998401 -0.0840438830
10   -0.004885350  0.0001110223  0.08613943  0.007216450  0.0001110223
mean -0.004569859  0.0067723605  0.05669076  0.006069219 -0.0315580895
     d_y2_d_x4  d_y3_d_x4
1    0.3959055 0.03896883
5    0.3334000 0.04507505
10   0.2421258 0.02287059
mean 0.3238104 0.03563816

, , b_3_0

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1    -0.1036330469 -0.015818829 -0.16928537  0.058505811 -0.008350353
5     0.0092022346  0.019490025  0.18335766 -0.062146477  0.007141051
10    0.0001787653  0.011466788  0.12395916 -0.004659593  0.009654283
mean -0.0314173490  0.005045995  0.04601049 -0.002766753  0.002814993
      d_y3_d_x2    d_y1_d_x3    d_y2_d_x3   d_y3_d_x3     d_y1_d_x4
1    0.03177489 -0.079616869  0.033861802 -0.01409983  0.0835026492
5    0.02361125  0.116129328 -0.027533531 -0.10158541 -0.0408562073
10   0.15087598  0.001110223 -0.010075274 -0.23081537 -0.0002220446
mean 0.06875404  0.012540894 -0.001249001 -0.11550020  0.0141414658
        d_y2_d_x4   d_y3_d_x4
1     0.021871394 -0.03330669
5    -0.020705659 -0.14188650
10   -0.012184698 -0.24702462
mean -0.003672988 -0.14073927

, , b_3_1

         d_y1_d_x1  d_y2_d_x1 d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1    -1.490547e-01 0.01435670 0.2632494  0.00000000 0.000000000 0.000000000
5    -7.098636e-02 0.03269126 0.4007928 -0.06214648 0.007141051 0.023611252
10   -5.949463e-06 0.01493196 0.3108666  0.00000000 0.000000000 0.000000000
mean -7.334899e-02 0.02065998 0.3249696 -0.02071549 0.002380350 0.007870417
      d_y1_d_x3    d_y2_d_x3  d_y3_d_x3   d_y1_d_x4    d_y2_d_x4  d_y3_d_x4
1    0.00000000  0.000000000  0.0000000  0.00000000  0.000000000  0.0000000
5    0.11624035 -0.027533531 -0.1015854 -0.04085621 -0.020705659 -0.1418865
10   0.00000000  0.000000000  0.0000000  0.00000000  0.000000000  0.0000000
mean 0.03874678 -0.009177844 -0.0338618 -0.01361874 -0.006901886 -0.0472955

, , b_3_2

       d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1    -0.10363305 -0.015818829 -0.16928537 -0.045421607 0.03017553 0.4325348
5     0.00000000  0.000000000  0.00000000 -0.133132832 0.03983231 0.4244040
10    0.00000000  0.000000000  0.00000000 -0.004844308 0.01311946 0.3377834
mean -0.03454435 -0.005272943 -0.05642846 -0.061132915 0.02770910 0.3982407
       d_y1_d_x3  d_y2_d_x3    d_y3_d_x3  d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1    -0.07960299 0.03386180 -0.014210855 0.08350265 0.021871394 -0.03330669
5     0.00000000 0.00000000  0.000000000 0.00000000 0.000000000  0.00000000
10    0.00000000 0.00000000  0.000000000 0.00000000 0.000000000  0.00000000
mean -0.02653433 0.01128727 -0.004736952 0.02783422 0.007290465 -0.01110223

, , b_3_3

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1     0.1106618239  0.016891720  0.18076693 -0.062473892  0.008916705
5    -0.0057517577 -0.012182031 -0.11460574  0.038843988 -0.004463437
10    0.0002241385  0.014377230  0.15542185 -0.005842267  0.012104684
mean  0.0350447349  0.006362306  0.07386101 -0.009824057  0.005519317
       d_y3_d_x2     d_y1_d_x3    d_y2_d_x3  d_y3_d_x3     d_y1_d_x4
1    -0.03392998  0.0395655730 -0.005551115  0.4479750 -0.0891647867
5    -0.01475796 -0.1439959263  0.049737992  0.4640732  0.0250910404
10    0.18917056  0.0007771561 -0.009173218 -0.1025846 -0.0006661338
mean  0.04682754 -0.0345510657  0.011671220  0.2698212 -0.0215799600
        d_y2_d_x4   d_y3_d_x4
1    -0.022870594  0.03563816
5     0.012878587  0.08837375
10   -0.015279444 -0.31008529
mean -0.008423817 -0.06202446

, , b_3_4

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
1    -4.419579e-02 -0.006746165 -0.07219415  0.024950635 -0.0035611268
5     7.560382e-03  0.016012636  0.15064319 -0.051058369  0.0058669520
10   -6.801493e-05 -0.004362780 -0.04716287  0.001772840 -0.0036731747
mean -1.223447e-02  0.001634564  0.01042872 -0.008111631 -0.0004557832
        d_y3_d_x2     d_y1_d_x3    d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1     0.013550854 -0.0339867023  0.013544721 -0.0064392935 -0.0098671071
5     0.019398558  0.0954791801 -0.022593039 -0.0835997938 -0.1039168751
10   -0.057403936 -0.0005551115  0.003816392  0.0875965966 -0.0003330669
mean -0.008151508  0.0203124554 -0.001743975 -0.0008141636 -0.0380390164
      d_y2_d_x4 d_y3_d_x4
1    0.03930190 0.4181100
5    0.01604272 0.2845502
10   0.00809075 0.2806644
mean 0.02114512 0.3277748

, , R_1_2

        d_y1_d_x1     d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2
1     0.012302106 -0.4730857642 -0.022865221 -0.23681944 0.035356899
5    -0.389154438 -0.1346716768  0.006126323 -0.02640070 0.200346660
10   -0.002199324 -0.0001412116  0.001882921  0.03400172 0.006272141
mean -0.126350552 -0.2026328842 -0.004951992 -0.07640614 0.080658567
       d_y3_d_x2   d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1     0.04842374  0.18782198  0.457300864 -0.036304293 -0.002109424
5     0.03805750 -0.13578028 -0.301536573 -0.032640557  0.513034060
10   -0.02126043 -0.01043610 -0.001026956  0.009214851  0.007327472
mean  0.02174027  0.01386854  0.051579111 -0.019910000  0.172750703
        d_y2_d_x4    d_y3_d_x4
1    9.630075e-01  0.018873791
5    1.147971e-01 -0.069944051
10   2.775558e-05 -0.002775558
mean 3.592774e-01 -0.017948606

, , R_1_3

         d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1     0.6779988895 -0.0439634712 -0.7518035113 -0.15287721  0.012866382
5     0.1100880665 -0.0272114692 -0.1341660789  0.25360526  0.002158135
10   -0.0008353512  0.0001322236 -0.0007461053  0.02054856 -0.003285345
mean  0.2624172016 -0.0236809056 -0.2955718985  0.04042553  0.003913057
      d_y3_d_x2    d_y1_d_x3    d_y2_d_x3    d_y3_d_x3   d_y1_d_x4    d_y2_d_x4
1    0.39436273  0.215605311 0.0112132525 -0.516919840 -0.38914705 0.0889288643
5    0.25411486 -0.444311254 0.0162647673 -0.312194715 -0.03386180 0.0418554080
10   0.01486094 -0.004662937 0.0008743006 -0.003996803  0.00144329 0.0002220446
mean 0.22111284 -0.077789627 0.0094507735 -0.277703786 -0.14052185 0.0436687723
       d_y3_d_x4
1    0.451305660
5    0.175637282
10   0.001332268
mean 0.209425070

, , R_2_3

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1    -0.0295668558 -0.03247460 -0.083808061  0.09014664 -0.03836515 -0.12400722
5     0.0509223599  0.17907793  0.041843222 -0.03551199  0.05245643 -0.14276885
10    0.0004814612  0.10663947 -0.004474384 -0.01049811  0.08873839  0.12655913
mean  0.0072789884  0.08441427 -0.015479741  0.01471218  0.03427656 -0.04673898
        d_y1_d_x3   d_y2_d_x3   d_y3_d_x3    d_y1_d_x4    d_y2_d_x4   d_y3_d_x4
1    -0.101071929  0.17463808  0.20083935  0.036234904  0.005440093  0.16997515
5     0.111244347 -0.19939606  0.24436009 -0.117239551 -0.321020988  0.23181457
10    0.002886580 -0.08058831 -0.24913405 -0.001332268 -0.097907793 -0.21849189
mean  0.004352999 -0.03511543  0.06535513 -0.027445638 -0.137829563  0.06109927

> print( drop( attr( margEffCondM, "jacobian" )[ 4, , ] ) )
                 b_1_0        b_1_1        b_1_2        b_1_3        b_1_4
d_y1_d_x1  0.042456900  0.229417496  0.094803436 -0.069025236 -0.002250030
d_y2_d_x1  0.012155517 -0.020716702  0.012197842 -0.012852658  0.005073742
d_y3_d_x1  0.022047194 -0.054605274  0.026002135 -0.024798515  0.007522865
d_y1_d_x2 -0.011452050  0.058560019  0.199251001  0.051635820  0.013569738
d_y2_d_x2 -0.000837786 -0.005741823 -0.040290314 -0.005260770 -0.001370206
d_y3_d_x2 -0.026793845 -0.014616861 -0.099959367  0.011757689 -0.013593743
d_y1_d_x3 -0.030767056 -0.122198548  0.092893286  0.110175757 -0.060252729
d_y2_d_x3 -0.005403085  0.016634842 -0.022611542 -0.018730388  0.003890407
d_y3_d_x3  0.035305092  0.029235873  0.004625929 -0.102288548  0.025424107
d_y1_d_x4  0.003811766  0.080898251 -0.077789627  0.033551865  0.167990621
d_y2_d_x4 -0.028250550 -0.004996004 -0.023240669  0.028074765 -0.047105838
d_y3_d_x4 -0.006735353 -0.004884981 -0.001480297  0.004366877 -0.085339143
                 b_2_0        b_2_1        b_2_2        b_2_3        b_2_4
d_y1_d_x1  0.008024061 -0.022191869 -0.003013822 -0.003580919  0.007719276
d_y2_d_x1  0.069168691  0.283412432 -0.051125291  0.117001952 -0.011003959
d_y3_d_x1 -0.001320640  0.022105135 -0.006529182  0.007857725 -0.001154711
d_y1_d_x2  0.006892933 -0.004962636 -0.025279579 -0.012078401  0.001854851
d_y2_d_x2 -0.019306168 -0.015996670  0.289551399  0.116253877 -0.050256955
d_y3_d_x2 -0.001180108 -0.001551010  0.029159259  0.010510205 -0.004569859
d_y1_d_x3  0.001600572  0.015580130 -0.014238610 -0.013535469  0.006772360
d_y2_d_x3  0.014654944 -0.026608345  0.116721447  0.058457868  0.056690763
d_y3_d_x3  0.003108624 -0.000851171  0.010103030  0.008289665  0.006069219
d_y1_d_x4 -0.013146891 -0.017245464  0.004283611  0.006059967 -0.031558089
d_y2_d_x4 -0.018526847 -0.027237472  0.109356968 -0.225777730  0.323810423
d_y3_d_x4  0.007142435  0.003293662  0.009806970 -0.020058029  0.035638159
                 b_3_0        b_3_1        b_3_2        b_3_3         b_3_4
d_y1_d_x1 -0.031417349 -0.073348986 -0.034544349  0.035044735 -0.0122344733
d_y2_d_x1  0.005045995  0.020659975 -0.005272943  0.006362306  0.0016345637
d_y3_d_x1  0.046010486  0.324969581 -0.056428455  0.073861011  0.0104287230
d_y1_d_x2 -0.002766753 -0.020715492 -0.061132915 -0.009824057 -0.0081116315
d_y2_d_x2  0.002814993  0.002380350  0.027709100  0.005519317 -0.0004557832
d_y3_d_x2  0.068754042  0.007870417  0.398240728  0.046827540 -0.0081515083
d_y1_d_x3  0.012540894  0.038746784 -0.026534330 -0.034551066  0.0203124554
d_y2_d_x3 -0.001249001 -0.009177844  0.011287267  0.011671220 -0.0017439753
d_y3_d_x3 -0.115500202 -0.033861802 -0.004736952  0.269821202 -0.0008141636
d_y1_d_x4  0.014141466 -0.013618736  0.027834216 -0.021579960 -0.0380390164
d_y2_d_x4 -0.003672988 -0.006901886  0.007290465 -0.008423817  0.0211451227
d_y3_d_x4 -0.140739272 -0.047295501 -0.011102230 -0.062024460  0.3277748443
                 R_1_2        R_1_3        R_2_3
d_y1_d_x1 -0.126350552  0.262417202  0.007278988
d_y2_d_x1 -0.202632884 -0.023680906  0.084414267
d_y3_d_x1 -0.004951992 -0.295571898 -0.015479741
d_y1_d_x2 -0.076406139  0.040425534  0.014712178
d_y2_d_x2  0.080658567  0.003913057  0.034276557
d_y3_d_x2  0.021740271  0.221112842 -0.046738981
d_y1_d_x3  0.013868536 -0.077789627  0.004352999
d_y2_d_x3  0.051579111  0.009450773 -0.035115429
d_y3_d_x3 -0.019910000 -0.277703786  0.065355129
d_y1_d_x4  0.172750703 -0.140521853 -0.027445638
d_y2_d_x4  0.359277423  0.043668772 -0.137829563
d_y3_d_x4 -0.017948606  0.209425070  0.061099274
> all.equal( summary( margEffCondV )[ , ], summary( margEffCondM )[ 1:36, ],
+    check.attributes = FALSE ) 
[1] TRUE
> summary( margEffCondM )[ -( 1:24 ), ]
                     Estimate  Std. error     z value    Pr(> z)
3: d_y1_d_x1     0.0002023317 0.002779927  0.07278310 0.94197872
3: d_y2_d_x1     0.2319695899 0.513273328  0.45194164 0.65131103
3: d_y3_d_x1    -0.1301102884 0.372876730 -0.34893647 0.72713701
3: d_y1_d_x2    -0.0057134148 0.054479880 -0.10487201 0.91647737
3: d_y2_d_x2     0.1109910102 0.351961409  0.31534994 0.75249597
3: d_y3_d_x2    -0.1661674838 0.441133774 -0.37668275 0.70640938
3: d_y1_d_x3     0.0011362268 0.013605556  0.08351197 0.93344446
3: d_y2_d_x3    -0.1491871870 0.299778630 -0.49765785 0.61872522
3: d_y3_d_x3     0.1853439869 0.366226632  0.50609096 0.61279280
3: d_y1_d_x4    -0.0006208180 0.008470500 -0.07329177 0.94157394
3: d_y2_d_x4    -0.1992018262 0.550652280 -0.36175611 0.71753429
3: d_y3_d_x4     0.1994459164 0.533908019  0.37355857 0.70873276
mean: d_y1_d_x1  0.2837340363 0.403297726  0.70353493 0.48172245
mean: d_y2_d_x1  0.2067837152 0.389509697  0.53088207 0.59550050
mean: d_y3_d_x1 -0.2506808492 0.457721572 -0.54767104 0.58391780
mean: d_y1_d_x2 -0.1851981416 0.242893411 -0.76246672 0.44578150
mean: d_y2_d_x2  0.2066916063 0.332722026  0.62121408 0.53445878
mean: d_y3_d_x2 -0.1516595015 0.478982197 -0.31662868 0.75152537
mean: d_y1_d_x3  0.1691669426 0.226243239  0.74772154 0.45462814
mean: d_y2_d_x3 -0.3354308935 0.163389895 -2.05294761 0.04007766
mean: d_y3_d_x3  0.2291505773 0.427259319  0.53632669 0.59173279
mean: d_y1_d_x4 -0.1237756933 0.311277058 -0.39763834 0.69089679
mean: d_y2_d_x4 -0.3651579862 0.569086768 -0.64165608 0.52109651
mean: d_y3_d_x4  0.4305024662 0.436541960  0.98616515 0.32405208
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -0.6467480  0.2788967  0.1209011 -1.2689215
> 
> # calculating marginal effects, conditional
> # (assuming that all other dependent variables are as observed)
> margEffCondObs <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE )
> print( margEffCondObs )
     d_y1_d_x1  d_y2_d_x1   d_y3_d_x1   d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.171996342 0.20541522 -0.12683723 -0.09565856 0.22331558 -0.17476430
2  0.453396093 0.18518138 -0.10369269 -0.37122660 0.26642211 -0.08533400
3  0.097176031 0.34345525 -0.20610297 -0.27712919 0.23015413 -0.12829301
4  0.182385396 0.22260219 -0.35557783 -0.34901909 0.24641930 -0.15625477
5  0.395976600 0.26512294 -0.22405904 -0.32295096 0.25167248 -0.13425075
6  0.024154154 0.14516735 -0.07341978 -0.13290567 0.06973857 -0.06173208
7  0.247513245 0.14525007 -0.14360427 -0.02638256 0.11286656 -0.12522160
8  0.105211089 0.35027624 -0.23759517 -0.28310921 0.23964177 -0.14829929
9  0.305110226 0.02953495 -0.02468951 -0.21064577 0.08273875 -0.05169793
10 0.001391671 0.23196959 -0.11609485 -0.01856668 0.11099101 -0.13781508
     d_y1_d_x3   d_y2_d_x3  d_y3_d_x3    d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  0.049373080 -0.38496241 0.24421037 -0.035714957 -0.50420545 0.30196558
2  0.517589266 -0.42553291 0.13198369 -0.342320508 -0.46820299 0.27400615
3  0.240569744 -0.35783882 0.19252916 -0.169610695 -0.43559110 0.30277572
4  0.379022298 -0.37335148 0.24368295 -0.263740488 -0.35581139 0.56738648
5  0.538960957 -0.52391216 0.23199224 -0.395069134 -0.53871278 0.45553038
6  0.077901262 -0.07597528 0.06504185 -0.052734091 -0.09824945 0.08501070
7  0.086147908 -0.30982533 0.25313942 -0.065574382 -0.39933261 0.33260130
8  0.252190242 -0.38617280 0.23690022 -0.184985860 -0.46686983 0.37848422
9  0.152442974 -0.08913371 0.05744710 -0.100419550 -0.11271554 0.08247915
10 0.005969436 -0.14918719 0.14822613 -0.004569507 -0.19920183 0.16554889
> margEffCondObsA <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE )
> all.equal( margEffCondObs, margEffCondObsA )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm, reduced precision
> margEffCondObs1 <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = Miwa( steps = 32 ) )
> print( margEffCondObs1 )
     d_y1_d_x1  d_y2_d_x1   d_y3_d_x1   d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.171991465 0.20539502 -0.12685115 -0.09564462 0.22333831 -0.17480315
2  0.453396083 0.18521403 -0.10371605 -0.37117815 0.26642177 -0.08535933
3  0.097170705 0.34343671 -0.20609885 -0.27708251 0.23019994 -0.12833812
4  0.182370489 0.22262642 -0.35559976 -0.34891097 0.24647789 -0.15614626
5  0.396062172 0.26491181 -0.22410218 -0.32301776 0.25167518 -0.13429372
6  0.024153542 0.14525555 -0.07342138 -0.13290025 0.06986832 -0.06174283
7  0.247601640 0.14525164 -0.14353076 -0.02631610 0.11286814 -0.12516854
8  0.105068348 0.35027704 -0.23771705 -0.28313433 0.23960011 -0.14830372
9  0.305107739 0.02953581 -0.02469139 -0.21063612 0.08275916 -0.05170784
10 0.001376583 0.23197009 -0.11610897 -0.01850896 0.11099282 -0.13777067
     d_y1_d_x3   d_y2_d_x3  d_y3_d_x3    d_y1_d_x4  d_y2_d_x4  d_y3_d_x4
1  0.049369062 -0.38498413 0.24424901 -0.035714021 -0.5042087 0.30197976
2  0.517509460 -0.42554739 0.13203173 -0.342337487 -0.4682704 0.27407828
3  0.240548424 -0.35790074 0.19257697 -0.169608457 -0.4355710 0.30284445
4  0.378960324 -0.37343664 0.24376737 -0.263744039 -0.3558907 0.56751561
5  0.538996584 -0.52376449 0.23212450 -0.395145033 -0.5387374 0.45544566
6  0.077898816 -0.07584485 0.06505061 -0.052733734 -0.0983536 0.08502351
7  0.086045011 -0.30982678 0.25307025 -0.065460222 -0.3993349 0.33273176
8  0.252171647 -0.38616972 0.23688608 -0.184932693 -0.4668721 0.37861102
9  0.152437895 -0.08917606 0.05745498 -0.100419092 -0.1127594 0.08249152
10 0.005925195 -0.14918942 0.14818743 -0.004533174 -0.1992042 0.16558531
> all.equal( margEffCondObs, margEffCondObs1 )
 [1] "Component 1: Mean relative difference: 0.0001814309" 
 [2] "Component 2: Mean relative difference: 0.0001877033" 
 [3] "Component 3: Mean relative difference: 0.0001982085" 
 [4] "Component 4: Mean relative difference: 0.0002147753" 
 [5] "Component 5: Mean relative difference: 0.0001774133" 
 [6] "Component 6: Mean relative difference: 0.0003184793" 
 [7] "Component 7: Mean relative difference: 0.0001634686" 
 [8] "Component 8: Mean relative difference: 0.0001659606" 
 [9] "Component 9: Mean relative difference: 0.0002713405" 
[10] "Component 10: Mean relative difference: 0.0001883154"
[11] "Component 11: Mean relative difference: 9.769836e-05"
[12] "Component 12: Mean relative difference: 0.0002334694"
> # now with integrals obtained by the GHK algorithm
> margEffCondObs2 <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = "GHK" )
> print( margEffCondObs2 )
     d_y1_d_x1  d_y2_d_x1   d_y3_d_x1   d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.171936166 0.20319620 -0.12385679 -0.09574408 0.22370224 -0.17465581
2  0.453157362 0.18439423 -0.10283446 -0.37163716 0.26656087 -0.08523642
3  0.097192904 0.34196383 -0.20081480 -0.27731868 0.23042466 -0.12837050
4  0.182458672 0.22196631 -0.35611755 -0.34922234 0.24661637 -0.15765146
5  0.393051825 0.26378595 -0.22398993 -0.32020864 0.25177381 -0.13460512
6  0.024141688 0.14342864 -0.07114934 -0.13289707 0.06960894 -0.06155653
7  0.250013279 0.14620921 -0.14248645 -0.02546471 0.11350228 -0.12521680
8  0.108800624 0.35482588 -0.23693885 -0.28378378 0.24033985 -0.14898713
9  0.305041489 0.02885883 -0.02407495 -0.21064980 0.08259898 -0.05162190
10 0.002907119 0.23387574 -0.11614252 -0.01743434 0.11167712 -0.13772572
     d_y1_d_x3   d_y2_d_x3  d_y3_d_x3    d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  0.049408838 -0.38510771 0.24239683 -0.035705096 -0.50160122 0.29597065
2  0.518101828 -0.42562594 0.13175546 -0.342035096 -0.46653179 0.27157938
3  0.240723824 -0.35806888 0.19221868 -0.169514598 -0.43268421 0.29865874
4  0.379363635 -0.37358331 0.24488855 -0.263632734 -0.35576345 0.56822990
5  0.531838523 -0.52280315 0.23325027 -0.392204564 -0.53736075 0.45497010
6  0.077871052 -0.07506461 0.06422631 -0.052702503 -0.09572552 0.08269845
7  0.085831917 -0.31144596 0.25442557 -0.069814273 -0.40247246 0.33165944
8  0.252832306 -0.38761700 0.23844918 -0.188497670 -0.47013102 0.37789393
9  0.152396701 -0.08874065 0.05695896 -0.100362821 -0.11068513 0.08053555
10 0.003382784 -0.15020695 0.14718417 -0.007893238 -0.20061813 0.16419322
> all.equal( margEffCondObs, margEffCondObs2 )
 [1] "Component 1: Mean relative difference: 0.005543512" 
 [2] "Component 2: Mean relative difference: 0.007674393" 
 [3] "Component 3: Mean relative difference: 0.008961165" 
 [4] "Component 4: Mean relative difference: 0.003050649" 
 [5] "Component 5: Mean relative difference: 0.00184501"  
 [6] "Component 6: Mean relative difference: 0.002549041" 
 [7] "Component 7: Mean relative difference: 0.005124567" 
 [8] "Component 8: Mean relative difference: 0.002339987" 
 [9] "Component 9: Mean relative difference: 0.00553783"  
[10] "Component 10: Mean relative difference: 0.008996774"
[11] "Component 11: Mean relative difference: 0.005854874"
[12] "Component 12: Mean relative difference: 0.007158026"
> all.equal( margEffCondObs1, margEffCondObs2 )
 [1] "Component 1: Mean relative difference: 0.005627834" 
 [2] "Component 2: Mean relative difference: 0.007624478" 
 [3] "Component 3: Mean relative difference: 0.009017387" 
 [4] "Component 4: Mean relative difference: 0.003117591" 
 [5] "Component 5: Mean relative difference: 0.001876911" 
 [6] "Component 6: Mean relative difference: 0.002632088" 
 [7] "Component 7: Mean relative difference: 0.005154238" 
 [8] "Component 8: Mean relative difference: 0.002203599" 
 [9] "Component 9: Mean relative difference: 0.005525474" 
[10] "Component 10: Mean relative difference: 0.009180781"
[11] "Component 11: Mean relative difference: 0.00593697" 
[12] "Component 12: Mean relative difference: 0.007245035"
> # now with variance covariance matrix and Jacobian
> margEffCondObsV <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, 
+    data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, vcov = diag( 18 ), returnJacobian = TRUE )
> print( attr( margEffCondObsV, "vcov" ) )
, , d_y1_d_x1

      d_y1_d_x1    d_y2_d_x1     d_y3_d_x1     d_y1_d_x2    d_y2_d_x2
1  2.671114e-01 -0.001897659  0.0012381527 -0.0898724972 0.0111026042
5  4.804800e-01  0.066989903 -0.1865386538 -0.2400866050 0.0134390757
10 7.279534e-05  0.000104812  0.0002842754 -0.0007541722 0.0001431043
       d_y3_d_x2     d_y1_d_x3     d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1   0.0232684661  0.0871299144 -0.0172963073 -0.0453103425 -0.0615079750
5  -0.1876624140 -0.1074876853  0.1088809711  0.3287584733  0.0447034940
10  0.0005193529  0.0002645317 -0.0001021944 -0.0004114926 -0.0001929968
       d_y2_d_x4     d_y3_d_x4
1  -0.0073392638 -0.0251473057
5  -0.2424337723  0.1370873362
10 -0.0001535455 -0.0005902426

, , d_y2_d_x1

      d_y1_d_x1 d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -0.001897659 0.1706676  0.003222529 -0.007611475 -0.01922027 -0.015126608
5   0.066989903 0.3353120 -0.024244383 -0.023043764 -0.06623061 -0.137910505
10  0.000104812 0.2634495  0.006039631 -0.002325959  0.08898879  0.002116951
      d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4  d_y2_d_x4    d_y3_d_x4
1   0.007321058 -0.11870970  0.008319572 -1.436645e-03 -0.2777298  0.002991466
5  -0.091064636  0.08272558  0.178623525 -3.681556e-02 -0.1483143  0.087427397
10  0.000474731 -0.10891137 -0.001437958 -8.247834e-05 -0.2017248 -0.005099263

, , d_y3_d_x1

       d_y1_d_x1    d_y2_d_x1 d_y3_d_x1    d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1   0.0012381527  0.003222529 0.1105299 -0.024097591 -0.014252445 0.02281127
5  -0.1865386538 -0.024244383 0.3072387  0.095206563 -0.060415748 0.12725063
10  0.0002842754  0.006039631 0.1376916 -0.003939484 -0.003951327 0.06569682
     d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4    d_y2_d_x4  d_y3_d_x4
1  0.018160457 0.009569937 -0.11252047 -0.0056719837  0.003267811 -0.2101076
5  0.029956958 0.026539397 -0.30227540 -0.0224241963  0.180598167 -0.2776347
10 0.001069899 0.002303729 -0.06427397 -0.0004819725 -0.001453009 -0.1051672

, , d_y1_d_x2

       d_y1_d_x1    d_y2_d_x1    d_y3_d_x1  d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  -0.0898724972 -0.007611475 -0.024097591 0.10986178 -0.02228280 -0.02627183
5  -0.2400866050 -0.023043764  0.095206563 0.23267476 -0.05216925  0.06279416
10 -0.0007541722 -0.002325959 -0.003939484 0.01073828 -0.00361963 -0.01075533
      d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4   d_y2_d_x4    d_y3_d_x4
1  -0.058179035  0.013015795  0.019179690  0.030288107 0.017481874  0.044870268
5  -0.011431584 -0.018673838 -0.216220272 -0.156770642 0.111569101 -0.040851050
10 -0.002774442  0.001998866  0.005157712  0.001952641 0.003359287  0.007972825

, , d_y2_d_x2

      d_y1_d_x1   d_y2_d_x1    d_y3_d_x1   d_y1_d_x2 d_y2_d_x2     d_y3_d_x2
1  0.0111026042 -0.01922027 -0.014252445 -0.02228280 0.1473312 -0.0080961714
5  0.0134390757 -0.06623061 -0.060415748 -0.05216925 0.1886225 -0.0004257871
10 0.0001431043  0.08898879 -0.003951327 -0.00361963 0.1238768  0.0082323867
      d_y1_d_x3   d_y2_d_x3     d_y3_d_x3     d_y1_d_x4     d_y2_d_x4
1  0.0058083274  0.02950299  0.0422163033 -0.0033252316  0.0008039518
5  0.0272750616 -0.08510760  0.0836469176  0.0418727562 -0.1133176742
10 0.0005720315 -0.06784746 -0.0001247016 -0.0002634166 -0.1243476947
      d_y3_d_x4
1   0.044042116
5   0.102732795
10 -0.002635618

, , d_y3_d_x2

       d_y1_d_x1    d_y2_d_x1  d_y3_d_x1   d_y1_d_x2     d_y2_d_x2 d_y3_d_x2
1   0.0232684661 -0.015126608 0.02281127 -0.02627183 -0.0080961714 0.1706051
5  -0.1876624140 -0.137910505 0.12725063  0.06279416 -0.0004257871 0.4303697
10  0.0005193529  0.002116951 0.06569682 -0.01075533  0.0082323867 0.1622181
     d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  0.001136998  0.043084921 -0.04575450 -0.004964150  0.04006526 -0.08970814
5  0.024384423 -0.016406034 -0.33975596 -0.099549757  0.25270383 -0.15393704
10 0.001765153 -0.001622427 -0.07125052 -0.001272237 -0.00621035 -0.11691077

, , d_y1_d_x3

       d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1   0.0871299144  0.007321058 0.018160457 -0.058179035 0.0058083274 0.001136998
5  -0.1074876853 -0.091064636 0.029956958 -0.011431584 0.0272750616 0.024384423
10  0.0002645317  0.000474731 0.001069899 -0.002774442 0.0005720315 0.001765153
      d_y1_d_x3     d_y2_d_x3    d_y3_d_x3     d_y1_d_x4     d_y2_d_x4
1  0.0521904094 -0.0151792452 -0.025668559 -0.0294393007 -0.0151550345
5  0.3514690138 -0.1655214329 -0.117460193  0.2401467254  0.1158983349
10 0.0009796297 -0.0004350475 -0.001531253 -0.0006843985 -0.0007401457
      d_y3_d_x4
1  -0.033763398
5  -0.100667995
10 -0.002143286

, , d_y2_d_x3

       d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -0.0172963073 -0.11870970 0.009569937  0.013015795  0.02950299  0.043084921
5   0.1088809711  0.08272558 0.026539397 -0.018673838 -0.08510760 -0.016406034
10 -0.0001021944 -0.10891137 0.002303729  0.001998866 -0.06784746 -0.001622427
       d_y1_d_x3  d_y2_d_x3    d_y3_d_x3     d_y1_d_x4   d_y2_d_x4    d_y3_d_x4
1  -0.0151792452 0.18711669 -0.033164689  6.124715e-03 0.240725022 -0.039941636
5  -0.1655214329 0.33828590  0.037169819 -1.018522e-01 0.008146998 -0.075880148
10 -0.0004350475 0.08986723  0.001479273  9.574645e-05 0.156670287  0.003914299

, , d_y3_d_x3

       d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
1  -0.0453103425  0.008319572 -0.11252047  0.019179690  0.0422163033
5   0.3287584733  0.178623525 -0.30227540 -0.216220272  0.0836469176
10 -0.0004114926 -0.001437958 -0.06427397  0.005157712 -0.0001247016
     d_y3_d_x2    d_y1_d_x3    d_y2_d_x3  d_y3_d_x3    d_y1_d_x4   d_y2_d_x4
1  -0.04575450 -0.025668559 -0.033164689 0.22228714 0.0145703030 -0.03394560
5  -0.33975596 -0.117460193  0.037169819 0.70443230 0.1417470696 -0.39174344
10 -0.07125052 -0.001531253  0.001479273 0.07763938 0.0008552238  0.00516164
   d_y3_d_x4
1  0.2723756
5  0.3434694
10 0.1182207

, , d_y1_d_x4

       d_y1_d_x1     d_y2_d_x1     d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
1  -0.0615079750 -1.436645e-03 -0.0056719837  0.030288107 -0.0033252316
5   0.0447034940 -3.681556e-02 -0.0224241963 -0.156770642  0.0418727562
10 -0.0001929968 -8.247834e-05 -0.0004819725  0.001952641 -0.0002634166
      d_y3_d_x2     d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1  -0.004964150 -0.0294393007  6.124715e-03 0.0145703030 0.0216785049
5  -0.099549757  0.2401467254 -1.018522e-01 0.1417470696 0.5356693232
10 -0.001272237 -0.0006843985  9.574645e-05 0.0008552238 0.0005543967
       d_y2_d_x4     d_y3_d_x4
1   2.400363e-03  0.0090631453
5  -9.601904e-03 -0.1435444583
10  6.934889e-05  0.0009225482

, , d_y2_d_x4

       d_y1_d_x1  d_y2_d_x1    d_y3_d_x1   d_y1_d_x2     d_y2_d_x2   d_y3_d_x2
1  -0.0073392638 -0.2777298  0.003267811 0.017481874  0.0008039518  0.04006526
5  -0.2424337723 -0.1483143  0.180598167 0.111569101 -0.1133176742  0.25270383
10 -0.0001535455 -0.2017248 -0.001453009 0.003359287 -0.1243476947 -0.00621035
       d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1  -0.0151550345 0.240725022 -0.03394560  2.400363e-03 0.6045764 -0.02104286
5   0.1158983349 0.008146998 -0.39174344 -9.601904e-03 0.5647754 -0.26188497
10 -0.0007401457 0.156670287  0.00516164  6.934889e-05 0.3032179  0.01106651

, , d_y3_d_x4

       d_y1_d_x1    d_y2_d_x1  d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.0251473057  0.002991466 -0.2101076  0.044870268  0.044042116 -0.08970814
5   0.1370873362  0.087427397 -0.2776347 -0.040851050  0.102732795 -0.15393704
10 -0.0005902426 -0.005099263 -0.1051672  0.007972825 -0.002635618 -0.11691077
      d_y1_d_x3    d_y2_d_x3 d_y3_d_x3     d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  -0.033763398 -0.039941636 0.2723756  0.0090631453 -0.02104286 0.5215308
5  -0.100667995 -0.075880148 0.3434694 -0.1435444583 -0.26188497 0.4795926
10 -0.002143286  0.003914299 0.1182207  0.0009225482  0.01106651 0.2113200

> print( drop( attr( margEffCondObsV, "vcov" )[ 1, , ] ) )
             d_y1_d_x1    d_y2_d_x1    d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
d_y1_d_x1  0.267111405 -0.001897659  0.001238153 -0.089872497  0.0111026042
d_y2_d_x1 -0.001897659  0.170667630  0.003222529 -0.007611475 -0.0192202679
d_y3_d_x1  0.001238153  0.003222529  0.110529897 -0.024097591 -0.0142524454
d_y1_d_x2 -0.089872497 -0.007611475 -0.024097591  0.109861780 -0.0222828044
d_y2_d_x2  0.011102604 -0.019220268 -0.014252445 -0.022282804  0.1473311531
d_y3_d_x2  0.023268466 -0.015126608  0.022811267 -0.026271829 -0.0080961714
d_y1_d_x3  0.087129914  0.007321058  0.018160457 -0.058179035  0.0058083274
d_y2_d_x3 -0.017296307 -0.118709701  0.009569937  0.013015795  0.0295029897
d_y3_d_x3 -0.045310342  0.008319572 -0.112520471  0.019179690  0.0422163033
d_y1_d_x4 -0.061507975 -0.001436645 -0.005671984  0.030288107 -0.0033252316
d_y2_d_x4 -0.007339264 -0.277729784  0.003267811  0.017481874  0.0008039518
d_y3_d_x4 -0.025147306  0.002991466 -0.210107581  0.044870268  0.0440421158
             d_y3_d_x2    d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
d_y1_d_x1  0.023268466  0.087129914 -0.017296307 -0.045310342 -0.061507975
d_y2_d_x1 -0.015126608  0.007321058 -0.118709701  0.008319572 -0.001436645
d_y3_d_x1  0.022811267  0.018160457  0.009569937 -0.112520471 -0.005671984
d_y1_d_x2 -0.026271829 -0.058179035  0.013015795  0.019179690  0.030288107
d_y2_d_x2 -0.008096171  0.005808327  0.029502990  0.042216303 -0.003325232
d_y3_d_x2  0.170605098  0.001136998  0.043084921 -0.045754505 -0.004964150
d_y1_d_x3  0.001136998  0.052190409 -0.015179245 -0.025668559 -0.029439301
d_y2_d_x3  0.043084921 -0.015179245  0.187116685 -0.033164689  0.006124715
d_y3_d_x3 -0.045754505 -0.025668559 -0.033164689  0.222287143  0.014570303
d_y1_d_x4 -0.004964150 -0.029439301  0.006124715  0.014570303  0.021678505
d_y2_d_x4  0.040065264 -0.015155034  0.240725022 -0.033945603  0.002400363
d_y3_d_x4 -0.089708135 -0.033763398 -0.039941636  0.272375610  0.009063145
              d_y2_d_x4    d_y3_d_x4
d_y1_d_x1 -0.0073392638 -0.025147306
d_y2_d_x1 -0.2777297835  0.002991466
d_y3_d_x1  0.0032678110 -0.210107581
d_y1_d_x2  0.0174818739  0.044870268
d_y2_d_x2  0.0008039518  0.044042116
d_y3_d_x2  0.0400652639 -0.089708135
d_y1_d_x3 -0.0151550345 -0.033763398
d_y2_d_x3  0.2407250221 -0.039941636
d_y3_d_x3 -0.0339456030  0.272375610
d_y1_d_x4  0.0024003631  0.009063145
d_y2_d_x4  0.6045764157 -0.021042862
d_y3_d_x4 -0.0210428616  0.521530763
> print( attr( margEffCondObsV, "jacobian" ) )
, , b_1_0

      d_y1_d_x1     d_y2_d_x1    d_y3_d_x1   d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1   0.237119196 -0.0042905705 -0.004537520 -0.16362764  0.021246739  0.05309042
5   0.279256250  0.0130994340 -0.042653983 -0.18347254  0.006690779 -0.05041527
10 -0.004746446  0.0002331714  0.002017613  0.04644298 -0.004668669 -0.02071561
    d_y1_d_x3    d_y2_d_x3    d_y3_d_x3   d_y1_d_x4     d_y2_d_x4     d_y3_d_x4
1   0.1154545 -0.016986412 -0.049349413 -0.08099597  3.774758e-03  0.0037747583
5   0.0462963  0.021205260  0.092925667 -0.02620126 -4.085621e-02  0.0320854454
10 -0.0184297  0.001387779  0.009436896  0.01432188 -4.163336e-05 -0.0009992007

, , b_1_1

      d_y1_d_x1     d_y2_d_x1     d_y3_d_x1  d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  2.760459e-01 -9.172312e-03 -2.164891e-02  0.0000000 0.000000000  0.00000000
5  4.300837e-01 -6.483072e-02 -9.133239e-02 -0.1834725 0.006690779 -0.05041527
10 3.416556e-05 -6.254719e-06 -8.454504e-05  0.0000000 0.000000000  0.00000000
   d_y1_d_x3  d_y2_d_x3  d_y3_d_x3   d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  0.0000000 0.00000000 0.00000000  0.00000000  0.00000000 0.00000000
5  0.0462963 0.02120526 0.09292567 -0.02620126 -0.04085621 0.03208545
10 0.0000000 0.00000000 0.00000000  0.00000000  0.00000000 0.00000000

, , b_1_2

   d_y1_d_x1   d_y2_d_x1   d_y3_d_x1  d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  0.2371192 -0.00429057 -0.00453752 0.03892668 -0.004881742 -0.01711139
5  0.0000000  0.00000000  0.00000000 0.24661116 -0.058139940 -0.14174766
10 0.0000000  0.00000000  0.00000000 0.05122359 -0.004908095 -0.02281777
   d_y1_d_x3   d_y2_d_x3   d_y3_d_x3   d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  0.1154701 -0.01698641 -0.04934941 -0.08099597 0.003774758 0.003774758
5  0.0000000  0.00000000  0.00000000  0.00000000 0.000000000 0.000000000
10 0.0000000  0.00000000  0.00000000  0.00000000 0.000000000 0.000000000

, , b_1_3

      d_y1_d_x1     d_y2_d_x1   d_y3_d_x1 d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.253201499  0.0045815729 0.004845272 0.1747255 -0.022687772 -0.05669121
5  -0.174546122 -0.0081876608 0.026660414 0.1146775 -0.004182000  0.03151152
10 -0.005951165  0.0002923537 0.002529713 0.0582309 -0.005853647 -0.02597354
     d_y1_d_x3    d_y2_d_x3    d_y3_d_x3  d_y1_d_x4     d_y2_d_x4    d_y3_d_x4
1  -0.08438909  0.012989609  0.035582648 0.08648464 -4.329870e-03 -0.004080070
5   0.40112358 -0.078492768 -0.149324997 0.01654232  2.542411e-02 -0.019761970
10 -0.01898481  0.001484923  0.009214851 0.01787459 -4.163336e-05 -0.001554312

, , b_1_4

     d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  0.101122853 -1.829775e-03 -0.0019350901 -0.06978133 0.009060974  0.02264117
5  0.229431652  1.076225e-02 -0.0350437055 -0.15073756 0.005497018 -0.04142023
10 0.001805885 -8.871495e-05 -0.0007676428 -0.01767021 0.001776293  0.00788169
    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3     d_y1_d_x4     d_y2_d_x4
1  0.04925227 -0.0073274720 -0.021094237  0.0043836462 -0.0031086245
5  0.03802514  0.0175415238  0.076605389  0.4085065619 -0.0982547377
10 0.00721645 -0.0005412337 -0.003330669 -0.0004440892 -0.0002081668
     d_y3_d_x4
1  -0.01543210
5  -0.06494805
10 -0.00144329

, , b_2_0

       d_y1_d_x1  d_y2_d_x1   d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  -0.0067049148 -0.2093069 -0.01110603  0.02359868 -0.07427991 -0.01969025
5  -0.0468176067  0.0601708  0.02411969  0.01982570 -0.11310591  0.01951730
10  0.0001492367  0.2197046  0.01077585 -0.00348749  0.13273560  0.01049971
       d_y1_d_x3   d_y2_d_x3   d_y3_d_x3    d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  -0.0138153378  0.24458213  0.02656209 0.0034451608  0.31741276  0.02617351
5   0.0205946371  0.05317968 -0.03752554 0.0323074900  0.06283862 -0.03719247
10  0.0005551115 -0.22637447 -0.01054712 0.0001110223 -0.30199454 -0.01176836

, , b_2_1

       d_y1_d_x1 d_y2_d_x1   d_y3_d_x1 d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1  -1.019913e-02 0.1193442 0.003567316 0.0000000  0.0000000 0.0000000
5  -6.151580e-02 0.4058003 0.034744322 0.0198257 -0.1131059 0.0195173
10 -2.590150e-06 0.3469243 0.014366785 0.0000000  0.0000000 0.0000000
    d_y1_d_x3  d_y2_d_x3   d_y3_d_x3  d_y1_d_x4  d_y2_d_x4   d_y3_d_x4
1  0.00000000 0.00000000  0.00000000 0.00000000 0.00000000  0.00000000
5  0.02065015 0.05306866 -0.03752554 0.03225198 0.06294965 -0.03708145
10 0.00000000 0.00000000  0.00000000 0.00000000 0.00000000  0.00000000

, , b_2_2

      d_y1_d_x1  d_y2_d_x1   d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1  -0.006704915 -0.2093069 -0.01110603 -0.003494220 0.3286511 0.01467335
5   0.000000000  0.0000000  0.00000000 -0.041690108 0.2926944 0.05426163
10  0.000000000  0.0000000  0.00000000 -0.003639317 0.2599553 0.01409065
     d_y1_d_x3 d_y2_d_x3  d_y3_d_x3   d_y1_d_x4 d_y2_d_x4  d_y3_d_x4
1  -0.01381534 0.2445821 0.02656209 0.003445161 0.3174128 0.02617351
5   0.00000000 0.0000000 0.00000000 0.000000000 0.0000000 0.00000000
10  0.00000000 0.0000000 0.00000000 0.000000000 0.0000000 0.00000000

, , b_2_3

      d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.0071596671  0.22350287  0.01185928 -0.025199228 0.07931785  0.02102572
5  0.0292628426 -0.03760911 -0.01507576 -0.012391838 0.07069564 -0.01219908
10 0.0001871152  0.27546887  0.01351092 -0.004372667 0.16642588  0.01316469
       d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4  d_y2_d_x4   d_y3_d_x4
1   0.0112548859  0.06750156 -0.013794521 -0.0036741443 -0.3393952 -0.02783884
5  -0.0745514761  0.37225778  0.057620575 -0.0200395256 -0.0393019  0.02353673
10  0.0009992007 -0.15652757 -0.009325873 -0.0002220446 -0.3786277 -0.01521006

, , b_2_4

       d_y1_d_x1   d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -2.859406e-03 -0.08926191 -0.004736324 0.010063992 -0.03167772 -0.008397188
5  -3.846446e-02  0.04943519  0.019816285 0.016288417 -0.09292568  0.016035047
10 -5.678036e-05 -0.08359122 -0.004099898 0.001326889 -0.05050205 -0.003994835
       d_y1_d_x3  d_y2_d_x3    d_y3_d_x3     d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1  -0.0058997945 0.10480505  0.011296519 -0.0020226876 0.4640732 0.025812685
5   0.0172084569 0.04396483 -0.031197267 -0.0353606033 0.4576339 0.004440892
10 -0.0005551115 0.08613943  0.003885781 -0.0002220446 0.2421258 0.007993606

, , b_3_0

       d_y1_d_x1    d_y2_d_x1  d_y3_d_x1   d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.0232567722 -0.011015572 -0.1591526  0.04568840 -0.015580858 -0.12588268
5  -0.0739470342 -0.007314459  0.2213006  0.06229383 -0.013690362  0.05968877
10  0.0008188513  0.011466788  0.1311974 -0.01094591  0.009654283  0.15417144
      d_y1_d_x3    d_y2_d_x3  d_y3_d_x3    d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  -0.028622937  0.024313884  0.2425005  0.011735404  0.02364775  0.2854106
5  -0.035305092  0.004662937 -0.1475486 -0.033750780  0.03186340 -0.2560174
10  0.003663736 -0.010075274 -0.2164935 -0.001776357 -0.01218470 -0.2394751

, , b_3_1

       d_y1_d_x1   d_y2_d_x1 d_y3_d_x1  d_y1_d_x2   d_y2_d_x2  d_y3_d_x2
1  -3.172708e-02 0.003760221 0.1006422 0.00000000  0.00000000 0.00000000
5  -1.245229e-01 0.048919331 0.3650462 0.06229383 -0.01369036 0.05968877
10 -4.433343e-06 0.014931963 0.2725413 0.00000000  0.00000000 0.00000000
     d_y1_d_x3   d_y2_d_x3  d_y3_d_x3   d_y1_d_x4 d_y2_d_x4  d_y3_d_x4
1   0.00000000 0.000000000  0.0000000  0.00000000 0.0000000  0.0000000
5  -0.03524958 0.004662937 -0.1475486 -0.03375078 0.0318634 -0.2560174
10  0.00000000 0.000000000  0.0000000  0.00000000 0.0000000  0.0000000

, , b_3_2

     d_y1_d_x1   d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1  -0.02325677 -0.01101557 -0.1591526 -0.008470304 0.01477579 0.2597948
5   0.00000000  0.00000000  0.0000000 -0.062229064 0.03522897 0.4247349
10  0.00000000  0.00000000  0.0000000 -0.011769193 0.01311946 0.2955153
    d_y1_d_x3  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4  d_y2_d_x4 d_y3_d_x4
1  -0.0286212 0.02420286 0.2424172 0.0117354 0.02364775 0.2854106
5   0.0000000 0.00000000 0.0000000 0.0000000 0.00000000 0.0000000
10  0.0000000 0.00000000 0.0000000 0.0000000 0.00000000 0.0000000

, , b_3_3

     d_y1_d_x1   d_y2_d_x1  d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  0.024834133 0.011762689  0.1699469 -0.04878715 0.016637610  0.13442051
5  0.046219800 0.004571824 -0.1383216 -0.03893609 0.008557013 -0.03730783
10 0.001026687 0.014377230  0.1644973 -0.01372414 0.012104684  0.19330245
      d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1   0.022096908 -0.010769163  0.000915934 -0.012531642 -0.02609024 -0.3046174
5  -0.102473585  0.045963233  0.457078819  0.021260771 -0.02009504  0.1600942
10  0.003108624 -0.009173218 -0.130451205 -0.002220446 -0.01527944 -0.3002043

, , b_3_4

       d_y1_d_x1    d_y2_d_x1   d_y3_d_x1  d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.0099181812 -0.004697747 -0.06787290 0.01948447 -0.006644679 -0.05368446
5  -0.0607534844 -0.006009421  0.18181638 0.05117943 -0.011247742  0.04903917
10 -0.0003115491 -0.004362780 -0.04991682 0.00416460 -0.003673175 -0.05865776
       d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4  d_y2_d_x4 d_y3_d_x4
1  -0.0121985755 0.010436096  0.10338952 -0.0034659775 0.02498002 0.3814726
5  -0.0290878432 0.003552714 -0.12079227 -0.1520450432 0.07538414 0.1548761
10 -0.0009992007 0.003816392  0.08282264 -0.0005551115 0.00809075 0.2320366

, , R_1_2

       d_y1_d_x1     d_y2_d_x1    d_y3_d_x1     d_y1_d_x2   d_y2_d_x2
1   0.0119593147 -0.0174661633 2.470719e-03 -0.1075036372 0.060236172
5  -0.2627469940 -0.3102622052 5.436432e-02  0.0008249927 0.141162941
10  0.0002986817 -0.0001412116 5.869527e-06 -0.0079378150 0.006272141
     d_y3_d_x2   d_y1_d_x3    d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1  0.057426766 0.044677803 -0.030753178 -0.0316136006 -0.0024511643
5  0.165725303 0.360267371 -0.354161145 -0.2032818358  0.3658184866
10 0.005869358 0.001665335 -0.001026956 -0.0006661338 -0.0005551115
      d_y2_d_x4     d_y3_d_x4
1  6.217249e-03 -0.0081878948
5  2.864375e-01 -0.1064703881
10 2.775558e-05 -0.0008881784

, , R_1_3

     d_y1_d_x1     d_y2_d_x1    d_y3_d_x1  d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1  -0.03036766 -0.0028628581 -0.046038902 0.16796613 -0.014779641 0.11986384
5  -0.13515076 -0.1522331795 -0.008299913 0.21839363 -0.004554075 0.33427476
10 -0.00310063  0.0001322236 -0.002880124 0.04099705 -0.003285345 0.03256694
     d_y1_d_x3     d_y2_d_x3   d_y3_d_x3    d_y1_d_x4    d_y2_d_x4   d_y3_d_x4
1  -0.10554405  0.0111022302 -0.08215650  0.023814284 0.0027755576 0.030475622
5  -0.17463808 -0.0337507799 -0.40301096 -0.447863968 0.1726396803 0.091593400
10 -0.01409983  0.0008743006 -0.01254552  0.004551914 0.0002220446 0.004773959

, , R_2_3

       d_y1_d_x1 d_y2_d_x1  d_y3_d_x1     d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  -4.065696e-04 0.1000440 -0.1147518  0.0134169502 0.14424394 -0.20173175
5   1.095618e-01 0.1914696 -0.2351233 -0.0474577987 0.19609338 -0.26047393
10 -5.019252e-05 0.1066395 -0.1269163  0.0005696241 0.08873839 -0.08386716
       d_y1_d_x3   d_y2_d_x3  d_y3_d_x3     d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  -0.0050619231 -0.22060131 0.27922109 -0.0002203099 -0.26456615 0.34089398
5  -0.0632827124 -0.23669955 0.42554849 -0.0561772850 -0.46074256 0.51880722
10 -0.0004440892 -0.08058831 0.07960299 -0.0002220446 -0.09790779 0.09769963

> print( drop( attr( margEffCondObsV, "jacobian" )[ 1, , ] ) )
                 b_1_0        b_1_1        b_1_2        b_1_3        b_1_4
d_y1_d_x1  0.237119196  0.276045875  0.237119196 -0.253201499  0.101122853
d_y2_d_x1 -0.004290570 -0.009172312 -0.004290570  0.004581573 -0.001829775
d_y3_d_x1 -0.004537520 -0.021648911 -0.004537520  0.004845272 -0.001935090
d_y1_d_x2 -0.163627640  0.000000000  0.038926679  0.174725473 -0.069781334
d_y2_d_x2  0.021246739  0.000000000 -0.004881742 -0.022687772  0.009060974
d_y3_d_x2  0.053090421  0.000000000 -0.017111390 -0.056691210  0.022641165
d_y1_d_x3  0.115454521  0.000000000  0.115470133 -0.084389093  0.049252269
d_y2_d_x3 -0.016986412  0.000000000 -0.016986412  0.012989609 -0.007327472
d_y3_d_x3 -0.049349413  0.000000000 -0.049349413  0.035582648 -0.021094237
d_y1_d_x4 -0.080995974  0.000000000 -0.080995974  0.086484639  0.004383646
d_y2_d_x4  0.003774758  0.000000000  0.003774758 -0.004329870 -0.003108624
d_y3_d_x4  0.003774758  0.000000000  0.003774758 -0.004080070 -0.015432100
                 b_2_0        b_2_1        b_2_2        b_2_3        b_2_4
d_y1_d_x1 -0.006704915 -0.010199135 -0.006704915  0.007159667 -0.002859406
d_y2_d_x1 -0.209306903  0.119344221 -0.209306903  0.223502872 -0.089261905
d_y3_d_x1 -0.011106030  0.003567316 -0.011106030  0.011859282 -0.004736324
d_y1_d_x2  0.023598678  0.000000000 -0.003494220 -0.025199228  0.010063992
d_y2_d_x2 -0.074279907  0.000000000  0.328651123  0.079317846 -0.031677723
d_y3_d_x2 -0.019690253  0.000000000  0.014673346  0.021025719 -0.008397188
d_y1_d_x3 -0.013815338  0.000000000 -0.013815338  0.011254886 -0.005899795
d_y2_d_x3  0.244582132  0.000000000  0.244582132  0.067501560  0.104805054
d_y3_d_x3  0.026562086  0.000000000  0.026562086 -0.013794521  0.011296519
d_y1_d_x4  0.003445161  0.000000000  0.003445161 -0.003674144 -0.002022688
d_y2_d_x4  0.317412763  0.000000000  0.317412763 -0.339395179  0.464073224
d_y3_d_x4  0.026173508  0.000000000  0.026173508 -0.027838842  0.025812685
                b_3_0        b_3_1        b_3_2        b_3_3        b_3_4
d_y1_d_x1 -0.02325677 -0.031727076 -0.023256772  0.024834133 -0.009918181
d_y2_d_x1 -0.01101557  0.003760221 -0.011015572  0.011762689 -0.004697747
d_y3_d_x1 -0.15915262  0.100642233 -0.159152617  0.169946937 -0.067872897
d_y1_d_x2  0.04568840  0.000000000 -0.008470304 -0.048787152  0.019484466
d_y2_d_x2 -0.01558086  0.000000000  0.014775793  0.016637610 -0.006644679
d_y3_d_x2 -0.12588268  0.000000000  0.259794850  0.134420513 -0.053684460
d_y1_d_x3 -0.02862294  0.000000000 -0.028621203  0.022096908 -0.012198575
d_y2_d_x3  0.02431388  0.000000000  0.024202862 -0.010769163  0.010436096
d_y3_d_x3  0.24250046  0.000000000  0.242417197  0.000915934  0.103389519
d_y1_d_x4  0.01173540  0.000000000  0.011735404 -0.012531642 -0.003465978
d_y2_d_x4  0.02364775  0.000000000  0.023647750 -0.026090241  0.024980018
d_y3_d_x4  0.28541058  0.000000000  0.285410584 -0.304617442  0.381472631
                 R_1_2        R_1_3         R_2_3
d_y1_d_x1  0.011959315 -0.030367660 -0.0004065696
d_y2_d_x1 -0.017466163 -0.002862858  0.1000439964
d_y3_d_x1  0.002470719 -0.046038902 -0.1147518488
d_y1_d_x2 -0.107503637  0.167966125  0.0134169502
d_y2_d_x2  0.060236172 -0.014779641  0.1442439395
d_y3_d_x2  0.057426766  0.119863838 -0.2017317546
d_y1_d_x3  0.044677803 -0.105544046 -0.0050619231
d_y2_d_x3 -0.030753178  0.011102230 -0.2206013150
d_y3_d_x3 -0.031613601 -0.082156504  0.2792210907
d_y1_d_x4 -0.002451164  0.023814284 -0.0002203099
d_y2_d_x4  0.006217249  0.002775558 -0.2645661468
d_y3_d_x4 -0.008187895  0.030475622  0.3408939797
> summary( margEffCondObsV )
              Estimate Std. error z value Pr(> z)
1: d_y1_d_x1  0.171996   0.516828   0.333   0.739
1: d_y2_d_x1  0.205415   0.413119   0.497   0.619
1: d_y3_d_x1 -0.126837   0.332460  -0.382   0.703
1: d_y1_d_x2 -0.095659   0.331454  -0.289   0.773
1: d_y2_d_x2  0.223316   0.383837   0.582   0.561
1: d_y3_d_x2 -0.174764   0.413044  -0.423   0.672
1: d_y1_d_x3  0.049373   0.228452   0.216   0.829
1: d_y2_d_x3 -0.384962   0.432570  -0.890   0.373
1: d_y3_d_x3  0.244210   0.471473   0.518   0.604
1: d_y1_d_x4 -0.035715   0.147236  -0.243   0.808
1: d_y2_d_x4 -0.504205   0.777545  -0.648   0.517
1: d_y3_d_x4  0.301966   0.722171   0.418   0.676
2: d_y1_d_x1  0.395977   0.693167   0.571   0.568
2: d_y2_d_x1  0.265123   0.579061   0.458   0.647
2: d_y3_d_x1 -0.224059   0.554291  -0.404   0.686
2: d_y1_d_x2 -0.322951   0.482364  -0.670   0.503
2: d_y2_d_x2  0.251672   0.434307   0.579   0.562
2: d_y3_d_x2 -0.134251   0.656026  -0.205   0.838
2: d_y1_d_x3  0.538961   0.592848   0.909   0.363
2: d_y2_d_x3 -0.523912   0.581624  -0.901   0.368
2: d_y3_d_x3  0.231992   0.839305   0.276   0.782
2: d_y1_d_x4 -0.395069   0.731894  -0.540   0.589
2: d_y2_d_x4 -0.538713   0.751515  -0.717   0.473
2: d_y3_d_x4  0.455530   0.692526   0.658   0.511
3: d_y1_d_x1  0.001392   0.008532   0.163   0.870
3: d_y2_d_x1  0.231970   0.513273   0.452   0.651
3: d_y3_d_x1 -0.116095   0.371068  -0.313   0.754
3: d_y1_d_x2 -0.018567   0.103626  -0.179   0.858
3: d_y2_d_x2  0.110991   0.351961   0.315   0.752
3: d_y3_d_x2 -0.137815   0.402763  -0.342   0.732
3: d_y1_d_x3  0.005969   0.031299   0.191   0.849
3: d_y2_d_x3 -0.149187   0.299779  -0.498   0.619
3: d_y3_d_x3  0.148226   0.278638   0.532   0.595
3: d_y1_d_x4 -0.004570   0.023546  -0.194   0.846
3: d_y2_d_x4 -0.199202   0.550652  -0.362   0.718
3: d_y3_d_x4  0.165549   0.459696   0.360   0.719
> margEffCondObsVA <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, vcov = diag( 18 ), returnJacobian = TRUE )
> all.equal( margEffCondObs, margEffCondObsA )
[1] TRUE
> # now with Jacobian but without variance covariance matrix
> margEffCondObsJac <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, 
+    data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, returnJacobian = TRUE )
> all.equal( attr( margEffCondObsJac, "jacobian" ), 
+    attr( margEffCondObsV, "jacobian" ) )
[1] TRUE
> # now with mean values of marginal effects
> margEffCondObsM <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, 
+    data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, vcov = diag( 18 ), addMean = TRUE, returnJacobian = TRUE )
> all.equal( margEffCondObsV, margEffCondObsM[ 1:3, ], check.attributes = FALSE )
[1] TRUE
> print( margEffCondObsM )
       d_y1_d_x1 d_y2_d_x1  d_y3_d_x1   d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1    0.171996342 0.2054152 -0.1268372 -0.09565856 0.2233156 -0.1747643
2    0.395976600 0.2651229 -0.2240590 -0.32295096 0.2516725 -0.1342508
3    0.001391671 0.2319696 -0.1160949 -0.01856668 0.1109910 -0.1378151
mean 0.189788204 0.2341692 -0.1556637 -0.14572540 0.1953264 -0.1489434
       d_y1_d_x3  d_y2_d_x3 d_y3_d_x3    d_y1_d_x4  d_y2_d_x4 d_y3_d_x4
1    0.049373080 -0.3849624 0.2442104 -0.035714957 -0.5042055 0.3019656
2    0.538960957 -0.5239122 0.2319922 -0.395069134 -0.5387128 0.4555304
3    0.005969436 -0.1491872 0.1482261 -0.004569507 -0.1992018 0.1655489
mean 0.198101158 -0.3526873 0.2081429 -0.145117866 -0.4140400 0.3076816
> all.equal( attr( margEffCondObsV, "vcov" ), 
+    attr( margEffCondObsM, "vcov" )[ 1:3, , ] )
[1] TRUE
> print( attr( margEffCondObsM, "vcov" ) )
, , d_y1_d_x1

        d_y1_d_x1    d_y2_d_x1     d_y3_d_x1     d_y1_d_x2    d_y2_d_x2
1    2.671114e-01 -0.001897659  0.0012381527 -0.0898724972 0.0111026042
5    4.804800e-01  0.066989903 -0.1865386538 -0.2400866050 0.0134390757
10   7.279534e-05  0.000104812  0.0002842754 -0.0007541722 0.0001431043
mean 1.415407e-01  0.006460991 -0.0348547378 -0.0573521650 0.0054981909
         d_y3_d_x2     d_y1_d_x3     d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1     0.0232684661  0.0871299144 -0.0172963073 -0.0453103425 -0.0615079750
5    -0.1876624140 -0.1074876853  0.1088809711  0.3287584733  0.0447034940
10    0.0005193529  0.0002645317 -0.0001021944 -0.0004114926 -0.0001929968
mean -0.0317096952 -0.0021282115  0.0083716077  0.0473235130 -0.0012924245
         d_y2_d_x4     d_y3_d_x4
1    -0.0073392638 -0.0251473057
5    -0.2424337723  0.1370873362
10   -0.0001535455 -0.0005902426
mean -0.0434581834  0.0117377244

, , d_y2_d_x1

        d_y1_d_x1 d_y2_d_x1    d_y3_d_x1    d_y1_d_x2    d_y2_d_x2    d_y3_d_x2
1    -0.001897659 0.1706676  0.003222529 -0.007611475 -0.019220268 -0.015126608
5     0.066989903 0.3353120 -0.024244383 -0.023043764 -0.066230609 -0.137910505
10    0.000104812 0.2634495  0.006039631 -0.002325959  0.088988794  0.002116951
mean  0.006460991 0.1487773 -0.009259879 -0.003117154 -0.001428115 -0.038992651
        d_y1_d_x3    d_y2_d_x3    d_y3_d_x3     d_y1_d_x4  d_y2_d_x4
1     0.007321058 -0.118709701  0.008319572 -1.436645e-03 -0.2777298
5    -0.091064636  0.082725580  0.178623525 -3.681556e-02 -0.1483143
10    0.000474731 -0.108911373 -0.001437958 -8.247834e-05 -0.2017248
mean -0.014435438  0.001873007  0.048515049 -5.328876e-03 -0.1055805
        d_y3_d_x4
1     0.002991466
5     0.087427397
10   -0.005099263
mean  0.033256539

, , d_y3_d_x1

         d_y1_d_x1    d_y2_d_x1 d_y3_d_x1    d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1     0.0012381527  0.003222529 0.1105299 -0.024097591 -0.014252445 0.02281127
5    -0.1865386538 -0.024244383 0.3072387  0.095206563 -0.060415748 0.12725063
10    0.0002842754  0.006039631 0.1376916 -0.003939484 -0.003951327 0.06569682
mean -0.0348547378 -0.009259879 0.1005792  0.011532132 -0.025381502 0.02335124
       d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4    d_y2_d_x4   d_y3_d_x4
1    0.018160457 0.009569937 -0.11252047 -0.0056719837  0.003267811 -0.21010758
5    0.029956958 0.026539397 -0.30227540 -0.0224241963  0.180598167 -0.27763466
10   0.001069899 0.002303729 -0.06427397 -0.0004819725 -0.001453009 -0.10516720
mean 0.001888329 0.027490286 -0.05358672  0.0032720857  0.048842175 -0.08765941

, , d_y1_d_x2

         d_y1_d_x1    d_y2_d_x1    d_y3_d_x1  d_y1_d_x2   d_y2_d_x2
1    -0.0898724972 -0.007611475 -0.024097591 0.10986178 -0.02228280
5    -0.2400866050 -0.023043764  0.095206563 0.23267476 -0.05216925
10   -0.0007541722 -0.002325959 -0.003939484 0.01073828 -0.00361963
mean -0.0573521650 -0.003117154  0.011532132 0.07275856 -0.01923728
        d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1    -0.026271829 -0.058179035  0.0130157952  0.019179690  0.030288107
5     0.062794165 -0.011431584 -0.0186738375 -0.216220272 -0.156770642
10   -0.010755334 -0.002774442  0.0019988657  0.005157712  0.001952641
mean  0.003498611 -0.010942622  0.0002753078 -0.042714458 -0.031730097
       d_y2_d_x4    d_y3_d_x4
1    0.017481874  0.044870268
5    0.111569101 -0.040851050
10   0.003359287  0.007972825
mean 0.021329800  0.008074000

, , d_y2_d_x2

        d_y1_d_x1    d_y2_d_x1    d_y3_d_x1   d_y1_d_x2 d_y2_d_x2     d_y3_d_x2
1    0.0111026042 -0.019220268 -0.014252445 -0.02228280 0.1473312 -0.0080961714
5    0.0134390757 -0.066230609 -0.060415748 -0.05216925 0.1886225 -0.0004257871
10   0.0001431043  0.088988794 -0.003951327 -0.00361963 0.1238768  0.0082323867
mean 0.0054981909 -0.001428115 -0.025381502 -0.01923728 0.1293292 -0.0040483856
        d_y1_d_x3    d_y2_d_x3     d_y3_d_x3     d_y1_d_x4     d_y2_d_x4
1    0.0058083274  0.029502990  0.0422163033 -0.0033252316  0.0008039518
5    0.0272750616 -0.085107600  0.0836469176  0.0418727562 -0.1133176742
10   0.0005720315 -0.067847459 -0.0001247016 -0.0002634166 -0.1243476947
mean 0.0011736333 -0.005661578  0.0423819663  0.0075781779 -0.0532979029
        d_y3_d_x4
1     0.044042116
5     0.102732795
10   -0.002635618
mean  0.043590542

, , d_y3_d_x2

         d_y1_d_x1    d_y2_d_x1  d_y3_d_x1    d_y1_d_x2     d_y2_d_x2 d_y3_d_x2
1     0.0232684661 -0.015126608 0.02281127 -0.026271829 -0.0080961714 0.1706051
5    -0.1876624140 -0.137910505 0.12725063  0.062794165 -0.0004257871 0.4303697
10    0.0005193529  0.002116951 0.06569682 -0.010755334  0.0082323867 0.1622181
mean -0.0317096952 -0.038992651 0.02335124  0.003498611 -0.0040483856 0.1882394
        d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1     0.001136998  0.043084921 -0.04575450 -0.004964150  0.04006526 -0.08970814
5     0.024384423 -0.016406034 -0.33975596 -0.099549757  0.25270383 -0.15393704
10    0.001765153 -0.001622427 -0.07125052 -0.001272237 -0.00621035 -0.11691077
mean -0.012435445  0.029008909 -0.04504409 -0.007038166  0.06936369 -0.04657785

, , d_y1_d_x3

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1     0.0871299144  0.007321058 0.018160457 -0.058179035 0.0058083274
5    -0.1074876853 -0.091064636 0.029956958 -0.011431584 0.0272750616
10    0.0002645317  0.000474731 0.001069899 -0.002774442 0.0005720315
mean -0.0021282115 -0.014435438 0.001888329 -0.010942622 0.0011736333
        d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1     0.001136998 0.0521904094 -0.0151792452 -0.025668559 -0.0294393007
5     0.024384423 0.3514690138 -0.1655214329 -0.117460193  0.2401467254
10    0.001765153 0.0009796297 -0.0004350475 -0.001531253 -0.0006843985
mean -0.012435445 0.0453763413 -0.0170533898 -0.005485470  0.0373684783
         d_y2_d_x4    d_y3_d_x4
1    -0.0151550345 -0.033763398
5     0.1158983349 -0.100667995
10   -0.0007401457 -0.002143286
mean  0.0185309846 -0.015869356

, , d_y2_d_x3

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1     d_y1_d_x2    d_y2_d_x2
1    -0.0172963073 -0.118709701 0.009569937  0.0130157952  0.029502990
5     0.1088809711  0.082725580 0.026539397 -0.0186738375 -0.085107600
10   -0.0001021944 -0.108911373 0.002303729  0.0019988657 -0.067847459
mean  0.0083716077  0.001873007 0.027490286  0.0002753078 -0.005661578
        d_y3_d_x2     d_y1_d_x3  d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1     0.043084921 -0.0151792452 0.18711669 -0.033164689  6.124715e-03
5    -0.016406034 -0.1655214329 0.33828590  0.037169819 -1.018522e-01
10   -0.001622427 -0.0004350475 0.08986723  0.001479273  9.574645e-05
mean  0.029008909 -0.0170533898 0.07208950 -0.032033793 -1.303522e-02
       d_y2_d_x4    d_y3_d_x4
1    0.240725022 -0.039941636
5    0.008146998 -0.075880148
10   0.156670287  0.003914299
mean 0.052208528 -0.051264437

, , d_y3_d_x3

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
1    -0.0453103425  0.008319572 -0.11252047  0.019179690  0.0422163033
5     0.3287584733  0.178623525 -0.30227540 -0.216220272  0.0836469176
10   -0.0004114926 -0.001437958 -0.06427397  0.005157712 -0.0001247016
mean  0.0473235130  0.048515049 -0.05358672 -0.042714458  0.0423819663
       d_y3_d_x2    d_y1_d_x3    d_y2_d_x3  d_y3_d_x3    d_y1_d_x4   d_y2_d_x4
1    -0.04575450 -0.025668559 -0.033164689 0.22228714 0.0145703030 -0.03394560
5    -0.33975596 -0.117460193  0.037169819 0.70443230 0.1417470696 -0.39174344
10   -0.07125052 -0.001531253  0.001479273 0.07763938 0.0008552238  0.00516164
mean -0.04504409 -0.005485470 -0.032033793 0.12854159 0.0094401700 -0.09701941
      d_y3_d_x4
1    0.27237561
5    0.34346937
10   0.11822067
mean 0.08405141

, , d_y1_d_x4

         d_y1_d_x1     d_y2_d_x1     d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
1    -0.0615079750 -1.436645e-03 -0.0056719837  0.030288107 -0.0033252316
5     0.0447034940 -3.681556e-02 -0.0224241963 -0.156770642  0.0418727562
10   -0.0001929968 -8.247834e-05 -0.0004819725  0.001952641 -0.0002634166
mean -0.0012924245 -5.328876e-03  0.0032720857 -0.031730097  0.0075781779
        d_y3_d_x2     d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1    -0.004964150 -0.0294393007  6.124715e-03 0.0145703030 0.0216785049
5    -0.099549757  0.2401467254 -1.018522e-01 0.1417470696 0.5356693232
10   -0.001272237 -0.0006843985  9.574645e-05 0.0008552238 0.0005543967
mean -0.007038166  0.0373684783 -1.303522e-02 0.0094401700 0.0602206400
         d_y2_d_x4     d_y3_d_x4
1     2.400363e-03  0.0090631453
5    -9.601904e-03 -0.1435444583
10    6.934889e-05  0.0009225482
mean  5.689881e-04 -0.0332512729

, , d_y2_d_x4

         d_y1_d_x1  d_y2_d_x1    d_y3_d_x1   d_y1_d_x2     d_y2_d_x2
1    -0.0073392638 -0.2777298  0.003267811 0.017481874  0.0008039518
5    -0.2424337723 -0.1483143  0.180598167 0.111569101 -0.1133176742
10   -0.0001535455 -0.2017248 -0.001453009 0.003359287 -0.1243476947
mean -0.0434581834 -0.1055805  0.048842175 0.021329800 -0.0532979029
       d_y3_d_x2     d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4 d_y2_d_x4
1     0.04006526 -0.0151550345 0.240725022 -0.03394560  2.400363e-03 0.6045764
5     0.25270383  0.1158983349 0.008146998 -0.39174344 -9.601904e-03 0.5647754
10   -0.00621035 -0.0007401457 0.156670287  0.00516164  6.934889e-05 0.3032179
mean  0.06936369  0.0185309846 0.052208528 -0.09701941  5.689881e-04 0.3184329
       d_y3_d_x4
1    -0.02104286
5    -0.26188497
10    0.01106651
mean -0.07009580

, , d_y3_d_x4

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1    -0.0251473057  0.002991466 -0.21010758  0.044870268  0.044042116
5     0.1370873362  0.087427397 -0.27763466 -0.040851050  0.102732795
10   -0.0005902426 -0.005099263 -0.10516720  0.007972825 -0.002635618
mean  0.0117377244  0.033256539 -0.08765941  0.008074000  0.043590542
       d_y3_d_x2    d_y1_d_x3    d_y2_d_x3  d_y3_d_x3     d_y1_d_x4   d_y2_d_x4
1    -0.08970814 -0.033763398 -0.039941636 0.27237561  0.0090631453 -0.02104286
5    -0.15393704 -0.100667995 -0.075880148 0.34346937 -0.1435444583 -0.26188497
10   -0.11691077 -0.002143286  0.003914299 0.11822067  0.0009225482  0.01106651
mean -0.04657785 -0.015869356 -0.051264437 0.08405141 -0.0332512729 -0.07009580
     d_y3_d_x4
1    0.5215308
5    0.4795926
10   0.2113200
mean 0.2154906

> print( drop( attr( margEffCondObsM, "vcov" )[ 4, , ] ) )
             d_y1_d_x1    d_y2_d_x1    d_y3_d_x1     d_y1_d_x2    d_y2_d_x2
d_y1_d_x1  0.141540706  0.006460991 -0.034854738 -0.0573521650  0.005498191
d_y2_d_x1  0.006460991  0.148777309 -0.009259879 -0.0031171538 -0.001428115
d_y3_d_x1 -0.034854738 -0.009259879  0.100579205  0.0115321321 -0.025381502
d_y1_d_x2 -0.057352165 -0.003117154  0.011532132  0.0727585583 -0.019237283
d_y2_d_x2  0.005498191 -0.001428115 -0.025381502 -0.0192372835  0.129329235
d_y3_d_x2 -0.031709695 -0.038992651  0.023351239  0.0034986111 -0.004048386
d_y1_d_x3 -0.002128212 -0.014435438  0.001888329 -0.0109426217  0.001173633
d_y2_d_x3  0.008371608  0.001873007  0.027490286  0.0002753078 -0.005661578
d_y3_d_x3  0.047323513  0.048515049 -0.053586720 -0.0427144579  0.042381966
d_y1_d_x4 -0.001292424 -0.005328876  0.003272086 -0.0317300974  0.007578178
d_y2_d_x4 -0.043458183 -0.105580451  0.048842175  0.0213298000 -0.053297903
d_y3_d_x4  0.011737724  0.033256539 -0.087659411  0.0080739999  0.043590542
             d_y3_d_x2    d_y1_d_x3     d_y2_d_x3   d_y3_d_x3     d_y1_d_x4
d_y1_d_x1 -0.031709695 -0.002128212  0.0083716077  0.04732351 -0.0012924245
d_y2_d_x1 -0.038992651 -0.014435438  0.0018730065  0.04851505 -0.0053288760
d_y3_d_x1  0.023351239  0.001888329  0.0274902864 -0.05358672  0.0032720857
d_y1_d_x2  0.003498611 -0.010942622  0.0002753078 -0.04271446 -0.0317300974
d_y2_d_x2 -0.004048386  0.001173633 -0.0056615778  0.04238197  0.0075781779
d_y3_d_x2  0.188239422 -0.012435445  0.0290089086 -0.04504409 -0.0070381655
d_y1_d_x3 -0.012435445  0.045376341 -0.0170533898 -0.00548547  0.0373684783
d_y2_d_x3  0.029008909 -0.017053390  0.0720894962 -0.03203379 -0.0130352239
d_y3_d_x3 -0.045044094 -0.005485470 -0.0320337930  0.12854159  0.0094401700
d_y1_d_x4 -0.007038166  0.037368478 -0.0130352239  0.00944017  0.0602206400
d_y2_d_x4  0.069363685  0.018530985  0.0522085277 -0.09701941  0.0005689881
d_y3_d_x4 -0.046577852 -0.015869356 -0.0512644375  0.08405141 -0.0332512729
              d_y2_d_x4   d_y3_d_x4
d_y1_d_x1 -0.0434581834  0.01173772
d_y2_d_x1 -0.1055804511  0.03325654
d_y3_d_x1  0.0488421749 -0.08765941
d_y1_d_x2  0.0213298000  0.00807400
d_y2_d_x2 -0.0532979029  0.04359054
d_y3_d_x2  0.0693636851 -0.04657785
d_y1_d_x3  0.0185309846 -0.01586936
d_y2_d_x3  0.0522085277 -0.05126444
d_y3_d_x3 -0.0970194096  0.08405141
d_y1_d_x4  0.0005689881 -0.03325127
d_y2_d_x4  0.3184328972 -0.07009580
d_y3_d_x4 -0.0700958041  0.21549063
> all.equal( attr( margEffCondObsV, "jacobian" ), 
+    attr( margEffCondObsM, "jacobian" )[ 1:3, , ] )
[1] TRUE
> print( attr( margEffCondObsM, "jacobian" ) )
, , b_1_0

        d_y1_d_x1     d_y2_d_x1    d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1     0.237119196 -0.0042905705 -0.004537520 -0.16362764  0.021246739
5     0.279256250  0.0130994340 -0.042653983 -0.18347254  0.006690779
10   -0.004746446  0.0002331714  0.002017613  0.04644298 -0.004668669
mean  0.170543000  0.0030140117 -0.015057964 -0.10021907  0.007756283
        d_y3_d_x2   d_y1_d_x3    d_y2_d_x3    d_y3_d_x3   d_y1_d_x4
1     0.053090421  0.11545452 -0.016986412 -0.049349413 -0.08099597
5    -0.050415270  0.04629630  0.021205260  0.092925667 -0.02620126
10   -0.020715613 -0.01842970  0.001387779  0.009436896  0.01432188
mean -0.006013487  0.04777371  0.001868875  0.017671050 -0.03095845
         d_y2_d_x4     d_y3_d_x4
1     3.774758e-03  0.0037747583
5    -4.085621e-02  0.0320854454
10   -4.163336e-05 -0.0009992007
mean -1.237436e-02  0.0116203343

, , b_1_1

        d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2   d_y2_d_x2
1    2.760459e-01 -9.172312e-03 -2.164891e-02  0.00000000 0.000000000
5    4.300837e-01 -6.483072e-02 -9.133239e-02 -0.18347254 0.006690779
10   3.416556e-05 -6.254719e-06 -8.454504e-05  0.00000000 0.000000000
mean 2.353879e-01 -2.466976e-02 -3.768861e-02 -0.06115751 0.002230260
       d_y3_d_x2 d_y1_d_x3  d_y2_d_x3  d_y3_d_x3    d_y1_d_x4   d_y2_d_x4
1     0.00000000 0.0000000 0.00000000 0.00000000  0.000000000  0.00000000
5    -0.05041527 0.0462963 0.02120526 0.09292567 -0.026201263 -0.04085621
10    0.00000000 0.0000000 0.00000000 0.00000000  0.000000000  0.00000000
mean -0.01680509 0.0154321 0.00706842 0.03097522 -0.008733754 -0.01361874
      d_y3_d_x4
1    0.00000000
5    0.03208545
10   0.00000000
mean 0.01069515

, , b_1_2

      d_y1_d_x1   d_y2_d_x1    d_y3_d_x1  d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1    0.23711920 -0.00429057 -0.004537520 0.03892668 -0.004881742 -0.01711139
5    0.00000000  0.00000000  0.000000000 0.24661116 -0.058139940 -0.14174766
10   0.00000000  0.00000000  0.000000000 0.05122359 -0.004908095 -0.02281777
mean 0.07903973 -0.00143019 -0.001512507 0.11225381 -0.022643259 -0.06055894
      d_y1_d_x3    d_y2_d_x3   d_y3_d_x3   d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1    0.11547013 -0.016986412 -0.04934941 -0.08099597 0.003774758 0.003774758
5    0.00000000  0.000000000  0.00000000  0.00000000 0.000000000 0.000000000
10   0.00000000  0.000000000  0.00000000  0.00000000 0.000000000 0.000000000
mean 0.03849004 -0.005662137 -0.01644980 -0.02699866 0.001258253 0.001258253

, , b_1_3

        d_y1_d_x1     d_y2_d_x1   d_y3_d_x1 d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1    -0.253201499  0.0045815729 0.004845272 0.1747255 -0.022687772 -0.05669121
5    -0.174546122 -0.0081876608 0.026660414 0.1146775 -0.004182000  0.03151152
10   -0.005951165  0.0002923537 0.002529713 0.0582309 -0.005853647 -0.02597354
mean -0.144566262 -0.0011045781 0.011345133 0.1158780 -0.010907806 -0.01705108
       d_y1_d_x3    d_y2_d_x3    d_y3_d_x3  d_y1_d_x4     d_y2_d_x4
1    -0.08438909  0.012989609  0.035582648 0.08648464 -4.329870e-03
5     0.40112358 -0.078492768 -0.149324997 0.01654232  2.542411e-02
10   -0.01898481  0.001484923  0.009214851 0.01787459 -4.163336e-05
mean  0.09924989 -0.021339412 -0.034842499 0.04030052  7.017535e-03
        d_y3_d_x4
1    -0.004080070
5    -0.019761970
10   -0.001554312
mean -0.008465451

, , b_1_4

       d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2   d_y2_d_x2
1    0.101122853 -1.829775e-03 -0.0019350901 -0.06978133 0.009060974
5    0.229431652  1.076225e-02 -0.0350437055 -0.15073756 0.005497018
10   0.001805885 -8.871495e-05 -0.0007676428 -0.01767021 0.001776293
mean 0.110786797  2.947919e-03 -0.0125821461 -0.07939637 0.005444762
        d_y3_d_x2  d_y1_d_x3     d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1     0.022641165 0.04925227 -0.0073274720 -0.021094237  0.0043836462
5    -0.041420232 0.03802514  0.0175415238  0.076605389  0.4085065619
10    0.007881690 0.00721645 -0.0005412337 -0.003330669 -0.0004440892
mean -0.003632459 0.03149795  0.0032242727  0.017393494  0.1374820396
         d_y2_d_x4   d_y3_d_x4
1    -0.0031086245 -0.01543210
5    -0.0982547377 -0.06494805
10   -0.0002081668 -0.00144329
mean -0.0338571763 -0.02727448

, , b_2_0

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2
1    -0.0067049148 -0.20930690 -0.011106030  0.02359868 -0.07427991
5    -0.0468176067  0.06017080  0.024119695  0.01982570 -0.11310591
10    0.0001492367  0.21970457  0.010775848 -0.00348749  0.13273560
mean -0.0177910949  0.02352282  0.007929838  0.01331229 -0.01821674
        d_y3_d_x2     d_y1_d_x3   d_y2_d_x3   d_y3_d_x3    d_y1_d_x4
1    -0.019690253 -0.0138153378  0.24458213  0.02656209 0.0034451608
5     0.019517303  0.0205946371  0.05317968 -0.03752554 0.0323074900
10    0.010499709  0.0005551115 -0.22637447 -0.01054712 0.0001110223
mean  0.003442253  0.0024448036  0.02379578 -0.00717019 0.0119545577
       d_y2_d_x4    d_y3_d_x4
1     0.31741276  0.026173508
5     0.06283862 -0.037192471
10   -0.30199454 -0.011768364
mean  0.02608562 -0.007595776

, , b_2_1

         d_y1_d_x1 d_y2_d_x1   d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1    -1.019913e-02 0.1193442 0.003567316 0.000000000  0.00000000 0.000000000
5    -6.151580e-02 0.4058003 0.034744322 0.019825696 -0.11310591 0.019517303
10   -2.590150e-06 0.3469243 0.014366785 0.000000000  0.00000000 0.000000000
mean -2.390584e-02 0.2906896 0.017559475 0.006608565 -0.03770197 0.006505768
       d_y1_d_x3  d_y2_d_x3   d_y3_d_x3  d_y1_d_x4  d_y2_d_x4   d_y3_d_x4
1    0.000000000 0.00000000  0.00000000 0.00000000 0.00000000  0.00000000
5    0.020650148 0.05306866 -0.03752554 0.03225198 0.06294965 -0.03708145
10   0.000000000 0.00000000  0.00000000 0.00000000 0.00000000  0.00000000
mean 0.006883383 0.01768955 -0.01250851 0.01075066 0.02098322 -0.01236048

, , b_2_2

        d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1    -0.006704915 -0.20930690 -0.01110603 -0.003494220 0.3286511 0.01467335
5     0.000000000  0.00000000  0.00000000 -0.041690108 0.2926944 0.05426163
10    0.000000000  0.00000000  0.00000000 -0.003639317 0.2599553 0.01409065
mean -0.002234972 -0.06976897 -0.00370201 -0.016274548 0.2937670 0.02767521
        d_y1_d_x3  d_y2_d_x3   d_y3_d_x3   d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1    -0.013815338 0.24458213 0.026562086 0.003445161 0.3174128 0.026173508
5     0.000000000 0.00000000 0.000000000 0.000000000 0.0000000 0.000000000
10    0.000000000 0.00000000 0.000000000 0.000000000 0.0000000 0.000000000
mean -0.004605113 0.08152738 0.008854029 0.001148387 0.1058043 0.008724503

, , b_2_3

        d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2  d_y2_d_x2    d_y3_d_x2
1    0.0071596671  0.22350287  0.011859282 -0.025199228 0.07931785  0.021025719
5    0.0292628426 -0.03760911 -0.015075756 -0.012391838 0.07069564 -0.012199081
10   0.0001871152  0.27546887  0.013510919 -0.004372667 0.16642588  0.013164692
mean 0.0122032083  0.15378754  0.003431481 -0.013987911 0.10547979  0.007330444
         d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4  d_y2_d_x4
1     0.0112548859  0.06750156 -0.013794521 -0.0036741443 -0.3393952
5    -0.0745514761  0.37225778  0.057620575 -0.0200395256 -0.0393019
10    0.0009992007 -0.15652757 -0.009325873 -0.0002220446 -0.3786277
mean -0.0207657965  0.09441059  0.011500060 -0.0079785715 -0.2524416
        d_y3_d_x4
1    -0.027838842
5     0.023536728
10   -0.015210055
mean -0.006504057

, , b_2_4

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2
1    -2.859406e-03 -0.08926191 -0.004736324 0.010063992 -0.03167772
5    -3.846446e-02  0.04943519  0.019816285 0.016288417 -0.09292568
10   -5.678036e-05 -0.08359122 -0.004099898 0.001326889 -0.05050205
mean -1.379355e-02 -0.04113931  0.003660021 0.009226432 -0.05836848
        d_y3_d_x2     d_y1_d_x3  d_y2_d_x3    d_y3_d_x3     d_y1_d_x4 d_y2_d_x4
1    -0.008397188 -0.0058997945 0.10480505  0.011296519 -0.0020226876 0.4640732
5     0.016035047  0.0172084569 0.04396483 -0.031197267 -0.0353606033 0.4576339
10   -0.003994835 -0.0005551115 0.08613943  0.003885781 -0.0002220446 0.2421258
mean  0.001214341  0.0035845169 0.07830310 -0.005338322 -0.0125351118 0.3879443
       d_y3_d_x4
1    0.025812685
5    0.004440892
10   0.007993606
mean 0.012749061

, , b_3_0

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1    -0.0232567722 -0.011015572 -0.15915262  0.04568840 -0.015580858
5    -0.0739470342 -0.007314459  0.22130059  0.06229383 -0.013690362
10    0.0008188513  0.011466788  0.13119743 -0.01094591  0.009654283
mean -0.0321283184 -0.002287747  0.06444847  0.03234544 -0.006538979
       d_y3_d_x2    d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4   d_y2_d_x4
1    -0.12588268 -0.028622937  0.024313884  0.24250046  0.011735404  0.02364775
5     0.05968877 -0.035305092  0.004662937 -0.14754864 -0.033750780  0.03186340
10    0.15417144  0.003663736 -0.010075274 -0.21649349 -0.001776357 -0.01218470
mean  0.02932584 -0.020088098  0.006300516 -0.04051389 -0.007930577  0.01444215
       d_y3_d_x4
1     0.28541058
5    -0.25601743
10   -0.23947511
mean -0.07002732

, , b_3_1

         d_y1_d_x1   d_y2_d_x1 d_y3_d_x1  d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1    -3.172708e-02 0.003760221 0.1006422 0.00000000  0.000000000 0.00000000
5    -1.245229e-01 0.048919331 0.3650462 0.06229383 -0.013690362 0.05968877
10   -4.433343e-06 0.014931963 0.2725413 0.00000000  0.000000000 0.00000000
mean -5.208480e-02 0.022537172 0.2460766 0.02076461 -0.004563454 0.01989626
       d_y1_d_x3   d_y2_d_x3   d_y3_d_x3   d_y1_d_x4  d_y2_d_x4   d_y3_d_x4
1     0.00000000 0.000000000  0.00000000  0.00000000 0.00000000  0.00000000
5    -0.03524958 0.004662937 -0.14754864 -0.03375078 0.03186340 -0.25601743
10    0.00000000 0.000000000  0.00000000  0.00000000 0.00000000  0.00000000
mean -0.01174986 0.001554312 -0.04918288 -0.01125026 0.01062113 -0.08533914

, , b_3_2

        d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1    -0.023256772 -0.011015572 -0.15915262 -0.008470304 0.01477579 0.2597948
5     0.000000000  0.000000000  0.00000000 -0.062229064 0.03522897 0.4247349
10    0.000000000  0.000000000  0.00000000 -0.011769193 0.01311946 0.2955153
mean -0.007752257 -0.003671857 -0.05305087 -0.027489520 0.02104141 0.3266817
        d_y1_d_x3   d_y2_d_x3  d_y3_d_x3   d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1    -0.028621203 0.024202862 0.24241720 0.011735404 0.023647750 0.28541058
5     0.000000000 0.000000000 0.00000000 0.000000000 0.000000000 0.00000000
10    0.000000000 0.000000000 0.00000000 0.000000000 0.000000000 0.00000000
mean -0.009540401 0.008067621 0.08080573 0.003911801 0.007882583 0.09513686

, , b_3_3

       d_y1_d_x1   d_y2_d_x1   d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1    0.024834133 0.011762689  0.16994694 -0.04878715 0.016637610  0.13442051
5    0.046219800 0.004571824 -0.13832156 -0.03893609 0.008557013 -0.03730783
10   0.001026687 0.014377230  0.16449729 -0.01372414 0.012104684  0.19330245
mean 0.024026873 0.010237248  0.06537422 -0.03381579 0.012433102  0.09680504
        d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1     0.022096908 -0.010769163  0.000915934 -0.012531642 -0.02609024 -0.3046174
5    -0.102473585  0.045963233  0.457078819  0.021260771 -0.02009504  0.1600942
10    0.003108624 -0.009173218 -0.130451205 -0.002220446 -0.01527944 -0.3002043
mean -0.025756018  0.008673617  0.109181183  0.002169561 -0.02048824 -0.1482425

, , b_3_4

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1  d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1    -0.0099181812 -0.004697747 -0.06787290 0.01948447 -0.006644679 -0.05368446
5    -0.0607534844 -0.006009421  0.18181638 0.05117943 -0.011247742  0.04903917
10   -0.0003115491 -0.004362780 -0.04991682 0.00416460 -0.003673175 -0.05865776
mean -0.0236610716 -0.005023316  0.02134222 0.02494283 -0.007188532 -0.02110102
         d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4  d_y2_d_x4 d_y3_d_x4
1    -0.0121985755 0.010436096  0.10338952 -0.0034659775 0.02498002 0.3814726
5    -0.0290878432 0.003552714 -0.12079227 -0.1520450432 0.07538414 0.1548761
10   -0.0009992007 0.003816392  0.08282264 -0.0005551115 0.00809075 0.2320366
mean -0.0140952065 0.005935067  0.02180663 -0.0520220441 0.03615164 0.2561285

, , R_1_2

         d_y1_d_x1     d_y2_d_x1    d_y3_d_x1     d_y1_d_x2   d_y2_d_x2
1     0.0119593147 -0.0174661633 2.470719e-03 -0.1075036372 0.060236172
5    -0.2627469940 -0.3102622052 5.436432e-02  0.0008249927 0.141162941
10    0.0002986817 -0.0001412116 5.869527e-06 -0.0079378150 0.006272141
mean -0.0834963325 -0.1092898600 1.894697e-02 -0.0382054865 0.069223751
       d_y3_d_x2   d_y1_d_x3    d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1    0.057426766 0.044677803 -0.030753178 -0.0316136006 -0.0024511643
5    0.165725303 0.360267371 -0.354161145 -0.2032818358  0.3658184866
10   0.005869358 0.001665335 -0.001026956 -0.0006661338 -0.0005551115
mean 0.076340476 0.135536836 -0.128647093 -0.0785205234  0.1209374036
        d_y2_d_x4     d_y3_d_x4
1    6.217249e-03 -0.0081878948
5    2.864375e-01 -0.1064703881
10   2.775558e-05 -0.0008881784
mean 9.756085e-02 -0.0385154871

, , R_1_3

       d_y1_d_x1     d_y2_d_x1    d_y3_d_x1  d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1    -0.03036766 -0.0028628581 -0.046038902 0.16796613 -0.014779641 0.11986384
5    -0.13515076 -0.1522331795 -0.008299913 0.21839363 -0.004554075 0.33427476
10   -0.00310063  0.0001322236 -0.002880124 0.04099705 -0.003285345 0.03256694
mean -0.05620635 -0.0516546046 -0.019072980 0.14245227 -0.007539687 0.16223518
       d_y1_d_x3     d_y2_d_x3   d_y3_d_x3    d_y1_d_x4    d_y2_d_x4
1    -0.10554405  0.0111022302 -0.08215650  0.023814284 0.0027755576
5    -0.17463808 -0.0337507799 -0.40301096 -0.447863968 0.1726396803
10   -0.01409983  0.0008743006 -0.01254552  0.004551914 0.0002220446
mean -0.09809399 -0.0072580830 -0.16590433 -0.139832590 0.0585457608
       d_y3_d_x4
1    0.030475622
5    0.091593400
10   0.004773959
mean 0.042280994

, , R_2_3

         d_y1_d_x1 d_y2_d_x1  d_y3_d_x1     d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1    -4.065696e-04 0.1000440 -0.1147518  0.0134169502 0.14424394 -0.20173175
5     1.095618e-01 0.1914696 -0.2351233 -0.0474577987 0.19609338 -0.26047393
10   -5.019252e-05 0.1066395 -0.1269163  0.0005696241 0.08873839 -0.08386716
mean  3.636834e-02 0.1327177 -0.1589305 -0.0111570748 0.14302524 -0.18202428
         d_y1_d_x3   d_y2_d_x3  d_y3_d_x3     d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1    -0.0050619231 -0.22060131 0.27922109 -0.0002203099 -0.26456615 0.34089398
5    -0.0632827124 -0.23669955 0.42554849 -0.0561772850 -0.46074256 0.51880722
10   -0.0004440892 -0.08058831 0.07960299 -0.0002220446 -0.09790779 0.09769963
mean -0.0229295749 -0.17929639 0.26145752 -0.0188732132 -0.27440550 0.31913361

> print( drop( attr( margEffCondObsM, "jacobian" )[ 4, , ] ) )
                 b_1_0        b_1_1        b_1_2        b_1_3        b_1_4
d_y1_d_x1  0.170543000  0.235387911  0.079039732 -0.144566262  0.110786797
d_y2_d_x1  0.003014012 -0.024669762 -0.001430190 -0.001104578  0.002947919
d_y3_d_x1 -0.015057964 -0.037688614 -0.001512507  0.011345133 -0.012582146
d_y1_d_x2 -0.100219066 -0.061157512  0.112253808  0.115877971 -0.079396369
d_y2_d_x2  0.007756283  0.002230260 -0.022643259 -0.010907806  0.005444762
d_y3_d_x2 -0.006013487 -0.016805090 -0.060558939 -0.017051077 -0.003632459
d_y1_d_x3  0.047773706  0.015432100  0.038490044  0.099249891  0.031497952
d_y2_d_x3  0.001868875  0.007068420 -0.005662137 -0.021339412  0.003224273
d_y3_d_x3  0.017671050  0.030975222 -0.016449804 -0.034842499  0.017393494
d_y1_d_x4 -0.030958453 -0.008733754 -0.026998658  0.040300518  0.137482040
d_y2_d_x4 -0.012374361 -0.013618736  0.001258253  0.007017535 -0.033857176
d_y3_d_x4  0.011620334  0.010695148  0.001258253 -0.008465451 -0.027274479
                 b_2_0        b_2_1        b_2_2        b_2_3        b_2_4
d_y1_d_x1 -0.017791095 -0.023905843 -0.002234972  0.012203208 -0.013793549
d_y2_d_x1  0.023522821  0.290689624 -0.069768968  0.153787542 -0.041139311
d_y3_d_x1  0.007929838  0.017559475 -0.003702010  0.003431481  0.003660021
d_y1_d_x2  0.013312295  0.006608565 -0.016274548 -0.013987911  0.009226432
d_y2_d_x2 -0.018216738 -0.037701971  0.293766966  0.105479788 -0.058368483
d_y3_d_x2  0.003442253  0.006505768  0.027675206  0.007330444  0.001214341
d_y1_d_x3  0.002444804  0.006883383 -0.004605113 -0.020765796  0.003584517
d_y2_d_x3  0.023795780  0.017689554  0.081527377  0.094410590  0.078303105
d_y3_d_x3 -0.007170190 -0.012508513  0.008854029  0.011500060 -0.005338322
d_y1_d_x4  0.011954558  0.010750660  0.001148387 -0.007978572 -0.012535112
d_y2_d_x4  0.026085615  0.020983215  0.105804254 -0.252441586  0.387944306
d_y3_d_x4 -0.007595776 -0.012360483  0.008724503 -0.006504057  0.012749061
                 b_3_0        b_3_1        b_3_2        b_3_3        b_3_4
d_y1_d_x1 -0.032128318 -0.052084800 -0.007752257  0.024026873 -0.023661072
d_y2_d_x1 -0.002287747  0.022537172 -0.003671857  0.010237248 -0.005023316
d_y3_d_x1  0.064448467  0.246076566 -0.053050872  0.065374224  0.021342222
d_y1_d_x2  0.032345438  0.020764608 -0.027489520 -0.033815794  0.024942832
d_y2_d_x2 -0.006538979 -0.004563454  0.021041407  0.012433102 -0.007188532
d_y3_d_x2  0.029325843  0.019896258  0.326681700  0.096805045 -0.021101018
d_y1_d_x3 -0.020088098 -0.011749860 -0.009540401 -0.025756018 -0.014095206
d_y2_d_x3  0.006300516  0.001554312  0.008067621  0.008673617  0.005935067
d_y3_d_x3 -0.040513889 -0.049182880  0.080805732  0.109181183  0.021806631
d_y1_d_x4 -0.007930577 -0.011250260  0.003911801  0.002169561 -0.052022044
d_y2_d_x4  0.014442151  0.010621134  0.007882583 -0.020488241  0.036151637
d_y3_d_x4 -0.070027317 -0.085339143  0.095136861 -0.148242529  0.256128452
                R_1_2        R_1_3       R_2_3
d_y1_d_x1 -0.08349633 -0.056206349  0.03636834
d_y2_d_x1 -0.10928986 -0.051654605  0.13271769
d_y3_d_x1  0.01894697 -0.019072980 -0.15893051
d_y1_d_x2 -0.03820549  0.142452268 -0.01115707
d_y2_d_x2  0.06922375 -0.007539687  0.14302524
d_y3_d_x2  0.07634048  0.162235178 -0.18202428
d_y1_d_x3  0.13553684 -0.098093987 -0.02292957
d_y2_d_x3 -0.12864709 -0.007258083 -0.17929639
d_y3_d_x3 -0.07852052 -0.165904327  0.26145752
d_y1_d_x4  0.12093740 -0.139832590 -0.01887321
d_y2_d_x4  0.09756085  0.058545761 -0.27440550
d_y3_d_x4 -0.03851549  0.042280994  0.31913361
> all.equal( summary( margEffCondObsV )[ , ], summary( margEffCondObsM )[ 1:36, ],
+    check.attributes = FALSE )
[1] TRUE
> summary( margEffCondObsM )[ -( 1:24 ), ]
                    Estimate  Std. error    z value   Pr(> z)
3: d_y1_d_x1     0.001391671 0.008532018  0.1631116 0.8704305
3: d_y2_d_x1     0.231969590 0.513273328  0.4519416 0.6513110
3: d_y3_d_x1    -0.116094853 0.371068155 -0.3128667 0.7543820
3: d_y1_d_x2    -0.018566681 0.103625684 -0.1791707 0.8578037
3: d_y2_d_x2     0.110991010 0.351961409  0.3153499 0.7524960
3: d_y3_d_x2    -0.137815080 0.402763024 -0.3421741 0.7322199
3: d_y1_d_x3     0.005969436 0.031299036  0.1907227 0.8487429
3: d_y2_d_x3    -0.149187187 0.299778630 -0.4976578 0.6187252
3: d_y3_d_x3     0.148226127 0.278638443  0.5319658 0.5947497
3: d_y1_d_x4    -0.004569507 0.023545629 -0.1940703 0.8461208
3: d_y2_d_x4    -0.199201826 0.550652280 -0.3617561 0.7175343
3: d_y3_d_x4     0.165548888 0.459695522  0.3601273 0.7187520
mean: d_y1_d_x1  0.189788204 0.376218960  0.5044621 0.6139367
mean: d_y2_d_x1  0.234169248 0.385716618  0.6071018 0.5437834
mean: d_y3_d_x1 -0.155663711 0.317142247 -0.4908325 0.6235449
mean: d_y1_d_x2 -0.145725401 0.269737944 -0.5402481 0.5890260
mean: d_y2_d_x2  0.195326359 0.359623741  0.5431409 0.5870328
mean: d_y3_d_x2 -0.148943376 0.433865673 -0.3432938 0.7313775
mean: d_y1_d_x3  0.198101158 0.213017232  0.9299771 0.3523829
mean: d_y2_d_x3 -0.352687253 0.268494872 -1.3135717 0.1889904
mean: d_y3_d_x3  0.208142914 0.358526971  0.5805502 0.5615436
mean: d_y1_d_x4 -0.145117866 0.245398940 -0.5913549 0.5542827
mean: d_y2_d_x4 -0.414040021 0.564298589 -0.7337251 0.4631163
mean: d_y3_d_x4  0.307681615 0.464209685  0.6628074 0.5074539
> 
> # for testing state of random number generator
> rnorm( 4 )
[1]  0.1870145  0.3303074 -1.2090711  1.9202205
> 
> 
