
R version 2.15.2 (2012-10-26) -- "Trick or Treat"
Copyright (C) 2012 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library( "mvProbit" )
Loading required package: mvtnorm
Loading required package: maxLik
Loading required package: miscTools
Loading required package: abind
> 
> ## generate a simulated data set
> set.seed( 123 )
> # number of observations
> nObs <- 10
> 
> # generate explanatory variables
> xMat <- cbind( 
+    const = rep( 1, nObs ),
+    x1 = as.numeric( rnorm( nObs ) > 0 ),
+    x2 = as.numeric( rnorm( nObs ) > 0 ),
+    x3 = rnorm( nObs ),
+    x4 = rnorm( nObs ) )
> 
> # model coefficients
> beta <- cbind( c(  0.8,  1.2, -1.0,  1.4, -0.8 ),
+                c( -0.6,  1.0,  0.6, -1.2, -1.6 ),
+                c(  0.5, -0.6, -0.7,  1.1,  1.2 ) )
> 
> # covariance matrix of error terms
> sigma <- miscTools::symMatrix( c( 1, 0.2, 0.4, 1, -0.1, 1 ) )
> 
> # all parameters in a vector
> allCoef <- c( c( beta ), sigma[ lower.tri( sigma ) ] )
> 
> # generate dependent variables
> yMatLin <- xMat %*% beta 
> yMat <- ( yMatLin + rmvnorm( nObs, sigma = sigma ) ) > 0
> colnames( yMat ) <- paste( "y", 1:3, sep = "" )
> # (yMatLin > 0 )== yMat
> 
> # unconditional expectations of dependent variables
> yExp <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ) )
> print( yExp )
           V1         V2         V3
1  0.02086892 0.72542879 0.19411024
2  0.39392340 0.76842941 0.21363900
3  0.12455645 0.78785603 0.19642672
4  0.23485392 0.68069956 0.29183903
5  0.67999333 0.43467562 0.57861599
6  0.02791996 0.97271018 0.03370023
7  0.95816411 0.18630028 0.78414444
8  0.85639266 0.24667543 0.72388317
9  0.06073636 0.96822363 0.03444764
10 0.99787991 0.06734972 0.92257845
> yExpA <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ) )
> all.equal( yExp, yExpA )
[1] TRUE
> yExp2 <- pnorm( yMatLin )
> all.equal( yExp, as.data.frame( yExp2 ) )
[1] TRUE
> 
> 
> # conditional expectations of dependent variables
> # (assuming that all other dependent variables are one)
> yExpCond <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz() )
> print( yExpCond )
           V1         V2        V3
1  0.07187274 0.83441226 0.5236193
2  0.66023348 0.77856855 0.3142187
3  0.29709617 0.83846471 0.3994699
4  0.44823829 0.72724816 0.4608874
5  0.84677186 0.44247741 0.6176247
6  0.13901197 0.98492618 0.1616680
7  0.99080074 0.17880919 0.7487862
8  0.95048885 0.24377749 0.7104822
9  0.24434181 0.97834900 0.1330594
10 0.99980223 0.06515097 0.8917154
> yExpCondA <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz() )
> all.equal( yExpCond, yExpCondA )
[1] TRUE
> yExpCond2 <- matrix( NA, nrow = nObs, ncol = ncol( yMat ) )
> for( i in 1:nObs ) {
+    for( k in 1:ncol( yMat ) ) {
+       set.seed( 123 )
+       numerator <- pmvnorm( upper = yMatLin[ i, ], sigma = sigma )
+       set.seed( 123 )
+       denominator <- pmvnorm( upper = yMatLin[ i, -k ], sigma = sigma[ -k, -k ] )
+       yExpCond2[ i, k ] <- numerator / denominator
+    }
+ }
> all.equal( yExpCond, as.data.frame( yExpCond2 ) )
[1] TRUE
> # now with explicitly specifying the algorithm
> yExpCond3 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz )
> all.equal( yExpCond, yExpCond3 )
[1] TRUE
> identical( yExpCond, yExpCond3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm
> yExpCond4 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = Miwa )
> all.equal( yExpCond, yExpCond4 )
[1] "Component 1: Mean relative difference: 4.435478e-05"
[2] "Component 2: Mean relative difference: 0.0001002261"
[3] "Component 3: Mean relative difference: 5.938566e-05"
> # now with integrals obtained by the Miwa algorithm, less precise
> yExpCond5 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = Miwa( steps = 32 ) )
> all.equal( yExpCond4, yExpCond5 )
[1] "Component 1: Mean relative difference: 1.014946e-05"
[2] "Component 2: Mean relative difference: 1.070674e-05"
[3] "Component 3: Mean relative difference: 9.286508e-06"
> # now with integrals obtained by the TVPACK algorithm
> yExpCond6 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = TVPACK )
> all.equal( yExpCond, yExpCond6 )
[1] "Component 1: Mean relative difference: 4.435948e-05"
[2] "Component 2: Mean relative difference: 0.0001002157"
[3] "Component 3: Mean relative difference: 5.938604e-05"
> # now with integrals obtained by the TVPACK algorithm, less precise
> yExpCond7 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = TVPACK( abseps = 0.5 ) )
> all.equal( yExpCond6, yExpCond7 )
[1] "Component 1: Mean relative difference: 0.03017515"
[2] "Component 2: Mean relative difference: 0.04273065"
[3] "Component 3: Mean relative difference: 0.0424229" 
> # now with integrals obtained by the GHK algorithm
> yExpCond8 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE )
> all.equal( yExpCond, yExpCond8 )
[1] "Component 1: Mean relative difference: 0.002370084"
[2] "Component 2: Mean relative difference: 0.005788364"
[3] "Component 3: Mean relative difference: 0.005552991"
> # now with integrals obtained by the GHK algorithm, less precise
> yExpCond9 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    nGHK = 100 )
> all.equal( yExpCond8, yExpCond9 )
[1] "Component 1: Mean relative difference: 0.089207"  
[2] "Component 2: Mean relative difference: 0.05716181"
[3] "Component 3: Mean relative difference: 0.0646556" 
> 
> 
> # conditional expectations of dependent variables
> # (assuming that all other dependent variables are as observed)
> yExpCondObs <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE, algorithm = GenzBretz() )
> print( yExpCondObs )
           y1         y2         y3
1  0.01446330 0.73515489 0.17239140
2  0.36422466 0.74444655 0.11898201
3  0.10197280 0.78808436 0.15158540
4  0.19744044 0.81305670 0.46088740
5  0.46887344 0.54232735 0.70688505
6  0.02469662 0.97269183 0.02935400
7  0.97137607 0.17880919 0.80927845
8  0.88954588 0.24377749 0.78280394
9  0.05566761 0.96764681 0.02721613
10 0.99859830 0.06515097 0.92560102
> yExpCondObsA <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE, algorithm = GenzBretz() )
> all.equal( yExpCondObs, yExpCondObsA )
[1] TRUE
> yExpCondObs2 <- matrix( NA, nrow = nObs, ncol = ncol( yMat ) )
> for( i in 1:nObs ){
+    for( k in 1:ncol( yMat ) ) {
+       ySign <- 2 * yMat[ i, ] - 1
+       ySign[ k ] <- 1
+       yLinTmp <- yMatLin[ i, ] * ySign
+       sigmaTmp <- diag( ySign ) %*% sigma %*% diag( ySign )
+       set.seed( 123 )
+       numerator <- pmvnorm( upper = yLinTmp, sigma = sigmaTmp )
+       set.seed( 123 )
+       denominator <- pmvnorm( upper = yLinTmp[ -k ], sigma = sigmaTmp[ -k, -k ] )
+       yExpCondObs2[ i, k ] <- numerator / denominator
+    }
+ }
> all.equal( yExpCondObs, as.data.frame( yExpCondObs2 ) )
[1] "Names: 3 string mismatches"
> # now with explicitly specifying the algorithm
> yExpCondObs3 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = GenzBretz )
> all.equal( yExpCondObs, yExpCondObs3 )
[1] TRUE
> identical( yExpCondObs, yExpCondObs3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm
> yExpCondObs4 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = Miwa )
> all.equal( yExpCondObs, yExpCondObs4 )
[1] "Component 1: Mean relative difference: 9.258897e-05"
[2] "Component 2: Mean relative difference: 5.029085e-05"
[3] "Component 3: Mean relative difference: 0.0001009532"
> # now with integrals obtained by the Miwa algorithm, less precise
> yExpCondObs5 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = Miwa( steps = 32 ) )
> all.equal( yExpCondObs4, yExpCondObs5 )
[1] "Component 1: Mean relative difference: 4.471818e-06"
[2] "Component 2: Mean relative difference: 3.954285e-06"
[3] "Component 3: Mean relative difference: 4.758699e-06"
> # now with integrals obtained by the TVPACK algorithm
> yExpCondObs6 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = TVPACK )
> all.equal( yExpCondObs, yExpCondObs6 )
[1] "Component 1: Mean relative difference: 9.258463e-05"
[2] "Component 2: Mean relative difference: 5.028616e-05"
[3] "Component 3: Mean relative difference: 0.0001009503"
> # now with integrals obtained by the TVPACK algorithm, less precise
> yExpCondObs7 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = TVPACK( abseps = 0.5 ) )
> all.equal( yExpCondObs6, yExpCondObs7 )
[1] "Component 1: Mean relative difference: 0.05130138"
[2] "Component 2: Mean relative difference: 0.04744355"
[3] "Component 3: Mean relative difference: 0.02586555"
> # now with integrals obtained by the GHK algorithm
> yExpCondObs8 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE )
> all.equal( yExpCondObs, yExpCondObs8 )
[1] "Component 1: Mean relative difference: 0.002650961"
[2] "Component 2: Mean relative difference: 0.002438056"
[3] "Component 3: Mean relative difference: 0.00287644" 
> # now with integrals obtained by the GHK algorithm, less precise
> yExpCondObs9 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, nGHK = 100 )
> all.equal( yExpCondObs8, yExpCondObs9 )
[1] "Component 1: Mean relative difference: 0.01486969"
[2] "Component 2: Mean relative difference: 0.0173985" 
[3] "Component 3: Mean relative difference: 0.01629308"
> 
> 
> # unconditional expectations of dependent variables by simulation
> nSim <- 10000
> ySim <- array( NA, c( nObs, ncol( yMat ), nSim ) )
> for( s in 1:nSim ) {
+    ySim[ , , s ] <- ( yMatLin + rmvnorm( nObs, sigma = sigma ) ) > 0
+ }
> yExpSim <- matrix( NA, nrow = nObs, ncol = ncol( yMat ) )
> for( i in 1:nObs ) {
+    yExpSim[ i, ] <- rowSums( ySim[ i, , ] ) / nSim
+ }
> print( yExpSim )
        [,1]   [,2]   [,3]
 [1,] 0.0192 0.7292 0.1974
 [2,] 0.4004 0.7599 0.2151
 [3,] 0.1185 0.7867 0.1978
 [4,] 0.2374 0.6843 0.2992
 [5,] 0.6817 0.4368 0.5779
 [6,] 0.0275 0.9709 0.0356
 [7,] 0.9580 0.1843 0.7872
 [8,] 0.8551 0.2551 0.7156
 [9,] 0.0624 0.9697 0.0332
[10,] 0.9984 0.0636 0.9231
> print( yExpSim - as.matrix( yExp ) )
                 V1           V2            V3
 [1,] -0.0016689243  0.003771207  0.0032897559
 [2,]  0.0064765951 -0.008529406  0.0014610027
 [3,] -0.0060564475 -0.001156035  0.0013732843
 [4,]  0.0025460841  0.003600442  0.0073609724
 [5,]  0.0017066657  0.002124382 -0.0007159879
 [6,] -0.0004199629 -0.001810177  0.0018997717
 [7,] -0.0001641098 -0.002000281  0.0030555602
 [8,] -0.0012926616  0.008424570 -0.0082831712
 [9,]  0.0016636425  0.001476372 -0.0012476431
[10,]  0.0005200914 -0.003749723  0.0005215455
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -0.07304505  0.71128820  0.08262612 -1.11816720
> 
> # calculating log likelihood value(s)
> logLikVal <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = GenzBretz() )
> print( logLikVal )
 [1] -0.53540368 -0.94155840 -0.55161623 -2.32656485 -2.25902218 -0.08645378
 [7] -0.46570791 -0.70386950 -0.12392314 -0.14927833
> logLikValA <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = GenzBretz() )
> all.equal( logLikVal, logLikValA )
[1] TRUE
> # now with explicitly specifying the algorithm
> logLikVal3 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = GenzBretz )
> all.equal( logLikVal, logLikVal3 )
[1] TRUE
> identical( logLikVal, logLikVal3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm
> logLikVal4 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = Miwa )
> all.equal( logLikVal, logLikVal4 )
[1] "Mean relative difference: 8.840686e-05"
> # now with integrals obtained by the Miwa algorithm, less precise
> logLikVal5 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = Miwa( steps = 32 ) )
> all.equal( logLikVal4, logLikVal5 )
[1] "Mean relative difference: 4.53253e-06"
> # now with integrals obtained by the TVPACK algorithm
> logLikVal6 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = TVPACK )
> all.equal( logLikVal, logLikVal6 )
[1] "Mean relative difference: 8.840067e-05"
> # now with integrals obtained by the TVPACK algorithm, less precise
> logLikVal7 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = TVPACK( abseps = 0.5 ) )
> all.equal( logLikVal6, logLikVal7 )
[1] "Mean relative difference: 0.05527167"
> # now with integrals obtained by the GHK algorithm
> logLikVal8 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ) )
> all.equal( logLikVal, logLikVal8 )
[1] "Mean relative difference: 0.002220837"
> # now with integrals obtained by the GHK algorithm, less precise
> logLikVal9 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    nGHK = 100 )
> all.equal( logLikVal8, logLikVal9 )
[1] "Mean relative difference: 0.01480876"
> 
> # calculating log likelihood value(s) with one-sided gradients
> logLikValGrad1 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    oneSidedGrad = TRUE, algorithm = GenzBretz() )
> print( logLikValGrad1 )
 [1] -0.53540368 -0.94155840 -0.55161623 -2.32656485 -2.25902218 -0.08645378
 [7] -0.46570791 -0.70386950 -0.12392314 -0.14927833
attr(,"gradient")
             b_1_0       b_1_1       b_1_2        b_1_3        b_1_4
 [1,] -0.039483841  0.00000000 -0.03948384  0.042161781 -0.016838445
 [2,] -0.620181812  0.00000000 -0.62018181  0.135184077  0.182997967
 [3,] -0.208837065 -0.20883706 -0.20883706  0.214267757 -0.186935416
 [4,]  1.493926468  1.49392647  1.49392647 -1.088909900  1.311866859
 [5,]  0.917269941  0.91726994  0.00000000 -0.573329733  0.753611631
 [6,] -0.060924129 -0.06092413 -0.06092413  0.102760321 -0.041954808
 [7,]  0.071223816  0.07122382  0.07122382  0.059670390  0.039452129
 [8,]  0.224807263  0.00000000  0.00000000  0.034479391 -0.013918202
 [9,] -0.121700445  0.00000000 -0.12170044  0.138511771  0.037235792
[10,]  0.004787314  0.00000000  0.00000000  0.006002406 -0.001821434
            b_2_0      b_2_1       b_2_2       b_2_3       b_2_4       b_3_0
 [1,]  0.44704993  0.0000000  0.44704993 -0.47737052  0.19065080 -0.31393241
 [2,]  0.43840786  0.0000000  0.43840786 -0.09556192 -0.12936166 -0.24068300
 [3,]  0.37076298  0.3707630  0.37076298 -0.38040447  0.33187946 -0.28829263
 [4,]  0.33970605  0.3397061  0.33970605 -0.24760876  0.29830726 -0.79100711
 [5,] -0.88642408 -0.8864241  0.00000000  0.55404986 -0.72826926 -1.24501533
 [6,]  0.06467570  0.0646757  0.06467570 -0.10908807  0.04453829 -0.07038947
 [7,] -0.31973919 -0.3197392 -0.31973919 -0.26787335 -0.17710918  0.34377267
 [8,] -0.41846140  0.0000000  0.00000000 -0.06418073  0.02590766  0.39132057
 [9,]  0.07517436  0.0000000  0.07517436 -0.08555872 -0.02300055 -0.06658594
[10,] -0.13608740  0.0000000  0.00000000 -0.17062841  0.05177731  0.15270486
            b_3_1       b_3_2      b_3_3       b_3_4         R_1_2        R_1_3
 [1,]  0.00000000 -0.31393241 0.33522447 -0.13388094 -0.0089522201  0.031648334
 [2,]  0.00000000 -0.24068300 0.05246286  0.07101869 -0.2109161679  0.242606606
 [3,] -0.28829263 -0.28829263 0.29578952 -0.25805813 -0.0489604013  0.118484255
 [4,] -0.79100711 -0.79100711 0.57655814 -0.69460983  0.5931737070 -0.947273870
 [5,] -1.24501533  0.00000000 0.77818347 -1.02288104 -0.6958962371 -0.901556092
 [6,] -0.07038947 -0.07038947 0.11872545 -0.04847302 -0.0020805972  0.015112572
 [7,]  0.34377267  0.34377267 0.28800829  0.19042175 -0.0121688749  0.055215326
 [8,]  0.00000000  0.00000000 0.06001806 -0.02422733 -0.0620710171  0.159552938
 [9,]  0.00000000 -0.06658594 0.07578392  0.02037281 -0.0038911043  0.024566263
[10,]  0.00000000  0.00000000 0.19146363 -0.05809977 -0.0003026085  0.003157443
             R_2_3
 [1,] -0.161540001
 [2,] -0.132532626
 [3,] -0.129196504
 [4,] -0.319508442
 [5,]  1.016442887
 [6,] -0.006549753
 [7,] -0.129101410
 [8,] -0.192174063
 [9,] -0.007700663
[10,] -0.026654477
> logLikValGrad1A <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ),
+    oneSidedGrad = TRUE, algorithm = GenzBretz() )
> all.equal( logLikValGrad1, logLikValGrad1A )
[1] TRUE
> 
> # calculating log likelihood value(s) with two-sided gradients
> logLikValGrad <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    returnGrad = TRUE, algorithm = GenzBretz() )
> print( logLikValGrad )
 [1] -0.53540368 -0.94155840 -0.55161623 -2.32656485 -2.25902218 -0.08645378
 [7] -0.46570791 -0.70386950 -0.12392314 -0.14927833
attr(,"gradient")
             b_1_0       b_1_1       b_1_2        b_1_3        b_1_4
 [1,] -0.039483794  0.00000000 -0.03948379  0.042161732 -0.016838426
 [2,] -0.620181508  0.00000000 -0.62018151  0.135184011  0.182997877
 [3,] -0.208836904 -0.20883690 -0.20883690  0.214267592 -0.186935271
 [4,]  1.493926912  1.49392691  1.49392691 -1.088910224  1.311867250
 [5,]  0.917270326  0.91727033  0.00000000 -0.573329973  0.753611947
 [6,] -0.060924066 -0.06092407 -0.06092407  0.102760215 -0.041954764
 [7,]  0.071223890  0.07122389  0.07122389  0.059670453  0.039452170
 [8,]  0.224807433  0.00000000  0.00000000  0.034479417 -0.013918213
 [9,] -0.121700338  0.00000000 -0.12170034  0.138511650  0.037235760
[10,]  0.004787322  0.00000000  0.00000000  0.006002416 -0.001821437
            b_2_0       b_2_1       b_2_2       b_2_3       b_2_4       b_3_0
 [1,]  0.44705018  0.00000000  0.44705018 -0.47737078  0.19065091 -0.31393221
 [2,]  0.43840810  0.00000000  0.43840810 -0.09556197 -0.12936173 -0.24068282
 [3,]  0.37076320  0.37076320  0.37076320 -0.38040469  0.33187965 -0.28829243
 [4,]  0.33970627  0.33970627  0.33970627 -0.24760892  0.29830745 -0.79100675
 [5,] -0.88642374 -0.88642374  0.00000000  0.55404964 -0.72826897 -1.24501491
 [6,]  0.06467576  0.06467576  0.06467576 -0.10908818  0.04453833 -0.07038940
 [7,] -0.31973900 -0.31973900 -0.31973900 -0.26787319 -0.17710907  0.34377288
 [8,] -0.41846117  0.00000000  0.00000000 -0.06418069  0.02590765  0.39132081
 [9,]  0.07517443  0.00000000  0.07517443 -0.08555880 -0.02300057 -0.06658587
[10,] -0.13608729  0.00000000  0.00000000 -0.17062827  0.05177727  0.15270498
           b_3_1       b_3_2      b_3_3       b_3_4         R_1_2        R_1_3
 [1,]  0.0000000 -0.31393221 0.33522426 -0.13388086 -0.0089522338  0.031648323
 [2,]  0.0000000 -0.24068282 0.05246282  0.07101864 -0.2109161817  0.242606594
 [3,] -0.2882924 -0.28829243 0.29578932 -0.25805795 -0.0489604438  0.118484204
 [4,] -0.7910068 -0.79100675 0.57655789 -0.69460952  0.5931740810 -0.947273091
 [5,] -1.2450149  0.00000000 0.77818321 -1.02288070 -0.6958959089 -0.901555435
 [6,] -0.0703894 -0.07038940 0.11872533 -0.04847297 -0.0020805999  0.015112555
 [7,]  0.3437729  0.34377288 0.28800846  0.19042187 -0.0121688918  0.055215307
 [8,]  0.0000000  0.00000000 0.06001809 -0.02422734 -0.0620710620  0.159552892
 [9,]  0.0000000 -0.06658587 0.07578384  0.02037279 -0.0038911139  0.024566240
[10,]  0.0000000  0.00000000 0.19146378 -0.05809982 -0.0003026085  0.003157441
             R_2_3
 [1,] -0.161540031
 [2,] -0.132532661
 [3,] -0.129196543
 [4,] -0.319508409
 [5,]  1.016443490
 [6,] -0.006549763
 [7,] -0.129101447
 [8,] -0.192174094
 [9,] -0.007700674
[10,] -0.026654501
> # now manually
> llTmp <- function( coef ) {
+    betaTmp <- coef[ 1:15 ]
+    sigmaTmp <- diag( 3 )
+    sigmaTmp[ lower.tri( sigmaTmp ) ] <- coef[ -(1:15) ]
+    sigmaTmp[ upper.tri( sigmaTmp ) ] <- t( sigmaTmp )[ upper.tri( sigmaTmp ) ]
+    result <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+       coef = betaTmp, sigma = sigmaTmp, 
+       data = as.data.frame( cbind( xMat, yMat ) ), algorithm = GenzBretz() )
+    return( result )
+ }
> logLikValGrad2 <- numericGradient( llTmp, allCoef )
> print( logLikValGrad2 )
              [,1]        [,2]        [,3]         [,4]         [,5]
 [1,] -0.039483794  0.00000000 -0.03948379  0.042161731 -0.016838426
 [2,] -0.620181508  0.00000000 -0.62018151  0.135184011  0.182997877
 [3,] -0.208836904 -0.20883690 -0.20883690  0.214267592 -0.186935271
 [4,]  1.493926912  1.49392691  1.49392691 -1.088910224  1.311867250
 [5,]  0.917270326  0.91727033  0.00000000 -0.573329973  0.753611947
 [6,] -0.060924066 -0.06092407 -0.06092407  0.102760215 -0.041954764
 [7,]  0.071223890  0.07122389  0.07122389  0.059670452  0.039452170
 [8,]  0.224807433  0.00000000  0.00000000  0.034479417 -0.013918213
 [9,] -0.121700338  0.00000000 -0.12170034  0.138511650  0.037235760
[10,]  0.004787322  0.00000000  0.00000000  0.006002416 -0.001821437
             [,6]        [,7]        [,8]        [,9]       [,10]       [,11]
 [1,]  0.44705018  0.00000000  0.44705018 -0.47737078  0.19065091 -0.31393221
 [2,]  0.43840810  0.00000000  0.43840810 -0.09556197 -0.12936173 -0.24068282
 [3,]  0.37076320  0.37076320  0.37076320 -0.38040469  0.33187965 -0.28829243
 [4,]  0.33970627  0.33970627  0.33970627 -0.24760892  0.29830745 -0.79100675
 [5,] -0.88642374 -0.88642374  0.00000000  0.55404964 -0.72826897 -1.24501491
 [6,]  0.06467576  0.06467576  0.06467576 -0.10908818  0.04453833 -0.07038940
 [7,] -0.31973900 -0.31973900 -0.31973900 -0.26787319 -0.17710907  0.34377288
 [8,] -0.41846117  0.00000000  0.00000000 -0.06418069  0.02590765  0.39132081
 [9,]  0.07517443  0.00000000  0.07517443 -0.08555880 -0.02300057 -0.06658587
[10,] -0.13608729  0.00000000  0.00000000 -0.17062827  0.05177727  0.15270498
           [,12]       [,13]      [,14]       [,15]         [,16]        [,17]
 [1,]  0.0000000 -0.31393221 0.33522426 -0.13388086 -0.0089522338  0.031648323
 [2,]  0.0000000 -0.24068282 0.05246282  0.07101864 -0.2109161817  0.242606594
 [3,] -0.2882924 -0.28829243 0.29578932 -0.25805795 -0.0489604438  0.118484204
 [4,] -0.7910068 -0.79100675 0.57655789 -0.69460952  0.5931740810 -0.947273091
 [5,] -1.2450149  0.00000000 0.77818321 -1.02288070 -0.6958959089 -0.901555435
 [6,] -0.0703894 -0.07038940 0.11872533 -0.04847297 -0.0020805999  0.015112555
 [7,]  0.3437729  0.34377288 0.28800846  0.19042187 -0.0121688918  0.055215307
 [8,]  0.0000000  0.00000000 0.06001809 -0.02422734 -0.0620710620  0.159552892
 [9,]  0.0000000 -0.06658587 0.07578384  0.02037279 -0.0038911139  0.024566240
[10,]  0.0000000  0.00000000 0.19146378 -0.05809982 -0.0003026085  0.003157441
             [,18]
 [1,] -0.161540031
 [2,] -0.132532661
 [3,] -0.129196543
 [4,] -0.319508409
 [5,]  1.016443490
 [6,] -0.006549763
 [7,] -0.129101447
 [8,] -0.192174094
 [9,] -0.007700674
[10,] -0.026654501
> attr( logLikValGrad1, "gradient" ) / logLikValGrad2 - 1
              b_1_0         b_1_1         b_1_2         b_1_3         b_1_4
 [1,]  1.172539e-06           NaN  1.172539e-06  1.181710e-06  1.170315e-06
 [2,]  4.897873e-07           NaN  4.897873e-07  4.911986e-07  4.892079e-07
 [3,]  7.713836e-07  7.713836e-07  7.713836e-07  7.719547e-07  7.711369e-07
 [4,] -2.975603e-07 -2.975603e-07 -2.975603e-07 -2.976685e-07 -2.977415e-07
 [5,] -4.197512e-07 -4.197512e-07           NaN -4.198659e-07 -4.199933e-07
 [6,]  1.031653e-06  1.031653e-06  1.031653e-06  1.032718e-06  1.035716e-06
 [7,] -1.042044e-06 -1.042044e-06 -1.042044e-06 -1.040062e-06 -1.040227e-06
 [8,] -7.585615e-07           NaN           NaN -7.634856e-07 -7.635966e-07
 [9,]  8.724623e-07           NaN  8.724623e-07  8.730429e-07  8.713498e-07
[10,] -1.594374e-06           NaN           NaN -1.571777e-06 -1.688243e-06
              b_2_0         b_2_1         b_2_2         b_2_3         b_2_4
 [1,] -5.386585e-07           NaN -5.386585e-07 -5.389699e-07 -5.417569e-07
 [2,] -5.535818e-07           NaN -5.535818e-07 -5.531841e-07 -5.526840e-07
 [3,] -5.878059e-07 -5.878059e-07 -5.878059e-07 -5.885737e-07 -5.886354e-07
 [4,] -6.248770e-07 -6.248770e-07 -6.248770e-07 -6.254775e-07 -6.254369e-07
 [5,]  3.892690e-07  3.892690e-07           NaN  3.894043e-07  3.889638e-07
 [6,] -9.982019e-07 -9.982019e-07 -9.982019e-07 -9.991444e-07 -9.971267e-07
 [7,]  6.218852e-07  6.218852e-07  6.218852e-07  6.219296e-07  6.215289e-07
 [8,]  5.603366e-07           NaN           NaN  5.626911e-07  5.500184e-07
 [9,] -9.667911e-07           NaN -9.667911e-07 -9.659973e-07 -9.578363e-07
[10,]  8.278502e-07           NaN           NaN  8.258985e-07  8.268165e-07
              b_3_0         b_3_1         b_3_2         b_3_3         b_3_4
 [1,]  6.344491e-07           NaN  6.344491e-07  6.347396e-07  6.330639e-07
 [2,]  7.477358e-07           NaN  7.477358e-07  7.429443e-07  7.472152e-07
 [3,]  6.758559e-07  6.758559e-07  6.758559e-07  6.760121e-07  6.770351e-07
 [4,]  4.496996e-07  4.496996e-07  4.496996e-07  4.498713e-07  4.499190e-07
 [5,]  3.374324e-07  3.374324e-07           NaN  3.370737e-07  3.369725e-07
 [6,]  9.966304e-07  9.966304e-07  9.966304e-07  9.962999e-07  1.000857e-06
 [7,] -6.145786e-07 -6.145786e-07 -6.145786e-07 -6.145651e-07 -6.149950e-07
 [8,] -5.974969e-07           NaN           NaN -5.994757e-07 -6.149497e-07
 [9,]  1.027925e-06           NaN  1.027925e-06  1.026799e-06  1.028447e-06
[10,] -8.015593e-07           NaN           NaN -8.031124e-07 -8.027310e-07
              R_1_2        R_1_3         R_2_3
 [1,] -1.537802e-06 3.402760e-07 -1.869386e-07
 [2,] -6.579764e-08 4.805039e-08 -2.672256e-07
 [3,] -8.684877e-07 4.254080e-07 -2.999057e-07
 [4,] -6.303767e-07 8.227581e-07  1.042435e-07
 [5,]  4.715963e-07 7.290201e-07 -5.933169e-07
 [6,] -1.280657e-06 1.112974e-06 -1.565810e-06
 [7,] -1.386765e-06 3.468485e-07 -2.889471e-07
 [8,] -7.226074e-07 2.908585e-07 -1.594500e-07
 [9,] -2.453775e-06 9.343661e-07 -1.432711e-06
[10,]  0.000000e+00 7.208235e-07 -9.101042e-07
> range( attr( logLikValGrad1, "gradient" ) / logLikValGrad2 - 1, na.rm = TRUE )
[1] -2.453775e-06  1.181710e-06
> attr( logLikValGrad1, "gradient" ) - logLikValGrad2
              b_1_0         b_1_1         b_1_2         b_1_3         b_1_4
 [1,] -4.629630e-08  0.000000e+00 -4.629630e-08  4.982294e-08 -1.970626e-08
 [2,] -3.037570e-07  0.000000e+00 -3.037570e-07  6.640219e-08  8.952400e-08
 [3,] -1.610934e-07 -1.610934e-07 -1.610934e-07  1.654049e-07 -1.441527e-07
 [4,] -4.445333e-07 -4.445333e-07 -4.445333e-07  3.241343e-07 -3.905973e-07
 [5,] -3.850253e-07 -3.850253e-07  0.000000e+00  2.407217e-07 -3.165120e-07
 [6,] -6.285250e-08 -6.285250e-08 -6.285250e-08  1.061224e-07 -4.345321e-08
 [7,] -7.421841e-08 -7.421841e-08 -7.421841e-08 -6.206098e-08 -4.103923e-08
 [8,] -1.705303e-07  0.000000e+00  0.000000e+00 -2.632454e-08  1.062790e-08
 [9,] -1.061790e-07  0.000000e+00 -1.061790e-07  1.209266e-07  3.244537e-08
[10,] -7.632783e-09  0.000000e+00  0.000000e+00 -9.434460e-09  3.075029e-09
              b_2_0         b_2_1         b_2_2         b_2_3         b_2_4
 [1,] -2.408074e-07  0.000000e+00 -2.408074e-07  2.572885e-07 -1.032864e-07
 [2,] -2.426948e-07  0.000000e+00 -2.426948e-07  5.286336e-08  7.149616e-08
 [3,] -2.179368e-07 -2.179368e-07 -2.179368e-07  2.238962e-07 -1.953561e-07
 [4,] -2.122746e-07 -2.122746e-07 -2.122746e-07  1.548738e-07 -1.865725e-07
 [5,] -3.450573e-07 -3.450573e-07  0.000000e+00  2.157493e-07 -2.832703e-07
 [6,] -6.455947e-08 -6.455947e-08 -6.455947e-08  1.089948e-07 -4.441036e-08
 [7,] -1.988409e-07 -1.988409e-07 -1.988409e-07 -1.665983e-07 -1.100784e-07
 [8,] -2.344791e-07  0.000000e+00  0.000000e+00 -3.611390e-08  1.424968e-08
 [9,] -7.267797e-08  0.000000e+00 -7.267797e-08  8.264957e-08  2.203078e-08
[10,] -1.126599e-07  0.000000e+00  0.000000e+00 -1.409216e-07  4.281030e-08
              b_3_0         b_3_1         b_3_2         b_3_3         b_3_4
 [1,] -1.991740e-07  0.000000e+00 -1.991740e-07  2.127801e-07 -8.475514e-08
 [2,] -1.799672e-07  0.000000e+00 -1.799672e-07  3.897695e-08  5.306621e-08
 [3,] -1.948441e-07 -1.948441e-07 -1.948441e-07  1.999572e-07 -1.747143e-07
 [4,] -3.557155e-07 -3.557155e-07 -3.557155e-07  2.593768e-07 -3.125180e-07
 [5,] -4.201084e-07 -4.201084e-07  0.000000e+00  2.623051e-07 -3.446826e-07
 [6,] -7.015222e-08 -7.015222e-08 -7.015222e-08  1.182860e-07 -4.851452e-08
 [7,] -2.112754e-07 -2.112754e-07 -2.112754e-07 -1.769999e-07 -1.171085e-07
 [8,] -2.338130e-07  0.000000e+00  0.000000e+00 -3.597939e-08  1.489860e-08
 [9,] -6.844525e-08  0.000000e+00 -6.844525e-08  7.781475e-08  2.095234e-08
[10,] -1.224021e-07  0.000000e+00  0.000000e+00 -1.537669e-07  4.663853e-08
              R_1_2         R_1_3         R_2_3
 [1,]  1.376677e-08  1.076916e-08  3.019807e-08
 [2,]  1.387779e-08  1.165734e-08  3.541611e-08
 [3,]  4.252154e-08  5.040413e-08  3.874678e-08
 [4,] -3.739231e-07 -7.793766e-07 -3.330669e-08
 [5,] -3.281819e-07 -6.572520e-07 -6.030731e-07
 [6,]  2.664535e-09  1.681988e-08  1.025569e-08
 [7,]  1.687539e-08  1.915135e-08  3.730349e-08
 [8,]  4.485301e-08  4.640732e-08  3.064216e-08
 [9,]  9.547918e-09  2.295386e-08  1.103284e-08
[10,]  0.000000e+00  2.275957e-09  2.425837e-08
> range( attr( logLikValGrad1, "gradient" ) - logLikValGrad2 )
[1] -7.793766e-07  3.241343e-07
> attr( logLikValGrad1, "gradient" ) / logLikValGrad2 - 1
              b_1_0         b_1_1         b_1_2         b_1_3         b_1_4
 [1,]  1.172539e-06           NaN  1.172539e-06  1.181710e-06  1.170315e-06
 [2,]  4.897873e-07           NaN  4.897873e-07  4.911986e-07  4.892079e-07
 [3,]  7.713836e-07  7.713836e-07  7.713836e-07  7.719547e-07  7.711369e-07
 [4,] -2.975603e-07 -2.975603e-07 -2.975603e-07 -2.976685e-07 -2.977415e-07
 [5,] -4.197512e-07 -4.197512e-07           NaN -4.198659e-07 -4.199933e-07
 [6,]  1.031653e-06  1.031653e-06  1.031653e-06  1.032718e-06  1.035716e-06
 [7,] -1.042044e-06 -1.042044e-06 -1.042044e-06 -1.040062e-06 -1.040227e-06
 [8,] -7.585615e-07           NaN           NaN -7.634856e-07 -7.635966e-07
 [9,]  8.724623e-07           NaN  8.724623e-07  8.730429e-07  8.713498e-07
[10,] -1.594374e-06           NaN           NaN -1.571777e-06 -1.688243e-06
              b_2_0         b_2_1         b_2_2         b_2_3         b_2_4
 [1,] -5.386585e-07           NaN -5.386585e-07 -5.389699e-07 -5.417569e-07
 [2,] -5.535818e-07           NaN -5.535818e-07 -5.531841e-07 -5.526840e-07
 [3,] -5.878059e-07 -5.878059e-07 -5.878059e-07 -5.885737e-07 -5.886354e-07
 [4,] -6.248770e-07 -6.248770e-07 -6.248770e-07 -6.254775e-07 -6.254369e-07
 [5,]  3.892690e-07  3.892690e-07           NaN  3.894043e-07  3.889638e-07
 [6,] -9.982019e-07 -9.982019e-07 -9.982019e-07 -9.991444e-07 -9.971267e-07
 [7,]  6.218852e-07  6.218852e-07  6.218852e-07  6.219296e-07  6.215289e-07
 [8,]  5.603366e-07           NaN           NaN  5.626911e-07  5.500184e-07
 [9,] -9.667911e-07           NaN -9.667911e-07 -9.659973e-07 -9.578363e-07
[10,]  8.278502e-07           NaN           NaN  8.258985e-07  8.268165e-07
              b_3_0         b_3_1         b_3_2         b_3_3         b_3_4
 [1,]  6.344491e-07           NaN  6.344491e-07  6.347396e-07  6.330639e-07
 [2,]  7.477358e-07           NaN  7.477358e-07  7.429443e-07  7.472152e-07
 [3,]  6.758559e-07  6.758559e-07  6.758559e-07  6.760121e-07  6.770351e-07
 [4,]  4.496996e-07  4.496996e-07  4.496996e-07  4.498713e-07  4.499190e-07
 [5,]  3.374324e-07  3.374324e-07           NaN  3.370737e-07  3.369725e-07
 [6,]  9.966304e-07  9.966304e-07  9.966304e-07  9.962999e-07  1.000857e-06
 [7,] -6.145786e-07 -6.145786e-07 -6.145786e-07 -6.145651e-07 -6.149950e-07
 [8,] -5.974969e-07           NaN           NaN -5.994757e-07 -6.149497e-07
 [9,]  1.027925e-06           NaN  1.027925e-06  1.026799e-06  1.028447e-06
[10,] -8.015593e-07           NaN           NaN -8.031124e-07 -8.027310e-07
              R_1_2        R_1_3         R_2_3
 [1,] -1.537802e-06 3.402760e-07 -1.869386e-07
 [2,] -6.579764e-08 4.805039e-08 -2.672256e-07
 [3,] -8.684877e-07 4.254080e-07 -2.999057e-07
 [4,] -6.303767e-07 8.227581e-07  1.042435e-07
 [5,]  4.715963e-07 7.290201e-07 -5.933169e-07
 [6,] -1.280657e-06 1.112974e-06 -1.565810e-06
 [7,] -1.386765e-06 3.468485e-07 -2.889471e-07
 [8,] -7.226074e-07 2.908585e-07 -1.594500e-07
 [9,] -2.453775e-06 9.343661e-07 -1.432711e-06
[10,]  0.000000e+00 7.208235e-07 -9.101042e-07
> range( attr( logLikValGrad, "gradient" ) / logLikValGrad2 - 1, na.rm = TRUE )
[1] -9.386900e-08  2.259713e-08
> attr( logLikValGrad, "gradient" ) - logLikValGrad2
      b_1_0 b_1_1 b_1_2         b_1_3         b_1_4 b_2_0 b_2_1 b_2_2
 [1,]     0     0     0  3.866577e-10  3.745312e-11     0     0     0
 [2,]     0     0     0  1.907821e-10 -1.060298e-10     0     0     0
 [3,]     0     0     0  1.223789e-10  4.611900e-11     0     0     0
 [4,]     0     0     0  1.178655e-10 -2.377472e-10     0     0     0
 [5,]     0     0     0  6.575163e-11 -1.824645e-10     0     0     0
 [6,]     0     0     0  1.094737e-10 -1.704445e-10     0     0     0
 [7,]     0     0     0  1.182429e-10  7.165793e-11     0     0     0
 [8,]     0     0     0 -1.697814e-10  7.008022e-11     0     0     0
 [9,]     0     0     0  8.041684e-11 -4.142313e-11     0     0     0
[10,]     0     0     0  1.356374e-10  1.709765e-10     0     0     0
              b_2_3         b_2_4 b_3_0 b_3_1 b_3_2         b_3_3         b_3_4
 [1,]  1.486793e-10 -5.907174e-10     0     0     0  9.739193e-11  1.854486e-10
 [2,] -3.800472e-11 -1.161413e-10     0     0     0 -2.513731e-10 -3.696585e-11
 [3,]  2.920912e-10 -2.752966e-10     0     0     0  4.620376e-11 -3.043096e-10
 [4,]  1.486723e-10 -1.670018e-10     0     0     0  9.897294e-11 -1.523540e-10
 [5,]  7.493595e-11  2.222942e-10     0     0     0 -2.791867e-10  4.704919e-10
 [6,]  1.028245e-10  4.788751e-11     0     0     0 -3.923527e-11 -2.048743e-10
 [7,] -1.190298e-11  6.309231e-11     0     0     0  3.886502e-12 -7.929002e-11
 [8,] -1.511131e-10 -2.673207e-10     0     0     0 -1.187615e-10  4.228351e-10
 [9,] -6.792164e-11 -2.059669e-10     0     0     0 -8.531933e-11  1.064933e-11
[10,]  3.330139e-10 -5.351829e-11     0     0     0 -2.973679e-10  6.808094e-11
      R_1_2 R_1_3 R_2_3
 [1,]     0     0     0
 [2,]     0     0     0
 [3,]     0     0     0
 [4,]     0     0     0
 [5,]     0     0     0
 [6,]     0     0     0
 [7,]     0     0     0
 [8,]     0     0     0
 [9,]     0     0     0
[10,]     0     0     0
> range( attr( logLikValGrad, "gradient" ) - logLikValGrad2 )
[1] -5.907174e-10  4.704919e-10
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -1.3162070  0.7625245  0.9035873  1.6774175
> 
> # calculating marginal effects, unconditional
> margEffUnc <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ) )
> print( margEffUnc )
     d_y1_d_x1  d_y2_d_x1   d_y3_d_x1   d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.180673491 0.21966598 -0.12235589 -0.12920309 0.22580951 -0.24120841
2  0.430121958 0.19008353 -0.13195878 -0.37365413 0.21525553 -0.24897191
3  0.115232772 0.36750507 -0.20314566 -0.31483718 0.20898573 -0.24219913
4  0.207611034 0.38276287 -0.22888859 -0.37427350 0.23255246 -0.26855955
5  0.448006648 0.31256137 -0.20905150 -0.38274109 0.23373092 -0.27065767
6  0.026991730 0.15092034 -0.07583674 -0.15288996 0.06575970 -0.09574988
7  0.256300597 0.15702898 -0.13302286 -0.03866694 0.11839993 -0.14725130
8  0.131828020 0.37694792 -0.22611070 -0.33077755 0.21945964 -0.26592681
9  0.302950354 0.02962659 -0.02666829 -0.23089623 0.07290773 -0.09709985
10 0.002095525 0.24265946 -0.12793733 -0.02934265 0.11782358 -0.15753170
     d_y1_d_x3   d_y2_d_x3  d_y3_d_x3    d_y1_d_x4  d_y2_d_x4  d_y3_d_x4
1  0.070272979 -0.40009837 0.30243692 -0.040155988 -0.5334645 0.32993118
2  0.538657270 -0.36576535 0.32022424 -0.307804155 -0.4876871 0.34933554
3  0.287479936 -0.34790671 0.30462485 -0.164274249 -0.4638756 0.33231802
4  0.430074036 -0.42873970 0.37764850 -0.245756592 -0.5716529 0.41198018
5  0.500659694 -0.47229842 0.43028800 -0.286091254 -0.6297312 0.46940509
6  0.089736371 -0.07546714 0.08239434 -0.051277926 -0.1006229 0.08988474
7  0.125115932 -0.32171038 0.32215058 -0.071494818 -0.4289472 0.35143700
8  0.317022613 -0.37862010 0.36777139 -0.181155779 -0.5048268 0.40120515
9  0.168371792 -0.08563215 0.08389399 -0.096212453 -0.1141762 0.09152071
10 0.009358606 -0.15639629 0.15952285 -0.005347775 -0.2085284 0.17402492
> print( attr( margEffUnc, "vcov" )[ 1:3, , ] )
, , d_y1_d_x1

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1   d_y1_d_x2 d_y2_d_x2 d_y3_d_x2   d_y1_d_x3
1 0.2564698         0         0 -0.08661131         0         0  0.09743039
2 0.1008447         0         0 -0.05986199         0         0 -0.02843850
3 0.1674119         0         0 -0.09902071         0         0  0.26025246
  d_y2_d_x3 d_y3_d_x3   d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0 -0.05780532         0         0
2         0         0  0.03660826         0         0
3         0         0 -0.13728324         0         0

, , d_y2_d_x1

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2   d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0 0.1765481         0         0 -0.04029736         0         0
2         0 0.1075070         0         0 -0.04364529         0         0
3         0 0.1234019         0         0 -0.02945168         0         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1 -0.097801103         0         0 -0.26755261         0
2 -0.109438030         0         0 -0.14562511         0
3  0.002346862         0         0 -0.06316801         0

, , d_y3_d_x1

  d_y1_d_x1 d_y2_d_x1  d_y3_d_x1 d_y1_d_x2 d_y2_d_x2     d_y3_d_x2 d_y1_d_x3
1         0         0 0.08208219         0         0  0.0001099928         0
2         0         0 0.06470109         0         0 -0.0239228542         0
3         0         0 0.12273407         0         0 -0.0261632905         0
  d_y2_d_x3    d_y3_d_x3 d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1         0 -0.079158382         0         0 -0.14677670
2         0 -0.067116460         0         0 -0.07088185
3         0 -0.006515311         0         0 -0.06808212

, , d_y1_d_x2

    d_y1_d_x1 d_y2_d_x1 d_y3_d_x1  d_y1_d_x2 d_y2_d_x2 d_y3_d_x2   d_y1_d_x3
1 -0.08661131         0         0 0.08031764         0         0 -0.04381692
2 -0.05986199         0         0 0.15517620         0         0  0.06216022
3 -0.09902071         0         0 0.17981312         0         0 -0.13346812
  d_y2_d_x3 d_y3_d_x3   d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0  0.02672620         0         0
2         0         0 -0.04832780         0         0
3         0         0  0.06428241         0         0

, , d_y2_d_x2

  d_y1_d_x1   d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0 -0.04029736         0         0 0.1211364         0         0
2         0 -0.04364529         0         0 0.1022165         0         0
3         0 -0.02945168         0         0 0.1235233         0         0
    d_y2_d_x3 d_y3_d_x3 d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1 0.066791094         0         0  0.04863166         0
2 0.060255068         0         0  0.08046264         0
3 0.002278392         0         0 -0.06336149         0

, , d_y3_d_x2

  d_y1_d_x1 d_y2_d_x1     d_y3_d_x1 d_y1_d_x2 d_y2_d_x2  d_y3_d_x2 d_y1_d_x3
1         0         0  0.0001099928         0         0 0.10833600         0
2         0         0 -0.0239228542         0         0 0.09751318         0
3         0         0 -0.0261632905         0         0 0.12970073         0
  d_y2_d_x3   d_y3_d_x3 d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1         0  0.03466714         0         0 -0.01413605
2         0  0.05013561         0         0  0.05646223
3         0 -0.01225009         0         0 -0.07878877

, , d_y1_d_x3

    d_y1_d_x1 d_y2_d_x1 d_y3_d_x1   d_y1_d_x2 d_y2_d_x2 d_y3_d_x2  d_y1_d_x3
1  0.09743039         0         0 -0.04381692         0         0 0.05517381
2 -0.02843850         0         0  0.06216022         0         0 0.16854587
3  0.26025246         0         0 -0.13346812         0         0 0.43541851
  d_y2_d_x3 d_y3_d_x3   d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0 -0.03140734         0         0
2         0         0 -0.03514956         0         0
3         0         0 -0.20370618         0         0

, , d_y2_d_x3

  d_y1_d_x1    d_y2_d_x1 d_y3_d_x1 d_y1_d_x2   d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0 -0.097801103         0         0 0.066791094         0         0
2         0 -0.109438030         0         0 0.060255068         0         0
3         0  0.002346862         0         0 0.002278392         0         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1 0.1313755         0         0 0.1746719         0
2 0.2110680         0         0 0.1571977         0
3 0.2938075         0         0 0.4621366         0

, , d_y3_d_x3

  d_y1_d_x1 d_y2_d_x1    d_y3_d_x1 d_y1_d_x2 d_y2_d_x2   d_y3_d_x2 d_y1_d_x3
1         0         0 -0.079158382         0         0  0.03466714         0
2         0         0 -0.067116460         0         0  0.05013561         0
3         0         0 -0.006515311         0         0 -0.01225009         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0 0.1485937         0         0 0.1937855
2         0 0.1903930         0         0 0.1110189
3         0 0.2574540         0         0 0.3424057

, , d_y1_d_x4

    d_y1_d_x1 d_y2_d_x1 d_y3_d_x1   d_y1_d_x2 d_y2_d_x2 d_y3_d_x2   d_y1_d_x3
1 -0.05780532         0         0  0.02672620         0         0 -0.03140734
2  0.03660826         0         0 -0.04832780         0         0 -0.03514956
3 -0.13728324         0         0  0.06428241         0         0 -0.20370618
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0 0.0212204         0         0
2         0         0 0.1815106         0         0
3         0         0 0.1465636         0         0

, , d_y2_d_x4

  d_y1_d_x1   d_y2_d_x1 d_y3_d_x1 d_y1_d_x2   d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0 -0.26755261         0         0  0.04863166         0         0
2         0 -0.14562511         0         0  0.08046264         0         0
3         0 -0.06316801         0         0 -0.06336149         0         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1 0.1746719         0         0 0.5410290         0
2 0.1571977         0         0 0.3020335         0
3 0.4621366         0         0 0.9435256         0

, , d_y3_d_x4

  d_y1_d_x1 d_y2_d_x1   d_y3_d_x1 d_y1_d_x2 d_y2_d_x2   d_y3_d_x2 d_y1_d_x3
1         0         0 -0.14677670         0         0 -0.01413605         0
2         0         0 -0.07088185         0         0  0.05646223         0
3         0         0 -0.06808212         0         0 -0.07878877         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0 0.1937855         0         0 0.4115219
2         0 0.1110189         0         0 0.2012421
3         0 0.3424057         0         0 0.6086354

> print( drop( attr( margEffUnc, "vcov" )[ nObs, , ] ) )
              d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2   d_y2_d_x2
d_y1_d_x1  0.0001176217  0.00000000  0.00000000 -0.001145678  0.00000000
d_y2_d_x1  0.0000000000  0.25892667  0.00000000  0.000000000  0.08265483
d_y3_d_x1  0.0000000000  0.00000000  0.13368957  0.000000000  0.00000000
d_y1_d_x2 -0.0011456777  0.00000000  0.00000000  0.016169819  0.00000000
d_y2_d_x2  0.0000000000  0.08265483  0.00000000  0.000000000  0.12214353
d_y3_d_x2  0.0000000000  0.00000000  0.06144675  0.000000000  0.00000000
d_y1_d_x3  0.0004233938  0.00000000  0.00000000 -0.004124394  0.00000000
d_y2_d_x3  0.0000000000 -0.10506166  0.00000000  0.000000000 -0.06458309
d_y3_d_x3  0.0000000000  0.00000000 -0.06059759  0.000000000  0.00000000
d_y1_d_x4 -0.0002567171  0.00000000  0.00000000  0.002500751  0.00000000
d_y2_d_x4  0.0000000000 -0.19958499  0.00000000  0.000000000 -0.12268809
d_y3_d_x4  0.0000000000  0.00000000 -0.10144935  0.000000000  0.00000000
            d_y3_d_x2     d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4
d_y1_d_x1  0.00000000  0.0004233938  0.00000000  0.00000000 -0.0002567171
d_y2_d_x1  0.00000000  0.0000000000 -0.10506166  0.00000000  0.0000000000
d_y3_d_x1  0.06144675  0.0000000000  0.00000000 -0.06059759  0.0000000000
d_y1_d_x2  0.00000000 -0.0041243944  0.00000000  0.00000000  0.0025007512
d_y2_d_x2  0.00000000  0.0000000000 -0.06458309  0.00000000  0.0000000000
d_y3_d_x2  0.16593068  0.0000000000  0.00000000 -0.07052900  0.0000000000
d_y1_d_x3  0.00000000  0.0015429393  0.00000000  0.00000000 -0.0009158142
d_y2_d_x3  0.00000000  0.0000000000  0.08926007  0.00000000  0.0000000000
d_y3_d_x3 -0.07052900  0.0000000000  0.00000000  0.07841036  0.0000000000
d_y1_d_x4  0.00000000 -0.0009158142  0.00000000  0.00000000  0.0006021045
d_y2_d_x4  0.00000000  0.0000000000  0.15893909  0.00000000  0.0000000000
d_y3_d_x4 -0.11807602  0.0000000000  0.00000000  0.12013414  0.0000000000
           d_y2_d_x4  d_y3_d_x4
d_y1_d_x1  0.0000000  0.0000000
d_y2_d_x1 -0.1995850  0.0000000
d_y3_d_x1  0.0000000 -0.1014494
d_y1_d_x2  0.0000000  0.0000000
d_y2_d_x2 -0.1226881  0.0000000
d_y3_d_x2  0.0000000 -0.1180760
d_y1_d_x3  0.0000000  0.0000000
d_y2_d_x3  0.1589391  0.0000000
d_y3_d_x3  0.0000000  0.1201341
d_y1_d_x4  0.0000000  0.0000000
d_y2_d_x4  0.3123363  0.0000000
d_y3_d_x4  0.0000000  0.2148557
> summary( margEffUnc )
               Estimate Std. error z value Pr(> z)  
1: d_y1_d_x1   0.180673   0.506428   0.357  0.7213  
1: d_y2_d_x1   0.219666   0.420176   0.523  0.6011  
1: d_y3_d_x1  -0.122356   0.286500  -0.427  0.6693  
1: d_y1_d_x2  -0.129203   0.283404  -0.456  0.6485  
1: d_y2_d_x2   0.225810   0.348047   0.649  0.5165  
1: d_y3_d_x2  -0.241208   0.329144  -0.733  0.4637  
1: d_y1_d_x3   0.070273   0.234891   0.299  0.7648  
1: d_y2_d_x3  -0.400098   0.362458  -1.104  0.2697  
1: d_y3_d_x3   0.302437   0.385478   0.785  0.4327  
1: d_y1_d_x4  -0.040156   0.145672  -0.276  0.7828  
1: d_y2_d_x4  -0.533464   0.735547  -0.725  0.4683  
1: d_y3_d_x4   0.329931   0.641500   0.514  0.6070  
2: d_y1_d_x1   0.430122   0.317561   1.354  0.1756  
2: d_y2_d_x1   0.190084   0.327883   0.580  0.5621  
2: d_y3_d_x1  -0.131959   0.254364  -0.519  0.6039  
2: d_y1_d_x2  -0.373654   0.393924  -0.949  0.3429  
2: d_y2_d_x2   0.215256   0.319713   0.673  0.5008  
2: d_y3_d_x2  -0.248972   0.312271  -0.797  0.4253  
2: d_y1_d_x3   0.538657   0.410543   1.312  0.1895  
2: d_y2_d_x3  -0.365765   0.459421  -0.796  0.4259  
2: d_y3_d_x3   0.320224   0.436340   0.734  0.4630  
2: d_y1_d_x4  -0.307804   0.426041  -0.722  0.4700  
2: d_y2_d_x4  -0.487687   0.549576  -0.887  0.3749  
2: d_y3_d_x4   0.349336   0.448600   0.779  0.4361  
3: d_y1_d_x1   0.115233   0.409160   0.282  0.7782  
3: d_y2_d_x1   0.367505   0.351286   1.046  0.2955  
3: d_y3_d_x1  -0.203146   0.350334  -0.580  0.5620  
3: d_y1_d_x2  -0.314837   0.424044  -0.742  0.4578  
3: d_y2_d_x2   0.208986   0.351459   0.595  0.5521  
3: d_y3_d_x2  -0.242199   0.360140  -0.673  0.5013  
3: d_y1_d_x3   0.287480   0.659862   0.436  0.6631  
3: d_y2_d_x3  -0.347907   0.542040  -0.642  0.5210  
3: d_y3_d_x3   0.304625   0.507399   0.600  0.5483  
3: d_y1_d_x4  -0.164274   0.382836  -0.429  0.6679  
3: d_y2_d_x4  -0.463876   0.971352  -0.478  0.6330  
3: d_y3_d_x4   0.332318   0.780151   0.426  0.6701  
4: d_y1_d_x1   0.207611   0.540019   0.384  0.7006  
4: d_y2_d_x1   0.382763   0.357810   1.070  0.2847  
4: d_y3_d_x1  -0.228889   0.357614  -0.640  0.5221  
4: d_y1_d_x2  -0.374273   0.337358  -1.109  0.2672  
4: d_y2_d_x2   0.232552   0.363994   0.639  0.5229  
4: d_y3_d_x2  -0.268560   0.355628  -0.755  0.4501  
4: d_y1_d_x3   0.430074   0.609132   0.706  0.4802  
4: d_y2_d_x3  -0.428740   0.443667  -0.966  0.3339  
4: d_y3_d_x3   0.377649   0.445647   0.847  0.3968  
4: d_y1_d_x4  -0.245757   0.366506  -0.671  0.5025  
4: d_y2_d_x4  -0.571653   0.778475  -0.734  0.4628  
4: d_y3_d_x4   0.411980   0.688013   0.599  0.5493  
5: d_y1_d_x1   0.448007   0.365489   1.226  0.2203  
5: d_y2_d_x1   0.312561   0.479915   0.651  0.5149  
5: d_y3_d_x1  -0.209051   0.417286  -0.501  0.6164  
5: d_y1_d_x2  -0.382741   0.346813  -1.104  0.2698  
5: d_y2_d_x2   0.233731   0.366815   0.637  0.5240  
5: d_y3_d_x2  -0.270658   0.358474  -0.755  0.4502  
5: d_y1_d_x3   0.500660   0.633149   0.791  0.4291  
5: d_y2_d_x3  -0.472298   0.460163  -1.026  0.3047  
5: d_y3_d_x3   0.430288   0.465925   0.924  0.3557  
5: d_y1_d_x4  -0.286091   0.511348  -0.559  0.5758  
5: d_y2_d_x4  -0.629731   0.347755  -1.811  0.0702 .
5: d_y3_d_x4   0.469405   0.346199   1.356  0.1751  
6: d_y1_d_x1   0.026992   0.154501   0.175  0.8613  
6: d_y2_d_x1   0.150920   0.460658   0.328  0.7432  
6: d_y3_d_x1  -0.075837   0.270198  -0.281  0.7790  
6: d_y1_d_x2  -0.152890   0.463512  -0.330  0.7415  
6: d_y2_d_x2   0.065760   0.246988   0.266  0.7900  
6: d_y3_d_x2  -0.095750   0.322528  -0.297  0.7666  
6: d_y1_d_x3   0.089736   0.391254   0.229  0.8186  
6: d_y2_d_x3  -0.075467   0.325988  -0.232  0.8169  
6: d_y3_d_x3   0.082394   0.333238   0.247  0.8047  
6: d_y1_d_x4  -0.051278   0.237088  -0.216  0.8288  
6: d_y2_d_x4  -0.100623   0.507245  -0.198  0.8428  
6: d_y3_d_x4   0.089885   0.439736   0.204  0.8380  
7: d_y1_d_x1   0.256301   0.455234   0.563  0.5734  
7: d_y2_d_x1   0.157029   0.440389   0.357  0.7214  
7: d_y3_d_x1  -0.133023   0.380718  -0.349  0.7268  
7: d_y1_d_x2  -0.038667   0.164698  -0.235  0.8144  
7: d_y2_d_x2   0.118400   0.358181   0.331  0.7410  
7: d_y3_d_x2  -0.147251   0.404268  -0.364  0.7157  
7: d_y1_d_x3   0.125116   0.403976   0.310  0.7568  
7: d_y2_d_x3  -0.321710   0.522218  -0.616  0.5379  
7: d_y3_d_x3   0.322151   0.467820   0.689  0.4911  
7: d_y1_d_x4  -0.071495   0.285471  -0.250  0.8022  
7: d_y2_d_x4  -0.428947   0.737887  -0.581  0.5610  
7: d_y3_d_x4   0.351437   0.549872   0.639  0.5227  
8: d_y1_d_x1   0.131828   0.200736   0.657  0.5114  
8: d_y2_d_x1   0.376948   0.385153   0.979  0.3277  
8: d_y3_d_x1  -0.226111   0.404274  -0.559  0.5760  
8: d_y1_d_x2  -0.330778   0.434486  -0.761  0.4465  
8: d_y2_d_x2   0.219460   0.406098   0.540  0.5889  
8: d_y3_d_x2  -0.265927   0.401733  -0.662  0.5080  
8: d_y1_d_x3   0.317023   0.380622   0.833  0.4049  
8: d_y2_d_x3  -0.378620   0.378829  -0.999  0.3176  
8: d_y3_d_x3   0.367771   0.372295   0.988  0.3232  
8: d_y1_d_x4  -0.181156   0.289976  -0.625  0.5321  
8: d_y2_d_x4  -0.504827   0.485713  -1.039  0.2986  
8: d_y3_d_x4   0.401205   0.424522   0.945  0.3446  
9: d_y1_d_x1   0.302950   0.601313   0.504  0.6144  
9: d_y2_d_x1   0.029627   0.119098   0.249  0.8035  
9: d_y3_d_x1  -0.026668   0.103269  -0.258  0.7962  
9: d_y1_d_x2  -0.230896   0.364964  -0.633  0.5270  
9: d_y2_d_x2   0.072908   0.184501   0.395  0.6927  
9: d_y3_d_x2  -0.097100   0.225089  -0.431  0.6662  
9: d_y1_d_x3   0.168372   0.416487   0.404  0.6860  
9: d_y2_d_x3  -0.085632   0.254656  -0.336  0.7367  
9: d_y3_d_x3   0.083894   0.241357   0.348  0.7281  
9: d_y1_d_x4  -0.096212   0.317272  -0.303  0.7617  
9: d_y2_d_x4  -0.114176   0.384669  -0.297  0.7666  
9: d_y3_d_x4   0.091521   0.303278   0.302  0.7628  
10: d_y1_d_x1  0.002096   0.010845   0.193  0.8468  
10: d_y2_d_x1  0.242659   0.508848   0.477  0.6334  
10: d_y3_d_x1 -0.127937   0.365636  -0.350  0.7264  
10: d_y1_d_x2 -0.029343   0.127161  -0.231  0.8175  
10: d_y2_d_x2  0.117824   0.349490   0.337  0.7360  
10: d_y3_d_x2 -0.157532   0.407346  -0.387  0.6990  
10: d_y1_d_x3  0.009359   0.039280   0.238  0.8117  
10: d_y2_d_x3 -0.156396   0.298764  -0.523  0.6006  
10: d_y3_d_x3  0.159523   0.280018   0.570  0.5689  
10: d_y1_d_x4 -0.005348   0.024538  -0.218  0.8275  
10: d_y2_d_x4 -0.208528   0.558871  -0.373  0.7091  
10: d_y3_d_x4  0.174025   0.463525   0.375  0.7073  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
> margEffUncA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ), vcov = diag( 18 ) )
> all.equal( margEffUnc, margEffUncA )
[1] TRUE
> # now with explicitly specifying dummy variables
> margEffUncD <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ),
+    dummyVar = c( "x1", "x2" ) )
> all.equal( margEffUncD, margEffUnc )
[1] TRUE
> # now with seemingly no dummy variables
> margEffUncD0 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ),
+    dummyVar = NULL )
> summary( margEffUncD0 )
               Estimate Std. error z value Pr(> z)  
1: d_y1_d_x1   0.060234   0.229069   0.263  0.7926  
1: d_y2_d_x1   0.333415   0.493550   0.676  0.4993  
1: d_y3_d_x1  -0.164966   0.377997  -0.436  0.6625  
1: d_y1_d_x2  -0.050195   0.164169  -0.306  0.7598  
1: d_y2_d_x2   0.200049   0.280941   0.712  0.4764  
1: d_y3_d_x2  -0.192460   0.275439  -0.699  0.4847  
1: d_y1_d_x3   0.070273   0.234891   0.299  0.7648  
1: d_y2_d_x3  -0.400098   0.362458  -1.104  0.2697  
1: d_y3_d_x3   0.302437   0.385478   0.785  0.4327  
1: d_y1_d_x4  -0.040156   0.145672  -0.276  0.7828  
1: d_y2_d_x4  -0.533464   0.735547  -0.725  0.4683  
1: d_y3_d_x4   0.329931   0.641500   0.514  0.6070  
2: d_y1_d_x1   0.461706   0.425426   1.085  0.2778  
2: d_y2_d_x1   0.304804   0.446903   0.682  0.4952  
2: d_y3_d_x1  -0.174668   0.354644  -0.493  0.6224  
2: d_y1_d_x2  -0.384755   0.302081  -1.274  0.2028  
2: d_y2_d_x2   0.182883   0.222563   0.822  0.4112  
2: d_y3_d_x2  -0.203779   0.215441  -0.946  0.3442  
2: d_y1_d_x3   0.538657   0.410543   1.312  0.1895  
2: d_y2_d_x3  -0.365765   0.459421  -0.796  0.4259  
2: d_y3_d_x3   0.320224   0.436340   0.734  0.4630  
2: d_y1_d_x4  -0.307804   0.426041  -0.722  0.4700  
2: d_y2_d_x4  -0.487687   0.549576  -0.887  0.3749  
2: d_y3_d_x4   0.349336   0.448600   0.779  0.4361  
3: d_y1_d_x1   0.246411   0.741814   0.332  0.7398  
3: d_y2_d_x1   0.289922   0.458628   0.632  0.5273  
3: d_y3_d_x1  -0.166159   0.309653  -0.537  0.5915  
3: d_y1_d_x2  -0.205343   0.465663  -0.441  0.6592  
3: d_y2_d_x2   0.173953   0.311849   0.558  0.5770  
3: d_y3_d_x2  -0.193852   0.343657  -0.564  0.5727  
3: d_y1_d_x3   0.287480   0.659862   0.436  0.6631  
3: d_y2_d_x3  -0.347907   0.542040  -0.642  0.5210  
3: d_y3_d_x3   0.304625   0.507399   0.600  0.5483  
3: d_y1_d_x4  -0.164274   0.382836  -0.429  0.6679  
3: d_y2_d_x4  -0.463876   0.971352  -0.478  0.6330  
3: d_y3_d_x4   0.332318   0.780151   0.426  0.6701  
4: d_y1_d_x1   0.368635   0.750782   0.491  0.6234  
4: d_y2_d_x1   0.357283   0.359035   0.995  0.3197  
4: d_y3_d_x1  -0.205990   0.308517  -0.668  0.5043  
4: d_y1_d_x2  -0.307196   0.412472  -0.745  0.4564  
4: d_y2_d_x2   0.214370   0.315233   0.680  0.4965  
4: d_y3_d_x2  -0.240322   0.319479  -0.752  0.4519  
4: d_y1_d_x3   0.430074   0.609132   0.706  0.4802  
4: d_y2_d_x3  -0.428740   0.443667  -0.966  0.3339  
4: d_y3_d_x3   0.377649   0.445647   0.847  0.3968  
4: d_y1_d_x4  -0.245757   0.366506  -0.671  0.5025  
4: d_y2_d_x4  -0.571653   0.778475  -0.734  0.4628  
4: d_y3_d_x4   0.411980   0.688013   0.599  0.5493  
5: d_y1_d_x1   0.429137   0.328361   1.307  0.1912  
5: d_y2_d_x1   0.393582   0.467800   0.841  0.4002  
5: d_y3_d_x1  -0.234703   0.442813  -0.530  0.5961  
5: d_y1_d_x2  -0.357614   0.462320  -0.774  0.4392  
5: d_y2_d_x2   0.236149   0.399435   0.591  0.5544  
5: d_y3_d_x2  -0.273820   0.402558  -0.680  0.4964  
5: d_y1_d_x3   0.500660   0.633149   0.791  0.4291  
5: d_y2_d_x3  -0.472298   0.460163  -1.026  0.3047  
5: d_y3_d_x3   0.430288   0.465925   0.924  0.3557  
5: d_y1_d_x4  -0.286091   0.511348  -0.559  0.5758  
5: d_y2_d_x4  -0.629731   0.347755  -1.811  0.0702 .
5: d_y3_d_x4   0.469405   0.346199   1.356  0.1751  
6: d_y1_d_x1   0.076917   0.399589   0.192  0.8474  
6: d_y2_d_x1   0.062889   0.284869   0.221  0.8253  
6: d_y3_d_x1  -0.044942   0.189725  -0.237  0.8127  
6: d_y1_d_x2  -0.064097   0.288673  -0.222  0.8243  
6: d_y2_d_x2   0.037734   0.167608   0.225  0.8219  
6: d_y3_d_x2  -0.052433   0.222176  -0.236  0.8134  
6: d_y1_d_x3   0.089736   0.391254   0.229  0.8186  
6: d_y2_d_x3  -0.075467   0.325988  -0.232  0.8169  
6: d_y3_d_x3   0.082394   0.333238   0.247  0.8047  
6: d_y1_d_x4  -0.051278   0.237088  -0.216  0.8288  
6: d_y2_d_x4  -0.100623   0.507245  -0.198  0.8428  
6: d_y3_d_x4   0.089885   0.439736   0.204  0.8380  
7: d_y1_d_x1   0.107242   0.335695   0.319  0.7494  
7: d_y2_d_x1   0.268092   0.654960   0.409  0.6823  
7: d_y3_d_x1  -0.175718   0.493248  -0.356  0.7217  
7: d_y1_d_x2  -0.089369   0.362408  -0.247  0.8052  
7: d_y2_d_x2   0.160855   0.480808   0.335  0.7380  
7: d_y3_d_x2  -0.205005   0.533324  -0.384  0.7007  
7: d_y1_d_x3   0.125116   0.403976   0.310  0.7568  
7: d_y2_d_x3  -0.321710   0.522218  -0.616  0.5379  
7: d_y3_d_x3   0.322151   0.467820   0.689  0.4911  
7: d_y1_d_x4  -0.071495   0.285471  -0.250  0.8022  
7: d_y2_d_x4  -0.428947   0.737887  -0.581  0.5610  
7: d_y3_d_x4   0.351437   0.549872   0.639  0.5227  
8: d_y1_d_x1   0.271734   0.370560   0.733  0.4634  
8: d_y2_d_x1   0.315517   0.384084   0.821  0.4114  
8: d_y3_d_x1  -0.200603   0.355554  -0.564  0.5726  
8: d_y1_d_x2  -0.226445   0.333205  -0.680  0.4968  
8: d_y2_d_x2   0.189310   0.341789   0.554  0.5797  
8: d_y3_d_x2  -0.234036   0.362911  -0.645  0.5190  
8: d_y1_d_x3   0.317023   0.380622   0.833  0.4049  
8: d_y2_d_x3  -0.378620   0.378829  -0.999  0.3176  
8: d_y3_d_x3   0.367771   0.372295   0.988  0.3232  
8: d_y1_d_x4  -0.181156   0.289976  -0.625  0.5321  
8: d_y2_d_x4  -0.504827   0.485713  -1.039  0.2986  
8: d_y3_d_x4   0.401205   0.424522   0.945  0.3446  
9: d_y1_d_x1   0.144319   0.428640   0.337  0.7364  
9: d_y2_d_x1   0.071360   0.253986   0.281  0.7787  
9: d_y3_d_x1  -0.045760   0.171173  -0.267  0.7892  
9: d_y1_d_x2  -0.120266   0.295341  -0.407  0.6839  
9: d_y2_d_x2   0.042816   0.123046   0.348  0.7279  
9: d_y3_d_x2  -0.053387   0.151548  -0.352  0.7246  
9: d_y1_d_x3   0.168372   0.416487   0.404  0.6860  
9: d_y2_d_x3  -0.085632   0.254656  -0.336  0.7367  
9: d_y3_d_x3   0.083894   0.241357   0.348  0.7281  
9: d_y1_d_x4  -0.096212   0.317272  -0.303  0.7617  
9: d_y2_d_x4  -0.114176   0.384669  -0.297  0.7666  
9: d_y3_d_x4   0.091521   0.303278   0.302  0.7628  
10: d_y1_d_x1  0.008022   0.038409   0.209  0.8346  
10: d_y2_d_x1  0.130330   0.346800   0.376  0.7071  
10: d_y3_d_x1 -0.087012   0.250314  -0.348  0.7281  
10: d_y1_d_x2 -0.006685   0.032220  -0.207  0.8356  
10: d_y2_d_x2  0.078198   0.232741   0.336  0.7369  
10: d_y3_d_x2 -0.101515   0.278728  -0.364  0.7157  
10: d_y1_d_x3  0.009359   0.039280   0.238  0.8117  
10: d_y2_d_x3 -0.156396   0.298764  -0.523  0.6006  
10: d_y3_d_x3  0.159523   0.280018   0.570  0.5689  
10: d_y1_d_x4 -0.005348   0.024538  -0.218  0.8275  
10: d_y2_d_x4 -0.208528   0.558871  -0.373  0.7091  
10: d_y3_d_x4  0.174025   0.463525   0.375  0.7073  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
> # now with seemingly only dummy variables
> margEffUncDA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ),
+    dummyVar = c( "x1", "x2", "x3", "x4" ) )
> summary( margEffUncDA )
               Estimate Std. error z value Pr(> z)  
1: d_y1_d_x1   0.180673   0.506428   0.357  0.7213  
1: d_y2_d_x1   0.219666   0.420176   0.523  0.6011  
1: d_y3_d_x1  -0.122356   0.286500  -0.427  0.6693  
1: d_y1_d_x2  -0.129203   0.283404  -0.456  0.6485  
1: d_y2_d_x2   0.225810   0.348047   0.649  0.5165  
1: d_y3_d_x2  -0.241208   0.329144  -0.733  0.4637  
1: d_y1_d_x3   0.510588   0.293968   1.737  0.0824 .
1: d_y2_d_x3  -0.217616   0.372909  -0.584  0.5595  
1: d_y3_d_x3   0.298602   0.374009   0.798  0.4246  
1: d_y1_d_x4  -0.038743   0.137789  -0.281  0.7786  
1: d_y2_d_x4  -0.524961   0.523494  -1.003  0.3160  
1: d_y3_d_x4   0.346068   0.576168   0.601  0.5481  
2: d_y1_d_x1   0.430122   0.317561   1.354  0.1756  
2: d_y2_d_x1   0.190084   0.327883   0.580  0.5621  
2: d_y3_d_x1  -0.131959   0.254364  -0.519  0.6039  
2: d_y1_d_x2  -0.373654   0.393924  -0.949  0.3429  
2: d_y2_d_x2   0.215256   0.319713   0.673  0.5008  
2: d_y3_d_x2  -0.248972   0.312271  -0.797  0.4253  
2: d_y1_d_x3   0.410125   0.396819   1.034  0.3014  
2: d_y2_d_x3  -0.448236   0.314764  -1.424  0.1544  
2: d_y3_d_x3   0.417677   0.343720   1.215  0.2243  
2: d_y1_d_x4  -0.210803   0.309845  -0.680  0.4963  
2: d_y2_d_x4  -0.512795   0.357795  -1.433  0.1518  
2: d_y3_d_x4   0.446390   0.312268   1.430  0.1529  
3: d_y1_d_x1   0.115233   0.409160   0.282  0.7782  
3: d_y2_d_x1   0.367505   0.351286   1.046  0.2955  
3: d_y3_d_x1  -0.203146   0.350334  -0.580  0.5620  
3: d_y1_d_x2  -0.314837   0.424044  -0.742  0.4578  
3: d_y2_d_x2   0.208986   0.351459   0.595  0.5521  
3: d_y3_d_x2  -0.242199   0.360140  -0.673  0.5013  
3: d_y1_d_x3   0.342143   0.566956   0.603  0.5462  
3: d_y2_d_x3  -0.281479   0.514058  -0.548  0.5840  
3: d_y3_d_x3   0.307287   0.472745   0.650  0.5157  
3: d_y1_d_x4  -0.223117   0.401738  -0.555  0.5786  
3: d_y2_d_x4  -0.251119   0.675741  -0.372  0.7102  
3: d_y3_d_x4   0.206232   0.578378   0.357  0.7214  
4: d_y1_d_x1   0.207611   0.540019   0.384  0.7006  
4: d_y2_d_x1   0.382763   0.357810   1.070  0.2847  
4: d_y3_d_x1  -0.228889   0.357614  -0.640  0.5221  
4: d_y1_d_x2  -0.374273   0.337358  -1.109  0.2672  
4: d_y2_d_x2   0.232552   0.363994   0.639  0.5229  
4: d_y3_d_x2  -0.268560   0.355628  -0.755  0.4501  
4: d_y1_d_x3   0.338243   0.565710   0.598  0.5499  
4: d_y2_d_x3  -0.288488   0.512001  -0.563  0.5731  
4: d_y3_d_x3   0.311934   0.468322   0.666  0.5054  
4: d_y1_d_x4  -0.285863   0.356399  -0.802  0.4225  
4: d_y2_d_x4  -0.361366   0.706221  -0.512  0.6089  
4: d_y3_d_x4   0.289321   0.607781   0.476  0.6341  
5: d_y1_d_x1   0.448007   0.365489   1.226  0.2203  
5: d_y2_d_x1   0.312561   0.479915   0.651  0.5149  
5: d_y3_d_x1  -0.209051   0.417286  -0.501  0.6164  
5: d_y1_d_x2  -0.382741   0.346813  -1.104  0.2698  
5: d_y2_d_x2   0.233731   0.366815   0.637  0.5240  
5: d_y3_d_x2  -0.270658   0.358474  -0.755  0.4502  
5: d_y1_d_x3   0.086632   0.249892   0.347  0.7288  
5: d_y2_d_x3  -0.162984   0.362247  -0.450  0.6528  
5: d_y3_d_x3   0.164314   0.354266   0.464  0.6428  
5: d_y1_d_x4  -0.242305   0.457724  -0.529  0.5965  
5: d_y2_d_x4  -0.548566   0.432588  -1.268  0.2048  
5: d_y3_d_x4   0.444516   0.383787   1.158  0.2468  
6: d_y1_d_x1   0.026992   0.154501   0.175  0.8613  
6: d_y2_d_x1   0.150920   0.460658   0.328  0.7432  
6: d_y3_d_x1  -0.075837   0.270198  -0.281  0.7790  
6: d_y1_d_x2  -0.152890   0.463512  -0.330  0.7415  
6: d_y2_d_x2   0.065760   0.246988   0.266  0.7900  
6: d_y3_d_x2  -0.095750   0.322528  -0.297  0.7666  
6: d_y1_d_x3   0.294462   0.542545   0.543  0.5873  
6: d_y2_d_x3  -0.362960   0.454475  -0.799  0.4245  
6: d_y3_d_x3   0.359477   0.408133   0.881  0.3784  
6: d_y1_d_x4  -0.071365   0.291084  -0.245  0.8063  
6: d_y2_d_x4  -0.075971   0.369470  -0.206  0.8371  
6: d_y3_d_x4   0.068823   0.335898   0.205  0.8377  
7: d_y1_d_x1   0.256301   0.455234   0.563  0.5734  
7: d_y2_d_x1   0.157029   0.440389   0.357  0.7214  
7: d_y3_d_x1  -0.133023   0.380718  -0.349  0.7268  
7: d_y1_d_x2  -0.038667   0.164698  -0.235  0.8144  
7: d_y2_d_x2   0.118400   0.358181   0.331  0.7410  
7: d_y3_d_x2  -0.147251   0.404268  -0.364  0.7157  
7: d_y1_d_x3   0.263628   0.517690   0.509  0.6106  
7: d_y2_d_x3  -0.406595   0.387861  -1.048  0.2945  
7: d_y3_d_x3   0.386465   0.363439   1.063  0.2876  
7: d_y1_d_x4  -0.069998   0.274874  -0.255  0.7990  
7: d_y2_d_x4  -0.443659   0.566743  -0.783  0.4337  
7: d_y3_d_x4   0.358465   0.471789   0.760  0.4474  
8: d_y1_d_x1   0.131828   0.200736   0.657  0.5114  
8: d_y2_d_x1   0.376948   0.385153   0.979  0.3277  
8: d_y3_d_x1  -0.226111   0.404274  -0.559  0.5760  
8: d_y1_d_x2  -0.330778   0.434486  -0.761  0.4465  
8: d_y2_d_x2   0.219460   0.406098   0.540  0.5889  
8: d_y3_d_x2  -0.265927   0.401733  -0.662  0.5080  
8: d_y1_d_x3   0.185554   0.248831   0.746  0.4558  
8: d_y2_d_x3  -0.263729   0.275021  -0.959  0.3376  
8: d_y3_d_x3   0.271620   0.270641   1.004  0.3156  
8: d_y1_d_x4  -0.259873   0.418877  -0.620  0.5350  
8: d_y2_d_x4  -0.207944   0.274256  -0.758  0.4483  
8: d_y3_d_x4   0.221009   0.261751   0.844  0.3985  
9: d_y1_d_x1   0.302950   0.601313   0.504  0.6144  
9: d_y2_d_x1   0.029627   0.119098   0.249  0.8035  
9: d_y3_d_x1  -0.026668   0.103269  -0.258  0.7962  
9: d_y1_d_x2  -0.230896   0.364964  -0.633  0.5270  
9: d_y2_d_x2   0.072908   0.184501   0.395  0.6927  
9: d_y3_d_x2  -0.097100   0.225089  -0.431  0.6662  
9: d_y1_d_x3   0.407884   0.398941   1.022  0.3066  
9: d_y2_d_x3  -0.449061   0.316410  -1.419  0.1558  
9: d_y3_d_x3   0.417625   0.346271   1.206  0.2278  
9: d_y1_d_x4  -0.031703   0.120740  -0.263  0.7929  
9: d_y2_d_x4  -0.506593   0.571616  -0.886  0.3755  
9: d_y3_d_x4   0.327282   0.592565   0.552  0.5807  
10: d_y1_d_x1  0.002096   0.010845   0.193  0.8468  
10: d_y2_d_x1  0.242659   0.508848   0.477  0.6334  
10: d_y3_d_x1 -0.127937   0.365636  -0.350  0.7264  
10: d_y1_d_x2 -0.029343   0.127161  -0.231  0.8175  
10: d_y2_d_x2  0.117824   0.349490   0.337  0.7360  
10: d_y3_d_x2 -0.157532   0.407346  -0.387  0.6990  
10: d_y1_d_x3  0.128581   0.214119   0.601  0.5482  
10: d_y2_d_x3 -0.386714   0.292472  -1.322  0.1861  
10: d_y3_d_x3  0.356248   0.291286   1.223  0.2213  
10: d_y1_d_x4 -0.034296   0.141396  -0.243  0.8084  
10: d_y2_d_x4 -0.017558   0.069195  -0.254  0.7997  
10: d_y3_d_x4  0.029071   0.103923   0.280  0.7797  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
> # now with mean values of the marginal effects
> margEffUncM <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ), 
+    addMean = TRUE )
> all.equal( margEffUnc, margEffUncM[ 1:nObs, ], check.attributes = FALSE )
[1] TRUE
> print( margEffUncM[ nObs:(nObs+1), ] )
       d_y1_d_x1 d_y2_d_x1  d_y3_d_x1   d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
10   0.002095525 0.2426595 -0.1279373 -0.02934265 0.1178236 -0.1575317
mean 0.210181213 0.2429762 -0.1484976 -0.23572823 0.1710685 -0.2035156
       d_y1_d_x3  d_y2_d_x3 d_y3_d_x3    d_y1_d_x4  d_y2_d_x4 d_y3_d_x4
10   0.009358606 -0.1563963 0.1595228 -0.005347775 -0.2085284 0.1740249
mean 0.253674923 -0.3032635 0.2750956 -0.144957099 -0.4043513 0.3001043
> all.equal( attr( margEffUnc, "vcov" ), 
+    attr( margEffUncM, "vcov" )[ 1:nObs, , ] )
[1] TRUE
> print( attr( margEffUncM, "vcov" )[ nObs:(nObs+1), , ] )
, , d_y1_d_x1

        d_y1_d_x1 d_y2_d_x1 d_y3_d_x1    d_y1_d_x2 d_y2_d_x2 d_y3_d_x2
10   0.0001176217         0         0 -0.001145678         0         0
mean 0.0616473460         0         0 -0.014676234         0         0
        d_y1_d_x3 d_y2_d_x3 d_y3_d_x3     d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10   0.0004233938         0         0 -0.0002567171         0         0
mean 0.0131762240         0         0 -0.0135166876         0         0

, , d_y2_d_x1

     d_y1_d_x1  d_y2_d_x1 d_y3_d_x1 d_y1_d_x2    d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0 0.25892667         0         0  0.082654833         0         0
mean         0 0.06969919         0         0 -0.009436932         0         0
        d_y2_d_x3 d_y3_d_x3 d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
10   -0.105061662         0         0 -0.19958499         0
mean  0.008750508         0         0 -0.02749563         0

, , d_y3_d_x1

     d_y1_d_x1 d_y2_d_x1  d_y3_d_x1 d_y1_d_x2 d_y2_d_x2    d_y3_d_x2 d_y1_d_x3
10           0         0 0.13368957         0         0  0.061446755         0
mean         0         0 0.06562862         0         0 -0.007405409         0
     d_y2_d_x3    d_y3_d_x3 d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
10           0 -0.060597587         0         0 -0.10144935
mean         0  0.007402118         0         0 -0.01736106

, , d_y1_d_x2

        d_y1_d_x1 d_y2_d_x1 d_y3_d_x1  d_y1_d_x2 d_y2_d_x2 d_y3_d_x2
10   -0.001145678         0         0 0.01616982         0         0
mean -0.014676234         0         0 0.06142330         0         0
        d_y1_d_x3 d_y2_d_x3 d_y3_d_x3    d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10   -0.004124394         0         0  0.002500751         0         0
mean  0.022070205         0         0 -0.007582236         0         0

, , d_y2_d_x2

     d_y1_d_x1    d_y2_d_x1 d_y3_d_x1 d_y1_d_x2  d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0  0.082654833         0         0 0.12214353         0         0
mean         0 -0.009436932         0         0 0.08158337         0         0
       d_y2_d_x3 d_y3_d_x3 d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
10   -0.06458309         0         0 -0.12268809         0
mean  0.03244511         0         0  0.01069094         0

, , d_y3_d_x2

     d_y1_d_x1 d_y2_d_x1    d_y3_d_x1 d_y1_d_x2 d_y2_d_x2  d_y3_d_x2 d_y1_d_x3
10           0         0  0.061446755         0         0 0.16593068         0
mean         0         0 -0.007405409         0         0 0.08538425         0
     d_y2_d_x3   d_y3_d_x3 d_y1_d_x4 d_y2_d_x4    d_y3_d_x4
10           0 -0.07052900         0         0 -0.118076017
mean         0  0.03368832         0         0  0.001945654

, , d_y1_d_x3

        d_y1_d_x1 d_y2_d_x1 d_y3_d_x1    d_y1_d_x2 d_y2_d_x2 d_y3_d_x2
10   0.0004233938         0         0 -0.004124394         0         0
mean 0.0131762240         0         0  0.022070205         0         0
       d_y1_d_x3 d_y2_d_x3 d_y3_d_x3     d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10   0.001542939         0         0 -0.0009158142         0         0
mean 0.019902103         0         0 -0.0014505656         0         0

, , d_y2_d_x3

     d_y1_d_x1    d_y2_d_x1 d_y3_d_x1 d_y1_d_x2   d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0 -0.105061662         0         0 -0.06458309         0         0
mean         0  0.008750508         0         0  0.03244511         0         0
      d_y2_d_x3 d_y3_d_x3 d_y1_d_x4  d_y2_d_x4 d_y3_d_x4
10   0.08926007         0         0 0.15893909         0
mean 0.02100814         0         0 0.00970332         0

, , d_y3_d_x3

     d_y1_d_x1 d_y2_d_x1    d_y3_d_x1 d_y1_d_x2 d_y2_d_x2   d_y3_d_x2 d_y1_d_x3
10           0         0 -0.060597587         0         0 -0.07052900         0
mean         0         0  0.007402118         0         0  0.03368832         0
     d_y2_d_x3  d_y3_d_x3 d_y1_d_x4 d_y2_d_x4  d_y3_d_x4
10           0 0.07841036         0         0 0.12013414
mean         0 0.02265446         0         0 0.01162585

, , d_y1_d_x4

         d_y1_d_x1 d_y2_d_x1 d_y3_d_x1    d_y1_d_x2 d_y2_d_x2 d_y3_d_x2
10   -0.0002567171         0         0  0.002500751         0         0
mean -0.0135166876         0         0 -0.007582236         0         0
         d_y1_d_x3 d_y2_d_x3 d_y3_d_x3    d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10   -0.0009158142         0         0 0.0006021045         0         0
mean -0.0014505656         0         0 0.0387119634         0         0

, , d_y2_d_x4

     d_y1_d_x1   d_y2_d_x1 d_y3_d_x1 d_y1_d_x2   d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0 -0.19958499         0         0 -0.12268809         0         0
mean         0 -0.02749563         0         0  0.01069094         0         0
      d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10   0.15893909         0         0 0.3123363         0
mean 0.00970332         0         0 0.1659365         0

, , d_y3_d_x4

     d_y1_d_x1 d_y2_d_x1   d_y3_d_x1 d_y1_d_x2 d_y2_d_x2    d_y3_d_x2 d_y1_d_x3
10           0         0 -0.10144935         0         0 -0.118076017         0
mean         0         0 -0.01736106         0         0  0.001945654         0
     d_y2_d_x3  d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0 0.12013414         0         0 0.2148557
mean         0 0.01162585         0         0 0.1353801

> print( drop( attr( margEffUncM, "vcov" )[ nObs+1, , ] ) )
            d_y1_d_x1    d_y2_d_x1    d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
d_y1_d_x1  0.06164735  0.000000000  0.000000000 -0.014676234  0.000000000
d_y2_d_x1  0.00000000  0.069699186  0.000000000  0.000000000 -0.009436932
d_y3_d_x1  0.00000000  0.000000000  0.065628617  0.000000000  0.000000000
d_y1_d_x2 -0.01467623  0.000000000  0.000000000  0.061423301  0.000000000
d_y2_d_x2  0.00000000 -0.009436932  0.000000000  0.000000000  0.081583371
d_y3_d_x2  0.00000000  0.000000000 -0.007405409  0.000000000  0.000000000
d_y1_d_x3  0.01317622  0.000000000  0.000000000  0.022070205  0.000000000
d_y2_d_x3  0.00000000  0.008750508  0.000000000  0.000000000  0.032445111
d_y3_d_x3  0.00000000  0.000000000  0.007402118  0.000000000  0.000000000
d_y1_d_x4 -0.01351669  0.000000000  0.000000000 -0.007582236  0.000000000
d_y2_d_x4  0.00000000 -0.027495628  0.000000000  0.000000000  0.010690943
d_y3_d_x4  0.00000000  0.000000000 -0.017361059  0.000000000  0.000000000
             d_y3_d_x2    d_y1_d_x3   d_y2_d_x3   d_y3_d_x3    d_y1_d_x4
d_y1_d_x1  0.000000000  0.013176224 0.000000000 0.000000000 -0.013516688
d_y2_d_x1  0.000000000  0.000000000 0.008750508 0.000000000  0.000000000
d_y3_d_x1 -0.007405409  0.000000000 0.000000000 0.007402118  0.000000000
d_y1_d_x2  0.000000000  0.022070205 0.000000000 0.000000000 -0.007582236
d_y2_d_x2  0.000000000  0.000000000 0.032445111 0.000000000  0.000000000
d_y3_d_x2  0.085384250  0.000000000 0.000000000 0.033688322  0.000000000
d_y1_d_x3  0.000000000  0.019902103 0.000000000 0.000000000 -0.001450566
d_y2_d_x3  0.000000000  0.000000000 0.021008142 0.000000000  0.000000000
d_y3_d_x3  0.033688322  0.000000000 0.000000000 0.022654460  0.000000000
d_y1_d_x4  0.000000000 -0.001450566 0.000000000 0.000000000  0.038711963
d_y2_d_x4  0.000000000  0.000000000 0.009703320 0.000000000  0.000000000
d_y3_d_x4  0.001945654  0.000000000 0.000000000 0.011625846  0.000000000
            d_y2_d_x4    d_y3_d_x4
d_y1_d_x1  0.00000000  0.000000000
d_y2_d_x1 -0.02749563  0.000000000
d_y3_d_x1  0.00000000 -0.017361059
d_y1_d_x2  0.00000000  0.000000000
d_y2_d_x2  0.01069094  0.000000000
d_y3_d_x2  0.00000000  0.001945654
d_y1_d_x3  0.00000000  0.000000000
d_y2_d_x3  0.00970332  0.000000000
d_y3_d_x3  0.00000000  0.011625846
d_y1_d_x4  0.00000000  0.000000000
d_y2_d_x4  0.16593652  0.000000000
d_y3_d_x4  0.00000000  0.135380119
> all.equal( summary( margEffUnc )[ , ], 
+    summary( margEffUncM )[ 1:( 12 * nObs ), ], check.attributes = FALSE )
[1] TRUE
> printCoefmat( summary( margEffUncM )[ -( 1:( 12 * (nObs-1) ) ), ] )
                  Estimate Std. error z value Pr(> z)  
10: d_y1_d_x1    0.0020955  0.0108454  0.1932 0.84679  
10: d_y2_d_x1    0.2426595  0.5088484  0.4769 0.63345  
10: d_y3_d_x1   -0.1279373  0.3656358 -0.3499 0.72641  
10: d_y1_d_x2   -0.0293426  0.1271606 -0.2308 0.81751  
10: d_y2_d_x2    0.1178236  0.3494904  0.3371 0.73602  
10: d_y3_d_x2   -0.1575317  0.4073459 -0.3867 0.69896  
10: d_y1_d_x3    0.0093586  0.0392803  0.2383 0.81169  
10: d_y2_d_x3   -0.1563963  0.2987642 -0.5235 0.60064  
10: d_y3_d_x3    0.1595228  0.2800185  0.5697 0.56889  
10: d_y1_d_x4   -0.0053478  0.0245378 -0.2179 0.82748  
10: d_y2_d_x4   -0.2085284  0.5588705 -0.3731 0.70906  
10: d_y3_d_x4    0.1740249  0.4635253  0.3754 0.70733  
mean: d_y1_d_x1  0.2101812  0.2482888  0.8465 0.39726  
mean: d_y2_d_x1  0.2429762  0.2640060  0.9203 0.35739  
mean: d_y3_d_x1 -0.1484976  0.2561808 -0.5797 0.56214  
mean: d_y1_d_x2 -0.2357282  0.2478372 -0.9511 0.34153  
mean: d_y2_d_x2  0.1710685  0.2856280  0.5989 0.54923  
mean: d_y3_d_x2 -0.2035156  0.2922058 -0.6965 0.48613  
mean: d_y1_d_x3  0.2536749  0.1410748  1.7982 0.07215 .
mean: d_y2_d_x3 -0.3032635  0.1449419 -2.0923 0.03641 *
mean: d_y3_d_x3  0.2750956  0.1505140  1.8277 0.06759 .
mean: d_y1_d_x4 -0.1449571  0.1967536 -0.7367 0.46128  
mean: d_y2_d_x4 -0.4043513  0.4073531 -0.9926 0.32089  
mean: d_y3_d_x4  0.3001043  0.3679404  0.8156 0.41471  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -0.5074569 -0.4007881  0.9870865 -1.2228328
> 
> # calculating marginal effects, conditional
> # (assuming that all other dependent variables are one)
> margEffCond <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz() )
> print( margEffCond )
      d_y1_d_x1  d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2  d_y3_d_x2
1  0.4118196285 0.11755425 -0.3603571 -0.229336023 0.24592945 -0.1258047
2  0.3072493886 0.16496098 -0.2207962 -0.251218729 0.23603249 -0.1732265
3  0.2668136514 0.22747911 -0.3834613 -0.358314743 0.23024729 -0.1482975
4  0.3739634546 0.27583243 -0.3555778 -0.346905711 0.26380199 -0.1562548
5  0.4391801486 0.27082731 -0.2615752 -0.320544987 0.26315436 -0.1630063
6  0.1333475202 0.05063076 -0.3842384 -0.271514059 0.05963121 -0.1100592
7  0.1186209608 0.14525007 -0.1602907 -0.008844268 0.11286656 -0.1545433
8  0.0479944760 0.35027624 -0.2340024 -0.203212079 0.23964177 -0.1769059
9  0.5485854658 0.01846945 -0.1161634 -0.323192759 0.07403491 -0.1034704
10 0.0002023317 0.23196959 -0.1301103 -0.005713415 0.11099101 -0.1661675
     d_y1_d_x3   d_y2_d_x3 d_y3_d_x3     d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  0.176511553 -0.35179286 0.2229842 -0.1468374651 -0.32872178 0.6037347
2  0.470625850 -0.39065433 0.2417527 -0.4007656056 -0.40480342 0.4969012
3  0.440547549 -0.33694170 0.2350549 -0.3803063475 -0.32464544 0.5721855
4  0.520056790 -0.45146105 0.2436830 -0.4144341592 -0.44879952 0.5673865
5  0.329853049 -0.50531263 0.2791236 -0.2238687968 -0.56755035 0.4883268
6  0.253508476 -0.05245314 0.1581382 -0.2782416393 -0.04810410 0.3860385
7  0.036015810 -0.30982533 0.2977379 -0.0217475808 -0.39933261 0.3574982
8  0.147285010 -0.38617280 0.2839412 -0.0911087350 -0.46686982 0.4072656
9  0.361307538 -0.07085862 0.1415298 -0.3929185216 -0.06647694 0.3342594
10 0.001136227 -0.14918719 0.1853440 -0.0006208183 -0.19920183 0.1994459
> margEffCondA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz() )
> all.equal( margEffCond, margEffCondA )
[1] TRUE
> # now with dummy variables specified explicitly
> margEffCondD <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    dummyVars = c( "x1", "x2" ), algorithm = GenzBretz() )
> all.equal( margEffCondD, margEffCond )
[1] TRUE
> # now with seemingly no dummy variables
> margEffCondD0 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    dummyVars = NULL, algorithm = GenzBretz() )
> print( margEffCondD0 )
      d_y1_d_x1  d_y2_d_x1   d_y3_d_x1    d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.1884635652 0.17102712 -0.42316725 -0.125801131 0.18806309 -0.12892375
2  0.5099557823 0.22543984 -0.32620929 -0.335328823 0.20402620 -0.14650352
3  0.4821673456 0.17270950 -0.39225087 -0.314821101 0.17871508 -0.13835668
4  0.5392597432 0.24342496 -0.38415941 -0.368805082 0.23826960 -0.14572352
5  0.3084532159 0.32945682 -0.30363340 -0.231071359 0.26068085 -0.17458867
6  0.3290263251 0.02481757 -0.26612804 -0.186121049 0.02795717 -0.09105967
7  0.0313559801 0.24700912 -0.18717169 -0.025031082 0.15490110 -0.19216058
8  0.1301219439 0.28075214 -0.23379151 -0.102554771 0.19614099 -0.18116028
9  0.4656624778 0.03483961 -0.22862972 -0.264787711 0.03761668 -0.08212529
10 0.0009338786 0.12485332 -0.09718526 -0.000786224 0.07414565 -0.12046481
     d_y1_d_x3   d_y2_d_x3 d_y3_d_x3     d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  0.176511553 -0.35179286 0.2229842 -0.1468374651 -0.32872178 0.6037347
2  0.470625850 -0.39065433 0.2417527 -0.4007656056 -0.40480342 0.4969012
3  0.440547549 -0.33694170 0.2350549 -0.3803063475 -0.32464544 0.5721855
4  0.520056790 -0.45146105 0.2436830 -0.4144341592 -0.44879952 0.5673865
5  0.329853049 -0.50531263 0.2791236 -0.2238687968 -0.56755035 0.4883268
6  0.253508476 -0.05245314 0.1581382 -0.2782416393 -0.04810410 0.3860385
7  0.036015810 -0.30982533 0.2977379 -0.0217475808 -0.39933261 0.3574982
8  0.147285010 -0.38617280 0.2839412 -0.0911087350 -0.46686982 0.4072656
9  0.361307538 -0.07085862 0.1415298 -0.3929185216 -0.06647694 0.3342594
10 0.001136227 -0.14918719 0.1853440 -0.0006208183 -0.19920183 0.1994459
> # now with seemingly only dummy variables
> margEffCondDA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    dummyVars = c( "x1", "x2", "x3", "x4" ), algorithm = GenzBretz() )
> print( margEffCondDA )
      d_y1_d_x1  d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2  d_y3_d_x2
1  0.4118196285 0.11755425 -0.3603571 -0.229336023 0.24592945 -0.1258047
2  0.3072493886 0.16496098 -0.2207962 -0.251218729 0.23603249 -0.1732265
3  0.2668136514 0.22747911 -0.3834613 -0.358314743 0.23024729 -0.1482975
4  0.3739634546 0.27583243 -0.3555778 -0.346905711 0.26380199 -0.1562548
5  0.4391801486 0.27082731 -0.2615752 -0.320544987 0.26315436 -0.1630063
6  0.1333475202 0.05063076 -0.3842384 -0.271514059 0.05963121 -0.1100592
7  0.1186209608 0.14525007 -0.1602907 -0.008844268 0.11286656 -0.1545433
8  0.0479944760 0.35027624 -0.2340024 -0.203212079 0.23964177 -0.1769059
9  0.5485854658 0.01846945 -0.1161634 -0.323192759 0.07403491 -0.1034704
10 0.0002023317 0.23196959 -0.1301103 -0.005713415 0.11099101 -0.1661675
    d_y1_d_x3  d_y2_d_x3 d_y3_d_x3    d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  0.43230239 -0.2692830 0.1631718 -0.142023260 -0.35837410 0.54369935
2  0.22403261 -0.4616019 0.3079839 -0.328013708 -0.49007825 0.43466606
3  0.18752328 -0.2979142 0.2321765 -0.446802359 -0.18313630 0.40395556
4  0.18354779 -0.3041504 0.2365840 -0.411875993 -0.29361935 0.44264675
5  0.02729896 -0.1606363 0.1716591 -0.165495636 -0.50776892 0.47200346
6  0.14155213 -0.3691322 0.2835271 -0.354045944 -0.03714082 0.29003164
7  0.11478735 -0.4063478 0.3124210 -0.021385692 -0.41570255 0.35971732
8  0.07449582 -0.2637046 0.2414374 -0.146174052 -0.20463223 0.23281447
9  0.22089519 -0.4620024 0.3090326 -0.126527306 -0.33025402 0.54904170
10 0.04081212 -0.3738552 0.3198510 -0.003924666 -0.01724742 0.04690532
> # now with integrals obtained by the Miwa algorithm, reduced precision
> margEffCond1 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = Miwa( steps = 32 ) )
> print( margEffCond1 )
      d_y1_d_x1  d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2  d_y3_d_x2
1  0.4118175441 0.11744761 -0.3604293 -0.229377392 0.24595064 -0.1258412
2  0.3072778362 0.16499571 -0.2207798 -0.251230455 0.23600462 -0.1732307
3  0.2668567540 0.22752895 -0.3835033 -0.358189399 0.23045343 -0.1481687
4  0.3740368431 0.27590804 -0.3555998 -0.346792914 0.26395440 -0.1561463
5  0.4391762270 0.27082379 -0.2615569 -0.320425619 0.26329930 -0.1629057
6  0.1333669207 0.05068089 -0.3842359 -0.271497048 0.05975710 -0.1100381
7  0.1186476441 0.14525164 -0.1602639 -0.008826922 0.11286814 -0.1545282
8  0.0479957196 0.35027704 -0.2340019 -0.203276650 0.23960011 -0.1769520
9  0.5485472106 0.01837404 -0.1161731 -0.323172242 0.07410392 -0.1034597
10 0.0002125689 0.23197009 -0.1301010 -0.005696324 0.11099282 -0.1661532
    d_y1_d_x3   d_y2_d_x3 d_y3_d_x3     d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  0.17654673 -0.35173836 0.2230884 -0.1468532996 -0.32870549 0.6038590
2  0.47050847 -0.39074154 0.2416959 -0.4008818186 -0.40494388 0.4968085
3  0.44064334 -0.33692357 0.2351269 -0.3803577019 -0.32467070 0.5722886
4  0.52019140 -0.45148369 0.2437674 -0.4144878626 -0.44884522 0.5675156
5  0.32993069 -0.50525720 0.2791793 -0.2238869512 -0.56754997 0.4882992
6  0.25354621 -0.05240629 0.1581628 -0.2782961086 -0.04819657 0.3860753
7  0.03601456 -0.30982678 0.2977379 -0.0217517271 -0.39933488 0.3574964
8  0.14729740 -0.38616972 0.2839504 -0.0911171901 -0.46687210 0.4072593
9  0.36130356 -0.07095789 0.1415239 -0.3929209854 -0.06636947 0.3342959
10 0.00107701 -0.14918942 0.1852891 -0.0006898552 -0.19920415 0.1993821
> all.equal( margEffCond, margEffCond1 )
 [1] "Component 1: Mean relative difference: 9.319688e-05" 
 [2] "Component 2: Mean relative difference: 0.0002259434" 
 [3] "Component 3: Mean relative difference: 8.422528e-05" 
 [4] "Component 4: Mean relative difference: 0.0002359585" 
 [5] "Component 5: Mean relative difference: 0.0004315704" 
 [6] "Component 6: Mean relative difference: 0.0003287333" 
 [7] "Component 7: Mean relative difference: 0.0002101608" 
 [8] "Component 8: Mean relative difference: 0.0001300595" 
 [9] "Component 9: Mean relative difference: 0.0002044696" 
[10] "Component 10: Mean relative difference: 0.0001675271"
[11] "Component 11: Mean relative difference: 0.0001336317"
[12] "Component 12: Mean relative difference: 0.0001409381"
> # now with integrals obtained by the GHK algorithm
> margEffCond2 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE )
> print( margEffCond2 )
      d_y1_d_x1  d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2  d_y3_d_x2
1  0.4120204907 0.12496054 -0.3601937 -0.229275444 0.24656096 -0.1264859
2  0.3105789512 0.17860492 -0.2207353 -0.252699622 0.23756523 -0.1745610
3  0.2665383992 0.23025645 -0.3837299 -0.358474059 0.23147649 -0.1489714
4  0.3737016708 0.27812532 -0.3561175 -0.347728634 0.26481716 -0.1576515
5  0.4399322754 0.27239142 -0.2624700 -0.321660167 0.26420615 -0.1646125
6  0.1334041757 0.05757852 -0.3838745 -0.271187377 0.06238751 -0.1099318
7  0.1211635205 0.14620921 -0.1616811 -0.009995845 0.11350228 -0.1592700
8  0.0497739112 0.35482588 -0.2353584 -0.205476715 0.24033985 -0.1801000
9  0.5582196873 0.04588147 -0.1163612 -0.322752953 0.07726908 -0.1033954
10 0.0006320436 0.23387574 -0.1340470 -0.006734245 0.11167712 -0.1708361
      d_y1_d_x3   d_y2_d_x3 d_y3_d_x3    d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  0.1763299122 -0.35336690 0.2233966 -0.146608979 -0.33322866 0.6039101
2  0.4709427044 -0.39474822 0.2424568 -0.401220332 -0.41533126 0.4972206
3  0.4403126684 -0.33958467 0.2354779 -0.380063995 -0.33216144 0.5723273
4  0.5203984320 -0.45373955 0.2448886 -0.414046786 -0.45507118 0.5682299
5  0.3330012384 -0.50703990 0.2835796 -0.224241439 -0.57213943 0.4910794
6  0.2532455358 -0.05821538 0.1579588 -0.279259652 -0.06532845 0.3858571
7  0.0390976701 -0.31144596 0.3059117 -0.022992330 -0.40247246 0.3630267
8  0.1510299759 -0.38761701 0.2909536 -0.092205017 -0.47013102 0.4115833
9  0.3606962493 -0.07810203 0.1413356 -0.395142891 -0.08668239 0.3341350
10 0.0008025037 -0.15020695 0.1921428 -0.002065602 -0.20061813 0.2067482
> all.equal( margEffCond, margEffCond2 )
 [1] "Component 1: Mean relative difference: 0.007274846" 
 [2] "Component 2: Mean relative difference: 0.03747971"  
 [3] "Component 3: Mean relative difference: 0.003518855" 
 [4] "Component 4: Mean relative difference: 0.003813365" 
 [5] "Component 5: Mean relative difference: 0.007335713" 
 [6] "Component 6: Mean relative difference: 0.01250843"  
 [7] "Component 7: Mean relative difference: 0.00447887"  
 [8] "Component 8: Mean relative difference: 0.009787098" 
 [9] "Component 9: Mean relative difference: 0.01291233"  
[10] "Component 10: Mean relative difference: 0.00370665" 
[11] "Component 11: Mean relative difference: 0.02416914" 
[12] "Component 12: Mean relative difference: 0.004914306"
> all.equal( margEffCond1, margEffCond2 )
 [1] "Component 1: Mean relative difference: 0.007302638" 
 [2] "Component 2: Mean relative difference: 0.03747545"  
 [3] "Component 3: Mean relative difference: 0.003532005" 
 [4] "Component 4: Mean relative difference: 0.00395168"  
 [5] "Component 5: Mean relative difference: 0.006977384" 
 [6] "Component 6: Mean relative difference: 0.01267949"  
 [7] "Component 7: Mean relative difference: 0.004478344" 
 [8] "Component 8: Mean relative difference: 0.0097754"   
 [9] "Component 9: Mean relative difference: 0.01282563"  
[10] "Component 10: Mean relative difference: 0.003641363"
[11] "Component 11: Mean relative difference: 0.02411041" 
[12] "Component 12: Mean relative difference: 0.004893427"
> # now with integrals obtained by the GHK algorithm, reduced precision
> margEffCond3 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    nGHK = 100 )
> print( margEffCond3 )
    d_y1_d_x1   d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.35706025  0.07834237 -0.3573599 -0.217914737 0.24204995 -0.12187035
2  0.17842058  0.10430154 -0.2112069 -0.232255861 0.22509394 -0.16275834
3  0.24645348  0.20573628 -0.3913875 -0.333771538 0.22470462 -0.14101272
4  0.34468065  0.25552160 -0.3654151 -0.321372456 0.25714440 -0.14868069
5  0.39531390  0.25352172 -0.2730576 -0.296051054 0.25561012 -0.15513685
6  0.11925400  0.01643885 -0.3810721 -0.247448071 0.05157318 -0.10229342
7  0.10840916  0.13399605 -0.1617170 -0.005700740 0.10456385 -0.15496986
8  0.02747604  0.32724239 -0.2326725 -0.183705309 0.22932867 -0.16951149
9  0.37473790 -0.06742030 -0.1067990 -0.290665859 0.06543780 -0.09456364
10 0.02095092  0.21903350 -0.1224342 -0.005313354 0.10231193 -0.16701680
     d_y1_d_x3   d_y2_d_x3 d_y3_d_x3   d_y1_d_x4    d_y2_d_x4 d_y3_d_x4
1   0.16817105 -0.34301441 0.2182270 -0.13517345 -0.296424706 0.6083034
2   0.43073787 -0.37331845 0.2244791 -0.29583700 -0.345586212 0.4849186
3   0.41205924 -0.32545153 0.2246944 -0.32971272 -0.279847269 0.5686308
4   0.48497682 -0.43971853 0.2322381 -0.35294054 -0.406603074 0.5674606
5   0.30018498 -0.48736224 0.2677792 -0.16964584 -0.530957962 0.4937718
6   0.23046155 -0.03469405 0.1472323 -0.23448731  0.018303022 0.3692521
7   0.02676862 -0.28930258 0.2928207 -0.02104248 -0.371619725 0.3545769
8   0.12347183 -0.36592513 0.2741515 -0.06717796 -0.435908311 0.4095904
9   0.32456657 -0.05199358 0.1296053 -0.31719931  0.008670741 0.3163796
10 -0.02408396 -0.13771422 0.1783179 -0.04203884 -0.184218486 0.1853459
> all.equal( margEffCond, margEffCond3 )
 [1] "Component 1: Mean relative difference: 0.1950758"  
 [2] "Component 2: Mean relative difference: 0.1761965"  
 [3] "Component 3: Mean relative difference: 0.02485851" 
 [4] "Component 4: Mean relative difference: 0.0796093"  
 [5] "Component 5: Mean relative difference: 0.04275513" 
 [6] "Component 6: Mean relative difference: 0.04227655" 
 [7] "Component 7: Mean relative difference: 0.09482927" 
 [8] "Component 8: Mean relative difference: 0.05197425" 
 [9] "Component 9: Mean relative difference: 0.04356983" 
[10] "Component 10: Mean relative difference: 0.19926"   
[11] "Component 11: Mean relative difference: 0.1322209" 
[12] "Component 12: Mean relative difference: 0.01804595"
> all.equal( margEffCond2, margEffCond3 )
 [1] "Component 1: Mean relative difference: 0.2002449"  
 [2] "Component 2: Mean relative difference: 0.205957"   
 [3] "Component 3: Mean relative difference: 0.02547425" 
 [4] "Component 4: Mean relative difference: 0.0824537"  
 [5] "Component 5: Mean relative difference: 0.04972607" 
 [6] "Component 6: Mean relative difference: 0.05214635" 
 [7] "Component 7: Mean relative difference: 0.0977991"  
 [8] "Component 8: Mean relative difference: 0.06116274" 
 [9] "Component 9: Mean relative difference: 0.05545767" 
[10] "Component 10: Mean relative difference: 0.2004108" 
[11] "Component 11: Mean relative difference: 0.1526995" 
[12] "Component 12: Mean relative difference: 0.02031045"
> # now with variance covariance matrix and Jacobian
> margEffCondV <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    vcov = diag( 18 ), returnJacobian = TRUE, algorithm = GenzBretz() )
> print( attr( margEffCondV, "vcov" ) )
, , d_y1_d_x1

      d_y1_d_x1     d_y2_d_x1     d_y3_d_x1     d_y1_d_x2     d_y2_d_x2
1  9.750971e-01 -0.0030037424 -4.490045e-01 -0.2274334727  0.0068307497
5  2.912560e-01  0.0387204653 -5.823824e-02  0.0274927902 -0.0755630123
10 7.727995e-06  0.0001515647  5.378415e-05 -0.0001392449  0.0001042601
      d_y3_d_x2    d_y1_d_x3     d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1  0.1589283487 3.934286e-01 -0.0545844515 -0.2432581367 -4.944853e-01
5  0.0074691017 5.540639e-02  0.0922668020 -0.0213238363 -2.595350e-01
10 0.0002038302 3.910299e-05 -0.0001169125 -0.0002194712 -2.332565e-05
       d_y2_d_x4    d_y3_d_x4
1  -0.0198229985  0.269608565
5  -0.0399537906  0.081566935
10 -0.0001923054 -0.000239452

, , d_y2_d_x1

       d_y1_d_x1 d_y2_d_x1  d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.0030037424 0.3213086 0.08092957  0.089143004 -0.005045259 -0.05181404
5   0.0387204653 0.2564557 0.05195901 -0.032248624 -0.049598653 -0.03718387
10  0.0001515647 0.2634495 0.01979479 -0.003199861  0.088988794  0.02585722
      d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  -0.044425020 -0.36633542  0.03799573 -0.0186951558 -0.65413500 -0.05527524
5   0.111725783 -0.09090843  0.03549096 -0.1448381970 -0.08484975  0.05410384
10  0.001119961 -0.10893447 -0.03755846 -0.0004868155 -0.20179176 -0.04416140

, , d_y3_d_x1

       d_y1_d_x1  d_y2_d_x1 d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -4.490045e-01 0.08092957 0.7652168  0.066369491 -0.008445285 -0.38941393
5  -5.823824e-02 0.05195901 0.2587506 -0.104236832  0.007911417 -0.01687398
10  5.378415e-05 0.01979479 0.1390371 -0.001494665  0.005243041  0.05039549
       d_y1_d_x3    d_y2_d_x3   d_y3_d_x3     d_y1_d_x4    d_y2_d_x4
1  -0.0589534852 -0.077033570  0.47425474  0.1896566521 -0.147082517
5   0.2077087857 -0.049667231 -0.08374910 -0.0711749077 -0.028633123
10  0.0001153093 -0.005509167 -0.04793679 -0.0002881854 -0.009574259
     d_y3_d_x4
1  -0.37529645
5  -0.06049581
10 -0.09158989

, , d_y1_d_x2

       d_y1_d_x1    d_y2_d_x1    d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1  -0.2274334727  0.089143004  0.066369491 0.243352635 -0.051781028
5   0.0274927902 -0.032248624 -0.104236832 0.380620095 -0.066218734
10 -0.0001392449 -0.003199861 -0.001494665 0.002968057 -0.003344902
      d_y3_d_x2     d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4
1  -0.110923427 -0.1634907455 -0.065895948 0.034895237 0.1447586659
5  -0.072756702 -0.3655508281  0.064808166 0.005143587 0.1635483990
10 -0.006398513 -0.0007031102  0.002480571 0.004946782 0.0004110672
      d_y2_d_x4   d_y3_d_x4
1  -0.178230527 -0.03089988
5   0.005741983  0.02351164
10  0.004025100  0.00582476

, , d_y2_d_x2

       d_y1_d_x1    d_y2_d_x1    d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1   0.0068307497 -0.005045259 -0.008445285 -0.051781028 0.1206777 0.04231634
5  -0.0755630123 -0.049598653  0.007911417 -0.066218734 0.1807104 0.04028227
10  0.0001042601  0.088988794  0.005243041 -0.003344902 0.1238768 0.03178731
       d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4    d_y2_d_x4
1   0.0067652152  0.02482717 -0.007132244 -0.0016813137 -0.004858253
5  -0.0056740947 -0.05095621 -0.002507805  0.0881209679  0.003676665
10  0.0007496257 -0.06786146 -0.029800305 -0.0003243721 -0.124388072
      d_y3_d_x4
1  -0.007073870
5  -0.003166506
10 -0.034035059

, , d_y3_d_x2

      d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1  0.1589283487 -0.05181404 -0.38941393 -0.110923427 0.04231634 0.3899346
5  0.0074691017 -0.03718387 -0.01687398 -0.072756702 0.04028227 0.2915086
10 0.0002038302  0.02585722  0.05039549 -0.006398513 0.03178731 0.1945990
       d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1   0.0122755018  0.03624679 -0.25929664 -0.0683931619  0.10609847  0.14925101
5  -0.0689660516  0.01311081 -0.14267792 -0.0175189865  0.06322171  0.01111095
10  0.0009141576 -0.01953567 -0.09175208 -0.0007818626 -0.02874143 -0.14045609

, , d_y1_d_x3

      d_y1_d_x1    d_y2_d_x1     d_y3_d_x1     d_y1_d_x2     d_y2_d_x2
1  3.934286e-01 -0.044425020 -0.0589534852 -0.1634907455  0.0067652152
5  5.540639e-02  0.111725783  0.2077087857 -0.3655508281 -0.0056740947
10 3.910299e-05  0.001119961  0.0001153093 -0.0007031102  0.0007496257
       d_y3_d_x2    d_y1_d_x3     d_y2_d_x3   d_y3_d_x3     d_y1_d_x4
1   0.0122755018 0.3041483610 -0.0146727944 -0.08688044 -0.2673697861
5  -0.0689660516 0.8884786267 -0.1309429600 -0.08480726 -0.4882227548
10  0.0009141576 0.0002010184 -0.0008269078 -0.00117105 -0.0001169866
      d_y2_d_x4     d_y3_d_x4
1   0.088302701  0.0500342788
5  -0.040929466 -0.0141029862
10 -0.001410629 -0.0009810036

, , d_y2_d_x3

       d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  -0.0545844515 -0.36633542 -0.077033570 -0.065895948  0.02482717  0.03624679
5   0.0922668020 -0.09090843 -0.049667231  0.064808166 -0.05095621  0.01311081
10 -0.0001169125 -0.10893447 -0.005509167  0.002480571 -0.06786146 -0.01953567
       d_y1_d_x3  d_y2_d_x3  d_y3_d_x3     d_y1_d_x4  d_y2_d_x4   d_y3_d_x4
1  -0.0146727944 0.53412794 0.02804618  0.0499321586 0.78776994  0.08222368
5  -0.1309429600 0.36791631 0.02667885 -0.0433949192 0.04116895 -0.03045622
10 -0.0008269078 0.08991047 0.02951772  0.0004160018 0.15675641  0.03385855

, , d_y3_d_x3

       d_y1_d_x1   d_y2_d_x1   d_y3_d_x1   d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.2432581367  0.03799573  0.47425474 0.034895237 -0.007132244 -0.25929664
5  -0.0213238363  0.03549096 -0.08374910 0.005143587 -0.002507805 -0.14267792
10 -0.0002194712 -0.03755846 -0.04793679 0.004946782 -0.029800305 -0.09175208
     d_y1_d_x3  d_y2_d_x3 d_y3_d_x3    d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  -0.08688044 0.02804618 0.5420574 0.1174787233 -0.07872452 -0.18479475
5  -0.08480726 0.02667885 0.4428440 0.0923533969 -0.09298806  0.03846137
10 -0.00117105 0.02951772 0.1344002 0.0007734578  0.03941158  0.16918625

, , d_y1_d_x4

       d_y1_d_x1     d_y2_d_x1     d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
1  -4.944853e-01 -0.0186951558  0.1896566521 0.1447586659 -0.0016813137
5  -2.595350e-01 -0.1448381970 -0.0711749077 0.1635483990  0.0881209679
10 -2.332565e-05 -0.0004868155 -0.0002881854 0.0004110672 -0.0003243721
       d_y3_d_x2     d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1  -0.0683931619 -0.2673697861  0.0499321586 0.1174787233 3.486025e-01
5  -0.0175189865 -0.4882227548 -0.0433949192 0.0923533969 6.542542e-01
10 -0.0007818626 -0.0001169866  0.0004160018 0.0007734578 7.361778e-05
      d_y2_d_x4    d_y3_d_x4
1  0.0244780006 -0.186198829
5  0.0435973898 -0.142957210
10 0.0006209189  0.001044309

, , d_y2_d_x4

       d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.0198229985 -0.65413500 -0.147082517 -0.178230527 -0.004858253  0.10609847
5  -0.0399537906 -0.08484975 -0.028633123  0.005741983  0.003676665  0.06322171
10 -0.0001923054 -0.20179176 -0.009574259  0.004025100 -0.124388072 -0.02874143
      d_y1_d_x3  d_y2_d_x3   d_y3_d_x3    d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1   0.088302701 0.78776994 -0.07872452 0.0244780006 1.4551324  0.13386282
5  -0.040929466 0.04116895 -0.09298806 0.0435973898 0.2496839 -0.04520915
10 -0.001410629 0.15675641  0.03941158 0.0006209189 0.3033983  0.05138708

, , d_y3_d_x4

      d_y1_d_x1   d_y2_d_x1   d_y3_d_x1   d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1   0.269608565 -0.05527524 -0.37529645 -0.03089988 -0.007073870  0.14925101
5   0.081566935  0.05410384 -0.06049581  0.02351164 -0.003166506  0.01111095
10 -0.000239452 -0.04416140 -0.09158989  0.00582476 -0.034035059 -0.14045609
       d_y1_d_x3   d_y2_d_x3   d_y3_d_x3    d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1   0.0500342788  0.08222368 -0.18479475 -0.186198829  0.13386282 0.4416161
5  -0.0141029862 -0.03045622  0.03846137 -0.142957210 -0.04520915 0.2294765
10 -0.0009810036  0.03385855  0.16918625  0.001044309  0.05138708 0.2861057

> print( drop( attr( margEffCondV, "vcov" )[ 1, , ] ) )
             d_y1_d_x1    d_y2_d_x1    d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
d_y1_d_x1  0.975097137 -0.003003742 -0.449004490 -0.22743347  0.006830750
d_y2_d_x1 -0.003003742  0.321308613  0.080929573  0.08914300 -0.005045259
d_y3_d_x1 -0.449004490  0.080929573  0.765216774  0.06636949 -0.008445285
d_y1_d_x2 -0.227433473  0.089143004  0.066369491  0.24335263 -0.051781028
d_y2_d_x2  0.006830750 -0.005045259 -0.008445285 -0.05178103  0.120677689
d_y3_d_x2  0.158928349 -0.051814040 -0.389413931 -0.11092343  0.042316339
d_y1_d_x3  0.393428581 -0.044425020 -0.058953485 -0.16349075  0.006765215
d_y2_d_x3 -0.054584452 -0.366335424 -0.077033570 -0.06589595  0.024827168
d_y3_d_x3 -0.243258137  0.037995730  0.474254737  0.03489524 -0.007132244
d_y1_d_x4 -0.494485275 -0.018695156  0.189656652  0.14475867 -0.001681314
d_y2_d_x4 -0.019822998 -0.654135004 -0.147082517 -0.17823053 -0.004858253
d_y3_d_x4  0.269608565 -0.055275242 -0.375296447 -0.03089988 -0.007073870
            d_y3_d_x2    d_y1_d_x3   d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
d_y1_d_x1  0.15892835  0.393428581 -0.05458445 -0.243258137 -0.494485275
d_y2_d_x1 -0.05181404 -0.044425020 -0.36633542  0.037995730 -0.018695156
d_y3_d_x1 -0.38941393 -0.058953485 -0.07703357  0.474254737  0.189656652
d_y1_d_x2 -0.11092343 -0.163490745 -0.06589595  0.034895237  0.144758666
d_y2_d_x2  0.04231634  0.006765215  0.02482717 -0.007132244 -0.001681314
d_y3_d_x2  0.38993460  0.012275502  0.03624679 -0.259296642 -0.068393162
d_y1_d_x3  0.01227550  0.304148361 -0.01467279 -0.086880437 -0.267369786
d_y2_d_x3  0.03624679 -0.014672794  0.53412794  0.028046176  0.049932159
d_y3_d_x3 -0.25929664 -0.086880437  0.02804618  0.542057387  0.117478723
d_y1_d_x4 -0.06839316 -0.267369786  0.04993216  0.117478723  0.348602453
d_y2_d_x4  0.10609847  0.088302701  0.78776994 -0.078724520  0.024478001
d_y3_d_x4  0.14925101  0.050034279  0.08222368 -0.184794749 -0.186198829
             d_y2_d_x4   d_y3_d_x4
d_y1_d_x1 -0.019822998  0.26960856
d_y2_d_x1 -0.654135004 -0.05527524
d_y3_d_x1 -0.147082517 -0.37529645
d_y1_d_x2 -0.178230527 -0.03089988
d_y2_d_x2 -0.004858253 -0.00707387
d_y3_d_x2  0.106098465  0.14925101
d_y1_d_x3  0.088302701  0.05003428
d_y2_d_x3  0.787769943  0.08222368
d_y3_d_x3 -0.078724520 -0.18479475
d_y1_d_x4  0.024478001 -0.18619883
d_y2_d_x4  1.455132426  0.13386282
d_y3_d_x4  0.133862819  0.44161612
> print( attr( margEffCondV, "jacobian" ) )
, , b_1_0

       d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1   0.2844103080  0.0365935254  0.0780064050 -0.22745182  0.019380781
5  -0.1562244503 -0.0003601466 -0.0126554974  0.17568006 -0.017225469
10 -0.0008151565  0.0002331714  0.0007906751  0.01741561 -0.004668669
     d_y3_d_x2    d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4     d_y2_d_x4
1  -0.02311634  0.278668755 -0.067612582 0.013977708 -0.233313369 -6.972201e-02
5  -0.04385058 -0.365596442  0.050176530 0.087863050  0.241850984 -1.494360e-02
10 -0.01341462 -0.004374279  0.001376677 0.004041212  0.001687539 -8.881784e-05
      d_y3_d_x4
1  -0.004485301
5  -0.015187851
10 -0.001243450

, , b_1_1

      d_y1_d_x1     d_y2_d_x1     d_y3_d_x1 d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  4.322723e-01 -1.904979e-02 -8.015547e-02 0.0000000  0.00000000  0.00000000
5  2.559760e-01 -4.309406e-02 -8.364006e-02 0.1756801 -0.01722547 -0.04385058
10 4.235501e-06 -6.254719e-06 -2.028966e-05 0.0000000  0.00000000  0.00000000
    d_y1_d_x3  d_y2_d_x3  d_y3_d_x3 d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1   0.0000000 0.00000000 0.00000000 0.0000000  0.00000000  0.00000000
5  -0.3659073 0.05033196 0.08801848 0.2420286 -0.01503242 -0.01527667
10  0.0000000 0.00000000 0.00000000 0.0000000  0.00000000  0.00000000

, , b_1_2

   d_y1_d_x1  d_y2_d_x1  d_y3_d_x1 d_y1_d_x2    d_y2_d_x2   d_y3_d_x2 d_y1_d_x3
1  0.2844103 0.03659353 0.07800641  0.147862 -0.055643316 -0.15816188 0.2786688
5  0.0000000 0.00000000 0.00000000  0.431656 -0.060319529 -0.12749064 0.0000000
10 0.0000000 0.00000000 0.00000000  0.018235 -0.004908095 -0.01422558 0.0000000
     d_y2_d_x3  d_y3_d_x3  d_y1_d_x4   d_y2_d_x4    d_y3_d_x4
1  -0.06761258 0.01397771 -0.2333134 -0.06972201 -0.004485301
5   0.00000000 0.00000000  0.0000000  0.00000000  0.000000000
10  0.00000000 0.00000000  0.0000000  0.00000000  0.000000000

, , b_1_3

      d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1  -0.303700069 -0.0390754340 -0.0832970882  0.24287844 -0.020695256
5   0.097646416  0.0002251058  0.0079101827 -0.10980693  0.010766595
10 -0.001022055  0.0002923537  0.0009913603  0.02183595 -0.005853647
     d_y3_d_x2    d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1   0.02468417 -0.149770765  0.016177012 -0.172827926  0.249206211
5   0.02740834  0.484626391 -0.074524474 -0.138962472 -0.151922919
10 -0.01681944 -0.004709519  0.001474481  0.004407083  0.003108624
       d_y2_d_x4    d_y3_d_x4
1   0.0741184891  0.004574119
5   0.0092814645  0.008926193
10 -0.0000721645 -0.001154632

, , b_1_4

       d_y1_d_x1     d_y2_d_x1    d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1   0.1212908204  0.0156058291  0.033266941 -0.097000062  0.008265210
5  -0.1283510527 -0.0002958895 -0.010397517  0.144335412 -0.014152119
10  0.0003101437 -0.0000887149 -0.000300829 -0.006626134  0.001776293
      d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1  -0.009858291  0.118906274 -0.0281663581  0.006017409  0.0483027366
5  -0.036026810 -0.299982261  0.0414279722  0.073407946  0.4558161031
10  0.005103872  0.001165734 -0.0005440093 -0.002586820 -0.0002020132
       d_y2_d_x4    d_y3_d_x4
1  -0.0855305198 -0.159671783
5  -0.0553731270 -0.095541649
10 -0.0002394261 -0.001210645

, , b_2_0

       d_y1_d_x1  d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -0.0090414670 -0.1533759 -0.019587546  0.038823785 -0.14266410 -0.011727560
5   0.0329540419  0.1411774  0.009013214 -0.014887909 -0.04799001 -0.004653031
10  0.0001596093  0.2197046  0.006612413 -0.003257077  0.13273560  0.012840269
      d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  -0.042663095  0.35057512  0.030753178  0.0128896893  0.32795988  0.02922107
5   0.046695980 -0.08004708 -0.002331468 -0.0523137089 -0.08233414  0.00985878
10  0.001099121 -0.22647717 -0.018174351 -0.0009325873 -0.30221381 -0.01869616

, , b_2_1

       d_y1_d_x1 d_y2_d_x1   d_y3_d_x1   d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -2.526525e-02 0.1025285 0.006560333  0.00000000  0.00000000  0.000000000
5  -4.130975e-02 0.4007844 0.037210326 -0.01488791 -0.04799001 -0.004653031
10 -6.115108e-07 0.3469243 0.022544747  0.00000000  0.00000000  0.000000000
    d_y1_d_x3   d_y2_d_x3    d_y3_d_x3   d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  0.00000000  0.00000000  0.000000000  0.00000000  0.00000000 0.00000000
5  0.04669598 -0.08004708 -0.002331468 -0.05231371 -0.08233414 0.00985878
10 0.00000000  0.00000000  0.000000000  0.00000000  0.00000000 0.00000000

, , b_2_2

      d_y1_d_x1  d_y2_d_x1   d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1  -0.009041467 -0.1533759 -0.01958755 -0.016223782 0.2559044 0.02614788
5   0.000000000  0.0000000  0.00000000 -0.056197656 0.3527944 0.03255729
10  0.000000000  0.0000000  0.00000000 -0.003417298 0.2599553 0.02877260
    d_y1_d_x3 d_y2_d_x3  d_y3_d_x3  d_y1_d_x4 d_y2_d_x4  d_y3_d_x4
1  -0.0426631 0.3505751 0.03075318 0.01288969 0.3279599 0.02922107
5   0.0000000 0.0000000 0.00000000 0.00000000 0.0000000 0.00000000
10  0.0000000 0.0000000 0.00000000 0.00000000 0.0000000 0.00000000

, , b_2_3

       d_y1_d_x1  d_y2_d_x1    d_y3_d_x1    d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1   0.0096546928  0.1637784  0.020916046 -0.041456958 0.15234011 0.012522967
5  -0.0205975704 -0.0882414 -0.005633612  0.009305528 0.02999564 0.002908327
10  0.0002001206  0.2754689  0.008290742 -0.004083773 0.16642588 0.016099320
      d_y1_d_x3  d_y2_d_x3    d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1   0.029432752 -0.1174858 -0.006570394 -0.0137057032 -0.34994230 -0.03175238
5  -0.070775066  0.4503837  0.038498185  0.0317079696  0.05060397 -0.00657252
10  0.001904794 -0.1565463 -0.006716215 -0.0002664535 -0.37869152 -0.02273737

, , b_2_4

       d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -3.855862e-03 -0.06540932 -0.008353387  0.016556956 -0.06084113 -0.005001385
5   2.707442e-02  0.11598866  0.007405086 -0.012231624 -0.03942768 -0.003822842
10 -6.072653e-05 -0.08359122 -0.002515831  0.001239224 -0.05050205 -0.004885350
       d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4 d_y2_d_x4  d_y3_d_x4
1  -0.0182187598  0.14950263  0.012789769 -0.0107614851 0.3959702 0.03858238
5   0.0387800903 -0.06571410 -0.002375877 -0.0844308097 0.3327944 0.04475984
10 -0.0001665335  0.08608947  0.007838175  0.0002394596 0.2421167 0.02348185

, , b_3_0

       d_y1_d_x1   d_y2_d_x1  d_y3_d_x1    d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1  -0.1036330470 -0.01581883 -0.1692854  0.058505811 -0.008350353 0.03177489
5   0.0092022348  0.01949003  0.1833577 -0.062146477  0.007141051 0.02361125
10  0.0001787653  0.01146679  0.1239592 -0.004659593  0.009654283 0.15087598
     d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  -0.07976397  0.03259615 -0.01486589  0.0833777491  0.02131628 -0.03352874
5   0.11701751 -0.02671752 -0.10144108 -0.0392574862 -0.02000622 -0.14108714
10  0.00104361 -0.01007527 -0.23103741 -0.0004440892 -0.01214584 -0.24735769

, , b_3_1

       d_y1_d_x1  d_y2_d_x1 d_y3_d_x1   d_y1_d_x2   d_y2_d_x2  d_y3_d_x2
1  -1.490547e-01 0.01435670 0.2632494  0.00000000 0.000000000 0.00000000
5  -7.098635e-02 0.03269126 0.4007928 -0.06214648 0.007141051 0.02361125
10 -5.949685e-06 0.01493196 0.3108666  0.00000000 0.000000000 0.00000000
   d_y1_d_x3   d_y2_d_x3  d_y3_d_x3   d_y1_d_x4  d_y2_d_x4  d_y3_d_x4
1  0.0000000  0.00000000  0.0000000  0.00000000  0.0000000  0.0000000
5  0.1174283 -0.02651213 -0.1011857 -0.03903544 -0.0198952 -0.1407763
10 0.0000000  0.00000000  0.0000000  0.00000000  0.0000000  0.0000000

, , b_3_2

   d_y1_d_x1   d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1  -0.103633 -0.01581883 -0.1692854 -0.045421607 0.03017553 0.4325348
5   0.000000  0.00000000  0.0000000 -0.133132832 0.03983231 0.4244040
10  0.000000  0.00000000  0.0000000 -0.004844308 0.01311946 0.3377834
    d_y1_d_x3  d_y2_d_x3   d_y3_d_x3  d_y1_d_x4  d_y2_d_x4  d_y3_d_x4
1  -0.0797834 0.03228529 -0.01517675 0.08338885 0.02149392 -0.0333511
5   0.0000000 0.00000000  0.00000000 0.00000000 0.00000000  0.0000000
10  0.0000000 0.00000000  0.00000000 0.00000000 0.00000000  0.0000000

, , b_3_3

       d_y1_d_x1   d_y2_d_x1  d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1   0.1106618243  0.01689172  0.1807669 -0.062473892  0.008916705 -0.03392998
5  -0.0057517580 -0.01218203 -0.1146057  0.038843988 -0.004463437 -0.01475796
10  0.0002241388  0.01437723  0.1554218 -0.005842267  0.012104684  0.18917056
       d_y1_d_x3    d_y2_d_x3  d_y3_d_x3    d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1   3.954792e-02 -0.006006638  0.4478559 -0.089112051 -0.02251532  0.03570477
5  -1.429732e-01  0.050155070  0.4643641  0.025046631  0.01265654  0.08801848
10 -7.079115e-06 -0.009170551 -0.1033937 -0.001421085 -0.01528222 -0.31032954

, , b_3_4

       d_y1_d_x1    d_y2_d_x1   d_y3_d_x1   d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.0441957868 -0.006746165 -0.07219415  0.02495064 -0.003561127  0.01355085
5   0.0075603817  0.016012636  0.15064319 -0.05105837  0.005866952  0.01939856
10 -0.0000680147 -0.004362780 -0.04716287  0.00177284 -0.003673175 -0.05740394
       d_y1_d_x3    d_y2_d_x3    d_y3_d_x3     d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  -3.386874e-02  0.013999912 -0.005995204 -0.0097445896 0.038924088 0.4181463
5   9.545698e-02 -0.022631896 -0.083544283 -0.1048259525 0.015527214 0.2840417
10 -7.771561e-05  0.003891332  0.088484775  0.0005702369 0.008150316 0.2818537

, , R_1_2

      d_y1_d_x1     d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1   0.012302106 -0.4730857642 -0.022865221 -0.23681944 0.035356899  0.04842374
5  -0.389154438 -0.1346716768  0.006126323 -0.02640070 0.200346660  0.03805750
10 -0.002199324 -0.0001412116  0.001882921  0.03400172 0.006272141 -0.02126043
     d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4    d_y2_d_x4    d_y3_d_x4
1   0.18781782  0.457367477 -0.036348702 -0.002126077 9.629630e-01  0.019095836
5  -0.13626877 -0.301680902 -0.032607250  0.512923037 1.147082e-01 -0.070032868
10 -0.01115774 -0.001038059  0.008604228  0.007238654 6.661338e-05 -0.003241851

, , R_1_3

       d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1   0.6779988895 -0.0439634710 -0.7518035116 -0.15287721  0.012866382
5   0.1100880667 -0.0272114691 -0.1341660787  0.25360526  0.002158135
10 -0.0008353512  0.0001322236 -0.0007461054  0.02054856 -0.003285345
    d_y3_d_x2    d_y1_d_x3   d_y2_d_x3    d_y3_d_x3    d_y1_d_x4    d_y2_d_x4
1  0.39436273  0.215595597 0.011479706 -0.516686693 -0.389105415 0.0892619312
5  0.25411486 -0.444344561 0.016325830 -0.312128101 -0.034061642 0.0418554080
10 0.01486094 -0.004285461 0.000928424 -0.003697043  0.001687539 0.0002498002
     d_y3_d_x4
1  0.451771953
5  0.175415238
10 0.001554312

, , R_2_3

       d_y1_d_x1  d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2  d_y3_d_x2
1  -0.0295668557 -0.0324746 -0.083808061  0.09014664 -0.03836515 -0.1240072
5   0.0509223601  0.1790779  0.041843223 -0.03551199  0.05245643 -0.1427688
10  0.0004814613  0.1066395 -0.004474384 -0.01049811  0.08873839  0.1265591
     d_y1_d_x3   d_y2_d_x3  d_y3_d_x3    d_y1_d_x4    d_y2_d_x4  d_y3_d_x4
1  -0.10115103  0.17411628  0.2007838  0.036198822  0.005462297  0.1703970
5   0.11025625 -0.19973467  0.2440270 -0.117461596 -0.321098703  0.2318146
10  0.00308642 -0.08058137 -0.2488676 -0.001509903 -0.097927222 -0.2184919

> print( drop( attr( margEffCondV, "jacobian" )[ 1, , ] ) )
                 b_1_0       b_1_1        b_1_2        b_1_3        b_1_4
d_y1_d_x1  0.284410308  0.43227229  0.284410308 -0.303700069  0.121290820
d_y2_d_x1  0.036593525 -0.01904979  0.036593525 -0.039075434  0.015605829
d_y3_d_x1  0.078006405 -0.08015547  0.078006405 -0.083297088  0.033266941
d_y1_d_x2 -0.227451818  0.00000000  0.147861986  0.242878443 -0.097000062
d_y2_d_x2  0.019380781  0.00000000 -0.055643316 -0.020695256  0.008265210
d_y3_d_x2 -0.023116338  0.00000000 -0.158161880  0.024684173 -0.009858291
d_y1_d_x3  0.278668755  0.00000000  0.278668755 -0.149770765  0.118906274
d_y2_d_x3 -0.067612582  0.00000000 -0.067612582  0.016177012 -0.028166358
d_y3_d_x3  0.013977708  0.00000000  0.013977708 -0.172827926  0.006017409
d_y1_d_x4 -0.233313369  0.00000000 -0.233313369  0.249206211  0.048302737
d_y2_d_x4 -0.069722006  0.00000000 -0.069722006  0.074118489 -0.085530520
d_y3_d_x4 -0.004485301  0.00000000 -0.004485301  0.004574119 -0.159671783
                 b_2_0        b_2_1        b_2_2        b_2_3        b_2_4
d_y1_d_x1 -0.009041467 -0.025265249 -0.009041467  0.009654693 -0.003855862
d_y2_d_x1 -0.153375874  0.102528544 -0.153375874  0.163778394 -0.065409323
d_y3_d_x1 -0.019587546  0.006560333 -0.019587546  0.020916046 -0.008353387
d_y1_d_x2  0.038823785  0.000000000 -0.016223782 -0.041456958  0.016556956
d_y2_d_x2 -0.142664100  0.000000000  0.255904418  0.152340108 -0.060841134
d_y3_d_x2 -0.011727560  0.000000000  0.026147879  0.012522967 -0.005001385
d_y1_d_x3 -0.042663095  0.000000000 -0.042663095  0.029432752 -0.018218760
d_y2_d_x3  0.350575124  0.000000000  0.350575124 -0.117485790  0.149502632
d_y3_d_x3  0.030753178  0.000000000  0.030753178 -0.006570394  0.012789769
d_y1_d_x4  0.012889689  0.000000000  0.012889689 -0.013705703 -0.010761485
d_y2_d_x4  0.327959881  0.000000000  0.327959881 -0.349942297  0.395970154
d_y3_d_x4  0.029221070  0.000000000  0.029221070 -0.031752379  0.038582376
                 b_3_0      b_3_1       b_3_2        b_3_3        b_3_4
d_y1_d_x1 -0.103633047 -0.1490547 -0.10363305  0.110661824 -0.044195787
d_y2_d_x1 -0.015818829  0.0143567 -0.01581883  0.016891721 -0.006746165
d_y3_d_x1 -0.169285366  0.2632494 -0.16928537  0.180766927 -0.072194152
d_y1_d_x2  0.058505811  0.0000000 -0.04542161 -0.062473892  0.024950635
d_y2_d_x2 -0.008350353  0.0000000  0.03017553  0.008916705 -0.003561127
d_y3_d_x2  0.031774889  0.0000000  0.43253479 -0.033929980  0.013550853
d_y1_d_x3 -0.079763973  0.0000000 -0.07978340  0.039547925 -0.033868741
d_y2_d_x3  0.032596148  0.0000000  0.03228529 -0.006006638  0.013999912
d_y3_d_x3 -0.014865886  0.0000000 -0.01517675  0.447855873 -0.005995204
d_y1_d_x4  0.083377749  0.0000000  0.08338885 -0.089112051 -0.009744590
d_y2_d_x4  0.021316282  0.0000000  0.02149392 -0.022515323  0.038924088
d_y3_d_x4 -0.033528735  0.0000000 -0.03335110  0.035704772  0.418146304
                 R_1_2       R_1_3        R_2_3
d_y1_d_x1  0.012302106  0.67799889 -0.029566856
d_y2_d_x1 -0.473085764 -0.04396347 -0.032474601
d_y3_d_x1 -0.022865221 -0.75180351 -0.083808061
d_y1_d_x2 -0.236819439 -0.15287721  0.090146639
d_y2_d_x2  0.035356899  0.01286638 -0.038365154
d_y3_d_x2  0.048423740  0.39436273 -0.124007224
d_y1_d_x3  0.187817817  0.21559560 -0.101151032
d_y2_d_x3  0.457367477  0.01147971  0.174116277
d_y3_d_x3 -0.036348702 -0.51668669  0.200783834
d_y1_d_x4 -0.002126077 -0.38910541  0.036198822
d_y2_d_x4  0.962963043  0.08926193  0.005462297
d_y3_d_x4  0.019095836  0.45177195  0.170397030
> summary( margEffCondV )
               Estimate Std. error z value Pr(> z)
1: d_y1_d_x1  0.4118196  0.9874701   0.417   0.677
1: d_y2_d_x1  0.1175542  0.5668409   0.207   0.836
1: d_y3_d_x1 -0.3603571  0.8747667  -0.412   0.680
1: d_y1_d_x2 -0.2293360  0.4933078  -0.465   0.642
1: d_y2_d_x2  0.2459294  0.3473869   0.708   0.479
1: d_y3_d_x2 -0.1258047  0.6244474  -0.201   0.840
1: d_y1_d_x3  0.1765116  0.5514965   0.320   0.749
1: d_y2_d_x3 -0.3517929  0.7308406  -0.481   0.630
1: d_y3_d_x3  0.2229842  0.7362455   0.303   0.762
1: d_y1_d_x4 -0.1468375  0.5904257  -0.249   0.804
1: d_y2_d_x4 -0.3287218  1.2062887  -0.273   0.785
1: d_y3_d_x4  0.6037347  0.6645420   0.908   0.364
2: d_y1_d_x1  0.4391801  0.5396814   0.814   0.416
2: d_y2_d_x1  0.2708273  0.5064146   0.535   0.593
2: d_y3_d_x1 -0.2615752  0.5086753  -0.514   0.607
2: d_y1_d_x2 -0.3205450  0.6169442  -0.520   0.603
2: d_y2_d_x2  0.2631544  0.4251005   0.619   0.536
2: d_y3_d_x2 -0.1630063  0.5399154  -0.302   0.763
2: d_y1_d_x3  0.3298530  0.9425914   0.350   0.726
2: d_y2_d_x3 -0.5053126  0.6065611  -0.833   0.405
2: d_y3_d_x3  0.2791236  0.6654652   0.419   0.675
2: d_y1_d_x4 -0.2238688  0.8088598  -0.277   0.782
2: d_y2_d_x4 -0.5675504  0.4996838  -1.136   0.256
2: d_y3_d_x4  0.4883268  0.4790371   1.019   0.308
3: d_y1_d_x1  0.0002023  0.0027799   0.073   0.942
3: d_y2_d_x1  0.2319696  0.5132733   0.452   0.651
3: d_y3_d_x1 -0.1301103  0.3728767  -0.349   0.727
3: d_y1_d_x2 -0.0057134  0.0544799  -0.105   0.916
3: d_y2_d_x2  0.1109910  0.3519614   0.315   0.752
3: d_y3_d_x2 -0.1661675  0.4411338  -0.377   0.706
3: d_y1_d_x3  0.0011362  0.0141781   0.080   0.936
3: d_y2_d_x3 -0.1491872  0.2998508  -0.498   0.619
3: d_y3_d_x3  0.1853440  0.3666063   0.506   0.613
3: d_y1_d_x4 -0.0006208  0.0085801  -0.072   0.942
3: d_y2_d_x4 -0.1992018  0.5508161  -0.362   0.718
3: d_y3_d_x4  0.1994459  0.5348884   0.373   0.709
> margEffCondVA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    vcov = diag( 18 ), returnJacobian = TRUE, algorithm = GenzBretz() )
> all.equal( margEffCondV, margEffCondVA )
[1] TRUE
> # now with Jacobian but without variance covariance matrix
> margEffCondJac <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    returnJacobian = TRUE, algorithm = GenzBretz() )
> all.equal( attr( margEffCondJac, "jacobian" ), attr( margEffCondV, "jacobian" ) )
[1] TRUE
> # now with mean values of marginal effects
> margEffCondM <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    vcov = diag( 18 ), addMean = TRUE, returnJacobian = TRUE,
+    algorithm = GenzBretz() )
> all.equal( margEffCondV, margEffCondM[ 1:3, ], check.attributes = FALSE )
[1] TRUE
> print( margEffCondM )
        d_y1_d_x1 d_y2_d_x1  d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1    0.4118196285 0.1175542 -0.3603571 -0.229336023 0.2459294 -0.1258047
2    0.4391801486 0.2708273 -0.2615752 -0.320544987 0.2631544 -0.1630063
3    0.0002023317 0.2319696 -0.1301103 -0.005713415 0.1109910 -0.1661675
mean 0.2837340363 0.2067837 -0.2506808 -0.185198142 0.2066916 -0.1516595
       d_y1_d_x3  d_y2_d_x3 d_y3_d_x3     d_y1_d_x4  d_y2_d_x4 d_y3_d_x4
1    0.176511553 -0.3517929 0.2229842 -0.1468374651 -0.3287218 0.6037347
2    0.329853049 -0.5053126 0.2791236 -0.2238687968 -0.5675504 0.4883268
3    0.001136227 -0.1491872 0.1853440 -0.0006208183 -0.1992018 0.1994459
mean 0.169166943 -0.3354309 0.2291506 -0.1237756934 -0.3651580 0.4305025
> all.equal( attr( margEffCondV, "vcov" ), 
+    attr( margEffCondM, "vcov" )[ 1:3, , ] )
[1] TRUE
> print( attr( margEffCondM, "vcov" ) )
, , d_y1_d_x1

        d_y1_d_x1     d_y2_d_x1     d_y3_d_x1     d_y1_d_x2     d_y2_d_x2
1    9.750971e-01 -0.0030037424 -4.490045e-01 -0.2274334727  0.0068307497
5    2.912560e-01  0.0387204653 -5.823824e-02  0.0274927902 -0.0755630123
10   7.727995e-06  0.0001515647  5.378415e-05 -0.0001392449  0.0001042601
mean 1.626491e-01  0.0104253263 -1.058717e-01  0.0523851888 -0.0162192448
        d_y3_d_x2     d_y1_d_x3     d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1    0.1589283487  3.934286e-01 -0.0545844515 -0.2432581367 -4.944853e-01
5    0.0074691017  5.540639e-02  0.0922668020 -0.0213238363 -2.595350e-01
10   0.0002038302  3.910299e-05 -0.0001169125 -0.0002194712 -2.332565e-05
mean 0.0252988980 -5.398643e-02 -0.0001407298 -0.0383490510 -5.105689e-02
         d_y2_d_x4    d_y3_d_x4
1    -0.0198229985  0.269608565
5    -0.0399537906  0.081566935
10   -0.0001923054 -0.000239452
mean -0.0380279444  0.058379517

, , d_y2_d_x1

         d_y1_d_x1 d_y2_d_x1  d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1    -0.0030037424 0.3213086 0.08092957  0.089143004 -0.005045259 -0.05181404
5     0.0387204653 0.2564557 0.05195901 -0.032248624 -0.049598653 -0.03718387
10    0.0001515647 0.2634495 0.01979479 -0.003199861  0.088988794  0.02585722
mean  0.0104253263 0.1517178 0.02393939  0.014984015 -0.020431173 -0.01708688
        d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4
1    -0.044425020 -0.36633542  0.03799573 -0.0186951558 -0.65413500
5     0.111725783 -0.09090843  0.03549096 -0.1448381970 -0.08484975
10    0.001119961 -0.10893447 -0.03755846 -0.0004868155 -0.20179176
mean  0.005496937 -0.02052404  0.01835492 -0.0417439997 -0.13147660
         d_y3_d_x4
1    -0.0552752423
5     0.0541038449
10   -0.0441614036
mean  0.0000317336

, , d_y3_d_x1

         d_y1_d_x1  d_y2_d_x1 d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1    -4.490045e-01 0.08092957 0.7652168  0.066369491 -0.008445285 -0.38941393
5    -5.823824e-02 0.05195901 0.2587506 -0.104236832  0.007911417 -0.01687398
10    5.378415e-05 0.01979479 0.1390371 -0.001494665  0.005243041  0.05039549
mean -1.058717e-01 0.02393939 0.2095090 -0.015516234 -0.004223757 -0.08103704
         d_y1_d_x3    d_y2_d_x3   d_y3_d_x3     d_y1_d_x4    d_y2_d_x4
1    -0.0589534852 -0.077033570  0.47425474  0.1896566521 -0.147082517
5     0.2077087857 -0.049667231 -0.08374910 -0.0711749077 -0.028633123
10    0.0001153093 -0.005509167 -0.04793679 -0.0002881854 -0.009574259
mean  0.0408532581 -0.007330939  0.08701954  0.0277307543 -0.021156231
       d_y3_d_x4
1    -0.37529645
5    -0.06049581
10   -0.09158989
mean -0.08593253

, , d_y1_d_x2

         d_y1_d_x1    d_y2_d_x1    d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1    -0.2274334727  0.089143004  0.066369491 0.243352635 -0.051781028
5     0.0274927902 -0.032248624 -0.104236832 0.380620095 -0.066218734
10   -0.0001392449 -0.003199861 -0.001494665 0.002968057 -0.003344902
mean  0.0523851888  0.014984015 -0.015516234 0.058997209 -0.024817479
        d_y3_d_x2     d_y1_d_x3    d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1    -0.110923427 -0.1634907455 -0.065895948  0.034895237  0.1447586659
5    -0.072756702 -0.3655508281  0.064808166  0.005143587  0.1635483990
10   -0.006398513 -0.0007031102  0.002480571  0.004946782  0.0004110672
mean -0.039419377  0.0138913782 -0.012338688 -0.013060512 -0.0272746901
        d_y2_d_x4    d_y3_d_x4
1    -0.178230527 -0.030899876
5     0.005741983  0.023511638
10    0.004025100  0.005824760
mean -0.031316182  0.009377012

, , d_y2_d_x2

         d_y1_d_x1    d_y2_d_x1    d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1     0.0068307497 -0.005045259 -0.008445285 -0.051781028 0.1206777 0.04231634
5    -0.0755630123 -0.049598653  0.007911417 -0.066218734 0.1807104 0.04028227
10    0.0001042601  0.088988794  0.005243041 -0.003344902 0.1238768 0.03178731
mean -0.0162192448 -0.020431173 -0.004223757 -0.024817479 0.1107039 0.02655881
         d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4    d_y2_d_x4
1     0.0067652152  0.02482717 -0.007132244 -0.0016813137 -0.004858253
5    -0.0056740947 -0.05095621 -0.002507805  0.0881209679  0.003676665
10    0.0007496257 -0.06786146 -0.029800305 -0.0003243721 -0.124388072
mean -0.0096692845  0.04219827  0.004176153  0.0194314210  0.015364291
        d_y3_d_x4
1    -0.007073870
5    -0.003166506
10   -0.034035059
mean -0.001174398

, , d_y3_d_x2

        d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1    0.1589283487 -0.05181404 -0.38941393 -0.110923427 0.04231634 0.3899346
5    0.0074691017 -0.03718387 -0.01687398 -0.072756702 0.04028227 0.2915086
10   0.0002038302  0.02585722  0.05039549 -0.006398513 0.03178731 0.1945990
mean 0.0252988980 -0.01708688 -0.08103704 -0.039419377 0.02655881 0.2294239
         d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4
1     0.0122755018  0.03624679 -0.25929664 -0.0683931619  0.10609847
5    -0.0689660516  0.01311081 -0.14267792 -0.0175189865  0.06322171
10    0.0009141576 -0.01953567 -0.09175208 -0.0007818626 -0.02874143
mean -0.0334476019  0.01523310 -0.06549887 -0.0097769890  0.02944344
       d_y3_d_x4
1     0.14925101
5     0.01111095
10   -0.14045609
mean  0.02454733

, , d_y1_d_x3

         d_y1_d_x1    d_y2_d_x1     d_y3_d_x1     d_y1_d_x2     d_y2_d_x2
1     3.934286e-01 -0.044425020 -0.0589534852 -0.1634907455  0.0067652152
5     5.540639e-02  0.111725783  0.2077087857 -0.3655508281 -0.0056740947
10    3.910299e-05  0.001119961  0.0001153093 -0.0007031102  0.0007496257
mean -5.398643e-02  0.005496937  0.0408532581  0.0138913782 -0.0096692845
         d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1     0.0122755018 0.3041483610 -0.0146727944 -0.086880437 -0.2673697861
5    -0.0689660516 0.8884786267 -0.1309429600 -0.084807263 -0.4882227548
10    0.0009141576 0.0002010184 -0.0008269078 -0.001171050 -0.0001169866
mean -0.0334476019 0.0510479210 -0.0100354163 -0.007668509 -0.0121701363
        d_y2_d_x4     d_y3_d_x4
1     0.088302701  0.0500342788
5    -0.040929466 -0.0141029862
10   -0.001410629 -0.0009810036
mean  0.009443088 -0.0040337275

, , d_y2_d_x3

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2
1    -0.0545844515 -0.36633542 -0.077033570 -0.065895948  0.02482717
5     0.0922668020 -0.09090843 -0.049667231  0.064808166 -0.05095621
10   -0.0001169125 -0.10893447 -0.005509167  0.002480571 -0.06786146
mean -0.0001407298 -0.02052404 -0.007330939 -0.012338688  0.04219827
       d_y3_d_x2     d_y1_d_x3  d_y2_d_x3   d_y3_d_x3     d_y1_d_x4  d_y2_d_x4
1     0.03624679 -0.0146727944 0.53412794 0.028046176  0.0499321586 0.78776994
5     0.01311081 -0.1309429600 0.36791631 0.026678850 -0.0433949192 0.04116895
10   -0.01953567 -0.0008269078 0.08991047 0.029517722  0.0004160018 0.15675641
mean  0.01523310 -0.0100354163 0.02677747 0.001899146  0.0112226982 0.04196367
         d_y3_d_x4
1     0.0822236830
5    -0.0304562181
10    0.0338585491
mean -0.0003278372

, , d_y3_d_x3

         d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1    -0.2432581367  0.03799573  0.47425474  0.034895237 -0.007132244
5    -0.0213238363  0.03549096 -0.08374910  0.005143587 -0.002507805
10   -0.0002194712 -0.03755846 -0.04793679  0.004946782 -0.029800305
mean -0.0383490510  0.01835492  0.08701954 -0.013060512  0.004176153
       d_y3_d_x2    d_y1_d_x3   d_y2_d_x3 d_y3_d_x3    d_y1_d_x4   d_y2_d_x4
1    -0.25929664 -0.086880437 0.028046176 0.5420574 0.1174787233 -0.07872452
5    -0.14267792 -0.084807263 0.026678850 0.4428440 0.0923533969 -0.09298806
10   -0.09175208 -0.001171050 0.029517722 0.1344002 0.0007734578  0.03941158
mean -0.06549887 -0.007668509 0.001899146 0.1824442 0.0293194432 -0.03419992
       d_y3_d_x4
1    -0.18479475
5     0.03846137
10    0.16918625
mean -0.05560452

, , d_y1_d_x4

         d_y1_d_x1     d_y2_d_x1     d_y3_d_x1     d_y1_d_x2     d_y2_d_x2
1    -4.944853e-01 -0.0186951558  0.1896566521  0.1447586659 -0.0016813137
5    -2.595350e-01 -0.1448381970 -0.0711749077  0.1635483990  0.0881209679
10   -2.332565e-05 -0.0004868155 -0.0002881854  0.0004110672 -0.0003243721
mean -5.105689e-02 -0.0417439997  0.0277307543 -0.0272746901  0.0194314210
         d_y3_d_x2     d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1    -0.0683931619 -0.2673697861  0.0499321586 0.1174787233 3.486025e-01
5    -0.0175189865 -0.4882227548 -0.0433949192 0.0923533969 6.542542e-01
10   -0.0007818626 -0.0001169866  0.0004160018 0.0007734578 7.361778e-05
mean -0.0097769890 -0.0121701363  0.0112226982 0.0293194432 9.683524e-02
        d_y2_d_x4    d_y3_d_x4
1    0.0244780006 -0.186198829
5    0.0435973898 -0.142957210
10   0.0006209189  0.001044309
mean 0.0432648258 -0.062997985

, , d_y2_d_x4

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1    -0.0198229985 -0.65413500 -0.147082517 -0.178230527 -0.004858253
5    -0.0399537906 -0.08484975 -0.028633123  0.005741983  0.003676665
10   -0.0001923054 -0.20179176 -0.009574259  0.004025100 -0.124388072
mean -0.0380279444 -0.13147660 -0.021156231 -0.031316182  0.015364291
       d_y3_d_x2    d_y1_d_x3  d_y2_d_x3   d_y3_d_x3    d_y1_d_x4 d_y2_d_x4
1     0.10609847  0.088302701 0.78776994 -0.07872452 0.0244780006 1.4551324
5     0.06322171 -0.040929466 0.04116895 -0.09298806 0.0435973898 0.2496839
10   -0.02874143 -0.001410629 0.15675641  0.03941158 0.0006209189 0.3033983
mean  0.02944344  0.009443088 0.04196367 -0.03419992 0.0432648258 0.3238163
       d_y3_d_x4
1     0.13386282
5    -0.04520915
10    0.05138708
mean  0.02371622

, , d_y3_d_x4

        d_y1_d_x1     d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1     0.269608565 -0.0552752423 -0.37529645 -0.030899876 -0.007073870
5     0.081566935  0.0541038449 -0.06049581  0.023511638 -0.003166506
10   -0.000239452 -0.0441614036 -0.09158989  0.005824760 -0.034035059
mean  0.058379517  0.0000317336 -0.08593253  0.009377012 -0.001174398
       d_y3_d_x2     d_y1_d_x3     d_y2_d_x3   d_y3_d_x3    d_y1_d_x4
1     0.14925101  0.0500342788  0.0822236830 -0.18479475 -0.186198829
5     0.01111095 -0.0141029862 -0.0304562181  0.03846137 -0.142957210
10   -0.14045609 -0.0009810036  0.0338585491  0.16918625  0.001044309
mean  0.02454733 -0.0040337275 -0.0003278372 -0.05560452 -0.062997985
       d_y2_d_x4 d_y3_d_x4
1     0.13386282 0.4416161
5    -0.04520915 0.2294765
10    0.05138708 0.2861057
mean  0.02371622 0.1908066

> print( drop( attr( margEffCondM, "vcov" )[ 4, , ] ) )
              d_y1_d_x1     d_y2_d_x1    d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
d_y1_d_x1  0.1626490561  0.0104253263 -0.105871709  0.052385189 -0.016219245
d_y2_d_x1  0.0104253263  0.1517178036  0.023939392  0.014984015 -0.020431173
d_y3_d_x1 -0.1058717094  0.0239393920  0.209509037 -0.015516234 -0.004223757
d_y1_d_x2  0.0523851888  0.0149840150 -0.015516234  0.058997209 -0.024817479
d_y2_d_x2 -0.0162192448 -0.0204311730 -0.004223757 -0.024817479  0.110703946
d_y3_d_x2  0.0252988980 -0.0170868753 -0.081037045 -0.039419377  0.026558814
d_y1_d_x3 -0.0539864310  0.0054969371  0.040853258  0.013891378 -0.009669284
d_y2_d_x3 -0.0001407298 -0.0205240410 -0.007330939 -0.012338688  0.042198267
d_y3_d_x3 -0.0383490510  0.0183549215  0.087019539 -0.013060512  0.004176153
d_y1_d_x4 -0.0510568912 -0.0417439997  0.027730754 -0.027274690  0.019431421
d_y2_d_x4 -0.0380279444 -0.1314765982 -0.021156231 -0.031316182  0.015364291
d_y3_d_x4  0.0583795170  0.0000317336 -0.085932530  0.009377012 -0.001174398
             d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
d_y1_d_x1  0.025298898 -0.053986431 -0.0001407298 -0.038349051 -0.051056891
d_y2_d_x1 -0.017086875  0.005496937 -0.0205240410  0.018354921 -0.041744000
d_y3_d_x1 -0.081037045  0.040853258 -0.0073309387  0.087019539  0.027730754
d_y1_d_x2 -0.039419377  0.013891378 -0.0123386882 -0.013060512 -0.027274690
d_y2_d_x2  0.026558814 -0.009669284  0.0421982671  0.004176153  0.019431421
d_y3_d_x2  0.229423945 -0.033447602  0.0152330975 -0.065498874 -0.009776989
d_y1_d_x3 -0.033447602  0.051047921 -0.0100354163 -0.007668509 -0.012170136
d_y2_d_x3  0.015233097 -0.010035416  0.0267774715  0.001899146  0.011222698
d_y3_d_x3 -0.065498874 -0.007668509  0.0018991463  0.182444151  0.029319443
d_y1_d_x4 -0.009776989 -0.012170136  0.0112226982  0.029319443  0.096835243
d_y2_d_x4  0.029443439  0.009443088  0.0419636683 -0.034199922  0.043264826
d_y3_d_x4  0.024547332 -0.004033727 -0.0003278372 -0.055604523 -0.062997985
             d_y2_d_x4     d_y3_d_x4
d_y1_d_x1 -0.038027944  0.0583795170
d_y2_d_x1 -0.131476598  0.0000317336
d_y3_d_x1 -0.021156231 -0.0859325299
d_y1_d_x2 -0.031316182  0.0093770123
d_y2_d_x2  0.015364291 -0.0011743977
d_y3_d_x2  0.029443439  0.0245473325
d_y1_d_x3  0.009443088 -0.0040337275
d_y2_d_x3  0.041963668 -0.0003278372
d_y3_d_x3 -0.034199922 -0.0556045235
d_y1_d_x4  0.043264826 -0.0629979848
d_y2_d_x4  0.323816275  0.0237162220
d_y3_d_x4  0.023716222  0.1908065893
> all.equal( attr( margEffCondV, "jacobian" ), 
+    attr( margEffCondM, "jacobian" )[ 1:3, , ] )
[1] TRUE
> print( attr( margEffCondM, "jacobian" ) )
, , b_1_0

         d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2     d_y2_d_x2
1     0.2844103080  0.0365935254  0.0780064050 -0.22745182  0.0193807806
5    -0.1562244503 -0.0003601466 -0.0126554974  0.17568006 -0.0172254690
10   -0.0008151565  0.0002331714  0.0007906751  0.01741561 -0.0046686689
mean  0.0424569004  0.0121555167  0.0220471942 -0.01145205 -0.0008377857
       d_y3_d_x2    d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4
1    -0.02311634  0.278668755 -0.067612582 0.013977708 -0.233313369
5    -0.04385058 -0.365596442  0.050176530 0.087863050  0.241850984
10   -0.01341462 -0.004374279  0.001376677 0.004041212  0.001687539
mean -0.02679385 -0.030433989 -0.005353125 0.035293990  0.003408385
         d_y2_d_x4    d_y3_d_x4
1    -6.972201e-02 -0.004485301
5    -1.494360e-02 -0.015187851
10   -8.881784e-05 -0.001243450
mean -2.825148e-02 -0.006972201

, , b_1_1

        d_y1_d_x1     d_y2_d_x1     d_y3_d_x1  d_y1_d_x2    d_y2_d_x2
1    4.322723e-01 -1.904979e-02 -8.015547e-02 0.00000000  0.000000000
5    2.559760e-01 -4.309406e-02 -8.364006e-02 0.17568006 -0.017225469
10   4.235501e-06 -6.254719e-06 -2.028966e-05 0.00000000  0.000000000
mean 2.294175e-01 -2.071670e-02 -5.460527e-02 0.05856002 -0.005741823
       d_y3_d_x2  d_y1_d_x3  d_y2_d_x3  d_y3_d_x3  d_y1_d_x4    d_y2_d_x4
1     0.00000000  0.0000000 0.00000000 0.00000000 0.00000000  0.000000000
5    -0.04385058 -0.3659073 0.05033196 0.08801848 0.24202862 -0.015032420
10    0.00000000  0.0000000 0.00000000 0.00000000 0.00000000  0.000000000
mean -0.01461686 -0.1219691 0.01677732 0.02933949 0.08067621 -0.005010807
        d_y3_d_x4
1     0.000000000
5    -0.015276669
10    0.000000000
mean -0.005092223

, , b_1_2

      d_y1_d_x1  d_y2_d_x1  d_y3_d_x1 d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1    0.28441031 0.03659353 0.07800641  0.147862 -0.055643316 -0.15816188
5    0.00000000 0.00000000 0.00000000  0.431656 -0.060319529 -0.12749064
10   0.00000000 0.00000000 0.00000000  0.018235 -0.004908095 -0.01422558
mean 0.09480344 0.01219784 0.02600214  0.199251 -0.040290313 -0.09995937
      d_y1_d_x3   d_y2_d_x3   d_y3_d_x3   d_y1_d_x4   d_y2_d_x4    d_y3_d_x4
1    0.27866875 -0.06761258 0.013977708 -0.23331337 -0.06972201 -0.004485301
5    0.00000000  0.00000000 0.000000000  0.00000000  0.00000000  0.000000000
10   0.00000000  0.00000000 0.000000000  0.00000000  0.00000000  0.000000000
mean 0.09288958 -0.02253753 0.004659236 -0.07777112 -0.02324067 -0.001495100

, , b_1_3

        d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1    -0.303700069 -0.0390754340 -0.0832970882  0.24287844 -0.020695256
5     0.097646416  0.0002251058  0.0079101827 -0.10980693  0.010766595
10   -0.001022055  0.0002923537  0.0009913603  0.02183595 -0.005853647
mean -0.069025236 -0.0128526582 -0.0247985150  0.05163582 -0.005260769
       d_y3_d_x2    d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1     0.02468417 -0.149770765  0.016177012 -0.172827926  0.249206211
5     0.02740834  0.484626391 -0.074524474 -0.138962472 -0.151922919
10   -0.01681944 -0.004709519  0.001474481  0.004407083  0.003108624
mean  0.01175769  0.110048702 -0.018957661 -0.102461105  0.033463972
         d_y2_d_x4    d_y3_d_x4
1     0.0741184891  0.004574119
5     0.0092814645  0.008926193
10   -0.0000721645 -0.001154632
mean  0.0277759297  0.004115227

, , b_1_4

         d_y1_d_x1     d_y2_d_x1    d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1     0.1212908204  0.0156058291  0.033266941 -0.097000062  0.008265210
5    -0.1283510527 -0.0002958895 -0.010397517  0.144335412 -0.014152119
10    0.0003101437 -0.0000887149 -0.000300829 -0.006626134  0.001776293
mean -0.0022500295  0.0050737415  0.007522865  0.013569738 -0.001370206
        d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1    -0.009858291  0.118906274 -0.0281663581  0.006017409  0.0483027366
5    -0.036026810 -0.299982261  0.0414279722  0.073407946  0.4558161031
10    0.005103872  0.001165734 -0.0005440093 -0.002586820 -0.0002020132
mean -0.013593743 -0.059970084  0.0042392016  0.025612845  0.1679722755
         d_y2_d_x4    d_y3_d_x4
1    -0.0855305198 -0.159671783
5    -0.0553731270 -0.095541649
10   -0.0002394261 -0.001210645
mean -0.0470476910 -0.085474693

, , b_2_0

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2
1    -0.0090414670 -0.15337587 -0.019587546  0.038823785 -0.14266410
5     0.0329540419  0.14117738  0.009013214 -0.014887909 -0.04799001
10    0.0001596093  0.21970457  0.006612413 -0.003257077  0.13273560
mean  0.0080240614  0.06916869 -0.001320640  0.006892933 -0.01930617
        d_y3_d_x2    d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1    -0.011727560 -0.042663095  0.35057512  0.030753178  0.0128896893
5    -0.004653031  0.046695980 -0.08004708 -0.002331468 -0.0523137089
10    0.012840269  0.001099121 -0.22647717 -0.018174351 -0.0009325873
mean -0.001180107  0.001710669  0.01468362  0.003415786 -0.0134522023
       d_y2_d_x4    d_y3_d_x4
1     0.32795988  0.029221070
5    -0.08233414  0.009858780
10   -0.30221381 -0.018696156
mean -0.01886269  0.006794565

, , b_2_1

         d_y1_d_x1 d_y2_d_x1   d_y3_d_x1    d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1    -2.526525e-02 0.1025285 0.006560333  0.000000000  0.00000000  0.000000000
5    -4.130975e-02 0.4007844 0.037210326 -0.014887909 -0.04799001 -0.004653031
10   -6.115108e-07 0.3469243 0.022544747  0.000000000  0.00000000  0.000000000
mean -2.219187e-02 0.2834124 0.022105135 -0.004962636 -0.01599667 -0.001551010
      d_y1_d_x3   d_y2_d_x3     d_y3_d_x3   d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1    0.00000000  0.00000000  0.0000000000  0.00000000  0.00000000 0.00000000
5    0.04669598 -0.08004708 -0.0023314684 -0.05231371 -0.08233414 0.00985878
10   0.00000000  0.00000000  0.0000000000  0.00000000  0.00000000 0.00000000
mean 0.01556533 -0.02668236 -0.0007771561 -0.01743790 -0.02744471 0.00328626

, , b_2_2

        d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1    -0.009041467 -0.15337587 -0.019587546 -0.016223782 0.2559044 0.02614788
5     0.000000000  0.00000000  0.000000000 -0.056197656 0.3527944 0.03255729
10    0.000000000  0.00000000  0.000000000 -0.003417298 0.2599553 0.02877260
mean -0.003013822 -0.05112529 -0.006529182 -0.025279579 0.2895514 0.02915926
       d_y1_d_x3 d_y2_d_x3  d_y3_d_x3   d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1    -0.04266310 0.3505751 0.03075318 0.012889689 0.3279599 0.029221070
5     0.00000000 0.0000000 0.00000000 0.000000000 0.0000000 0.000000000
10    0.00000000 0.0000000 0.00000000 0.000000000 0.0000000 0.000000000
mean -0.01422103 0.1168584 0.01025106 0.004296563 0.1093200 0.009740357

, , b_2_3

         d_y1_d_x1  d_y2_d_x1    d_y3_d_x1    d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1     0.0096546928  0.1637784  0.020916046 -0.041456958 0.15234011 0.012522967
5    -0.0205975704 -0.0882414 -0.005633612  0.009305528 0.02999564 0.002908327
10    0.0002001206  0.2754689  0.008290742 -0.004083773 0.16642588 0.016099320
mean -0.0035809190  0.1170020  0.007857725 -0.012078401 0.11625388 0.010510205
        d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4   d_y2_d_x4
1     0.029432752 -0.11748579 -0.006570394 -0.0137057032 -0.34994230
5    -0.070775066  0.45038366  0.038498185  0.0317079696  0.05060397
10    0.001904794 -0.15654633 -0.006716215 -0.0002664535 -0.37869152
mean -0.013145840  0.05878385  0.008403858  0.0059119376 -0.22600995
       d_y3_d_x4
1    -0.03175238
5    -0.00657252
10   -0.02273737
mean -0.02035409

, , b_2_4

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2
1    -3.855862e-03 -0.06540932 -0.008353387  0.016556956 -0.06084113
5     2.707442e-02  0.11598866  0.007405086 -0.012231624 -0.03942768
10   -6.072653e-05 -0.08359122 -0.002515831  0.001239224 -0.05050205
mean  7.719276e-03 -0.01100396 -0.001154711  0.001854852 -0.05025696
        d_y3_d_x2     d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1    -0.005001385 -0.0182187598  0.14950263  0.012789769 -0.0107614851
5    -0.003822842  0.0387800903 -0.06571410 -0.002375877 -0.0844308097
10   -0.004885350 -0.0001665335  0.08608947  0.007838175  0.0002394596
mean -0.004569859  0.0067982657  0.05662600  0.006084022 -0.0316509451
     d_y2_d_x4  d_y3_d_x4
1    0.3959702 0.03858238
5    0.3327944 0.04475984
10   0.2421167 0.02348185
mean 0.3236271 0.03560802

, , b_3_0

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1    -0.1036330470 -0.015818829 -0.16928537  0.058505811 -0.008350353
5     0.0092022348  0.019490025  0.18335766 -0.062146477  0.007141051
10    0.0001787653  0.011466788  0.12395916 -0.004659593  0.009654283
mean -0.0314173490  0.005045995  0.04601049 -0.002766753  0.002814993
      d_y3_d_x2   d_y1_d_x3    d_y2_d_x3   d_y3_d_x3     d_y1_d_x4    d_y2_d_x4
1    0.03177489 -0.07976397  0.032596148 -0.01486589  0.0833777491  0.021316282
5    0.02361125  0.11701751 -0.026717517 -0.10144108 -0.0392574862 -0.020006219
10   0.15087598  0.00104361 -0.010075274 -0.23103741 -0.0004440892 -0.012145840
mean 0.06875404  0.01276571 -0.001398881 -0.11578146  0.0145587246 -0.003611926
       d_y3_d_x4
1    -0.03352874
5    -0.14108714
10   -0.24735769
mean -0.14065786

, , b_3_1

         d_y1_d_x1  d_y2_d_x1 d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1    -1.490547e-01 0.01435670 0.2632494  0.00000000 0.000000000 0.000000000
5    -7.098635e-02 0.03269126 0.4007928 -0.06214648 0.007141051 0.023611252
10   -5.949685e-06 0.01493196 0.3108666  0.00000000 0.000000000 0.000000000
mean -7.334899e-02 0.02065998 0.3249696 -0.02071549 0.002380350 0.007870417
      d_y1_d_x3    d_y2_d_x3   d_y3_d_x3   d_y1_d_x4    d_y2_d_x4   d_y3_d_x4
1    0.00000000  0.000000000  0.00000000  0.00000000  0.000000000  0.00000000
5    0.11742829 -0.026512126 -0.10118573 -0.03903544 -0.019895197 -0.14077628
10   0.00000000  0.000000000  0.00000000  0.00000000  0.000000000  0.00000000
mean 0.03914276 -0.008837375 -0.03372858 -0.01301181 -0.006631732 -0.04692543

, , b_3_2

       d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1    -0.10363305 -0.015818829 -0.16928537 -0.045421607 0.03017553 0.4325348
5     0.00000000  0.000000000  0.00000000 -0.133132832 0.03983231 0.4244040
10    0.00000000  0.000000000  0.00000000 -0.004844308 0.01311946 0.3377834
mean -0.03454435 -0.005272943 -0.05642846 -0.061132915 0.02770910 0.3982407
       d_y1_d_x3  d_y2_d_x3    d_y3_d_x3  d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1    -0.07978340 0.03228529 -0.015176749 0.08338885 0.021493918 -0.03335110
5     0.00000000 0.00000000  0.000000000 0.00000000 0.000000000  0.00000000
10    0.00000000 0.00000000  0.000000000 0.00000000 0.000000000  0.00000000
mean -0.02659447 0.01076176 -0.005058916 0.02779628 0.007164639 -0.01111703

, , b_3_3

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1     0.1106618243  0.016891721  0.18076693 -0.062473892  0.008916705
5    -0.0057517580 -0.012182031 -0.11460574  0.038843988 -0.004463437
10    0.0002241388  0.014377230  0.15542185 -0.005842267  0.012104684
mean  0.0350447351  0.006362307  0.07386101 -0.009824057  0.005519317
       d_y3_d_x2     d_y1_d_x3    d_y2_d_x3  d_y3_d_x3    d_y1_d_x4
1    -0.03392998  3.954792e-02 -0.006006638  0.4478559 -0.089112051
5    -0.01475796 -1.429732e-01  0.050155070  0.4643641  0.025046631
10    0.18917056 -7.079115e-06 -0.009170551 -0.1033937 -0.001421085
mean  0.04682754 -3.447746e-02  0.011659294  0.2696088 -0.021828835
        d_y2_d_x4   d_y3_d_x4
1    -0.022515323  0.03570477
5     0.012656542  0.08801848
10   -0.015282220 -0.31032954
mean -0.008380333 -0.06220210

, , b_3_4

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
1    -0.0441957868 -0.006746165 -0.07219415  0.024950635 -0.0035611267
5     0.0075603817  0.016012636  0.15064319 -0.051058369  0.0058669523
10   -0.0000680147 -0.004362780 -0.04716287  0.001772840 -0.0036731748
mean -0.0122344733  0.001634564  0.01042872 -0.008111631 -0.0004557831
        d_y3_d_x2     d_y1_d_x3    d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1     0.013550853 -3.386874e-02  0.013999912 -0.0059952043 -0.0097445896
5     0.019398558  9.545698e-02 -0.022631896 -0.0835442826 -0.1048259525
10   -0.057403936 -7.771561e-05  0.003891332  0.0884847751  0.0005702369
mean -0.008151508  2.050351e-02 -0.001580217 -0.0003515706 -0.0380001017
       d_y2_d_x4 d_y3_d_x4
1    0.038924088 0.4181463
5    0.015527214 0.2840417
10   0.008150316 0.2818537
mean 0.020867206 0.3280139

, , R_1_2

        d_y1_d_x1     d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2
1     0.012302106 -0.4730857642 -0.022865221 -0.23681944 0.035356899
5    -0.389154438 -0.1346716768  0.006126323 -0.02640070 0.200346660
10   -0.002199324 -0.0001412116  0.001882921  0.03400172 0.006272141
mean -0.126350552 -0.2026328842 -0.004951992 -0.07640614 0.080658567
       d_y3_d_x2   d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1     0.04842374  0.18781782  0.457367477 -0.036348702 -0.002126077
5     0.03805750 -0.13626877 -0.301680902 -0.032607250  0.512923037
10   -0.02126043 -0.01115774 -0.001038059  0.008604228  0.007238654
mean  0.02174027  0.01346377  0.051549505 -0.020117241  0.172678538
        d_y2_d_x4    d_y3_d_x4
1    9.629630e-01  0.019095836
5    1.147082e-01 -0.070032868
10   6.661338e-05 -0.003241851
mean 3.592460e-01 -0.018059628

, , R_1_3

         d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1     0.6779988895 -0.0439634710 -0.7518035116 -0.15287721  0.012866382
5     0.1100880667 -0.0272114691 -0.1341660787  0.25360526  0.002158135
10   -0.0008353512  0.0001322236 -0.0007461054  0.02054856 -0.003285345
mean  0.2624172017 -0.0236809055 -0.2955718985  0.04042553  0.003913057
      d_y3_d_x2    d_y1_d_x3   d_y2_d_x3    d_y3_d_x3    d_y1_d_x4    d_y2_d_x4
1    0.39436273  0.215595597 0.011479706 -0.516686693 -0.389105415 0.0892619312
5    0.25411486 -0.444344561 0.016325830 -0.312128101 -0.034061642 0.0418554080
10   0.01486094 -0.004285461 0.000928424 -0.003697043  0.001687539 0.0002498002
mean 0.22111284 -0.077678142 0.009577987 -0.277503946 -0.140493173 0.0437890465
       d_y3_d_x4
1    0.451771953
5    0.175415238
10   0.001554312
mean 0.209580501

, , R_2_3

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1    -0.0295668557 -0.03247460 -0.083808061  0.09014664 -0.03836515 -0.12400722
5     0.0509223601  0.17907793  0.041843223 -0.03551199  0.05245643 -0.14276885
10    0.0004814613  0.10663947 -0.004474384 -0.01049811  0.08873839  0.12655913
mean  0.0072789886  0.08441427 -0.015479741  0.01471218  0.03427656 -0.04673898
        d_y1_d_x3   d_y2_d_x3   d_y3_d_x3    d_y1_d_x4    d_y2_d_x4  d_y3_d_x4
1    -0.101151032  0.17411628  0.20078383  0.036198822  0.005462297  0.1703970
5     0.110256249 -0.19973467  0.24402702 -0.117461596 -0.321098703  0.2318146
10    0.003086420 -0.08058137 -0.24886759 -0.001509903 -0.097927222 -0.2184919
mean  0.004063879 -0.03539992  0.06531442 -0.027590893 -0.137854543  0.0612399

> print( drop( attr( margEffCondM, "jacobian" )[ 4, , ] ) )
                  b_1_0        b_1_1        b_1_2        b_1_3        b_1_4
d_y1_d_x1  0.0424569004  0.229417496  0.094803436 -0.069025236 -0.002250030
d_y2_d_x1  0.0121555167 -0.020716702  0.012197842 -0.012852658  0.005073742
d_y3_d_x1  0.0220471942 -0.054605274  0.026002135 -0.024798515  0.007522865
d_y1_d_x2 -0.0114520499  0.058560019  0.199251002  0.051635820  0.013569738
d_y2_d_x2 -0.0008377857 -0.005741823 -0.040290313 -0.005260769 -0.001370206
d_y3_d_x2 -0.0267938455 -0.014616861 -0.099959367  0.011757688 -0.013593743
d_y1_d_x3 -0.0304339887 -0.121969101  0.092889585  0.110048702 -0.059970084
d_y2_d_x3 -0.0053531254  0.016777320 -0.022537527 -0.018957661  0.004239202
d_y3_d_x3  0.0352939900  0.029339494  0.004659236 -0.102461105  0.025612845
d_y1_d_x4  0.0034083847  0.080676206 -0.077771123  0.033463972  0.167972275
d_y2_d_x4 -0.0282514752 -0.005010807 -0.023240669  0.027775930 -0.047047691
d_y3_d_x4 -0.0069722006 -0.005092223 -0.001495100  0.004115227 -0.085474693
                 b_2_0         b_2_1        b_2_2        b_2_3        b_2_4
d_y1_d_x1  0.008024061 -0.0221918694 -0.003013822 -0.003580919  0.007719276
d_y2_d_x1  0.069168691  0.2834124318 -0.051125291  0.117001952 -0.011003959
d_y3_d_x1 -0.001320640  0.0221051352 -0.006529182  0.007857725 -0.001154711
d_y1_d_x2  0.006892933 -0.0049626362 -0.025279579 -0.012078401  0.001854852
d_y2_d_x2 -0.019306168 -0.0159966694  0.289551399  0.116253877 -0.050256955
d_y3_d_x2 -0.001180107 -0.0015510103  0.029159259  0.010510205 -0.004569859
d_y1_d_x3  0.001710669  0.0155653268 -0.014221032 -0.013145840  0.006798266
d_y2_d_x3  0.014683625 -0.0266823600  0.116858375  0.058783847  0.056626000
d_y3_d_x3  0.003415786 -0.0007771561  0.010251059  0.008403858  0.006084022
d_y1_d_x4 -0.013452202 -0.0174379030  0.004296563  0.005911938 -0.031650945
d_y2_d_x4 -0.018862689 -0.0274447132  0.109319960 -0.226009951  0.323627087
d_y3_d_x4  0.006794565  0.0032862602  0.009740357 -0.020354089  0.035608023
                 b_3_0        b_3_1        b_3_2        b_3_3         b_3_4
d_y1_d_x1 -0.031417349 -0.073348986 -0.034544349  0.035044735 -0.0122344733
d_y2_d_x1  0.005045995  0.020659976 -0.005272943  0.006362307  0.0016345635
d_y3_d_x1  0.046010486  0.324969581 -0.056428455  0.073861012  0.0104287229
d_y1_d_x2 -0.002766753 -0.020715492 -0.061132915 -0.009824057 -0.0081116314
d_y2_d_x2  0.002814993  0.002380350  0.027709100  0.005519317 -0.0004557831
d_y3_d_x2  0.068754041  0.007870417  0.398240728  0.046827540 -0.0081515082
d_y1_d_x3  0.012765714  0.039142763 -0.026594467 -0.034477457  0.0205035063
d_y2_d_x3 -0.001398881 -0.008837375  0.010761762  0.011659294 -0.0015802174
d_y3_d_x3 -0.115781458 -0.033728575 -0.005058916  0.269608760 -0.0003515706
d_y1_d_x4  0.014558725 -0.013011814  0.027796284 -0.021828835 -0.0380001017
d_y2_d_x4 -0.003611926 -0.006631732  0.007164639 -0.008380333  0.0208672060
d_y3_d_x4 -0.140657856 -0.046925427 -0.011117033 -0.062202095  0.3280138925
                 R_1_2        R_1_3        R_2_3
d_y1_d_x1 -0.126350552  0.262417202  0.007278989
d_y2_d_x1 -0.202632884 -0.023680905  0.084414267
d_y3_d_x1 -0.004951992 -0.295571899 -0.015479741
d_y1_d_x2 -0.076406139  0.040425534  0.014712178
d_y2_d_x2  0.080658567  0.003913057  0.034276557
d_y3_d_x2  0.021740272  0.221112842 -0.046738981
d_y1_d_x3  0.013463767 -0.077678142  0.004063879
d_y2_d_x3  0.051549505  0.009577987 -0.035399924
d_y3_d_x3 -0.020117241 -0.277503946  0.065314421
d_y1_d_x4  0.172678538 -0.140493173 -0.027590893
d_y2_d_x4  0.359245966  0.043789046 -0.137854543
d_y3_d_x4 -0.018059628  0.209580501  0.061239902
> all.equal( summary( margEffCondV )[ , ], summary( margEffCondM )[ 1:36, ],
+    check.attributes = FALSE ) 
[1] TRUE
> summary( margEffCondM )[ -( 1:24 ), ]
                     Estimate  Std. error     z value    Pr(> z)
3: d_y1_d_x1     0.0002023317 0.002779927  0.07278310 0.94197872
3: d_y2_d_x1     0.2319695899 0.513273327  0.45194164 0.65131103
3: d_y3_d_x1    -0.1301102884 0.372876730 -0.34893647 0.72713701
3: d_y1_d_x2    -0.0057134148 0.054479880 -0.10487201 0.91647737
3: d_y2_d_x2     0.1109910102 0.351961409  0.31534994 0.75249597
3: d_y3_d_x2    -0.1661674838 0.441133774 -0.37668275 0.70640938
3: d_y1_d_x3     0.0011362273 0.014178097  0.08013962 0.93612621
3: d_y2_d_x3    -0.1491871869 0.299850754 -0.49753814 0.61880961
3: d_y3_d_x3     0.1853439877 0.366606299  0.50556684 0.61316077
3: d_y1_d_x4    -0.0006208183 0.008580080 -0.07235577 0.94231879
3: d_y2_d_x4    -0.1992018262 0.550816062 -0.36164854 0.71761468
3: d_y3_d_x4     0.1994459164 0.534888447  0.37287385 0.70924233
mean: d_y1_d_x1  0.2837340363 0.403297726  0.70353493 0.48172245
mean: d_y2_d_x1  0.2067837152 0.389509696  0.53088207 0.59550050
mean: d_y3_d_x1 -0.2506808492 0.457721572 -0.54767104 0.58391780
mean: d_y1_d_x2 -0.1851981416 0.242893411 -0.76246672 0.44578150
mean: d_y2_d_x2  0.2066916063 0.332722026  0.62121408 0.53445878
mean: d_y3_d_x2 -0.1516595015 0.478982197 -0.31662868 0.75152537
mean: d_y1_d_x3  0.1691669428 0.225937870  0.74873213 0.45401867
mean: d_y2_d_x3 -0.3354308933 0.163638234 -2.04983203 0.04038082
mean: d_y3_d_x3  0.2291505775 0.427134816  0.53648302 0.59162477
mean: d_y1_d_x4 -0.1237756934 0.311183616 -0.39775774 0.69080877
mean: d_y2_d_x4 -0.3651579862 0.569048570 -0.64169915 0.52106854
mean: d_y3_d_x4  0.4305024661 0.436814136  0.98555067 0.32435365
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -0.6467480  0.2788967  0.1209011 -1.2689215
> 
> # calculating marginal effects, conditional
> # (assuming that all other dependent variables are as observed)
> margEffCondObs <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE, algorithm = GenzBretz() )
> print( margEffCondObs )
     d_y1_d_x1  d_y2_d_x1   d_y3_d_x1   d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.171996342 0.20541522 -0.12683723 -0.09565856 0.22331558 -0.17476430
2  0.453396093 0.18518138 -0.10369269 -0.37122660 0.26642211 -0.08533400
3  0.097176031 0.34345525 -0.20610297 -0.27712919 0.23015413 -0.12829301
4  0.182385396 0.22260219 -0.35557783 -0.34901909 0.24641930 -0.15625477
5  0.395976600 0.26512294 -0.22405904 -0.32295096 0.25167248 -0.13425075
6  0.024154154 0.14516735 -0.07341978 -0.13290567 0.06973857 -0.06173208
7  0.247513245 0.14525007 -0.14360427 -0.02638256 0.11286656 -0.12522160
8  0.105211089 0.35027624 -0.23759517 -0.28310921 0.23964177 -0.14829929
9  0.305110226 0.02953495 -0.02468951 -0.21064577 0.08273875 -0.05169793
10 0.001391671 0.23196959 -0.11609485 -0.01856668 0.11099101 -0.13781508
     d_y1_d_x3   d_y2_d_x3  d_y3_d_x3    d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  0.049373080 -0.38496241 0.24421037 -0.035714957 -0.50420545 0.30196558
2  0.517589266 -0.42553291 0.13198369 -0.342320508 -0.46820299 0.27400615
3  0.240569744 -0.35783882 0.19252916 -0.169610695 -0.43559110 0.30277572
4  0.379022298 -0.37335148 0.24368295 -0.263740488 -0.35581139 0.56738648
5  0.538960957 -0.52391216 0.23199224 -0.395069134 -0.53871278 0.45553038
6  0.077901262 -0.07597528 0.06504185 -0.052734091 -0.09824945 0.08501070
7  0.086147908 -0.30982533 0.25313942 -0.065574382 -0.39933261 0.33260130
8  0.252190243 -0.38617280 0.23690022 -0.184985860 -0.46686982 0.37848422
9  0.152442974 -0.08913371 0.05744710 -0.100419550 -0.11271554 0.08247915
10 0.005969436 -0.14918719 0.14822613 -0.004569508 -0.19920183 0.16554889
> margEffCondObsA <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE, algorithm = GenzBretz() )
> all.equal( margEffCondObs, margEffCondObsA )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm, reduced precision
> margEffCondObs1 <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = Miwa( steps = 32 ) )
> print( margEffCondObs1 )
     d_y1_d_x1  d_y2_d_x1   d_y3_d_x1   d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.171991465 0.20539502 -0.12685115 -0.09564462 0.22333831 -0.17480315
2  0.453396083 0.18521403 -0.10371605 -0.37117815 0.26642177 -0.08535933
3  0.097170705 0.34343671 -0.20609885 -0.27708251 0.23019994 -0.12833812
4  0.182370489 0.22262642 -0.35559976 -0.34891097 0.24647789 -0.15614626
5  0.396062172 0.26491181 -0.22410218 -0.32301776 0.25167518 -0.13429372
6  0.024153542 0.14525555 -0.07342138 -0.13290025 0.06986832 -0.06174283
7  0.247601640 0.14525164 -0.14353076 -0.02631610 0.11286814 -0.12516854
8  0.105068348 0.35027704 -0.23771705 -0.28313433 0.23960011 -0.14830372
9  0.305107739 0.02953581 -0.02469139 -0.21063612 0.08275916 -0.05170784
10 0.001376583 0.23197009 -0.11610897 -0.01850896 0.11099282 -0.13777067
     d_y1_d_x3   d_y2_d_x3  d_y3_d_x3    d_y1_d_x4  d_y2_d_x4  d_y3_d_x4
1  0.049369062 -0.38498413 0.24424901 -0.035714021 -0.5042087 0.30197976
2  0.517509460 -0.42554739 0.13203173 -0.342337487 -0.4682704 0.27407828
3  0.240548424 -0.35790074 0.19257697 -0.169608457 -0.4355710 0.30284445
4  0.378960324 -0.37343664 0.24376737 -0.263744039 -0.3558907 0.56751561
5  0.538996584 -0.52376449 0.23212450 -0.395145034 -0.5387374 0.45544566
6  0.077898816 -0.07584486 0.06505061 -0.052733734 -0.0983536 0.08502351
7  0.086045011 -0.30982678 0.25307025 -0.065460222 -0.3993349 0.33273176
8  0.252171647 -0.38616972 0.23688608 -0.184932694 -0.4668721 0.37861102
9  0.152437895 -0.08917606 0.05745498 -0.100419092 -0.1127594 0.08249152
10 0.005925195 -0.14918942 0.14818743 -0.004533173 -0.1992042 0.16558531
> all.equal( margEffCondObs, margEffCondObs1 )
 [1] "Component 1: Mean relative difference: 0.0001814309" 
 [2] "Component 2: Mean relative difference: 0.0001877033" 
 [3] "Component 3: Mean relative difference: 0.0001982085" 
 [4] "Component 4: Mean relative difference: 0.0002147753" 
 [5] "Component 5: Mean relative difference: 0.0001774133" 
 [6] "Component 6: Mean relative difference: 0.0003184793" 
 [7] "Component 7: Mean relative difference: 0.0001634689" 
 [8] "Component 8: Mean relative difference: 0.000165961"  
 [9] "Component 9: Mean relative difference: 0.0002713411" 
[10] "Component 10: Mean relative difference: 0.0001883149"
[11] "Component 11: Mean relative difference: 9.769877e-05"
[12] "Component 12: Mean relative difference: 0.000233469" 
> # now with integrals obtained by the GHK algorithm
> margEffCondObs2 <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE )
> print( margEffCondObs2 )
     d_y1_d_x1  d_y2_d_x1   d_y3_d_x1   d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.171936166 0.20319620 -0.12385679 -0.09574408 0.22370224 -0.17465581
2  0.453157362 0.18439423 -0.10283446 -0.37163716 0.26656087 -0.08523642
3  0.097192904 0.34196383 -0.20081480 -0.27731868 0.23042466 -0.12837050
4  0.182458672 0.22196631 -0.35611755 -0.34922234 0.24661637 -0.15765146
5  0.393051825 0.26378595 -0.22398993 -0.32020864 0.25177381 -0.13460512
6  0.024141688 0.14342864 -0.07114934 -0.13289707 0.06960894 -0.06155653
7  0.250013279 0.14620921 -0.14248645 -0.02546471 0.11350228 -0.12521680
8  0.108800624 0.35482588 -0.23693885 -0.28378378 0.24033985 -0.14898713
9  0.305041489 0.02885883 -0.02407495 -0.21064980 0.08259898 -0.05162190
10 0.002907119 0.23387574 -0.11614252 -0.01743434 0.11167712 -0.13772572
     d_y1_d_x3   d_y2_d_x3  d_y3_d_x3    d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  0.049408838 -0.38510771 0.24239683 -0.035705096 -0.50160122 0.29597065
2  0.518101830 -0.42562594 0.13175546 -0.342035095 -0.46653179 0.27157938
3  0.240723824 -0.35806888 0.19221868 -0.169514598 -0.43268421 0.29865874
4  0.379363636 -0.37358331 0.24488856 -0.263632733 -0.35576345 0.56822990
5  0.531838528 -0.52280316 0.23325028 -0.392204561 -0.53736075 0.45497010
6  0.077871052 -0.07506461 0.06422631 -0.052702503 -0.09572552 0.08269845
7  0.085831917 -0.31144596 0.25442557 -0.069814274 -0.40247246 0.33165943
8  0.252832311 -0.38761701 0.23844919 -0.188497673 -0.47013102 0.37789393
9  0.152396701 -0.08874064 0.05695896 -0.100362821 -0.11068513 0.08053555
10 0.003382782 -0.15020695 0.14718417 -0.007893242 -0.20061813 0.16419322
> all.equal( margEffCondObs, margEffCondObs2 )
 [1] "Component 1: Mean relative difference: 0.005543512" 
 [2] "Component 2: Mean relative difference: 0.007674393" 
 [3] "Component 3: Mean relative difference: 0.008961165" 
 [4] "Component 4: Mean relative difference: 0.003050649" 
 [5] "Component 5: Mean relative difference: 0.00184501"  
 [6] "Component 6: Mean relative difference: 0.002549041" 
 [7] "Component 7: Mean relative difference: 0.005124569" 
 [8] "Component 8: Mean relative difference: 0.002339985" 
 [9] "Component 9: Mean relative difference: 0.005537837" 
[10] "Component 10: Mean relative difference: 0.00899678" 
[11] "Component 11: Mean relative difference: 0.005854874"
[12] "Component 12: Mean relative difference: 0.007158028"
> all.equal( margEffCondObs1, margEffCondObs2 )
 [1] "Component 1: Mean relative difference: 0.005627834" 
 [2] "Component 2: Mean relative difference: 0.007624478" 
 [3] "Component 3: Mean relative difference: 0.009017387" 
 [4] "Component 4: Mean relative difference: 0.003117591" 
 [5] "Component 5: Mean relative difference: 0.001876911" 
 [6] "Component 6: Mean relative difference: 0.002632088" 
 [7] "Component 7: Mean relative difference: 0.00515424"  
 [8] "Component 8: Mean relative difference: 0.002203596" 
 [9] "Component 9: Mean relative difference: 0.00552548"  
[10] "Component 10: Mean relative difference: 0.009180787"
[11] "Component 11: Mean relative difference: 0.005936969"
[12] "Component 12: Mean relative difference: 0.007245038"
> # now with variance covariance matrix and Jacobian
> margEffCondObsV <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, 
+    data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, vcov = diag( 18 ), returnJacobian = TRUE,
+    algorithm = GenzBretz() )
> print( attr( margEffCondObsV, "vcov" ) )
, , d_y1_d_x1

      d_y1_d_x1     d_y2_d_x1     d_y3_d_x1     d_y1_d_x2    d_y2_d_x2
1  2.671114e-01 -0.0018976595  0.0012381527 -0.0898724971 0.0111026043
5  4.804800e-01  0.0669899034 -0.1865386542 -0.2400866050 0.0134390760
10 7.279534e-05  0.0001048119  0.0002842755 -0.0007541722 0.0001431042
       d_y3_d_x2     d_y1_d_x3     d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1   0.0232684661  0.0871290977 -0.0177399676 -0.0452749762 -0.0615096107
5  -0.1876624140 -0.1074145476  0.1085141114  0.3282948982  0.0447948558
10  0.0005193529  0.0002662252 -0.0001022926 -0.0004098147 -0.0001890735
       d_y2_d_x4     d_y3_d_x4
1  -0.0068204289 -0.0250869153
5  -0.2422418545  0.1374495372
10 -0.0001533034 -0.0005859012

, , d_y2_d_x1

       d_y1_d_x1 d_y2_d_x1    d_y3_d_x1    d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -0.0018976595 0.1706676  0.003222529 -0.007611474 -0.01922027 -0.015126608
5   0.0669899034 0.3353120 -0.024244383 -0.023043764 -0.06623061 -0.137910505
10  0.0001048119 0.2634495  0.006039631 -0.002325959  0.08898879  0.002116951
      d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4  d_y2_d_x4    d_y3_d_x4
1   0.007305049 -0.11858593  0.008326058 -0.0014498166 -0.2776559  0.002860497
5  -0.091437246  0.08283591  0.178884983 -0.0370297126 -0.1484980  0.087180477
10  0.000340086 -0.10893447 -0.001590868 -0.0001548611 -0.2017918 -0.005231592

, , d_y3_d_x1

       d_y1_d_x1    d_y2_d_x1 d_y3_d_x1    d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1   0.0012381527  0.003222529 0.1105299 -0.024097591 -0.014252445 0.02281127
5  -0.1865386542 -0.024244383 0.3072387  0.095206563 -0.060415748 0.12725063
10  0.0002842755  0.006039631 0.1376916 -0.003939484 -0.003951327 0.06569682
     d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4    d_y2_d_x4  d_y3_d_x4
1  0.018163058 0.009363576 -0.11258162 -0.0056644662  0.003016901 -0.2102409
5  0.029859665 0.026161887 -0.30233907 -0.0222752809  0.180537117 -0.2773999
10 0.001123715 0.002298188 -0.06430114 -0.0005787055 -0.001452292 -0.1052176

, , d_y1_d_x2

       d_y1_d_x1    d_y2_d_x1    d_y3_d_x1  d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  -0.0898724971 -0.007611474 -0.024097591 0.10986178 -0.02228280 -0.02627183
5  -0.2400866050 -0.023043764  0.095206563 0.23267476 -0.05216925  0.06279417
10 -0.0007541722 -0.002325959 -0.003939484 0.01073828 -0.00361963 -0.01075533
      d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4   d_y2_d_x4    d_y3_d_x4
1  -0.058179549  0.013134169  0.019147256  0.030291362 0.017179928  0.044862936
5  -0.011435953 -0.018460870 -0.216260543 -0.156719353 0.111488447 -0.041148114
10 -0.002788209  0.002000751  0.005142881  0.001911291 0.003357581  0.007928101

, , d_y2_d_x2

      d_y1_d_x1   d_y2_d_x1    d_y3_d_x1   d_y1_d_x2 d_y2_d_x2     d_y3_d_x2
1  0.0111026043 -0.01922027 -0.014252445 -0.02228280 0.1473312 -0.0080961714
5  0.0134390760 -0.06623061 -0.060415748 -0.05216925 0.1886225 -0.0004257872
10 0.0001431042  0.08898879 -0.003951327 -0.00361963 0.1238768  0.0082323869
      d_y1_d_x3   d_y2_d_x3     d_y3_d_x3    d_y1_d_x4     d_y2_d_x4
1  0.0058140628  0.02949830  0.0422260636 -0.003319491  0.0009543671
5  0.0273894161 -0.08514916  0.0836840454  0.041852955 -0.1131972606
10 0.0004953686 -0.06786146 -0.0002171497 -0.000286752 -0.1243880723
     d_y3_d_x4
1   0.04408361
5   0.10280358
10 -0.00270248

, , d_y3_d_x2

       d_y1_d_x1    d_y2_d_x1  d_y3_d_x1   d_y1_d_x2     d_y2_d_x2 d_y3_d_x2
1   0.0232684661 -0.015126608 0.02281127 -0.02627183 -0.0080961714 0.1706051
5  -0.1876624140 -0.137910505 0.12725063  0.06279417 -0.0004257872 0.4303697
10  0.0005193529  0.002116951 0.06569682 -0.01075533  0.0082323869 0.1622181
     d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4    d_y2_d_x4   d_y3_d_x4
1  0.001137298  0.043253472 -0.04572322 -0.004974583  0.040296388 -0.08971663
5  0.024501812 -0.016294090 -0.34011612 -0.099403325  0.252717663 -0.15379709
10 0.001860797 -0.001625838 -0.07126846 -0.001334867 -0.006207211 -0.11693769

, , d_y1_d_x3

       d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1   0.0871290977  0.007305049 0.018163058 -0.058179549 0.0058140628 0.001137298
5  -0.1074145476 -0.091437246 0.029859665 -0.011435953 0.0273894161 0.024501812
10  0.0002662252  0.000340086 0.001123715 -0.002788209 0.0004953686 0.001860797
      d_y1_d_x3     d_y2_d_x3    d_y3_d_x3     d_y1_d_x4     d_y2_d_x4
1  0.0521894026 -0.0153685109 -0.025643191 -0.0294383921 -0.0148235754
5  0.3513500142 -0.1657620870 -0.117523028  0.2398832879  0.1158357073
10 0.0009906673 -0.0004001085 -0.001639983 -0.0006803364 -0.0005226474
      d_y3_d_x4
1  -0.033753890
5  -0.100643314
10 -0.002313793

, , d_y2_d_x3

       d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -0.0177399676 -0.11858593 0.009363576  0.013134169  0.02949830  0.043253472
5   0.1085141114  0.08283591 0.026161887 -0.018460870 -0.08514916 -0.016294090
10 -0.0001022926 -0.10893447 0.002298188  0.002000751 -0.06786146 -0.001625838
       d_y1_d_x3  d_y2_d_x3    d_y3_d_x3    d_y1_d_x4   d_y2_d_x4    d_y3_d_x4
1  -0.0153685109 0.18708466 -0.033064407  0.006300698 0.240449474 -0.039634609
5  -0.1657620870 0.33833702  0.037222067 -0.101515022 0.008338695 -0.076109180
10 -0.0004001085 0.08991047  0.001544213  0.000161025 0.156756405  0.004055025

, , d_y3_d_x3

       d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
1  -0.0452749762  0.008326058 -0.11258162  0.019147256  0.0422260636
5   0.3282948982  0.178884983 -0.30233907 -0.216260543  0.0836840454
10 -0.0004098147 -0.001590868 -0.06430114  0.005142881 -0.0002171497
     d_y3_d_x2    d_y1_d_x3    d_y2_d_x3  d_y3_d_x3    d_y1_d_x4    d_y2_d_x4
1  -0.04572322 -0.025643191 -0.033064407 0.22244068 0.0145491010 -0.033554080
5  -0.34011612 -0.117523028  0.037222067 0.70570062 0.1423288295 -0.391848569
10 -0.07126846 -0.001639983  0.001544213 0.07757025 0.0009269843  0.005326792
   d_y3_d_x4
1  0.2726033
5  0.3434701
10 0.1181769

, , d_y1_d_x4

       d_y1_d_x1     d_y2_d_x1     d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1  -0.0615096107 -0.0014498166 -0.0056644662  0.030291362 -0.003319491
5   0.0447948558 -0.0370297126 -0.0222752809 -0.156719353  0.041852955
10 -0.0001890735 -0.0001548611 -0.0005787055  0.001911291 -0.000286752
      d_y3_d_x2     d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1  -0.004974583 -0.0294383921  0.006300698 0.0145491010 0.0216791318
5  -0.099403325  0.2398832879 -0.101515022 0.1423288295 0.5351355080
10 -0.001334867 -0.0006803364  0.000161025 0.0009269843 0.0005311534
       d_y2_d_x4    d_y3_d_x4
1   0.0022469401  0.009029162
5  -0.0095536318 -0.143675446
10  0.0002302148  0.001021854

, , d_y2_d_x4

       d_y1_d_x1  d_y2_d_x1    d_y3_d_x1   d_y1_d_x2     d_y2_d_x2    d_y3_d_x2
1  -0.0068204289 -0.2776559  0.003016901 0.017179928  0.0009543671  0.040296388
5  -0.2422418545 -0.1484980  0.180537117 0.111488447 -0.1131972606  0.252717663
10 -0.0001533034 -0.2017918 -0.001452292 0.003357581 -0.1243880723 -0.006207211
       d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1  -0.0148235754 0.240449474 -0.033554080  0.0022469401 0.6044272 -0.02044526
5   0.1158357073 0.008338695 -0.391848569 -0.0095536318 0.5642249 -0.26202679
10 -0.0005226474 0.156756405  0.005326792  0.0002302148 0.3033983  0.01131299

, , d_y3_d_x4

       d_y1_d_x1    d_y2_d_x1  d_y3_d_x1    d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  -0.0250869153  0.002860497 -0.2102409  0.044862936  0.04408361 -0.08971663
5   0.1374495372  0.087180477 -0.2773999 -0.041148114  0.10280358 -0.15379709
10 -0.0005859012 -0.005231592 -0.1052176  0.007928101 -0.00270248 -0.11693769
      d_y1_d_x3    d_y2_d_x3 d_y3_d_x3    d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  -0.033753890 -0.039634609 0.2726033  0.009029162 -0.02044526 0.5220365
5  -0.100643314 -0.076109180 0.3434701 -0.143675446 -0.26202679 0.4793612
10 -0.002313793  0.004055025 0.1181769  0.001021854  0.01131299 0.2114558

> print( drop( attr( margEffCondObsV, "vcov" )[ 1, , ] ) )
             d_y1_d_x1    d_y2_d_x1    d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
d_y1_d_x1  0.267111405 -0.001897659  0.001238153 -0.089872497  0.0111026043
d_y2_d_x1 -0.001897659  0.170667630  0.003222529 -0.007611474 -0.0192202676
d_y3_d_x1  0.001238153  0.003222529  0.110529897 -0.024097591 -0.0142524454
d_y1_d_x2 -0.089872497 -0.007611474 -0.024097591  0.109861780 -0.0222828045
d_y2_d_x2  0.011102604 -0.019220268 -0.014252445 -0.022282804  0.1473311531
d_y3_d_x2  0.023268466 -0.015126608  0.022811267 -0.026271829 -0.0080961714
d_y1_d_x3  0.087129098  0.007305049  0.018163058 -0.058179549  0.0058140628
d_y2_d_x3 -0.017739968 -0.118585928  0.009363576  0.013134169  0.0294983027
d_y3_d_x3 -0.045274976  0.008326058 -0.112581620  0.019147256  0.0422260636
d_y1_d_x4 -0.061509611 -0.001449817 -0.005664466  0.030291362 -0.0033194912
d_y2_d_x4 -0.006820429 -0.277655856  0.003016901  0.017179928  0.0009543671
d_y3_d_x4 -0.025086915  0.002860497 -0.210240939  0.044862936  0.0440836116
             d_y3_d_x2    d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
d_y1_d_x1  0.023268466  0.087129098 -0.017739968 -0.045274976 -0.061509611
d_y2_d_x1 -0.015126608  0.007305049 -0.118585928  0.008326058 -0.001449817
d_y3_d_x1  0.022811267  0.018163058  0.009363576 -0.112581620 -0.005664466
d_y1_d_x2 -0.026271829 -0.058179549  0.013134169  0.019147256  0.030291362
d_y2_d_x2 -0.008096171  0.005814063  0.029498303  0.042226064 -0.003319491
d_y3_d_x2  0.170605098  0.001137298  0.043253472 -0.045723221 -0.004974583
d_y1_d_x3  0.001137298  0.052189403 -0.015368511 -0.025643191 -0.029438392
d_y2_d_x3  0.043253472 -0.015368511  0.187084657 -0.033064407  0.006300698
d_y3_d_x3 -0.045723221 -0.025643191 -0.033064407  0.222440678  0.014549101
d_y1_d_x4 -0.004974583 -0.029438392  0.006300698  0.014549101  0.021679132
d_y2_d_x4  0.040296388 -0.014823575  0.240449474 -0.033554080  0.002246940
d_y3_d_x4 -0.089716631 -0.033753890 -0.039634609  0.272603322  0.009029162
              d_y2_d_x4    d_y3_d_x4
d_y1_d_x1 -0.0068204289 -0.025086915
d_y2_d_x1 -0.2776558560  0.002860497
d_y3_d_x1  0.0030169012 -0.210240939
d_y1_d_x2  0.0171799282  0.044862936
d_y2_d_x2  0.0009543671  0.044083612
d_y3_d_x2  0.0402963879 -0.089716631
d_y1_d_x3 -0.0148235754 -0.033753890
d_y2_d_x3  0.2404494741 -0.039634609
d_y3_d_x3 -0.0335540805  0.272603322
d_y1_d_x4  0.0022469401  0.009029162
d_y2_d_x4  0.6044272427 -0.020445263
d_y3_d_x4 -0.0204452633  0.522036472
> print( attr( margEffCondObsV, "jacobian" ) )
, , b_1_0

      d_y1_d_x1     d_y2_d_x1    d_y3_d_x1   d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1   0.237119196 -0.0042905707 -0.004537520 -0.16362764  0.021246739  0.05309042
5   0.279256250  0.0130994340 -0.042653983 -0.18347254  0.006690779 -0.05041527
10 -0.004746446  0.0002331714  0.002017613  0.04644298 -0.004668669 -0.02071561
     d_y1_d_x3    d_y2_d_x3   d_y3_d_x3   d_y1_d_x4     d_y2_d_x4    d_y3_d_x4
1   0.11546354 -0.017597035 -0.04924117 -0.08098938  4.929390e-03  0.003941292
5   0.04649614  0.020150548  0.09161560 -0.02611245 -4.054534e-02  0.032862602
10 -0.01887379  0.001376677  0.00885958  0.01438849 -8.881784e-05 -0.001154632

, , b_1_1

      d_y1_d_x1     d_y2_d_x1     d_y3_d_x1  d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  2.760459e-01 -9.172312e-03 -2.164891e-02  0.0000000 0.000000000  0.00000000
5  4.300837e-01 -6.483072e-02 -9.133239e-02 -0.1834725 0.006690779 -0.05041527
10 3.416534e-05 -6.254719e-06 -8.454515e-05  0.0000000 0.000000000  0.00000000
    d_y1_d_x3  d_y2_d_x3  d_y3_d_x3   d_y1_d_x4  d_y2_d_x4  d_y3_d_x4
1  0.00000000 0.00000000 0.00000000  0.00000000  0.0000000 0.00000000
5  0.04634071 0.02061684 0.09177104 -0.02602363 -0.0408118 0.03277378
10 0.00000000 0.00000000 0.00000000  0.00000000  0.0000000 0.00000000

, , b_1_2

   d_y1_d_x1    d_y2_d_x1   d_y3_d_x1  d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  0.2371192 -0.004290571 -0.00453752 0.03892668 -0.004881742 -0.01711139
5  0.0000000  0.000000000  0.00000000 0.24661116 -0.058139940 -0.14174766
10 0.0000000  0.000000000  0.00000000 0.05122359 -0.004908095 -0.02281777
   d_y1_d_x3   d_y2_d_x3   d_y3_d_x3   d_y1_d_x4  d_y2_d_x4   d_y3_d_x4
1  0.1154635 -0.01759703 -0.04924117 -0.08098938 0.00492939 0.003941292
5  0.0000000  0.00000000  0.00000000  0.00000000 0.00000000 0.000000000
10 0.0000000  0.00000000  0.00000000  0.00000000 0.00000000 0.000000000

, , b_1_3

      d_y1_d_x1     d_y2_d_x1   d_y3_d_x1 d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.253201499  0.0045815732 0.004845272 0.1747255 -0.022687772 -0.05669121
5  -0.174546122 -0.0081876610 0.026660415 0.1146775 -0.004182000  0.03151152
10 -0.005951165  0.0002923537 0.002529713 0.0582309 -0.005853647 -0.02597354
     d_y1_d_x3    d_y2_d_x3    d_y3_d_x3  d_y1_d_x4     d_y2_d_x4    d_y3_d_x4
1  -0.08438371  0.013525756  0.035596448 0.08650580 -0.0041744386 -0.004107825
5   0.40110687 -0.078708507 -0.150118695 0.01643130  0.0254907206 -0.020561330
10 -0.01925572  0.001474481  0.009000073 0.01718625 -0.0000721645 -0.002131628

, , b_1_4

     d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  0.101122853 -0.0018297751 -0.0019350901 -0.06978133 0.009060974  0.02264117
5  0.229431652  0.0107622472 -0.0350437056 -0.15073756 0.005497018 -0.04142023
10 0.001805885 -0.0000887149 -0.0007676429 -0.01767021 0.001776293  0.00788169
     d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4     d_y2_d_x4
1  0.049251575 -0.0072386541 -0.021177504  0.004379314 -0.0029277490
5  0.038008485  0.0178967952  0.077160500  0.408389935 -0.0980485920
10 0.006650236 -0.0005440093 -0.004063416 -0.000592868 -0.0002394261
      d_y3_d_x4
1  -0.015490465
5  -0.064775851
10 -0.001658069

, , b_2_0

       d_y1_d_x1  d_y2_d_x1   d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  -0.0067049148 -0.2093069 -0.01110603  0.02359868 -0.07427991 -0.01969025
5  -0.0468176067  0.0601708  0.02411970  0.01982570 -0.11310591  0.01951730
10  0.0001492365  0.2197046  0.01077585 -0.00348749  0.13273560  0.01049971
      d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1  -0.013787756  0.24437119  0.02653155  0.0034687531  0.31739056  0.02636780
5   0.020222712  0.05337952 -0.03731460  0.0320410365  0.06252776 -0.03699263
10  0.001032507 -0.22647717 -0.01032507 -0.0001332268 -0.30221381 -0.01216804

, , b_2_1

       d_y1_d_x1 d_y2_d_x1   d_y3_d_x1 d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1  -1.019913e-02 0.1193442 0.003567316 0.0000000  0.0000000 0.0000000
5  -6.151580e-02 0.4058003 0.034744322 0.0198257 -0.1131059 0.0195173
10 -2.590372e-06 0.3469243 0.014366785 0.0000000  0.0000000 0.0000000
    d_y1_d_x3  d_y2_d_x3  d_y3_d_x3 d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1  0.00000000 0.00000000  0.0000000 0.0000000 0.0000000  0.00000000
5  0.02008949 0.05351275 -0.0373146 0.0318634 0.0627054 -0.03699263
10 0.00000000 0.00000000  0.0000000 0.0000000 0.0000000  0.00000000

, , b_2_2

      d_y1_d_x1  d_y2_d_x1   d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1  -0.006704915 -0.2093069 -0.01110603 -0.003494220 0.3286511 0.01467335
5   0.000000000  0.0000000  0.00000000 -0.041690108 0.2926944 0.05426163
10  0.000000000  0.0000000  0.00000000 -0.003639317 0.2599553 0.01409065
     d_y1_d_x3 d_y2_d_x3  d_y3_d_x3   d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1  -0.01378776 0.2443712 0.02653155 0.003468753 0.3173906 0.0263678
5   0.00000000 0.0000000 0.00000000 0.000000000 0.0000000 0.0000000
10  0.00000000 0.0000000 0.00000000 0.000000000 0.0000000 0.0000000

, , b_2_3

      d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  0.0071596671  0.22350287  0.01185928 -0.025199228 0.07931785  0.02102572
5  0.0292628427 -0.03760911 -0.01507576 -0.012391838 0.07069564 -0.01219908
10 0.0001871152  0.27546887  0.01351092 -0.004372667 0.16642588  0.01316469
      d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4   d_y3_d_x4
1   0.011232542  0.06788194 -0.01381498 -0.0037039816 -0.33892888 -0.02806644
5  -0.074705254  0.37237153  0.05801460 -0.0198951966 -0.03885781  0.02273737
10  0.000192342 -0.15654633 -0.01002040 -0.0003996803 -0.37869152 -0.01536549

, , b_2_4

       d_y1_d_x1   d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2    d_y3_d_x2
1  -2.859406e-03 -0.08926191 -0.004736324 0.010063992 -0.03167772 -0.008397188
5  -3.846446e-02  0.04943519  0.019816285 0.016288417 -0.09292568  0.016035047
10 -5.678036e-05 -0.08359122 -0.004099898 0.001326888 -0.05050205 -0.003994835
       d_y1_d_x3  d_y2_d_x3    d_y3_d_x3     d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1  -0.0058985802 0.10461632  0.011260437 -2.030807e-03 0.4643204 0.025697861
5   0.0168975944 0.04392042 -0.030864200 -3.549218e-02 0.4571371 0.003658077
10 -0.0002997602 0.08608947  0.003674838  7.021744e-05 0.2421167 0.008342692

, , b_3_0

       d_y1_d_x1    d_y2_d_x1  d_y3_d_x1   d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.0232567723 -0.011015572 -0.1591526  0.04568840 -0.015580858 -0.12588268
5  -0.0739470341 -0.007314459  0.2213006  0.06229383 -0.013690362  0.05968877
10  0.0008188513  0.011466788  0.1311974 -0.01094591  0.009654283  0.15417144
      d_y1_d_x3    d_y2_d_x3  d_y3_d_x3    d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  -0.028626927  0.024968916  0.2426337  0.011713547  0.02455813  0.2856604
5  -0.035238479  0.003963496 -0.1477818 -0.033484326  0.03184120 -0.2557510
10  0.003963496 -0.010075274 -0.2164158 -0.001909584 -0.01214584 -0.2393197

, , b_3_1

       d_y1_d_x1   d_y2_d_x1 d_y3_d_x1  d_y1_d_x2   d_y2_d_x2  d_y3_d_x2
1  -3.172708e-02 0.003760222 0.1006422 0.00000000  0.00000000 0.00000000
5  -1.245229e-01 0.048919331 0.3650462 0.06229383 -0.01369036 0.05968877
10 -4.433121e-06 0.014931963 0.2725413 0.00000000  0.00000000 0.00000000
     d_y1_d_x3   d_y2_d_x3  d_y3_d_x3   d_y1_d_x4 d_y2_d_x4  d_y3_d_x4
1   0.00000000 0.000000000  0.0000000  0.00000000 0.0000000  0.0000000
5  -0.03529954 0.003963496 -0.1479372 -0.03355094 0.0318412 -0.2556622
10  0.00000000 0.000000000  0.0000000  0.00000000 0.0000000  0.0000000

, , b_3_2

     d_y1_d_x1   d_y2_d_x1  d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1  -0.02325677 -0.01101557 -0.1591526 -0.008470304 0.01477579 0.2597948
5   0.00000000  0.00000000  0.0000000 -0.062229064 0.03522897 0.4247349
10  0.00000000  0.00000000  0.0000000 -0.011769192 0.01311946 0.2955153
    d_y1_d_x3  d_y2_d_x3 d_y3_d_x3  d_y1_d_x4  d_y2_d_x4 d_y3_d_x4
1  -0.0286238 0.02465805 0.2426337 0.01170383 0.02473577 0.2856604
5   0.0000000 0.00000000 0.0000000 0.00000000 0.00000000 0.0000000
10  0.0000000 0.00000000 0.0000000 0.00000000 0.00000000 0.0000000

, , b_3_3

     d_y1_d_x1   d_y2_d_x1  d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1  0.024834133 0.011762689  0.1699469 -0.04878715 0.016637610  0.13442051
5  0.046219800 0.004571824 -0.1383216 -0.03893609 0.008557014 -0.03730783
10 0.001026688 0.014377230  0.1644973 -0.01372414 0.012104684  0.19330245
      d_y1_d_x3    d_y2_d_x3     d_y3_d_x3    d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1   0.022102636 -0.011192323  0.0008547584 -0.012528173 -0.02571277 -0.3048783
5  -0.102096384  0.045943934  0.4573611985  0.020783375 -0.02042810  0.1603606
10  0.003062496 -0.009170551 -0.1310937438 -0.002220446 -0.01528222 -0.3003375

, , b_3_4

       d_y1_d_x1    d_y2_d_x1   d_y3_d_x1   d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1  -0.0099181812 -0.004697747 -0.06787290 0.019484466 -0.006644679 -0.05368446
5  -0.0607534844 -0.006009421  0.18181638 0.051179428 -0.011247743  0.04903917
10 -0.0003115489 -0.004362780 -0.04991682 0.004164601 -0.003673175 -0.05865776
      d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4 d_y3_d_x4
1  -0.012222515 0.010225154  0.10332291 -0.0034812393 0.024767800 0.3814975
5  -0.029271030 0.003164136 -0.12057022 -0.1524338957 0.075076186 0.1556137
10 -0.001598721 0.003891332  0.08185674 -0.0004680132 0.008150316 0.2321601

, , R_1_2

       d_y1_d_x1     d_y2_d_x1    d_y3_d_x1     d_y1_d_x2   d_y2_d_x2
1   0.0119593147 -0.0174661634 2.470719e-03 -0.1075036372 0.060236172
5  -0.2627469942 -0.3102622052 5.436432e-02  0.0008249928 0.141162941
10  0.0002986814 -0.0001412116 5.869194e-06 -0.0079378153 0.006272141
     d_y3_d_x2   d_y1_d_x3    d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1  0.057426766 0.044672946 -0.029198866 -3.142764e-02 -2.457756e-03
5  0.165725303 0.360367292 -0.354105634 -2.029044e-01  3.655298e-01
10 0.005869357 0.002053913 -0.001038059  4.440892e-05  4.440892e-05
      d_y2_d_x4     d_y3_d_x4
1  7.194245e-03 -0.0081157303
5  2.863931e-01 -0.1056932319
10 6.661338e-05 -0.0005329071

, , R_1_3

     d_y1_d_x1     d_y2_d_x1    d_y3_d_x1  d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1  -0.03036766 -0.0028628581 -0.046038902 0.16796613 -0.014779641 0.11986384
5  -0.13515076 -0.1522331797 -0.008299913 0.21839363 -0.004554075 0.33427476
10 -0.00310063  0.0001322236 -0.002880124 0.04099705 -0.003285345 0.03256694
     d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4    d_y2_d_x4   d_y3_d_x4
1  -0.10554734  0.011690648 -0.08223422  0.023809427 0.0023536728 0.030420111
5  -0.17428281 -0.033362202 -0.40429882 -0.447553106 0.1727951116 0.091660013
10 -0.01364464  0.000928424 -0.01226796  0.004396483 0.0002498002 0.004574119

, , R_2_3

       d_y1_d_x1 d_y2_d_x1  d_y3_d_x1     d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1  -4.065697e-04 0.1000440 -0.1147518  0.0134169502 0.14424394 -0.20173175
5   1.095618e-01 0.1914696 -0.2351233 -0.0474577989 0.19609338 -0.26047393
10 -5.019285e-05 0.1066395 -0.1269163  0.0005696239 0.08873839 -0.08386716
       d_y1_d_x3   d_y2_d_x3  d_y3_d_x3     d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1  -0.0050591475 -0.22088997 0.27925162 -0.0002026157 -0.26432190 0.34091618
5  -0.0634270414 -0.23671065 0.42570392 -0.0565325564 -0.46083137 0.51869620
10 -0.0004551914 -0.08058137 0.07938095  0.0003108624 -0.09792722 0.09796608

> print( drop( attr( margEffCondObsV, "jacobian" )[ 1, , ] ) )
                 b_1_0        b_1_1        b_1_2        b_1_3        b_1_4
d_y1_d_x1  0.237119196  0.276045875  0.237119196 -0.253201499  0.101122853
d_y2_d_x1 -0.004290571 -0.009172312 -0.004290571  0.004581573 -0.001829775
d_y3_d_x1 -0.004537520 -0.021648911 -0.004537520  0.004845272 -0.001935090
d_y1_d_x2 -0.163627640  0.000000000  0.038926679  0.174725473 -0.069781334
d_y2_d_x2  0.021246739  0.000000000 -0.004881742 -0.022687772  0.009060974
d_y3_d_x2  0.053090421  0.000000000 -0.017111390 -0.056691210  0.022641165
d_y1_d_x3  0.115463542  0.000000000  0.115463542 -0.084383710  0.049251575
d_y2_d_x3 -0.017597035  0.000000000 -0.017597035  0.013525756 -0.007238654
d_y3_d_x3 -0.049241167  0.000000000 -0.049241167  0.035596448 -0.021177504
d_y1_d_x4 -0.080989382  0.000000000 -0.080989382  0.086505803  0.004379314
d_y2_d_x4  0.004929390  0.000000000  0.004929390 -0.004174439 -0.002927749
d_y3_d_x4  0.003941292  0.000000000  0.003941292 -0.004107825 -0.015490465
                 b_2_0        b_2_1        b_2_2        b_2_3        b_2_4
d_y1_d_x1 -0.006704915 -0.010199134 -0.006704915  0.007159667 -0.002859406
d_y2_d_x1 -0.209306902  0.119344221 -0.209306902  0.223502872 -0.089261906
d_y3_d_x1 -0.011106030  0.003567316 -0.011106030  0.011859282 -0.004736324
d_y1_d_x2  0.023598678  0.000000000 -0.003494220 -0.025199228  0.010063992
d_y2_d_x2 -0.074279907  0.000000000  0.328651123  0.079317846 -0.031677723
d_y3_d_x2 -0.019690254  0.000000000  0.014673346  0.021025719 -0.008397188
d_y1_d_x3 -0.013787756  0.000000000 -0.013787756  0.011232542 -0.005898580
d_y2_d_x3  0.244371190  0.000000000  0.244371190  0.067881939  0.104616316
d_y3_d_x3  0.026531555  0.000000000  0.026531555 -0.013814977  0.011260437
d_y1_d_x4  0.003468753  0.000000000  0.003468753 -0.003703982 -0.002030807
d_y2_d_x4  0.317390558  0.000000000  0.317390558 -0.338928885  0.464320377
d_y3_d_x4  0.026367797  0.000000000  0.026367797 -0.028066438  0.025697861
                b_3_0        b_3_1        b_3_2         b_3_3        b_3_4
d_y1_d_x1 -0.02325677 -0.031727076 -0.023256772  0.0248341328 -0.009918181
d_y2_d_x1 -0.01101557  0.003760222 -0.011015572  0.0117626886 -0.004697747
d_y3_d_x1 -0.15915262  0.100642233 -0.159152617  0.1699469373 -0.067872897
d_y1_d_x2  0.04568840  0.000000000 -0.008470304 -0.0487871517  0.019484466
d_y2_d_x2 -0.01558086  0.000000000  0.014775793  0.0166376097 -0.006644679
d_y3_d_x2 -0.12588268  0.000000000  0.259794850  0.1344205125 -0.053684460
d_y1_d_x3 -0.02862693  0.000000000 -0.028623805  0.0221026360 -0.012222515
d_y2_d_x3  0.02496892  0.000000000  0.024658053 -0.0111923235  0.010225154
d_y3_d_x3  0.24263369  0.000000000  0.242633691  0.0008547584  0.103322906
d_y1_d_x4  0.01171355  0.000000000  0.011703832 -0.0125281729 -0.003481239
d_y2_d_x4  0.02455813  0.000000000  0.024735769 -0.0257127653  0.024767800
d_y3_d_x4  0.28566038  0.000000000  0.285660384 -0.3048783448  0.381497498
                 R_1_2        R_1_3         R_2_3
d_y1_d_x1  0.011959315 -0.030367660 -0.0004065697
d_y2_d_x1 -0.017466163 -0.002862858  0.1000439962
d_y3_d_x1  0.002470719 -0.046038902 -0.1147518488
d_y1_d_x2 -0.107503637  0.167966125  0.0134169502
d_y2_d_x2  0.060236172 -0.014779641  0.1442439397
d_y3_d_x2  0.057426766  0.119863838 -0.2017317546
d_y1_d_x3  0.044672946 -0.105547342 -0.0050591475
d_y2_d_x3 -0.029198866  0.011690648 -0.2208899730
d_y3_d_x3 -0.031427638 -0.082234219  0.2792516218
d_y1_d_x4 -0.002457756  0.023809427 -0.0002026157
d_y2_d_x4  0.007194245  0.002353673 -0.2643218977
d_y3_d_x4 -0.008115730  0.030420111  0.3409161842
> summary( margEffCondObsV )
              Estimate Std. error z value Pr(> z)
1: d_y1_d_x1  0.171996   0.516828   0.333   0.739
1: d_y2_d_x1  0.205415   0.413119   0.497   0.619
1: d_y3_d_x1 -0.126837   0.332460  -0.382   0.703
1: d_y1_d_x2 -0.095659   0.331454  -0.289   0.773
1: d_y2_d_x2  0.223316   0.383837   0.582   0.561
1: d_y3_d_x2 -0.174764   0.413044  -0.423   0.672
1: d_y1_d_x3  0.049373   0.228450   0.216   0.829
1: d_y2_d_x3 -0.384962   0.432533  -0.890   0.373
1: d_y3_d_x3  0.244210   0.471636   0.518   0.605
1: d_y1_d_x4 -0.035715   0.147238  -0.243   0.808
1: d_y2_d_x4 -0.504205   0.777449  -0.649   0.517
1: d_y3_d_x4  0.301966   0.722521   0.418   0.676
2: d_y1_d_x1  0.395977   0.693167   0.571   0.568
2: d_y2_d_x1  0.265123   0.579061   0.458   0.647
2: d_y3_d_x1 -0.224059   0.554291  -0.404   0.686
2: d_y1_d_x2 -0.322951   0.482364  -0.670   0.503
2: d_y2_d_x2  0.251672   0.434307   0.579   0.562
2: d_y3_d_x2 -0.134251   0.656026  -0.205   0.838
2: d_y1_d_x3  0.538961   0.592748   0.909   0.363
2: d_y2_d_x3 -0.523912   0.581667  -0.901   0.368
2: d_y3_d_x3  0.231992   0.840060   0.276   0.782
2: d_y1_d_x4 -0.395069   0.731530  -0.540   0.589
2: d_y2_d_x4 -0.538713   0.751149  -0.717   0.473
2: d_y3_d_x4  0.455530   0.692359   0.658   0.511
3: d_y1_d_x1  0.001392   0.008532   0.163   0.870
3: d_y2_d_x1  0.231970   0.513273   0.452   0.651
3: d_y3_d_x1 -0.116095   0.371068  -0.313   0.754
3: d_y1_d_x2 -0.018567   0.103626  -0.179   0.858
3: d_y2_d_x2  0.110991   0.351961   0.315   0.752
3: d_y3_d_x2 -0.137815   0.402763  -0.342   0.732
3: d_y1_d_x3  0.005969   0.031475   0.190   0.850
3: d_y2_d_x3 -0.149187   0.299851  -0.498   0.619
3: d_y3_d_x3  0.148226   0.278514   0.532   0.595
3: d_y1_d_x4 -0.004570   0.023047  -0.198   0.843
3: d_y2_d_x4 -0.199202   0.550816  -0.362   0.718
3: d_y3_d_x4  0.165549   0.459843   0.360   0.719
> margEffCondObsVA <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, vcov = diag( 18 ), returnJacobian = TRUE,
+    algorithm = GenzBretz() )
> all.equal( margEffCondObs, margEffCondObsA )
[1] TRUE
> # now with Jacobian but without variance covariance matrix
> margEffCondObsJac <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, 
+    data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, returnJacobian = TRUE, algorithm = GenzBretz() )
> all.equal( attr( margEffCondObsJac, "jacobian" ), 
+    attr( margEffCondObsV, "jacobian" ) )
[1] TRUE
> # now with mean values of marginal effects
> margEffCondObsM <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, 
+    data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, vcov = diag( 18 ), addMean = TRUE, returnJacobian = TRUE,
+    algorithm = GenzBretz() )
> all.equal( margEffCondObsV, margEffCondObsM[ 1:3, ], check.attributes = FALSE )
[1] TRUE
> print( margEffCondObsM )
       d_y1_d_x1 d_y2_d_x1  d_y3_d_x1   d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1    0.171996342 0.2054152 -0.1268372 -0.09565856 0.2233156 -0.1747643
2    0.395976600 0.2651229 -0.2240590 -0.32295096 0.2516725 -0.1342508
3    0.001391671 0.2319696 -0.1160949 -0.01856668 0.1109910 -0.1378151
mean 0.189788204 0.2341692 -0.1556637 -0.14572540 0.1953264 -0.1489434
       d_y1_d_x3  d_y2_d_x3 d_y3_d_x3    d_y1_d_x4  d_y2_d_x4 d_y3_d_x4
1    0.049373080 -0.3849624 0.2442104 -0.035714957 -0.5042055 0.3019656
2    0.538960957 -0.5239122 0.2319922 -0.395069134 -0.5387128 0.4555304
3    0.005969436 -0.1491872 0.1482261 -0.004569508 -0.1992018 0.1655489
mean 0.198101158 -0.3526873 0.2081429 -0.145117866 -0.4140400 0.3076816
> all.equal( attr( margEffCondObsV, "vcov" ), 
+    attr( margEffCondObsM, "vcov" )[ 1:3, , ] )
[1] TRUE
> print( attr( margEffCondObsM, "vcov" ) )
, , d_y1_d_x1

        d_y1_d_x1     d_y2_d_x1     d_y3_d_x1     d_y1_d_x2    d_y2_d_x2
1    2.671114e-01 -0.0018976595  0.0012381527 -0.0898724971 0.0111026043
5    4.804800e-01  0.0669899034 -0.1865386542 -0.2400866050 0.0134390760
10   7.279534e-05  0.0001048119  0.0002842755 -0.0007541722 0.0001431042
mean 1.415407e-01  0.0064609911 -0.0348547378 -0.0573521650 0.0054981910
         d_y3_d_x2     d_y1_d_x3     d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1     0.0232684661  0.0871290977 -0.0177399676 -0.0452749762 -0.0615096107
5    -0.1876624140 -0.1074145476  0.1085141114  0.3282948982  0.0447948558
10    0.0005193529  0.0002662252 -0.0001022926 -0.0004098147 -0.0001890735
mean -0.0317096952 -0.0021706952  0.0081606323  0.0471611132 -0.0012513516
         d_y2_d_x4     d_y3_d_x4
1    -0.0068204289 -0.0250869153
5    -0.2422418545  0.1374495372
10   -0.0001533034 -0.0005859012
mean -0.0433591742  0.0118519205

, , d_y2_d_x1

         d_y1_d_x1 d_y2_d_x1    d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1    -0.0018976595 0.1706676  0.003222529 -0.007611474 -0.019220268
5     0.0669899034 0.3353120 -0.024244383 -0.023043764 -0.066230609
10    0.0001048119 0.2634495  0.006039631 -0.002325959  0.088988794
mean  0.0064609911 0.1487773 -0.009259879 -0.003117154 -0.001428115
        d_y3_d_x2    d_y1_d_x3    d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1    -0.015126608  0.007305049 -0.118585928  0.008326058 -0.0014498166
5    -0.137910505 -0.091437246  0.082835907  0.178884983 -0.0370297126
10    0.002116951  0.000340086 -0.108934473 -0.001590868 -0.0001548611
mean -0.038992651 -0.014576494  0.001856717  0.048496965 -0.0053821720
      d_y2_d_x4    d_y3_d_x4
1    -0.2776559  0.002860497
5    -0.1484980  0.087180477
10   -0.2017918 -0.005231592
mean -0.1055868  0.033170120

, , d_y3_d_x1

         d_y1_d_x1    d_y2_d_x1 d_y3_d_x1    d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1     0.0012381527  0.003222529 0.1105299 -0.024097591 -0.014252445 0.02281127
5    -0.1865386542 -0.024244383 0.3072387  0.095206563 -0.060415748 0.12725063
10    0.0002842755  0.006039631 0.1376916 -0.003939484 -0.003951327 0.06569682
mean -0.0348547378 -0.009259879 0.1005792  0.011532132 -0.025381502 0.02335124
       d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4    d_y2_d_x4   d_y3_d_x4
1    0.018163058 0.009363576 -0.11258162 -0.0056644662  0.003016901 -0.21024094
5    0.029859665 0.026161887 -0.30233907 -0.0222752809  0.180537117 -0.27739988
10   0.001123715 0.002298188 -0.06430114 -0.0005787055 -0.001452292 -0.10521758
mean 0.001897524 0.027447843 -0.05359818  0.0032611251  0.048827871 -0.08763667

, , d_y1_d_x2

         d_y1_d_x1    d_y2_d_x1    d_y3_d_x1  d_y1_d_x2   d_y2_d_x2
1    -0.0898724971 -0.007611474 -0.024097591 0.10986178 -0.02228280
5    -0.2400866050 -0.023043764  0.095206563 0.23267476 -0.05216925
10   -0.0007541722 -0.002325959 -0.003939484 0.01073828 -0.00361963
mean -0.0573521650 -0.003117154  0.011532132 0.07275856 -0.01923728
        d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1    -0.026271829 -0.058179549  0.0131341691  0.019147256  0.030291362
5     0.062794165 -0.011435953 -0.0184608698 -0.216260543 -0.156719353
10   -0.010755334 -0.002788209  0.0020007513  0.005142881  0.001911291
mean  0.003498611 -0.010901932  0.0003400778 -0.042729429 -0.031756058
       d_y2_d_x4    d_y3_d_x4
1    0.017179928  0.044862936
5    0.111488447 -0.041148114
10   0.003357581  0.007928101
mean 0.021286450  0.007982487

, , d_y2_d_x2

        d_y1_d_x1    d_y2_d_x1    d_y3_d_x1   d_y1_d_x2 d_y2_d_x2     d_y3_d_x2
1    0.0111026043 -0.019220268 -0.014252445 -0.02228280 0.1473312 -0.0080961714
5    0.0134390760 -0.066230609 -0.060415748 -0.05216925 0.1886225 -0.0004257872
10   0.0001431042  0.088988794 -0.003951327 -0.00361963 0.1238768  0.0082323869
mean 0.0054981910 -0.001428115 -0.025381502 -0.01923728 0.1293292 -0.0040483855
        d_y1_d_x3    d_y2_d_x3     d_y3_d_x3    d_y1_d_x4     d_y2_d_x4
1    0.0058140628  0.029498303  0.0422260636 -0.003319491  0.0009543671
5    0.0273894161 -0.085149156  0.0836840454  0.041852955 -0.1131972606
10   0.0004953686 -0.067861457 -0.0002171497 -0.000286752 -0.1243880723
mean 0.0011529587 -0.005641265  0.0423905553  0.007599964 -0.0532275002
       d_y3_d_x4
1     0.04408361
5     0.10280358
10   -0.00270248
mean  0.04361764

, , d_y3_d_x2

         d_y1_d_x1    d_y2_d_x1  d_y3_d_x1    d_y1_d_x2     d_y2_d_x2 d_y3_d_x2
1     0.0232684661 -0.015126608 0.02281127 -0.026271829 -0.0080961714 0.1706051
5    -0.1876624140 -0.137910505 0.12725063  0.062794165 -0.0004257872 0.4303697
10    0.0005193529  0.002116951 0.06569682 -0.010755334  0.0082323869 0.1622181
mean -0.0317096952 -0.038992651 0.02335124  0.003498611 -0.0040483855 0.1882394
        d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4    d_y2_d_x4
1     0.001137298  0.043253472 -0.04572322 -0.004974583  0.040296388
5     0.024501812 -0.016294090 -0.34011612 -0.099403325  0.252717663
10    0.001860797 -0.001625838 -0.07126846 -0.001334867 -0.006207211
mean -0.012351322  0.029173732 -0.04504173 -0.007046198  0.069471898
       d_y3_d_x4
1    -0.08971663
5    -0.15379709
10   -0.11693769
mean -0.04654424

, , d_y1_d_x3

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1     0.0871290977  0.007305049 0.018163058 -0.058179549 0.0058140628
5    -0.1074145476 -0.091437246 0.029859665 -0.011435953 0.0273894161
10    0.0002662252  0.000340086 0.001123715 -0.002788209 0.0004953686
mean -0.0021706952 -0.014576494 0.001897524 -0.010901932 0.0011529587
        d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1     0.001137298 0.0521894026 -0.0153685109 -0.025643191 -0.0294383921
5     0.024501812 0.3513500142 -0.1657620870 -0.117523028  0.2398832879
10    0.001860797 0.0009906673 -0.0004001085 -0.001639983 -0.0006803364
mean -0.012351322 0.0453402460 -0.0170756833 -0.005519772  0.0373238243
         d_y2_d_x4    d_y3_d_x4
1    -0.0148235754 -0.033753890
5     0.1158357073 -0.100643314
10   -0.0005226474 -0.002313793
mean  0.0187299540 -0.015935991

, , d_y2_d_x3

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1     d_y1_d_x2    d_y2_d_x2
1    -0.0177399676 -0.118585928 0.009363576  0.0131341691  0.029498303
5     0.1085141114  0.082835907 0.026161887 -0.0184608698 -0.085149156
10   -0.0001022926 -0.108934473 0.002298188  0.0020007513 -0.067861457
mean  0.0081606323  0.001856717 0.027447843  0.0003400778 -0.005641265
        d_y3_d_x2     d_y1_d_x3  d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1     0.043253472 -0.0153685109 0.18708466 -0.033064407  0.006300698
5    -0.016294090 -0.1657620870 0.33833702  0.037222067 -0.101515022
10   -0.001625838 -0.0004001085 0.08991047  0.001544213  0.000161025
mean  0.029173732 -0.0170756833 0.07198143 -0.032220456 -0.012979622
       d_y2_d_x4    d_y3_d_x4
1    0.240449474 -0.039634609
5    0.008338695 -0.076109180
10   0.156756405  0.004055025
mean 0.052191852 -0.051399822

, , d_y3_d_x3

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2     d_y2_d_x2
1    -0.0452749762  0.008326058 -0.11258162  0.019147256  0.0422260636
5     0.3282948982  0.178884983 -0.30233907 -0.216260543  0.0836840454
10   -0.0004098147 -0.001590868 -0.06430114  0.005142881 -0.0002171497
mean  0.0471611132  0.048496965 -0.05359818 -0.042729429  0.0423905553
       d_y3_d_x2    d_y1_d_x3    d_y2_d_x3  d_y3_d_x3    d_y1_d_x4    d_y2_d_x4
1    -0.04572322 -0.025643191 -0.033064407 0.22244068 0.0145491010 -0.033554080
5    -0.34011612 -0.117523028  0.037222067 0.70570062 0.1423288295 -0.391848569
10   -0.07126846 -0.001639983  0.001544213 0.07757025 0.0009269843  0.005326792
mean -0.04504173 -0.005519772 -0.032220456 0.12854004 0.0095444796 -0.096925332
      d_y3_d_x4
1    0.27260332
5    0.34347006
10   0.11817688
mean 0.08399054

, , d_y1_d_x4

         d_y1_d_x1     d_y2_d_x1     d_y3_d_x1    d_y1_d_x2    d_y2_d_x2
1    -0.0615096107 -0.0014498166 -0.0056644662  0.030291362 -0.003319491
5     0.0447948558 -0.0370297126 -0.0222752809 -0.156719353  0.041852955
10   -0.0001890735 -0.0001548611 -0.0005787055  0.001911291 -0.000286752
mean -0.0012513516 -0.0053821720  0.0032611251 -0.031756058  0.007599964
        d_y3_d_x2     d_y1_d_x3    d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1    -0.004974583 -0.0294383921  0.006300698 0.0145491010 0.0216791318
5    -0.099403325  0.2398832879 -0.101515022 0.1423288295 0.5351355080
10   -0.001334867 -0.0006803364  0.000161025 0.0009269843 0.0005311534
mean -0.007046198  0.0373238243 -0.012979622 0.0095444796 0.0601792879
         d_y2_d_x4    d_y3_d_x4
1     0.0022469401  0.009029162
5    -0.0095536318 -0.143675446
10    0.0002302148  0.001021854
mean  0.0006292537 -0.033226750

, , d_y2_d_x4

         d_y1_d_x1  d_y2_d_x1    d_y3_d_x1   d_y1_d_x2     d_y2_d_x2
1    -0.0068204289 -0.2776559  0.003016901 0.017179928  0.0009543671
5    -0.2422418545 -0.1484980  0.180537117 0.111488447 -0.1131972606
10   -0.0001533034 -0.2017918 -0.001452292 0.003357581 -0.1243880723
mean -0.0433591742 -0.1055868  0.048827871 0.021286450 -0.0532275002
        d_y3_d_x2     d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1     0.040296388 -0.0148235754 0.240449474 -0.033554080  0.0022469401
5     0.252717663  0.1158357073 0.008338695 -0.391848569 -0.0095536318
10   -0.006207211 -0.0005226474 0.156756405  0.005326792  0.0002302148
mean  0.069471898  0.0187299540 0.052191852 -0.096925332  0.0006292537
     d_y2_d_x4   d_y3_d_x4
1    0.6044272 -0.02044526
5    0.5642249 -0.26202679
10   0.3033983  0.01131299
mean 0.3182233 -0.07005962

, , d_y3_d_x4

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2   d_y2_d_x2
1    -0.0250869153  0.002860497 -0.21024094  0.044862936  0.04408361
5     0.1374495372  0.087180477 -0.27739988 -0.041148114  0.10280358
10   -0.0005859012 -0.005231592 -0.10521758  0.007928101 -0.00270248
mean  0.0118519205  0.033170120 -0.08763667  0.007982487  0.04361764
       d_y3_d_x2    d_y1_d_x3    d_y2_d_x3  d_y3_d_x3    d_y1_d_x4   d_y2_d_x4
1    -0.08971663 -0.033753890 -0.039634609 0.27260332  0.009029162 -0.02044526
5    -0.15379709 -0.100643314 -0.076109180 0.34347006 -0.143675446 -0.26202679
10   -0.11693769 -0.002313793  0.004055025 0.11817688  0.001021854  0.01131299
mean -0.04654424 -0.015935991 -0.051399822 0.08399054 -0.033226750 -0.07005962
     d_y3_d_x4
1    0.5220365
5    0.4793612
10   0.2114558
mean 0.2156430

> print( drop( attr( margEffCondObsM, "vcov" )[ 4, , ] ) )
             d_y1_d_x1    d_y2_d_x1    d_y3_d_x1     d_y1_d_x2    d_y2_d_x2
d_y1_d_x1  0.141540706  0.006460991 -0.034854738 -0.0573521650  0.005498191
d_y2_d_x1  0.006460991  0.148777309 -0.009259879 -0.0031171537 -0.001428115
d_y3_d_x1 -0.034854738 -0.009259879  0.100579205  0.0115321322 -0.025381502
d_y1_d_x2 -0.057352165 -0.003117154  0.011532132  0.0727585583 -0.019237283
d_y2_d_x2  0.005498191 -0.001428115 -0.025381502 -0.0192372835  0.129329235
d_y3_d_x2 -0.031709695 -0.038992651  0.023351239  0.0034986111 -0.004048386
d_y1_d_x3 -0.002170695 -0.014576494  0.001897524 -0.0109019325  0.001152959
d_y2_d_x3  0.008160632  0.001856717  0.027447843  0.0003400778 -0.005641265
d_y3_d_x3  0.047161113  0.048496965 -0.053598184 -0.0427294288  0.042390555
d_y1_d_x4 -0.001251352 -0.005382172  0.003261125 -0.0317560582  0.007599964
d_y2_d_x4 -0.043359174 -0.105586755  0.048827871  0.0212864498 -0.053227500
d_y3_d_x4  0.011851921  0.033170120 -0.087636672  0.0079824870  0.043617635
             d_y3_d_x2    d_y1_d_x3     d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
d_y1_d_x1 -0.031709695 -0.002170695  0.0081606323  0.047161113 -0.0012513516
d_y2_d_x1 -0.038992651 -0.014576494  0.0018567171  0.048496965 -0.0053821720
d_y3_d_x1  0.023351239  0.001897524  0.0274478427 -0.053598184  0.0032611251
d_y1_d_x2  0.003498611 -0.010901932  0.0003400778 -0.042729429 -0.0317560582
d_y2_d_x2 -0.004048386  0.001152959 -0.0056412648  0.042390555  0.0075999641
d_y3_d_x2  0.188239422 -0.012351322  0.0291737323 -0.045041732 -0.0070461984
d_y1_d_x3 -0.012351322  0.045340246 -0.0170756833 -0.005519772  0.0373238243
d_y2_d_x3  0.029173732 -0.017075683  0.0719814311 -0.032220456 -0.0129796222
d_y3_d_x3 -0.045041732 -0.005519772 -0.0322204565  0.128540042  0.0095444796
d_y1_d_x4 -0.007046198  0.037323824 -0.0129796222  0.009544480  0.0601792879
d_y2_d_x4  0.069471898  0.018729954  0.0521918515 -0.096925332  0.0006292537
d_y3_d_x4 -0.046544236 -0.015935991 -0.0513998220  0.083990543 -0.0332267504
              d_y2_d_x4    d_y3_d_x4
d_y1_d_x1 -0.0433591742  0.011851921
d_y2_d_x1 -0.1055867547  0.033170120
d_y3_d_x1  0.0488278708 -0.087636672
d_y1_d_x2  0.0212864498  0.007982487
d_y2_d_x2 -0.0532275002  0.043617635
d_y3_d_x2  0.0694718982 -0.046544236
d_y1_d_x3  0.0187299540 -0.015935991
d_y2_d_x3  0.0521918515 -0.051399822
d_y3_d_x3 -0.0969253321  0.083990543
d_y1_d_x4  0.0006292537 -0.033226750
d_y2_d_x4  0.3182233313 -0.070059615
d_y3_d_x4 -0.0700596152  0.215643019
> all.equal( attr( margEffCondObsV, "jacobian" ), 
+    attr( margEffCondObsM, "jacobian" )[ 1:3, , ] )
[1] TRUE
> print( attr( margEffCondObsM, "jacobian" ) )
, , b_1_0

        d_y1_d_x1     d_y2_d_x1    d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1     0.237119196 -0.0042905707 -0.004537520 -0.16362764  0.021246739
5     0.279256250  0.0130994340 -0.042653983 -0.18347254  0.006690779
10   -0.004746446  0.0002331714  0.002017613  0.04644298 -0.004668669
mean  0.170543000  0.0030140116 -0.015057964 -0.10021907  0.007756283
        d_y3_d_x2   d_y1_d_x3    d_y2_d_x3   d_y3_d_x3   d_y1_d_x4
1     0.053090421  0.11546354 -0.017597035 -0.04924117 -0.08098938
5    -0.050415270  0.04649614  0.020150548  0.09161560 -0.02611245
10   -0.020715613 -0.01887379  0.001376677  0.00885958  0.01438849
mean -0.006013487  0.04769530  0.001310063  0.01707801 -0.03090445
         d_y2_d_x4    d_y3_d_x4
1     4.929390e-03  0.003941292
5    -4.054534e-02  0.032862602
10   -8.881784e-05 -0.001154632
mean -1.190159e-02  0.011883087

, , b_1_1

        d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2   d_y2_d_x2
1    2.760459e-01 -9.172312e-03 -2.164891e-02  0.00000000 0.000000000
5    4.300837e-01 -6.483072e-02 -9.133239e-02 -0.18347254 0.006690779
10   3.416534e-05 -6.254719e-06 -8.454515e-05  0.00000000 0.000000000
mean 2.353879e-01 -2.466976e-02 -3.768861e-02 -0.06115751 0.002230260
       d_y3_d_x2  d_y1_d_x3   d_y2_d_x3  d_y3_d_x3    d_y1_d_x4   d_y2_d_x4
1     0.00000000 0.00000000 0.000000000 0.00000000  0.000000000  0.00000000
5    -0.05041527 0.04634071 0.020616842 0.09177104 -0.026023628 -0.04081180
10    0.00000000 0.00000000 0.000000000 0.00000000  0.000000000  0.00000000
mean -0.01680509 0.01544690 0.006872281 0.03059035 -0.008674543 -0.01360393
      d_y3_d_x4
1    0.00000000
5    0.03277378
10   0.00000000
mean 0.01092459

, , b_1_2

      d_y1_d_x1    d_y2_d_x1    d_y3_d_x1  d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1    0.23711920 -0.004290571 -0.004537520 0.03892668 -0.004881742 -0.01711139
5    0.00000000  0.000000000  0.000000000 0.24661116 -0.058139940 -0.14174766
10   0.00000000  0.000000000  0.000000000 0.05122359 -0.004908095 -0.02281777
mean 0.07903973 -0.001430190 -0.001512507 0.11225381 -0.022643259 -0.06055894
      d_y1_d_x3    d_y2_d_x3   d_y3_d_x3   d_y1_d_x4  d_y2_d_x4   d_y3_d_x4
1    0.11546354 -0.017597035 -0.04924117 -0.08098938 0.00492939 0.003941292
5    0.00000000  0.000000000  0.00000000  0.00000000 0.00000000 0.000000000
10   0.00000000  0.000000000  0.00000000  0.00000000 0.00000000 0.000000000
mean 0.03848785 -0.005865678 -0.01641372 -0.02699646 0.00164313 0.001313764

, , b_1_3

        d_y1_d_x1     d_y2_d_x1   d_y3_d_x1 d_y1_d_x2    d_y2_d_x2   d_y3_d_x2
1    -0.253201499  0.0045815732 0.004845272 0.1747255 -0.022687772 -0.05669121
5    -0.174546122 -0.0081876610 0.026660415 0.1146775 -0.004182000  0.03151152
10   -0.005951165  0.0002923537 0.002529713 0.0582309 -0.005853647 -0.02597354
mean -0.144566262 -0.0011045780 0.011345133 0.1158780 -0.010907806 -0.01705108
       d_y1_d_x3    d_y2_d_x3    d_y3_d_x3  d_y1_d_x4     d_y2_d_x4
1    -0.08438371  0.013525756  0.035596448 0.08650580 -0.0041744386
5     0.40110687 -0.078708507 -0.150118695 0.01643130  0.0254907206
10   -0.01925572  0.001474481  0.009000073 0.01718625 -0.0000721645
mean  0.09915581 -0.021236090 -0.035174058 0.04004112  0.0070813725
        d_y3_d_x4
1    -0.004107825
5    -0.020561330
10   -0.002131628
mean -0.008933595

, , b_1_4

       d_y1_d_x1     d_y2_d_x1     d_y3_d_x1   d_y1_d_x2   d_y2_d_x2
1    0.101122853 -0.0018297751 -0.0019350901 -0.06978133 0.009060974
5    0.229431652  0.0107622472 -0.0350437056 -0.15073756 0.005497018
10   0.001805885 -0.0000887149 -0.0007676429 -0.01767021 0.001776293
mean 0.110786797  0.0029479191 -0.0125821462 -0.07939637 0.005444762
        d_y3_d_x2   d_y1_d_x3     d_y2_d_x3    d_y3_d_x3    d_y1_d_x4
1     0.022641165 0.049251575 -0.0072386541 -0.021177504  0.004379314
5    -0.041420233 0.038008485  0.0178967952  0.077160500  0.408389935
10    0.007881690 0.006650236 -0.0005440093 -0.004063416 -0.000592868
mean -0.003632459 0.031303432  0.0033713773  0.017306527  0.137392127
         d_y2_d_x4    d_y3_d_x4
1    -0.0029277490 -0.015490465
5    -0.0980485920 -0.064775851
10   -0.0002394261 -0.001658069
mean -0.0337385891 -0.027308128

, , b_2_0

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2
1    -0.0067049148 -0.20930690 -0.011106030  0.02359868 -0.07427991
5    -0.0468176067  0.06017080  0.024119695  0.01982570 -0.11310591
10    0.0001492365  0.21970457  0.010775848 -0.00348749  0.13273560
mean -0.0177910950  0.02352282  0.007929838  0.01331229 -0.01821674
        d_y3_d_x2    d_y1_d_x3   d_y2_d_x3    d_y3_d_x3     d_y1_d_x4
1    -0.019690254 -0.013787756  0.24437119  0.026531555  0.0034687531
5     0.019517303  0.020222712  0.05337952 -0.037314596  0.0320410365
10    0.010499709  0.001032507 -0.22647717 -0.010325074 -0.0001332268
mean  0.003442253  0.002489155  0.02375785 -0.007036038  0.0117921876
       d_y2_d_x4    d_y3_d_x4
1     0.31739056  0.026367797
5     0.06252776 -0.036992631
10   -0.30221381 -0.012168044
mean  0.02590150 -0.007597626

, , b_2_1

         d_y1_d_x1 d_y2_d_x1   d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1    -1.019913e-02 0.1193442 0.003567316 0.000000000  0.00000000 0.000000000
5    -6.151580e-02 0.4058003 0.034744322 0.019825696 -0.11310591 0.019517303
10   -2.590372e-06 0.3469243 0.014366785 0.000000000  0.00000000 0.000000000
mean -2.390584e-02 0.2906896 0.017559475 0.006608565 -0.03770197 0.006505768
       d_y1_d_x3  d_y2_d_x3  d_y3_d_x3  d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1    0.000000000 0.00000000  0.0000000 0.00000000 0.0000000  0.00000000
5    0.020089486 0.05351275 -0.0373146 0.03186340 0.0627054 -0.03699263
10   0.000000000 0.00000000  0.0000000 0.00000000 0.0000000  0.00000000
mean 0.006696495 0.01783758 -0.0124382 0.01062113 0.0209018 -0.01233088

, , b_2_2

        d_y1_d_x1   d_y2_d_x1   d_y3_d_x1    d_y1_d_x2 d_y2_d_x2  d_y3_d_x2
1    -0.006704915 -0.20930690 -0.01110603 -0.003494220 0.3286511 0.01467335
5     0.000000000  0.00000000  0.00000000 -0.041690108 0.2926944 0.05426163
10    0.000000000  0.00000000  0.00000000 -0.003639317 0.2599553 0.01409065
mean -0.002234972 -0.06976897 -0.00370201 -0.016274548 0.2937670 0.02767521
        d_y1_d_x3  d_y2_d_x3   d_y3_d_x3   d_y1_d_x4 d_y2_d_x4   d_y3_d_x4
1    -0.013787756 0.24437119 0.026531555 0.003468753 0.3173906 0.026367797
5     0.000000000 0.00000000 0.000000000 0.000000000 0.0000000 0.000000000
10    0.000000000 0.00000000 0.000000000 0.000000000 0.0000000 0.000000000
mean -0.004595919 0.08145706 0.008843852 0.001156251 0.1057969 0.008789266

, , b_2_3

        d_y1_d_x1   d_y2_d_x1    d_y3_d_x1    d_y1_d_x2  d_y2_d_x2    d_y3_d_x2
1    0.0071596671  0.22350287  0.011859282 -0.025199228 0.07931785  0.021025719
5    0.0292628427 -0.03760911 -0.015075756 -0.012391838 0.07069564 -0.012199081
10   0.0001871152  0.27546887  0.013510919 -0.004372667 0.16642588  0.013164692
mean 0.0122032083  0.15378754  0.003431482 -0.013987911 0.10547979  0.007330443
        d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4
1     0.011232542  0.06788194 -0.01381498 -0.0037039816 -0.33892888
5    -0.074705254  0.37237153  0.05801460 -0.0198951966 -0.03885781
10    0.000192342 -0.15654633 -0.01002040 -0.0003996803 -0.37869152
mean -0.021093457  0.09456905  0.01139307 -0.0079996195 -0.25215940
        d_y3_d_x4
1    -0.028066438
5     0.022737368
10   -0.015365487
mean -0.006898186

, , b_2_4

         d_y1_d_x1   d_y2_d_x1    d_y3_d_x1   d_y1_d_x2   d_y2_d_x2
1    -2.859406e-03 -0.08926191 -0.004736324 0.010063992 -0.03167772
5    -3.846446e-02  0.04943519  0.019816285 0.016288417 -0.09292568
10   -5.678036e-05 -0.08359122 -0.004099898 0.001326888 -0.05050205
mean -1.379355e-02 -0.04113931  0.003660021 0.009226432 -0.05836848
        d_y3_d_x2     d_y1_d_x3  d_y2_d_x3    d_y3_d_x3     d_y1_d_x4 d_y2_d_x4
1    -0.008397188 -0.0058985802 0.10461632  0.011260437 -2.030807e-03 0.4643204
5     0.016035047  0.0168975944 0.04392042 -0.030864200 -3.549218e-02 0.4571371
10   -0.003994835 -0.0002997602 0.08608947  0.003674838  7.021744e-05 0.2421167
mean  0.001214341  0.0035664180 0.07820874 -0.005309642 -1.248426e-02 0.3878581
       d_y3_d_x4
1    0.025697861
5    0.003658077
10   0.008342692
mean 0.012566210

, , b_3_0

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1    -0.0232567723 -0.011015572 -0.15915262  0.04568840 -0.015580858
5    -0.0739470341 -0.007314459  0.22130059  0.06229383 -0.013690362
10    0.0008188513  0.011466788  0.13119743 -0.01094591  0.009654283
mean -0.0321283183 -0.002287747  0.06444847  0.03234544 -0.006538979
       d_y3_d_x2    d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4   d_y2_d_x4
1    -0.12588268 -0.028626927  0.024968916  0.24263369  0.011713547  0.02455813
5     0.05968877 -0.035238479  0.003963496 -0.14778179 -0.033484326  0.03184120
10    0.15417144  0.003963496 -0.010075274 -0.21641577 -0.001909584 -0.01214584
mean  0.02932584 -0.019967303  0.006285713 -0.04052129 -0.007893454  0.01475116
       d_y3_d_x4
1     0.28566038
5    -0.25575098
10   -0.23931968
mean -0.06980342

, , b_3_1

         d_y1_d_x1   d_y2_d_x1 d_y3_d_x1  d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1    -3.172708e-02 0.003760222 0.1006422 0.00000000  0.000000000 0.00000000
5    -1.245229e-01 0.048919331 0.3650462 0.06229383 -0.013690362 0.05968877
10   -4.433121e-06 0.014931963 0.2725413 0.00000000  0.000000000 0.00000000
mean -5.208480e-02 0.022537172 0.2460766 0.02076461 -0.004563454 0.01989626
       d_y1_d_x3   d_y2_d_x3   d_y3_d_x3   d_y1_d_x4  d_y2_d_x4   d_y3_d_x4
1     0.00000000 0.000000000  0.00000000  0.00000000 0.00000000  0.00000000
5    -0.03529954 0.003963496 -0.14793722 -0.03355094 0.03184120 -0.25566216
10    0.00000000 0.000000000  0.00000000  0.00000000 0.00000000  0.00000000
mean -0.01176651 0.001321165 -0.04931241 -0.01118365 0.01061373 -0.08522072

, , b_3_2

        d_y1_d_x1    d_y2_d_x1   d_y3_d_x1    d_y1_d_x2  d_y2_d_x2 d_y3_d_x2
1    -0.023256772 -0.011015572 -0.15915262 -0.008470304 0.01477579 0.2597948
5     0.000000000  0.000000000  0.00000000 -0.062229064 0.03522897 0.4247349
10    0.000000000  0.000000000  0.00000000 -0.011769192 0.01311946 0.2955153
mean -0.007752257 -0.003671857 -0.05305087 -0.027489520 0.02104141 0.3266817
        d_y1_d_x3   d_y2_d_x3 d_y3_d_x3   d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1    -0.028623805 0.024658053 0.2426337 0.011703832 0.024735769 0.28566038
5     0.000000000 0.000000000 0.0000000 0.000000000 0.000000000 0.00000000
10    0.000000000 0.000000000 0.0000000 0.000000000 0.000000000 0.00000000
mean -0.009541268 0.008219351 0.0808779 0.003901277 0.008245256 0.09522013

, , b_3_3

       d_y1_d_x1   d_y2_d_x1   d_y3_d_x1   d_y1_d_x2   d_y2_d_x2   d_y3_d_x2
1    0.024834133 0.011762689  0.16994694 -0.04878715 0.016637610  0.13442051
5    0.046219800 0.004571824 -0.13832156 -0.03893609 0.008557014 -0.03730783
10   0.001026688 0.014377230  0.16449729 -0.01372414 0.012104684  0.19330245
mean 0.024026873 0.010237248  0.06537422 -0.03381579 0.012433102  0.09680504
        d_y1_d_x3    d_y2_d_x3     d_y3_d_x3    d_y1_d_x4   d_y2_d_x4
1     0.022102636 -0.011192323  0.0008547584 -0.012528173 -0.02571277
5    -0.102096384  0.045943934  0.4573611985  0.020783375 -0.02042810
10    0.003062496 -0.009170551 -0.1310937438 -0.002220446 -0.01528222
mean -0.025643751  0.008527020  0.1090407377  0.002011585 -0.02047436
      d_y3_d_x4
1    -0.3048783
5     0.1603606
10   -0.3003375
mean -0.1482851

, , b_3_4

         d_y1_d_x1    d_y2_d_x1   d_y3_d_x1   d_y1_d_x2    d_y2_d_x2
1    -0.0099181812 -0.004697747 -0.06787290 0.019484466 -0.006644679
5    -0.0607534844 -0.006009421  0.18181638 0.051179428 -0.011247743
10   -0.0003115489 -0.004362780 -0.04991682 0.004164601 -0.003673175
mean -0.0236610715 -0.005023316  0.02134222 0.024942832 -0.007188532
       d_y3_d_x2    d_y1_d_x3   d_y2_d_x3   d_y3_d_x3     d_y1_d_x4   d_y2_d_x4
1    -0.05368446 -0.012222515 0.010225154  0.10332291 -0.0034812393 0.024767800
5     0.04903917 -0.029271030 0.003164136 -0.12057022 -0.1524338957 0.075076186
10   -0.05865776 -0.001598721 0.003891332  0.08185674 -0.0004680132 0.008150316
mean -0.02110102 -0.014364089 0.005760207  0.02153648 -0.0521277161 0.035998101
     d_y3_d_x4
1    0.3814975
5    0.1556137
10   0.2321601
mean 0.2564238

, , R_1_2

         d_y1_d_x1     d_y2_d_x1    d_y3_d_x1     d_y1_d_x2   d_y2_d_x2
1     0.0119593147 -0.0174661634 2.470719e-03 -0.1075036372 0.060236172
5    -0.2627469942 -0.3102622052 5.436432e-02  0.0008249928 0.141162941
10    0.0002986814 -0.0001412116 5.869194e-06 -0.0079378153 0.006272141
mean -0.0834963327 -0.1092898601 1.894697e-02 -0.0382054866 0.069223751
       d_y3_d_x2   d_y1_d_x3    d_y2_d_x3     d_y3_d_x3     d_y1_d_x4
1    0.057426766 0.044672946 -0.029198866 -3.142764e-02 -2.457756e-03
5    0.165725303 0.360367292 -0.354105634 -2.029044e-01  3.655298e-01
10   0.005869357 0.002053913 -0.001038059  4.440892e-05  4.440892e-05
mean 0.076340475 0.135698050 -0.128114186 -7.809586e-02  1.210388e-01
        d_y2_d_x4     d_y3_d_x4
1    7.194245e-03 -0.0081157303
5    2.863931e-01 -0.1056932319
10   6.661338e-05 -0.0005329071
mean 9.788466e-02 -0.0381139564

, , R_1_3

       d_y1_d_x1     d_y2_d_x1    d_y3_d_x1  d_y1_d_x2    d_y2_d_x2  d_y3_d_x2
1    -0.03036766 -0.0028628581 -0.046038902 0.16796613 -0.014779641 0.11986384
5    -0.13515076 -0.1522331797 -0.008299913 0.21839363 -0.004554075 0.33427476
10   -0.00310063  0.0001322236 -0.002880124 0.04099705 -0.003285345 0.03256694
mean -0.05620635 -0.0516546047 -0.019072980 0.14245227 -0.007539687 0.16223518
       d_y1_d_x3    d_y2_d_x3   d_y3_d_x3    d_y1_d_x4    d_y2_d_x4   d_y3_d_x4
1    -0.10554734  0.011690648 -0.08223422  0.023809427 0.0023536728 0.030420111
5    -0.17428281 -0.033362202 -0.40429882 -0.447553106 0.1727951116 0.091660013
10   -0.01364464  0.000928424 -0.01226796  0.004396483 0.0002498002 0.004574119
mean -0.09782493 -0.006914376 -0.16626700 -0.139782399 0.0584661948 0.042218081

, , R_2_3

         d_y1_d_x1 d_y2_d_x1  d_y3_d_x1     d_y1_d_x2  d_y2_d_x2   d_y3_d_x2
1    -4.065697e-04 0.1000440 -0.1147518  0.0134169502 0.14424394 -0.20173175
5     1.095618e-01 0.1914696 -0.2351233 -0.0474577989 0.19609338 -0.26047393
10   -5.019285e-05 0.1066395 -0.1269163  0.0005696239 0.08873839 -0.08386716
mean  3.636834e-02 0.1327177 -0.1589305 -0.0111570749 0.14302524 -0.18202428
         d_y1_d_x3   d_y2_d_x3  d_y3_d_x3     d_y1_d_x4   d_y2_d_x4  d_y3_d_x4
1    -0.0050591475 -0.22088997 0.27925162 -0.0002026157 -0.26432190 0.34091618
5    -0.0634270414 -0.23671065 0.42570392 -0.0565325564 -0.46083137 0.51869620
10   -0.0004551914 -0.08058137 0.07938095  0.0003108624 -0.09792722 0.09796608
mean -0.0229804601 -0.17939400 0.26144549 -0.0188081032 -0.27436016 0.31919282

> print( drop( attr( margEffCondObsM, "jacobian" )[ 4, , ] ) )
                 b_1_0        b_1_1        b_1_2        b_1_3        b_1_4
d_y1_d_x1  0.170543000  0.235387911  0.079039732 -0.144566262  0.110786797
d_y2_d_x1  0.003014012 -0.024669762 -0.001430190 -0.001104578  0.002947919
d_y3_d_x1 -0.015057964 -0.037688614 -0.001512507  0.011345133 -0.012582146
d_y1_d_x2 -0.100219066 -0.061157512  0.112253808  0.115877971 -0.079396368
d_y2_d_x2  0.007756283  0.002230260 -0.022643259 -0.010907806  0.005444762
d_y3_d_x2 -0.006013487 -0.016805090 -0.060558939 -0.017051077 -0.003632459
d_y1_d_x3  0.047695297  0.015446903  0.038487847  0.099155815  0.031303432
d_y2_d_x3  0.001310063  0.006872281 -0.005865678 -0.021236090  0.003371377
d_y3_d_x3  0.017078006  0.030590345 -0.016413722 -0.035174058  0.017306527
d_y1_d_x4 -0.030904446 -0.008674543 -0.026996461  0.040041119  0.137392127
d_y2_d_x4 -0.011901591 -0.013603933  0.001643130  0.007081373 -0.033738589
d_y3_d_x4  0.011883087  0.010924595  0.001313764 -0.008933595 -0.027308128
                 b_2_0        b_2_1        b_2_2        b_2_3        b_2_4
d_y1_d_x1 -0.017791095 -0.023905843 -0.002234972  0.012203208 -0.013793549
d_y2_d_x1  0.023522821  0.290689624 -0.069768967  0.153787542 -0.041139311
d_y3_d_x1  0.007929838  0.017559475 -0.003702010  0.003431482  0.003660021
d_y1_d_x2  0.013312295  0.006608565 -0.016274548 -0.013987911  0.009226432
d_y2_d_x2 -0.018216739 -0.037701971  0.293766966  0.105479788 -0.058368483
d_y3_d_x2  0.003442253  0.006505768  0.027675206  0.007330443  0.001214341
d_y1_d_x3  0.002489155  0.006696495 -0.004595919 -0.021093457  0.003566418
d_y2_d_x3  0.023757848  0.017837583  0.081457063  0.094569047  0.078208736
d_y3_d_x3 -0.007036038 -0.012438199  0.008843852  0.011393074 -0.005309642
d_y1_d_x4  0.011792188  0.010621134  0.001156251 -0.007999619 -0.012484255
d_y2_d_x4  0.025901503  0.020901799  0.105796853 -0.252159404  0.387858051
d_y3_d_x4 -0.007597626 -0.012330877  0.008789266 -0.006898186  0.012566210
                 b_3_0        b_3_1        b_3_2        b_3_3        b_3_4
d_y1_d_x1 -0.032128318 -0.052084799 -0.007752257  0.024026873 -0.023661071
d_y2_d_x1 -0.002287747  0.022537172 -0.003671857  0.010237248 -0.005023316
d_y3_d_x1  0.064448467  0.246076566 -0.053050872  0.065374224  0.021342222
d_y1_d_x2  0.032345438  0.020764608 -0.027489520 -0.033815794  0.024942832
d_y2_d_x2 -0.006538979 -0.004563454  0.021041407  0.012433102 -0.007188532
d_y3_d_x2  0.029325843  0.019896258  0.326681700  0.096805045 -0.021101018
d_y1_d_x3 -0.019967303 -0.011766514 -0.009541268 -0.025643751 -0.014364089
d_y2_d_x3  0.006285713  0.001321165  0.008219351  0.008527020  0.005760207
d_y3_d_x3 -0.040521290 -0.049312406  0.080877897  0.109040738  0.021536476
d_y1_d_x4 -0.007893454 -0.011183647  0.003901277  0.002011585 -0.052127716
d_y2_d_x4  0.014751163  0.010613732  0.008245256 -0.020474363  0.035998101
d_y3_d_x4 -0.069803422 -0.085220719  0.095220128 -0.148285088  0.256423770
                R_1_2        R_1_3       R_2_3
d_y1_d_x1 -0.08349633 -0.056206349  0.03636834
d_y2_d_x1 -0.10928986 -0.051654605  0.13271769
d_y3_d_x1  0.01894697 -0.019072980 -0.15893051
d_y1_d_x2 -0.03820549  0.142452268 -0.01115707
d_y2_d_x2  0.06922375 -0.007539687  0.14302524
d_y3_d_x2  0.07634048  0.162235178 -0.18202428
d_y1_d_x3  0.13569805 -0.097824931 -0.02298046
d_y2_d_x3 -0.12811419 -0.006914376 -0.17939400
d_y3_d_x3 -0.07809586 -0.166267000  0.26144549
d_y1_d_x4  0.12103883 -0.139782399 -0.01880810
d_y2_d_x4  0.09788466  0.058466195 -0.27436016
d_y3_d_x4 -0.03811396  0.042218081  0.31919282
> all.equal( summary( margEffCondObsV )[ , ], summary( margEffCondObsM )[ 1:36, ],
+    check.attributes = FALSE )
[1] TRUE
> summary( margEffCondObsM )[ -( 1:24 ), ]
                    Estimate  Std. error    z value   Pr(> z)
3: d_y1_d_x1     0.001391671 0.008532019  0.1631116 0.8704305
3: d_y2_d_x1     0.231969590 0.513273327  0.4519416 0.6513110
3: d_y3_d_x1    -0.116094853 0.371068155 -0.3128667 0.7543820
3: d_y1_d_x2    -0.018566681 0.103625684 -0.1791707 0.8578037
3: d_y2_d_x2     0.110991010 0.351961409  0.3153499 0.7524960
3: d_y3_d_x2    -0.137815080 0.402763024 -0.3421741 0.7322199
3: d_y1_d_x3     0.005969436 0.031474867  0.1896572 0.8495777
3: d_y2_d_x3    -0.149187187 0.299850754 -0.4975381 0.6188096
3: d_y3_d_x3     0.148226127 0.278514358  0.5322028 0.5945855
3: d_y1_d_x4    -0.004569508 0.023046766 -0.1982711 0.8428330
3: d_y2_d_x4    -0.199201826 0.550816062 -0.3616485 0.7176147
3: d_y3_d_x4     0.165548888 0.459843246  0.3600116 0.7188385
mean: d_y1_d_x1  0.189788204 0.376218960  0.5044621 0.6139367
mean: d_y2_d_x1  0.234169248 0.385716618  0.6071018 0.5437834
mean: d_y3_d_x1 -0.155663711 0.317142247 -0.4908325 0.6235449
mean: d_y1_d_x2 -0.145725401 0.269737944 -0.5402481 0.5890260
mean: d_y2_d_x2  0.195326359 0.359623741  0.5431409 0.5870328
mean: d_y3_d_x2 -0.148943376 0.433865673 -0.3432938 0.7313775
mean: d_y1_d_x3  0.198101158 0.212932492  0.9303472 0.3521913
mean: d_y2_d_x3 -0.352687253 0.268293554 -1.3145573 0.1886587
mean: d_y3_d_x3  0.208142914 0.358524813  0.5805537 0.5615413
mean: d_y1_d_x4 -0.145117866 0.245314671 -0.5915580 0.5541466
mean: d_y2_d_x4 -0.414040020 0.564112871 -0.7339666 0.4629691
mean: d_y3_d_x4  0.307681615 0.464373792  0.6625732 0.5076040
> 
> # for testing state of random number generator
> rnorm( 4 )
[1]  0.1870145  0.3303074 -1.2090711  1.9202205
> 
> 
> proc.time()
   user  system elapsed 
 45.678   0.040  45.735 
