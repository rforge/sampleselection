
R version 2.15.2 (2012-10-26) -- "Trick or Treat"
Copyright (C) 2012 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library( "mvProbit" )
Loading required package: mvtnorm
Loading required package: maxLik
Loading required package: miscTools
Loading required package: abind
> 
> ## generate a simulated data set
> set.seed( 123 )
> # number of observations
> nObs <- 10
> 
> # generate explanatory variables
> xMat <- cbind( 
+    const = rep( 1, nObs ),
+    x1 = as.numeric( rnorm( nObs ) > 0 ),
+    x2 = as.numeric( rnorm( nObs ) > 0 ),
+    x3 = rnorm( nObs ),
+    x4 = rnorm( nObs ) )
> 
> # model coefficients
> beta <- cbind( c(  0.8,  1.2, -1.0,  1.4, -0.8 ),
+                c( -0.6,  1.0,  0.6, -1.2, -1.6 ),
+                c(  0.5, -0.6, -0.7,  1.1,  1.2 ) )
> 
> # covariance matrix of error terms
> sigma <- miscTools::symMatrix( c( 1, 0.2, 0.4, 1, -0.1, 1 ) )
> 
> # all parameters in a vector
> allCoef <- c( c( beta ), sigma[ lower.tri( sigma ) ] )
> 
> # generate dependent variables
> yMatLin <- xMat %*% beta 
> yMat <- ( yMatLin + rmvnorm( nObs, sigma = sigma ) ) > 0
> colnames( yMat ) <- paste( "y", 1:3, sep = "" )
> # (yMatLin > 0 )== yMat
> 
> # unconditional expectations of dependent variables
> yExp <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ) )
> round( yExp, 4 )
       V1     V2     V3
1  0.0209 0.7254 0.1941
2  0.3939 0.7684 0.2136
3  0.1246 0.7879 0.1964
4  0.2349 0.6807 0.2918
5  0.6800 0.4347 0.5786
6  0.0279 0.9727 0.0337
7  0.9582 0.1863 0.7841
8  0.8564 0.2467 0.7239
9  0.0607 0.9682 0.0344
10 0.9979 0.0673 0.9226
> yExpA <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ) )
> all.equal( yExp, yExpA )
[1] TRUE
> yExp2 <- pnorm( yMatLin )
> all.equal( yExp, as.data.frame( yExp2 ) )
[1] TRUE
> 
> 
> # conditional expectations of dependent variables
> # (assuming that all other dependent variables are one)
> yExpCond <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz() )
> round( yExpCond, 4 )
       V1     V2     V3
1  0.0719 0.8344 0.5236
2  0.6602 0.7786 0.3142
3  0.2971 0.8385 0.3995
4  0.4482 0.7272 0.4609
5  0.8468 0.4425 0.6176
6  0.1390 0.9849 0.1617
7  0.9908 0.1788 0.7488
8  0.9505 0.2438 0.7105
9  0.2443 0.9783 0.1331
10 0.9998 0.0652 0.8917
> yExpCondA <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz() )
> all.equal( yExpCond, yExpCondA )
[1] TRUE
> yExpCond2 <- matrix( NA, nrow = nObs, ncol = ncol( yMat ) )
> for( i in 1:nObs ) {
+    for( k in 1:ncol( yMat ) ) {
+       set.seed( 123 )
+       numerator <- pmvnorm( upper = yMatLin[ i, ], sigma = sigma )
+       set.seed( 123 )
+       denominator <- pmvnorm( upper = yMatLin[ i, -k ], sigma = sigma[ -k, -k ] )
+       yExpCond2[ i, k ] <- numerator / denominator
+    }
+ }
> all.equal( yExpCond, as.data.frame( yExpCond2 ) )
[1] TRUE
> # now with explicitly specifying the algorithm
> yExpCond3 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz )
> all.equal( yExpCond, yExpCond3 )
[1] TRUE
> identical( yExpCond, yExpCond3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm
> yExpCond4 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = Miwa )
> all.equal( yExpCond, yExpCond4 )
[1] "Component 1: Mean relative difference: 4.435478e-05"
[2] "Component 2: Mean relative difference: 0.0001002261"
[3] "Component 3: Mean relative difference: 5.938566e-05"
> # now with integrals obtained by the Miwa algorithm, less precise
> yExpCond5 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = Miwa( steps = 32 ) )
> all.equal( yExpCond4, yExpCond5 )
[1] "Component 1: Mean relative difference: 1.014946e-05"
[2] "Component 2: Mean relative difference: 1.070674e-05"
[3] "Component 3: Mean relative difference: 9.286508e-06"
> # now with integrals obtained by the TVPACK algorithm
> yExpCond6 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = TVPACK )
> all.equal( yExpCond, yExpCond6 )
[1] "Component 1: Mean relative difference: 4.435948e-05"
[2] "Component 2: Mean relative difference: 0.0001002157"
[3] "Component 3: Mean relative difference: 5.938604e-05"
> # now with integrals obtained by the TVPACK algorithm, less precise
> yExpCond7 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = TVPACK( abseps = 0.5 ) )
> all.equal( yExpCond6, yExpCond7 )
[1] "Component 1: Mean relative difference: 0.03017515"
[2] "Component 2: Mean relative difference: 0.04273065"
[3] "Component 3: Mean relative difference: 0.0424229" 
> # now with integrals obtained by the GHK algorithm
> yExpCond8 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE )
> all.equal( yExpCond, yExpCond8 )
[1] "Component 1: Mean relative difference: 0.002370084"
[2] "Component 2: Mean relative difference: 0.005788364"
[3] "Component 3: Mean relative difference: 0.005552991"
> # now with integrals obtained by the GHK algorithm, less precise
> yExpCond9 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    nGHK = 100 )
> all.equal( yExpCond8, yExpCond9 )
[1] "Component 1: Mean relative difference: 0.089207"  
[2] "Component 2: Mean relative difference: 0.05716181"
[3] "Component 3: Mean relative difference: 0.0646556" 
> 
> 
> # conditional expectations of dependent variables
> # (assuming that all other dependent variables are as observed)
> yExpCondObs <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE, algorithm = GenzBretz() )
> round( yExpCondObs, 4 )
       y1     y2     y3
1  0.0145 0.7352 0.1724
2  0.3642 0.7444 0.1190
3  0.1020 0.7881 0.1516
4  0.1974 0.8131 0.4609
5  0.4689 0.5423 0.7069
6  0.0247 0.9727 0.0294
7  0.9714 0.1788 0.8093
8  0.8895 0.2438 0.7828
9  0.0557 0.9676 0.0272
10 0.9986 0.0652 0.9256
> yExpCondObsA <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE, algorithm = GenzBretz() )
> all.equal( yExpCondObs, yExpCondObsA )
[1] TRUE
> yExpCondObs2 <- matrix( NA, nrow = nObs, ncol = ncol( yMat ) )
> for( i in 1:nObs ){
+    for( k in 1:ncol( yMat ) ) {
+       ySign <- 2 * yMat[ i, ] - 1
+       ySign[ k ] <- 1
+       yLinTmp <- yMatLin[ i, ] * ySign
+       sigmaTmp <- diag( ySign ) %*% sigma %*% diag( ySign )
+       set.seed( 123 )
+       numerator <- pmvnorm( upper = yLinTmp, sigma = sigmaTmp )
+       set.seed( 123 )
+       denominator <- pmvnorm( upper = yLinTmp[ -k ], sigma = sigmaTmp[ -k, -k ] )
+       yExpCondObs2[ i, k ] <- numerator / denominator
+    }
+ }
> all.equal( yExpCondObs, as.data.frame( yExpCondObs2 ) )
[1] "Names: 3 string mismatches"
> # now with explicitly specifying the algorithm
> yExpCondObs3 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = GenzBretz )
> all.equal( yExpCondObs, yExpCondObs3 )
[1] TRUE
> identical( yExpCondObs, yExpCondObs3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm
> yExpCondObs4 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = Miwa )
> all.equal( yExpCondObs, yExpCondObs4 )
[1] "Component 1: Mean relative difference: 9.258897e-05"
[2] "Component 2: Mean relative difference: 5.029085e-05"
[3] "Component 3: Mean relative difference: 0.0001009532"
> # now with integrals obtained by the Miwa algorithm, less precise
> yExpCondObs5 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = Miwa( steps = 32 ) )
> all.equal( yExpCondObs4, yExpCondObs5 )
[1] "Component 1: Mean relative difference: 4.471818e-06"
[2] "Component 2: Mean relative difference: 3.954285e-06"
[3] "Component 3: Mean relative difference: 4.758699e-06"
> # now with integrals obtained by the TVPACK algorithm
> yExpCondObs6 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = TVPACK )
> all.equal( yExpCondObs, yExpCondObs6 )
[1] "Component 1: Mean relative difference: 9.258463e-05"
[2] "Component 2: Mean relative difference: 5.028616e-05"
[3] "Component 3: Mean relative difference: 0.0001009503"
> # now with integrals obtained by the TVPACK algorithm, less precise
> yExpCondObs7 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = TVPACK( abseps = 0.5 ) )
> all.equal( yExpCondObs6, yExpCondObs7 )
[1] "Component 1: Mean relative difference: 0.05130138"
[2] "Component 2: Mean relative difference: 0.04744355"
[3] "Component 3: Mean relative difference: 0.02586555"
> # now with integrals obtained by the GHK algorithm
> yExpCondObs8 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE )
> all.equal( yExpCondObs, yExpCondObs8 )
[1] "Component 1: Mean relative difference: 0.002650961"
[2] "Component 2: Mean relative difference: 0.002438056"
[3] "Component 3: Mean relative difference: 0.00287644" 
> # now with integrals obtained by the GHK algorithm, less precise
> yExpCondObs9 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, nGHK = 100 )
> all.equal( yExpCondObs8, yExpCondObs9 )
[1] "Component 1: Mean relative difference: 0.01486969"
[2] "Component 2: Mean relative difference: 0.0173985" 
[3] "Component 3: Mean relative difference: 0.01629308"
> 
> 
> # unconditional expectations of dependent variables by simulation
> nSim <- 10000
> ySim <- array( NA, c( nObs, ncol( yMat ), nSim ) )
> for( s in 1:nSim ) {
+    ySim[ , , s ] <- ( yMatLin + rmvnorm( nObs, sigma = sigma ) ) > 0
+ }
> yExpSim <- matrix( NA, nrow = nObs, ncol = ncol( yMat ) )
> for( i in 1:nObs ) {
+    yExpSim[ i, ] <- rowSums( ySim[ i, , ] ) / nSim
+ }
> round( yExpSim, 4 )
        [,1]   [,2]   [,3]
 [1,] 0.0192 0.7292 0.1974
 [2,] 0.4004 0.7599 0.2151
 [3,] 0.1185 0.7867 0.1978
 [4,] 0.2374 0.6843 0.2992
 [5,] 0.6817 0.4368 0.5779
 [6,] 0.0275 0.9709 0.0356
 [7,] 0.9580 0.1843 0.7872
 [8,] 0.8551 0.2551 0.7156
 [9,] 0.0624 0.9697 0.0332
[10,] 0.9984 0.0636 0.9231
> round( yExpSim - as.matrix( yExp ), 4 )
           V1      V2      V3
 [1,] -0.0017  0.0038  0.0033
 [2,]  0.0065 -0.0085  0.0015
 [3,] -0.0061 -0.0012  0.0014
 [4,]  0.0025  0.0036  0.0074
 [5,]  0.0017  0.0021 -0.0007
 [6,] -0.0004 -0.0018  0.0019
 [7,] -0.0002 -0.0020  0.0031
 [8,] -0.0013  0.0084 -0.0083
 [9,]  0.0017  0.0015 -0.0012
[10,]  0.0005 -0.0037  0.0005
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -0.07304505  0.71128820  0.08262612 -1.11816720
> 
> # calculating log likelihood value(s)
> logLikVal <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = GenzBretz() )
> round( logLikVal, 4 )
 [1] -0.5354 -0.9416 -0.5516 -2.3266 -2.2590 -0.0865 -0.4657 -0.7039 -0.1239
[10] -0.1493
> logLikValA <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = GenzBretz() )
> all.equal( logLikVal, logLikValA )
[1] TRUE
> # now with explicitly specifying the algorithm
> logLikVal3 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = GenzBretz )
> all.equal( logLikVal, logLikVal3 )
[1] TRUE
> identical( logLikVal, logLikVal3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm
> logLikVal4 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = Miwa )
> all.equal( logLikVal, logLikVal4 )
[1] "Mean relative difference: 8.840686e-05"
> # now with integrals obtained by the Miwa algorithm, less precise
> logLikVal5 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = Miwa( steps = 32 ) )
> all.equal( logLikVal4, logLikVal5 )
[1] "Mean relative difference: 4.53253e-06"
> # now with integrals obtained by the TVPACK algorithm
> logLikVal6 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = TVPACK )
> all.equal( logLikVal, logLikVal6 )
[1] "Mean relative difference: 8.840067e-05"
> # now with integrals obtained by the TVPACK algorithm, less precise
> logLikVal7 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = TVPACK( abseps = 0.5 ) )
> all.equal( logLikVal6, logLikVal7 )
[1] "Mean relative difference: 0.05527167"
> # now with integrals obtained by the GHK algorithm
> logLikVal8 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ) )
> all.equal( logLikVal, logLikVal8 )
[1] "Mean relative difference: 0.002220837"
> # now with integrals obtained by the GHK algorithm, less precise
> logLikVal9 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    nGHK = 100 )
> all.equal( logLikVal8, logLikVal9 )
[1] "Mean relative difference: 0.01480876"
> 
> # calculating log likelihood value(s) with one-sided gradients
> logLikValGrad1 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    oneSidedGrad = TRUE, algorithm = GenzBretz() )
> round( c( logLikValGrad1 ), 4 )
 [1] -0.5354 -0.9416 -0.5516 -2.3266 -2.2590 -0.0865 -0.4657 -0.7039 -0.1239
[10] -0.1493
> round( attr( logLikValGrad1, "gradient" ), 4 )
        b_1_0   b_1_1   b_1_2   b_1_3   b_1_4   b_2_0   b_2_1   b_2_2   b_2_3
 [1,] -0.0395  0.0000 -0.0395  0.0422 -0.0168  0.4470  0.0000  0.4470 -0.4774
 [2,] -0.6202  0.0000 -0.6202  0.1352  0.1830  0.4384  0.0000  0.4384 -0.0956
 [3,] -0.2088 -0.2088 -0.2088  0.2143 -0.1869  0.3708  0.3708  0.3708 -0.3804
 [4,]  1.4939  1.4939  1.4939 -1.0889  1.3119  0.3397  0.3397  0.3397 -0.2476
 [5,]  0.9173  0.9173  0.0000 -0.5733  0.7536 -0.8864 -0.8864  0.0000  0.5540
 [6,] -0.0609 -0.0609 -0.0609  0.1028 -0.0420  0.0647  0.0647  0.0647 -0.1091
 [7,]  0.0712  0.0712  0.0712  0.0597  0.0395 -0.3197 -0.3197 -0.3197 -0.2679
 [8,]  0.2248  0.0000  0.0000  0.0345 -0.0139 -0.4185  0.0000  0.0000 -0.0642
 [9,] -0.1217  0.0000 -0.1217  0.1385  0.0372  0.0752  0.0000  0.0752 -0.0856
[10,]  0.0048  0.0000  0.0000  0.0060 -0.0018 -0.1361  0.0000  0.0000 -0.1706
        b_2_4   b_3_0   b_3_1   b_3_2  b_3_3   b_3_4   R_1_2   R_1_3   R_2_3
 [1,]  0.1907 -0.3139  0.0000 -0.3139 0.3352 -0.1339 -0.0090  0.0316 -0.1615
 [2,] -0.1294 -0.2407  0.0000 -0.2407 0.0525  0.0710 -0.2109  0.2426 -0.1325
 [3,]  0.3319 -0.2883 -0.2883 -0.2883 0.2958 -0.2581 -0.0490  0.1185 -0.1292
 [4,]  0.2983 -0.7910 -0.7910 -0.7910 0.5766 -0.6946  0.5932 -0.9473 -0.3195
 [5,] -0.7283 -1.2450 -1.2450  0.0000 0.7782 -1.0229 -0.6959 -0.9016  1.0164
 [6,]  0.0445 -0.0704 -0.0704 -0.0704 0.1187 -0.0485 -0.0021  0.0151 -0.0065
 [7,] -0.1771  0.3438  0.3438  0.3438 0.2880  0.1904 -0.0122  0.0552 -0.1291
 [8,]  0.0259  0.3913  0.0000  0.0000 0.0600 -0.0242 -0.0621  0.1596 -0.1922
 [9,] -0.0230 -0.0666  0.0000 -0.0666 0.0758  0.0204 -0.0039  0.0246 -0.0077
[10,]  0.0518  0.1527  0.0000  0.0000 0.1915 -0.0581 -0.0003  0.0032 -0.0267
> logLikValGrad1A <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ),
+    oneSidedGrad = TRUE, algorithm = GenzBretz() )
> all.equal( logLikValGrad1, logLikValGrad1A )
[1] TRUE
> 
> # calculating log likelihood value(s) with two-sided gradients
> logLikValGrad <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    returnGrad = TRUE, algorithm = GenzBretz() )
> round( c( logLikValGrad ), 4 )
 [1] -0.5354 -0.9416 -0.5516 -2.3266 -2.2590 -0.0865 -0.4657 -0.7039 -0.1239
[10] -0.1493
> round( attr( logLikValGrad, "gradient" ), 4 )
        b_1_0   b_1_1   b_1_2   b_1_3   b_1_4   b_2_0   b_2_1   b_2_2   b_2_3
 [1,] -0.0395  0.0000 -0.0395  0.0422 -0.0168  0.4471  0.0000  0.4471 -0.4774
 [2,] -0.6202  0.0000 -0.6202  0.1352  0.1830  0.4384  0.0000  0.4384 -0.0956
 [3,] -0.2088 -0.2088 -0.2088  0.2143 -0.1869  0.3708  0.3708  0.3708 -0.3804
 [4,]  1.4939  1.4939  1.4939 -1.0889  1.3119  0.3397  0.3397  0.3397 -0.2476
 [5,]  0.9173  0.9173  0.0000 -0.5733  0.7536 -0.8864 -0.8864  0.0000  0.5540
 [6,] -0.0609 -0.0609 -0.0609  0.1028 -0.0420  0.0647  0.0647  0.0647 -0.1091
 [7,]  0.0712  0.0712  0.0712  0.0597  0.0395 -0.3197 -0.3197 -0.3197 -0.2679
 [8,]  0.2248  0.0000  0.0000  0.0345 -0.0139 -0.4185  0.0000  0.0000 -0.0642
 [9,] -0.1217  0.0000 -0.1217  0.1385  0.0372  0.0752  0.0000  0.0752 -0.0856
[10,]  0.0048  0.0000  0.0000  0.0060 -0.0018 -0.1361  0.0000  0.0000 -0.1706
        b_2_4   b_3_0   b_3_1   b_3_2  b_3_3   b_3_4   R_1_2   R_1_3   R_2_3
 [1,]  0.1907 -0.3139  0.0000 -0.3139 0.3352 -0.1339 -0.0090  0.0316 -0.1615
 [2,] -0.1294 -0.2407  0.0000 -0.2407 0.0525  0.0710 -0.2109  0.2426 -0.1325
 [3,]  0.3319 -0.2883 -0.2883 -0.2883 0.2958 -0.2581 -0.0490  0.1185 -0.1292
 [4,]  0.2983 -0.7910 -0.7910 -0.7910 0.5766 -0.6946  0.5932 -0.9473 -0.3195
 [5,] -0.7283 -1.2450 -1.2450  0.0000 0.7782 -1.0229 -0.6959 -0.9016  1.0164
 [6,]  0.0445 -0.0704 -0.0704 -0.0704 0.1187 -0.0485 -0.0021  0.0151 -0.0065
 [7,] -0.1771  0.3438  0.3438  0.3438 0.2880  0.1904 -0.0122  0.0552 -0.1291
 [8,]  0.0259  0.3913  0.0000  0.0000 0.0600 -0.0242 -0.0621  0.1596 -0.1922
 [9,] -0.0230 -0.0666  0.0000 -0.0666 0.0758  0.0204 -0.0039  0.0246 -0.0077
[10,]  0.0518  0.1527  0.0000  0.0000 0.1915 -0.0581 -0.0003  0.0032 -0.0267
> # now manually
> llTmp <- function( coef ) {
+    betaTmp <- coef[ 1:15 ]
+    sigmaTmp <- diag( 3 )
+    sigmaTmp[ lower.tri( sigmaTmp ) ] <- coef[ -(1:15) ]
+    sigmaTmp[ upper.tri( sigmaTmp ) ] <- t( sigmaTmp )[ upper.tri( sigmaTmp ) ]
+    result <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+       coef = betaTmp, sigma = sigmaTmp, 
+       data = as.data.frame( cbind( xMat, yMat ) ), algorithm = GenzBretz() )
+    return( result )
+ }
> logLikValGrad2 <- numericGradient( llTmp, allCoef )
> round( logLikValGrad2, 4 )
         [,1]    [,2]    [,3]    [,4]    [,5]    [,6]    [,7]    [,8]    [,9]
 [1,] -0.0395  0.0000 -0.0395  0.0422 -0.0168  0.4471  0.0000  0.4471 -0.4774
 [2,] -0.6202  0.0000 -0.6202  0.1352  0.1830  0.4384  0.0000  0.4384 -0.0956
 [3,] -0.2088 -0.2088 -0.2088  0.2143 -0.1869  0.3708  0.3708  0.3708 -0.3804
 [4,]  1.4939  1.4939  1.4939 -1.0889  1.3119  0.3397  0.3397  0.3397 -0.2476
 [5,]  0.9173  0.9173  0.0000 -0.5733  0.7536 -0.8864 -0.8864  0.0000  0.5540
 [6,] -0.0609 -0.0609 -0.0609  0.1028 -0.0420  0.0647  0.0647  0.0647 -0.1091
 [7,]  0.0712  0.0712  0.0712  0.0597  0.0395 -0.3197 -0.3197 -0.3197 -0.2679
 [8,]  0.2248  0.0000  0.0000  0.0345 -0.0139 -0.4185  0.0000  0.0000 -0.0642
 [9,] -0.1217  0.0000 -0.1217  0.1385  0.0372  0.0752  0.0000  0.0752 -0.0856
[10,]  0.0048  0.0000  0.0000  0.0060 -0.0018 -0.1361  0.0000  0.0000 -0.1706
        [,10]   [,11]   [,12]   [,13]  [,14]   [,15]   [,16]   [,17]   [,18]
 [1,]  0.1907 -0.3139  0.0000 -0.3139 0.3352 -0.1339 -0.0090  0.0316 -0.1615
 [2,] -0.1294 -0.2407  0.0000 -0.2407 0.0525  0.0710 -0.2109  0.2426 -0.1325
 [3,]  0.3319 -0.2883 -0.2883 -0.2883 0.2958 -0.2581 -0.0490  0.1185 -0.1292
 [4,]  0.2983 -0.7910 -0.7910 -0.7910 0.5766 -0.6946  0.5932 -0.9473 -0.3195
 [5,] -0.7283 -1.2450 -1.2450  0.0000 0.7782 -1.0229 -0.6959 -0.9016  1.0164
 [6,]  0.0445 -0.0704 -0.0704 -0.0704 0.1187 -0.0485 -0.0021  0.0151 -0.0065
 [7,] -0.1771  0.3438  0.3438  0.3438 0.2880  0.1904 -0.0122  0.0552 -0.1291
 [8,]  0.0259  0.3913  0.0000  0.0000 0.0600 -0.0242 -0.0621  0.1596 -0.1922
 [9,] -0.0230 -0.0666  0.0000 -0.0666 0.0758  0.0204 -0.0039  0.0246 -0.0077
[10,]  0.0518  0.1527  0.0000  0.0000 0.1915 -0.0581 -0.0003  0.0032 -0.0267
> # attr( logLikValGrad1, "gradient" ) / logLikValGrad2 - 1
> range( attr( logLikValGrad1, "gradient" ) / logLikValGrad2 - 1, na.rm = TRUE )
[1] -2.453775e-06  1.181710e-06
> # attr( logLikValGrad1, "gradient" ) - logLikValGrad2
> range( attr( logLikValGrad1, "gradient" ) - logLikValGrad2 )
[1] -7.793766e-07  3.241343e-07
> # attr( logLikValGrad1, "gradient" ) / logLikValGrad2 - 1
> range( attr( logLikValGrad, "gradient" ) / logLikValGrad2 - 1, na.rm = TRUE )
[1] -9.386900e-08  2.259713e-08
> # attr( logLikValGrad, "gradient" ) - logLikValGrad2
> range( attr( logLikValGrad, "gradient" ) - logLikValGrad2 )
[1] -5.907174e-10  4.704919e-10
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -1.3162070  0.7625245  0.9035873  1.6774175
> 
> # calculating marginal effects, unconditional
> margEffUnc <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ) )
> round( margEffUnc, 4 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     0.1807    0.2197   -0.1224   -0.1292    0.2258   -0.2412    0.0703
2     0.4301    0.1901   -0.1320   -0.3737    0.2153   -0.2490    0.5387
3     0.1152    0.3675   -0.2031   -0.3148    0.2090   -0.2422    0.2875
4     0.2076    0.3828   -0.2289   -0.3743    0.2326   -0.2686    0.4301
5     0.4480    0.3126   -0.2091   -0.3827    0.2337   -0.2707    0.5007
6     0.0270    0.1509   -0.0758   -0.1529    0.0658   -0.0957    0.0897
7     0.2563    0.1570   -0.1330   -0.0387    0.1184   -0.1473    0.1251
8     0.1318    0.3769   -0.2261   -0.3308    0.2195   -0.2659    0.3170
9     0.3030    0.0296   -0.0267   -0.2309    0.0729   -0.0971    0.1684
10    0.0021    0.2427   -0.1279   -0.0293    0.1178   -0.1575    0.0094
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    -0.4001    0.3024   -0.0402   -0.5335    0.3299
2    -0.3658    0.3202   -0.3078   -0.4877    0.3493
3    -0.3479    0.3046   -0.1643   -0.4639    0.3323
4    -0.4287    0.3776   -0.2458   -0.5717    0.4120
5    -0.4723    0.4303   -0.2861   -0.6297    0.4694
6    -0.0755    0.0824   -0.0513   -0.1006    0.0899
7    -0.3217    0.3222   -0.0715   -0.4289    0.3514
8    -0.3786    0.3678   -0.1812   -0.5048    0.4012
9    -0.0856    0.0839   -0.0962   -0.1142    0.0915
10   -0.1564    0.1595   -0.0053   -0.2085    0.1740
> round( attr( margEffUnc, "vcov" )[ 1:3, , ], 5 )
, , d_y1_d_x1

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   0.25647         0         0  -0.08661         0         0   0.09743
2   0.10084         0         0  -0.05986         0         0  -0.02844
3   0.16741         0         0  -0.09902         0         0   0.26025
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0  -0.05781         0         0
2         0         0   0.03661         0         0
3         0         0  -0.13728         0         0

, , d_y2_d_x1

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0   0.17655         0         0  -0.04030         0         0
2         0   0.10751         0         0  -0.04365         0         0
3         0   0.12340         0         0  -0.02945         0         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1  -0.09780         0         0  -0.26755         0
2  -0.10944         0         0  -0.14563         0
3   0.00235         0         0  -0.06317         0

, , d_y3_d_x1

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0         0   0.08208         0         0   0.00011         0
2         0         0   0.06470         0         0  -0.02392         0
3         0         0   0.12273         0         0  -0.02616         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0  -0.07916         0         0  -0.14678
2         0  -0.06712         0         0  -0.07088
3         0  -0.00652         0         0  -0.06808

, , d_y1_d_x2

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1  -0.08661         0         0   0.08032         0         0  -0.04382
2  -0.05986         0         0   0.15518         0         0   0.06216
3  -0.09902         0         0   0.17981         0         0  -0.13347
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0   0.02673         0         0
2         0         0  -0.04833         0         0
3         0         0   0.06428         0         0

, , d_y2_d_x2

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0  -0.04030         0         0   0.12114         0         0
2         0  -0.04365         0         0   0.10222         0         0
3         0  -0.02945         0         0   0.12352         0         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   0.06679         0         0   0.04863         0
2   0.06026         0         0   0.08046         0
3   0.00228         0         0  -0.06336         0

, , d_y3_d_x2

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0         0   0.00011         0         0   0.10834         0
2         0         0  -0.02392         0         0   0.09751         0
3         0         0  -0.02616         0         0   0.12970         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0   0.03467         0         0  -0.01414
2         0   0.05014         0         0   0.05646
3         0  -0.01225         0         0  -0.07879

, , d_y1_d_x3

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   0.09743         0         0  -0.04382         0         0   0.05517
2  -0.02844         0         0   0.06216         0         0   0.16855
3   0.26025         0         0  -0.13347         0         0   0.43542
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0  -0.03141         0         0
2         0         0  -0.03515         0         0
3         0         0  -0.20371         0         0

, , d_y2_d_x3

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0  -0.09780         0         0   0.06679         0         0
2         0  -0.10944         0         0   0.06026         0         0
3         0   0.00235         0         0   0.00228         0         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   0.13138         0         0   0.17467         0
2   0.21107         0         0   0.15720         0
3   0.29381         0         0   0.46214         0

, , d_y3_d_x3

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0         0  -0.07916         0         0   0.03467         0
2         0         0  -0.06712         0         0   0.05014         0
3         0         0  -0.00652         0         0  -0.01225         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0   0.14859         0         0   0.19379
2         0   0.19039         0         0   0.11102
3         0   0.25745         0         0   0.34241

, , d_y1_d_x4

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1  -0.05781         0         0   0.02673         0         0  -0.03141
2   0.03661         0         0  -0.04833         0         0  -0.03515
3  -0.13728         0         0   0.06428         0         0  -0.20371
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0   0.02122         0         0
2         0         0   0.18151         0         0
3         0         0   0.14656         0         0

, , d_y2_d_x4

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0  -0.26755         0         0   0.04863         0         0
2         0  -0.14563         0         0   0.08046         0         0
3         0  -0.06317         0         0  -0.06336         0         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   0.17467         0         0   0.54103         0
2   0.15720         0         0   0.30203         0
3   0.46214         0         0   0.94353         0

, , d_y3_d_x4

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0         0  -0.14678         0         0  -0.01414         0
2         0         0  -0.07088         0         0   0.05646         0
3         0         0  -0.06808         0         0  -0.07879         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0   0.19379         0         0   0.41152
2         0   0.11102         0         0   0.20124
3         0   0.34241         0         0   0.60864

> round( drop( attr( margEffUnc, "vcov" )[ nObs, , ] ), 5 )
          d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
d_y1_d_x1   0.00012   0.00000   0.00000  -0.00115   0.00000   0.00000   0.00042
d_y2_d_x1   0.00000   0.25893   0.00000   0.00000   0.08265   0.00000   0.00000
d_y3_d_x1   0.00000   0.00000   0.13369   0.00000   0.00000   0.06145   0.00000
d_y1_d_x2  -0.00115   0.00000   0.00000   0.01617   0.00000   0.00000  -0.00412
d_y2_d_x2   0.00000   0.08265   0.00000   0.00000   0.12214   0.00000   0.00000
d_y3_d_x2   0.00000   0.00000   0.06145   0.00000   0.00000   0.16593   0.00000
d_y1_d_x3   0.00042   0.00000   0.00000  -0.00412   0.00000   0.00000   0.00154
d_y2_d_x3   0.00000  -0.10506   0.00000   0.00000  -0.06458   0.00000   0.00000
d_y3_d_x3   0.00000   0.00000  -0.06060   0.00000   0.00000  -0.07053   0.00000
d_y1_d_x4  -0.00026   0.00000   0.00000   0.00250   0.00000   0.00000  -0.00092
d_y2_d_x4   0.00000  -0.19958   0.00000   0.00000  -0.12269   0.00000   0.00000
d_y3_d_x4   0.00000   0.00000  -0.10145   0.00000   0.00000  -0.11808   0.00000
          d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
d_y1_d_x1   0.00000   0.00000  -0.00026   0.00000   0.00000
d_y2_d_x1  -0.10506   0.00000   0.00000  -0.19958   0.00000
d_y3_d_x1   0.00000  -0.06060   0.00000   0.00000  -0.10145
d_y1_d_x2   0.00000   0.00000   0.00250   0.00000   0.00000
d_y2_d_x2  -0.06458   0.00000   0.00000  -0.12269   0.00000
d_y3_d_x2   0.00000  -0.07053   0.00000   0.00000  -0.11808
d_y1_d_x3   0.00000   0.00000  -0.00092   0.00000   0.00000
d_y2_d_x3   0.08926   0.00000   0.00000   0.15894   0.00000
d_y3_d_x3   0.00000   0.07841   0.00000   0.00000   0.12013
d_y1_d_x4   0.00000   0.00000   0.00060   0.00000   0.00000
d_y2_d_x4   0.15894   0.00000   0.00000   0.31234   0.00000
d_y3_d_x4   0.00000   0.12013   0.00000   0.00000   0.21486
> print( summary( margEffUnc ), digits = 3 )
              Estimate Std. error z value Pr(> z)  
1: d_y1_d_x1   0.18067    0.50643    0.36    0.72  
1: d_y2_d_x1   0.21967    0.42018    0.52    0.60  
1: d_y3_d_x1  -0.12236    0.28650   -0.43    0.67  
1: d_y1_d_x2  -0.12920    0.28340   -0.46    0.65  
1: d_y2_d_x2   0.22581    0.34805    0.65    0.52  
1: d_y3_d_x2  -0.24121    0.32914   -0.73    0.46  
1: d_y1_d_x3   0.07027    0.23489    0.30    0.76  
1: d_y2_d_x3  -0.40010    0.36246   -1.10    0.27  
1: d_y3_d_x3   0.30244    0.38548    0.78    0.43  
1: d_y1_d_x4  -0.04016    0.14567   -0.28    0.78  
1: d_y2_d_x4  -0.53346    0.73555   -0.73    0.47  
1: d_y3_d_x4   0.32993    0.64150    0.51    0.61  
2: d_y1_d_x1   0.43012    0.31756    1.35    0.18  
2: d_y2_d_x1   0.19008    0.32788    0.58    0.56  
2: d_y3_d_x1  -0.13196    0.25436   -0.52    0.60  
2: d_y1_d_x2  -0.37365    0.39392   -0.95    0.34  
2: d_y2_d_x2   0.21526    0.31971    0.67    0.50  
2: d_y3_d_x2  -0.24897    0.31227   -0.80    0.43  
2: d_y1_d_x3   0.53866    0.41054    1.31    0.19  
2: d_y2_d_x3  -0.36577    0.45942   -0.80    0.43  
2: d_y3_d_x3   0.32022    0.43634    0.73    0.46  
2: d_y1_d_x4  -0.30780    0.42604   -0.72    0.47  
2: d_y2_d_x4  -0.48769    0.54958   -0.89    0.37  
2: d_y3_d_x4   0.34934    0.44860    0.78    0.44  
3: d_y1_d_x1   0.11523    0.40916    0.28    0.78  
3: d_y2_d_x1   0.36751    0.35129    1.05    0.30  
3: d_y3_d_x1  -0.20315    0.35033   -0.58    0.56  
3: d_y1_d_x2  -0.31484    0.42404   -0.74    0.46  
3: d_y2_d_x2   0.20899    0.35146    0.59    0.55  
3: d_y3_d_x2  -0.24220    0.36014   -0.67    0.50  
3: d_y1_d_x3   0.28748    0.65986    0.44    0.66  
3: d_y2_d_x3  -0.34791    0.54204   -0.64    0.52  
3: d_y3_d_x3   0.30462    0.50740    0.60    0.55  
3: d_y1_d_x4  -0.16427    0.38284   -0.43    0.67  
3: d_y2_d_x4  -0.46388    0.97135   -0.48    0.63  
3: d_y3_d_x4   0.33232    0.78015    0.43    0.67  
4: d_y1_d_x1   0.20761    0.54002    0.38    0.70  
4: d_y2_d_x1   0.38276    0.35781    1.07    0.28  
4: d_y3_d_x1  -0.22889    0.35761   -0.64    0.52  
4: d_y1_d_x2  -0.37427    0.33736   -1.11    0.27  
4: d_y2_d_x2   0.23255    0.36399    0.64    0.52  
4: d_y3_d_x2  -0.26856    0.35563   -0.76    0.45  
4: d_y1_d_x3   0.43007    0.60913    0.71    0.48  
4: d_y2_d_x3  -0.42874    0.44367   -0.97    0.33  
4: d_y3_d_x3   0.37765    0.44565    0.85    0.40  
4: d_y1_d_x4  -0.24576    0.36651   -0.67    0.50  
4: d_y2_d_x4  -0.57165    0.77847   -0.73    0.46  
4: d_y3_d_x4   0.41198    0.68801    0.60    0.55  
5: d_y1_d_x1   0.44801    0.36549    1.23    0.22  
5: d_y2_d_x1   0.31256    0.47992    0.65    0.51  
5: d_y3_d_x1  -0.20905    0.41729   -0.50    0.62  
5: d_y1_d_x2  -0.38274    0.34681   -1.10    0.27  
5: d_y2_d_x2   0.23373    0.36682    0.64    0.52  
5: d_y3_d_x2  -0.27066    0.35847   -0.76    0.45  
5: d_y1_d_x3   0.50066    0.63315    0.79    0.43  
5: d_y2_d_x3  -0.47230    0.46016   -1.03    0.30  
5: d_y3_d_x3   0.43029    0.46593    0.92    0.36  
5: d_y1_d_x4  -0.28609    0.51135   -0.56    0.58  
5: d_y2_d_x4  -0.62973    0.34775   -1.81    0.07 .
5: d_y3_d_x4   0.46941    0.34620    1.36    0.18  
6: d_y1_d_x1   0.02699    0.15450    0.17    0.86  
6: d_y2_d_x1   0.15092    0.46066    0.33    0.74  
6: d_y3_d_x1  -0.07584    0.27020   -0.28    0.78  
6: d_y1_d_x2  -0.15289    0.46351   -0.33    0.74  
6: d_y2_d_x2   0.06576    0.24699    0.27    0.79  
6: d_y3_d_x2  -0.09575    0.32253   -0.30    0.77  
6: d_y1_d_x3   0.08974    0.39125    0.23    0.82  
6: d_y2_d_x3  -0.07547    0.32599   -0.23    0.82  
6: d_y3_d_x3   0.08239    0.33324    0.25    0.80  
6: d_y1_d_x4  -0.05128    0.23709   -0.22    0.83  
6: d_y2_d_x4  -0.10062    0.50725   -0.20    0.84  
6: d_y3_d_x4   0.08988    0.43974    0.20    0.84  
7: d_y1_d_x1   0.25630    0.45523    0.56    0.57  
7: d_y2_d_x1   0.15703    0.44039    0.36    0.72  
7: d_y3_d_x1  -0.13302    0.38072   -0.35    0.73  
7: d_y1_d_x2  -0.03867    0.16470   -0.23    0.81  
7: d_y2_d_x2   0.11840    0.35818    0.33    0.74  
7: d_y3_d_x2  -0.14725    0.40427   -0.36    0.72  
7: d_y1_d_x3   0.12512    0.40398    0.31    0.76  
7: d_y2_d_x3  -0.32171    0.52222   -0.62    0.54  
7: d_y3_d_x3   0.32215    0.46782    0.69    0.49  
7: d_y1_d_x4  -0.07149    0.28547   -0.25    0.80  
7: d_y2_d_x4  -0.42895    0.73789   -0.58    0.56  
7: d_y3_d_x4   0.35144    0.54987    0.64    0.52  
8: d_y1_d_x1   0.13183    0.20074    0.66    0.51  
8: d_y2_d_x1   0.37695    0.38515    0.98    0.33  
8: d_y3_d_x1  -0.22611    0.40427   -0.56    0.58  
8: d_y1_d_x2  -0.33078    0.43449   -0.76    0.45  
8: d_y2_d_x2   0.21946    0.40610    0.54    0.59  
8: d_y3_d_x2  -0.26593    0.40173   -0.66    0.51  
8: d_y1_d_x3   0.31702    0.38062    0.83    0.40  
8: d_y2_d_x3  -0.37862    0.37883   -1.00    0.32  
8: d_y3_d_x3   0.36777    0.37230    0.99    0.32  
8: d_y1_d_x4  -0.18116    0.28998   -0.62    0.53  
8: d_y2_d_x4  -0.50483    0.48571   -1.04    0.30  
8: d_y3_d_x4   0.40121    0.42452    0.95    0.34  
9: d_y1_d_x1   0.30295    0.60131    0.50    0.61  
9: d_y2_d_x1   0.02963    0.11910    0.25    0.80  
9: d_y3_d_x1  -0.02667    0.10327   -0.26    0.80  
9: d_y1_d_x2  -0.23090    0.36496   -0.63    0.53  
9: d_y2_d_x2   0.07291    0.18450    0.40    0.69  
9: d_y3_d_x2  -0.09710    0.22509   -0.43    0.67  
9: d_y1_d_x3   0.16837    0.41649    0.40    0.69  
9: d_y2_d_x3  -0.08563    0.25466   -0.34    0.74  
9: d_y3_d_x3   0.08389    0.24136    0.35    0.73  
9: d_y1_d_x4  -0.09621    0.31727   -0.30    0.76  
9: d_y2_d_x4  -0.11418    0.38467   -0.30    0.77  
9: d_y3_d_x4   0.09152    0.30328    0.30    0.76  
10: d_y1_d_x1  0.00210    0.01085    0.19    0.85  
10: d_y2_d_x1  0.24266    0.50885    0.48    0.63  
10: d_y3_d_x1 -0.12794    0.36564   -0.35    0.73  
10: d_y1_d_x2 -0.02934    0.12716   -0.23    0.82  
10: d_y2_d_x2  0.11782    0.34949    0.34    0.74  
10: d_y3_d_x2 -0.15753    0.40735   -0.39    0.70  
10: d_y1_d_x3  0.00936    0.03928    0.24    0.81  
10: d_y2_d_x3 -0.15640    0.29876   -0.52    0.60  
10: d_y3_d_x3  0.15952    0.28002    0.57    0.57  
10: d_y1_d_x4 -0.00535    0.02454   -0.22    0.83  
10: d_y2_d_x4 -0.20853    0.55887   -0.37    0.71  
10: d_y3_d_x4  0.17402    0.46353    0.38    0.71  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
> margEffUncA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ), vcov = diag( 18 ) )
> all.equal( margEffUnc, margEffUncA )
[1] TRUE
> # now with explicitly specifying dummy variables
> margEffUncD <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ),
+    dummyVar = c( "x1", "x2" ) )
> all.equal( margEffUncD, margEffUnc )
[1] TRUE
> # now with seemingly no dummy variables
> margEffUncD0 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ),
+    dummyVar = NULL )
> print( summary( margEffUncD0 ), digits = 3 )
              Estimate Std. error z value Pr(> z)  
1: d_y1_d_x1   0.06023    0.22907    0.26    0.79  
1: d_y2_d_x1   0.33342    0.49355    0.68    0.50  
1: d_y3_d_x1  -0.16497    0.37800   -0.44    0.66  
1: d_y1_d_x2  -0.05019    0.16417   -0.31    0.76  
1: d_y2_d_x2   0.20005    0.28094    0.71    0.48  
1: d_y3_d_x2  -0.19246    0.27544   -0.70    0.48  
1: d_y1_d_x3   0.07027    0.23489    0.30    0.76  
1: d_y2_d_x3  -0.40010    0.36246   -1.10    0.27  
1: d_y3_d_x3   0.30244    0.38548    0.78    0.43  
1: d_y1_d_x4  -0.04016    0.14567   -0.28    0.78  
1: d_y2_d_x4  -0.53346    0.73555   -0.73    0.47  
1: d_y3_d_x4   0.32993    0.64150    0.51    0.61  
2: d_y1_d_x1   0.46171    0.42543    1.09    0.28  
2: d_y2_d_x1   0.30480    0.44690    0.68    0.50  
2: d_y3_d_x1  -0.17467    0.35464   -0.49    0.62  
2: d_y1_d_x2  -0.38476    0.30208   -1.27    0.20  
2: d_y2_d_x2   0.18288    0.22256    0.82    0.41  
2: d_y3_d_x2  -0.20378    0.21544   -0.95    0.34  
2: d_y1_d_x3   0.53866    0.41054    1.31    0.19  
2: d_y2_d_x3  -0.36577    0.45942   -0.80    0.43  
2: d_y3_d_x3   0.32022    0.43634    0.73    0.46  
2: d_y1_d_x4  -0.30780    0.42604   -0.72    0.47  
2: d_y2_d_x4  -0.48769    0.54958   -0.89    0.37  
2: d_y3_d_x4   0.34934    0.44860    0.78    0.44  
3: d_y1_d_x1   0.24641    0.74181    0.33    0.74  
3: d_y2_d_x1   0.28992    0.45863    0.63    0.53  
3: d_y3_d_x1  -0.16616    0.30965   -0.54    0.59  
3: d_y1_d_x2  -0.20534    0.46566   -0.44    0.66  
3: d_y2_d_x2   0.17395    0.31185    0.56    0.58  
3: d_y3_d_x2  -0.19385    0.34366   -0.56    0.57  
3: d_y1_d_x3   0.28748    0.65986    0.44    0.66  
3: d_y2_d_x3  -0.34791    0.54204   -0.64    0.52  
3: d_y3_d_x3   0.30462    0.50740    0.60    0.55  
3: d_y1_d_x4  -0.16427    0.38284   -0.43    0.67  
3: d_y2_d_x4  -0.46388    0.97135   -0.48    0.63  
3: d_y3_d_x4   0.33232    0.78015    0.43    0.67  
4: d_y1_d_x1   0.36863    0.75078    0.49    0.62  
4: d_y2_d_x1   0.35728    0.35903    1.00    0.32  
4: d_y3_d_x1  -0.20599    0.30852   -0.67    0.50  
4: d_y1_d_x2  -0.30720    0.41247   -0.74    0.46  
4: d_y2_d_x2   0.21437    0.31523    0.68    0.50  
4: d_y3_d_x2  -0.24032    0.31948   -0.75    0.45  
4: d_y1_d_x3   0.43007    0.60913    0.71    0.48  
4: d_y2_d_x3  -0.42874    0.44367   -0.97    0.33  
4: d_y3_d_x3   0.37765    0.44565    0.85    0.40  
4: d_y1_d_x4  -0.24576    0.36651   -0.67    0.50  
4: d_y2_d_x4  -0.57165    0.77847   -0.73    0.46  
4: d_y3_d_x4   0.41198    0.68801    0.60    0.55  
5: d_y1_d_x1   0.42914    0.32836    1.31    0.19  
5: d_y2_d_x1   0.39358    0.46780    0.84    0.40  
5: d_y3_d_x1  -0.23470    0.44281   -0.53    0.60  
5: d_y1_d_x2  -0.35761    0.46232   -0.77    0.44  
5: d_y2_d_x2   0.23615    0.39943    0.59    0.55  
5: d_y3_d_x2  -0.27382    0.40256   -0.68    0.50  
5: d_y1_d_x3   0.50066    0.63315    0.79    0.43  
5: d_y2_d_x3  -0.47230    0.46016   -1.03    0.30  
5: d_y3_d_x3   0.43029    0.46593    0.92    0.36  
5: d_y1_d_x4  -0.28609    0.51135   -0.56    0.58  
5: d_y2_d_x4  -0.62973    0.34775   -1.81    0.07 .
5: d_y3_d_x4   0.46941    0.34620    1.36    0.18  
6: d_y1_d_x1   0.07692    0.39959    0.19    0.85  
6: d_y2_d_x1   0.06289    0.28487    0.22    0.83  
6: d_y3_d_x1  -0.04494    0.18973   -0.24    0.81  
6: d_y1_d_x2  -0.06410    0.28867   -0.22    0.82  
6: d_y2_d_x2   0.03773    0.16761    0.23    0.82  
6: d_y3_d_x2  -0.05243    0.22218   -0.24    0.81  
6: d_y1_d_x3   0.08974    0.39125    0.23    0.82  
6: d_y2_d_x3  -0.07547    0.32599   -0.23    0.82  
6: d_y3_d_x3   0.08239    0.33324    0.25    0.80  
6: d_y1_d_x4  -0.05128    0.23709   -0.22    0.83  
6: d_y2_d_x4  -0.10062    0.50725   -0.20    0.84  
6: d_y3_d_x4   0.08988    0.43974    0.20    0.84  
7: d_y1_d_x1   0.10724    0.33569    0.32    0.75  
7: d_y2_d_x1   0.26809    0.65496    0.41    0.68  
7: d_y3_d_x1  -0.17572    0.49325   -0.36    0.72  
7: d_y1_d_x2  -0.08937    0.36241   -0.25    0.81  
7: d_y2_d_x2   0.16086    0.48081    0.33    0.74  
7: d_y3_d_x2  -0.20500    0.53332   -0.38    0.70  
7: d_y1_d_x3   0.12512    0.40398    0.31    0.76  
7: d_y2_d_x3  -0.32171    0.52222   -0.62    0.54  
7: d_y3_d_x3   0.32215    0.46782    0.69    0.49  
7: d_y1_d_x4  -0.07149    0.28547   -0.25    0.80  
7: d_y2_d_x4  -0.42895    0.73789   -0.58    0.56  
7: d_y3_d_x4   0.35144    0.54987    0.64    0.52  
8: d_y1_d_x1   0.27173    0.37056    0.73    0.46  
8: d_y2_d_x1   0.31552    0.38408    0.82    0.41  
8: d_y3_d_x1  -0.20060    0.35555   -0.56    0.57  
8: d_y1_d_x2  -0.22644    0.33321   -0.68    0.50  
8: d_y2_d_x2   0.18931    0.34179    0.55    0.58  
8: d_y3_d_x2  -0.23404    0.36291   -0.64    0.52  
8: d_y1_d_x3   0.31702    0.38062    0.83    0.40  
8: d_y2_d_x3  -0.37862    0.37883   -1.00    0.32  
8: d_y3_d_x3   0.36777    0.37230    0.99    0.32  
8: d_y1_d_x4  -0.18116    0.28998   -0.62    0.53  
8: d_y2_d_x4  -0.50483    0.48571   -1.04    0.30  
8: d_y3_d_x4   0.40121    0.42452    0.95    0.34  
9: d_y1_d_x1   0.14432    0.42864    0.34    0.74  
9: d_y2_d_x1   0.07136    0.25399    0.28    0.78  
9: d_y3_d_x1  -0.04576    0.17117   -0.27    0.79  
9: d_y1_d_x2  -0.12027    0.29534   -0.41    0.68  
9: d_y2_d_x2   0.04282    0.12305    0.35    0.73  
9: d_y3_d_x2  -0.05339    0.15155   -0.35    0.72  
9: d_y1_d_x3   0.16837    0.41649    0.40    0.69  
9: d_y2_d_x3  -0.08563    0.25466   -0.34    0.74  
9: d_y3_d_x3   0.08389    0.24136    0.35    0.73  
9: d_y1_d_x4  -0.09621    0.31727   -0.30    0.76  
9: d_y2_d_x4  -0.11418    0.38467   -0.30    0.77  
9: d_y3_d_x4   0.09152    0.30328    0.30    0.76  
10: d_y1_d_x1  0.00802    0.03841    0.21    0.83  
10: d_y2_d_x1  0.13033    0.34680    0.38    0.71  
10: d_y3_d_x1 -0.08701    0.25031   -0.35    0.73  
10: d_y1_d_x2 -0.00668    0.03222   -0.21    0.84  
10: d_y2_d_x2  0.07820    0.23274    0.34    0.74  
10: d_y3_d_x2 -0.10151    0.27873   -0.36    0.72  
10: d_y1_d_x3  0.00936    0.03928    0.24    0.81  
10: d_y2_d_x3 -0.15640    0.29876   -0.52    0.60  
10: d_y3_d_x3  0.15952    0.28002    0.57    0.57  
10: d_y1_d_x4 -0.00535    0.02454   -0.22    0.83  
10: d_y2_d_x4 -0.20853    0.55887   -0.37    0.71  
10: d_y3_d_x4  0.17402    0.46353    0.38    0.71  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
> # now with seemingly only dummy variables
> margEffUncDA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ),
+    dummyVar = c( "x1", "x2", "x3", "x4" ) )
> print( summary( margEffUncDA ), digits = 3 )
              Estimate Std. error z value Pr(> z)  
1: d_y1_d_x1    0.1807     0.5064    0.36   0.721  
1: d_y2_d_x1    0.2197     0.4202    0.52   0.601  
1: d_y3_d_x1   -0.1224     0.2865   -0.43   0.669  
1: d_y1_d_x2   -0.1292     0.2834   -0.46   0.648  
1: d_y2_d_x2    0.2258     0.3481    0.65   0.516  
1: d_y3_d_x2   -0.2412     0.3291   -0.73   0.464  
1: d_y1_d_x3    0.5106     0.2940    1.74   0.082 .
1: d_y2_d_x3   -0.2176     0.3729   -0.58   0.560  
1: d_y3_d_x3    0.2986     0.3740    0.80   0.425  
1: d_y1_d_x4   -0.0387     0.1378   -0.28   0.779  
1: d_y2_d_x4   -0.5250     0.5235   -1.00   0.316  
1: d_y3_d_x4    0.3461     0.5762    0.60   0.548  
2: d_y1_d_x1    0.4301     0.3176    1.35   0.176  
2: d_y2_d_x1    0.1901     0.3279    0.58   0.562  
2: d_y3_d_x1   -0.1320     0.2544   -0.52   0.604  
2: d_y1_d_x2   -0.3736     0.3939   -0.95   0.343  
2: d_y2_d_x2    0.2153     0.3197    0.67   0.501  
2: d_y3_d_x2   -0.2490     0.3123   -0.80   0.425  
2: d_y1_d_x3    0.4101     0.3968    1.03   0.301  
2: d_y2_d_x3   -0.4482     0.3148   -1.42   0.154  
2: d_y3_d_x3    0.4177     0.3437    1.22   0.224  
2: d_y1_d_x4   -0.2108     0.3098   -0.68   0.496  
2: d_y2_d_x4   -0.5128     0.3578   -1.43   0.152  
2: d_y3_d_x4    0.4464     0.3123    1.43   0.153  
3: d_y1_d_x1    0.1152     0.4092    0.28   0.778  
3: d_y2_d_x1    0.3675     0.3513    1.05   0.295  
3: d_y3_d_x1   -0.2031     0.3503   -0.58   0.562  
3: d_y1_d_x2   -0.3148     0.4240   -0.74   0.458  
3: d_y2_d_x2    0.2090     0.3515    0.59   0.552  
3: d_y3_d_x2   -0.2422     0.3601   -0.67   0.501  
3: d_y1_d_x3    0.3421     0.5670    0.60   0.546  
3: d_y2_d_x3   -0.2815     0.5141   -0.55   0.584  
3: d_y3_d_x3    0.3073     0.4727    0.65   0.516  
3: d_y1_d_x4   -0.2231     0.4017   -0.56   0.579  
3: d_y2_d_x4   -0.2511     0.6757   -0.37   0.710  
3: d_y3_d_x4    0.2062     0.5784    0.36   0.721  
4: d_y1_d_x1    0.2076     0.5400    0.38   0.701  
4: d_y2_d_x1    0.3828     0.3578    1.07   0.285  
4: d_y3_d_x1   -0.2289     0.3576   -0.64   0.522  
4: d_y1_d_x2   -0.3743     0.3374   -1.11   0.267  
4: d_y2_d_x2    0.2326     0.3640    0.64   0.523  
4: d_y3_d_x2   -0.2686     0.3556   -0.76   0.450  
4: d_y1_d_x3    0.3382     0.5657    0.60   0.550  
4: d_y2_d_x3   -0.2885     0.5120   -0.56   0.573  
4: d_y3_d_x3    0.3119     0.4683    0.67   0.505  
4: d_y1_d_x4   -0.2859     0.3564   -0.80   0.423  
4: d_y2_d_x4   -0.3614     0.7062   -0.51   0.609  
4: d_y3_d_x4    0.2893     0.6078    0.48   0.634  
5: d_y1_d_x1    0.4480     0.3655    1.23   0.220  
5: d_y2_d_x1    0.3126     0.4799    0.65   0.515  
5: d_y3_d_x1   -0.2091     0.4173   -0.50   0.616  
5: d_y1_d_x2   -0.3827     0.3468   -1.10   0.270  
5: d_y2_d_x2    0.2337     0.3668    0.64   0.524  
5: d_y3_d_x2   -0.2707     0.3585   -0.76   0.450  
5: d_y1_d_x3    0.0866     0.2499    0.35   0.729  
5: d_y2_d_x3   -0.1630     0.3623   -0.45   0.653  
5: d_y3_d_x3    0.1643     0.3543    0.46   0.643  
5: d_y1_d_x4   -0.2423     0.4577   -0.53   0.597  
5: d_y2_d_x4   -0.5486     0.4326   -1.27   0.205  
5: d_y3_d_x4    0.4445     0.3838    1.16   0.247  
6: d_y1_d_x1    0.0270     0.1545    0.17   0.861  
6: d_y2_d_x1    0.1509     0.4607    0.33   0.743  
6: d_y3_d_x1   -0.0758     0.2702   -0.28   0.779  
6: d_y1_d_x2   -0.1529     0.4635   -0.33   0.742  
6: d_y2_d_x2    0.0658     0.2470    0.27   0.790  
6: d_y3_d_x2   -0.0958     0.3225   -0.30   0.767  
6: d_y1_d_x3    0.2945     0.5425    0.54   0.587  
6: d_y2_d_x3   -0.3630     0.4545   -0.80   0.425  
6: d_y3_d_x3    0.3595     0.4081    0.88   0.378  
6: d_y1_d_x4   -0.0714     0.2911   -0.25   0.806  
6: d_y2_d_x4   -0.0760     0.3695   -0.21   0.837  
6: d_y3_d_x4    0.0688     0.3359    0.20   0.838  
7: d_y1_d_x1    0.2563     0.4552    0.56   0.573  
7: d_y2_d_x1    0.1570     0.4404    0.36   0.721  
7: d_y3_d_x1   -0.1330     0.3807   -0.35   0.727  
7: d_y1_d_x2   -0.0387     0.1647   -0.23   0.814  
7: d_y2_d_x2    0.1184     0.3582    0.33   0.741  
7: d_y3_d_x2   -0.1472     0.4043   -0.36   0.716  
7: d_y1_d_x3    0.2636     0.5177    0.51   0.611  
7: d_y2_d_x3   -0.4066     0.3879   -1.05   0.295  
7: d_y3_d_x3    0.3865     0.3634    1.06   0.288  
7: d_y1_d_x4   -0.0700     0.2749   -0.25   0.799  
7: d_y2_d_x4   -0.4437     0.5667   -0.78   0.434  
7: d_y3_d_x4    0.3585     0.4718    0.76   0.447  
8: d_y1_d_x1    0.1318     0.2007    0.66   0.511  
8: d_y2_d_x1    0.3770     0.3851    0.98   0.328  
8: d_y3_d_x1   -0.2261     0.4043   -0.56   0.576  
8: d_y1_d_x2   -0.3308     0.4345   -0.76   0.446  
8: d_y2_d_x2    0.2195     0.4061    0.54   0.589  
8: d_y3_d_x2   -0.2659     0.4017   -0.66   0.508  
8: d_y1_d_x3    0.1855     0.2488    0.75   0.456  
8: d_y2_d_x3   -0.2637     0.2750   -0.96   0.338  
8: d_y3_d_x3    0.2716     0.2706    1.00   0.316  
8: d_y1_d_x4   -0.2599     0.4189   -0.62   0.535  
8: d_y2_d_x4   -0.2079     0.2743   -0.76   0.448  
8: d_y3_d_x4    0.2210     0.2617    0.84   0.398  
9: d_y1_d_x1    0.3029     0.6013    0.50   0.614  
9: d_y2_d_x1    0.0296     0.1191    0.25   0.804  
9: d_y3_d_x1   -0.0267     0.1033   -0.26   0.796  
9: d_y1_d_x2   -0.2309     0.3650   -0.63   0.527  
9: d_y2_d_x2    0.0729     0.1845    0.40   0.693  
9: d_y3_d_x2   -0.0971     0.2251   -0.43   0.666  
9: d_y1_d_x3    0.4079     0.3989    1.02   0.307  
9: d_y2_d_x3   -0.4491     0.3164   -1.42   0.156  
9: d_y3_d_x3    0.4176     0.3463    1.21   0.228  
9: d_y1_d_x4   -0.0317     0.1207   -0.26   0.793  
9: d_y2_d_x4   -0.5066     0.5716   -0.89   0.375  
9: d_y3_d_x4    0.3273     0.5926    0.55   0.581  
10: d_y1_d_x1   0.0021     0.0109    0.19   0.847  
10: d_y2_d_x1   0.2427     0.5089    0.48   0.633  
10: d_y3_d_x1  -0.1279     0.3656   -0.35   0.726  
10: d_y1_d_x2  -0.0293     0.1272   -0.23   0.818  
10: d_y2_d_x2   0.1178     0.3495    0.34   0.736  
10: d_y3_d_x2  -0.1575     0.4073   -0.39   0.699  
10: d_y1_d_x3   0.1286     0.2141    0.60   0.548  
10: d_y2_d_x3  -0.3867     0.2925   -1.32   0.186  
10: d_y3_d_x3   0.3563     0.2913    1.22   0.221  
10: d_y1_d_x4  -0.0343     0.1414   -0.24   0.808  
10: d_y2_d_x4  -0.0176     0.0692   -0.25   0.800  
10: d_y3_d_x4   0.0291     0.1039    0.28   0.780  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
> # now with mean values of the marginal effects
> margEffUncM <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ), 
+    addMean = TRUE )
> all.equal( margEffUnc, margEffUncM[ 1:nObs, ], check.attributes = FALSE )
[1] TRUE
> round( margEffUncM[ nObs:(nObs+1), ], 4 )
     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10      0.0021    0.2427   -0.1279   -0.0293    0.1178   -0.1575    0.0094
mean    0.2102    0.2430   -0.1485   -0.2357    0.1711   -0.2035    0.2537
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10     -0.1564    0.1595   -0.0053   -0.2085    0.1740
mean   -0.3033    0.2751   -0.1450   -0.4044    0.3001
> all.equal( attr( margEffUnc, "vcov" ), 
+    attr( margEffUncM, "vcov" )[ 1:nObs, , ] )
[1] TRUE
> round( attr( margEffUncM, "vcov" )[ nObs:(nObs+1), , ], 5 )
, , d_y1_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10     0.00012         0         0  -0.00115         0         0   0.00042
mean   0.06165         0         0  -0.01468         0         0   0.01318
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0         0  -0.00026         0         0
mean         0         0  -0.01352         0         0

, , d_y2_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0   0.25893         0         0   0.08265         0         0
mean         0   0.06970         0         0  -0.00944         0         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10    -0.10506         0         0  -0.19958         0
mean   0.00875         0         0  -0.02750         0

, , d_y3_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0         0   0.13369         0         0   0.06145         0
mean         0         0   0.06563         0         0  -0.00741         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0   -0.0606         0         0  -0.10145
mean         0    0.0074         0         0  -0.01736

, , d_y1_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10    -0.00115         0         0   0.01617         0         0  -0.00412
mean  -0.01468         0         0   0.06142         0         0   0.02207
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0         0   0.00250         0         0
mean         0         0  -0.00758         0         0

, , d_y2_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0   0.08265         0         0   0.12214         0         0
mean         0  -0.00944         0         0   0.08158         0         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10    -0.06458         0         0  -0.12269         0
mean   0.03245         0         0   0.01069         0

, , d_y3_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0         0   0.06145         0         0   0.16593         0
mean         0         0  -0.00741         0         0   0.08538         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0  -0.07053         0         0  -0.11808
mean         0   0.03369         0         0   0.00195

, , d_y1_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10     0.00042         0         0  -0.00412         0         0   0.00154
mean   0.01318         0         0   0.02207         0         0   0.01990
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0         0  -0.00092         0         0
mean         0         0  -0.00145         0         0

, , d_y2_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0  -0.10506         0         0  -0.06458         0         0
mean         0   0.00875         0         0   0.03245         0         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10     0.08926         0         0   0.15894         0
mean   0.02101         0         0   0.00970         0

, , d_y3_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0         0   -0.0606         0         0  -0.07053         0
mean         0         0    0.0074         0         0   0.03369         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0   0.07841         0         0   0.12013
mean         0   0.02265         0         0   0.01163

, , d_y1_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10    -0.00026         0         0   0.00250         0         0  -0.00092
mean  -0.01352         0         0  -0.00758         0         0  -0.00145
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0         0   0.00060         0         0
mean         0         0   0.03871         0         0

, , d_y2_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0  -0.19958         0         0  -0.12269         0         0
mean         0  -0.02750         0         0   0.01069         0         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10     0.15894         0         0   0.31234         0
mean   0.00970         0         0   0.16594         0

, , d_y3_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0         0  -0.10145         0         0  -0.11808         0
mean         0         0  -0.01736         0         0   0.00195         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0   0.12013         0         0   0.21486
mean         0   0.01163         0         0   0.13538

> round( drop( attr( margEffUncM, "vcov" )[ nObs+1, , ] ), 5 )
          d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
d_y1_d_x1   0.06165   0.00000   0.00000  -0.01468   0.00000   0.00000   0.01318
d_y2_d_x1   0.00000   0.06970   0.00000   0.00000  -0.00944   0.00000   0.00000
d_y3_d_x1   0.00000   0.00000   0.06563   0.00000   0.00000  -0.00741   0.00000
d_y1_d_x2  -0.01468   0.00000   0.00000   0.06142   0.00000   0.00000   0.02207
d_y2_d_x2   0.00000  -0.00944   0.00000   0.00000   0.08158   0.00000   0.00000
d_y3_d_x2   0.00000   0.00000  -0.00741   0.00000   0.00000   0.08538   0.00000
d_y1_d_x3   0.01318   0.00000   0.00000   0.02207   0.00000   0.00000   0.01990
d_y2_d_x3   0.00000   0.00875   0.00000   0.00000   0.03245   0.00000   0.00000
d_y3_d_x3   0.00000   0.00000   0.00740   0.00000   0.00000   0.03369   0.00000
d_y1_d_x4  -0.01352   0.00000   0.00000  -0.00758   0.00000   0.00000  -0.00145
d_y2_d_x4   0.00000  -0.02750   0.00000   0.00000   0.01069   0.00000   0.00000
d_y3_d_x4   0.00000   0.00000  -0.01736   0.00000   0.00000   0.00195   0.00000
          d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
d_y1_d_x1   0.00000   0.00000  -0.01352   0.00000   0.00000
d_y2_d_x1   0.00875   0.00000   0.00000  -0.02750   0.00000
d_y3_d_x1   0.00000   0.00740   0.00000   0.00000  -0.01736
d_y1_d_x2   0.00000   0.00000  -0.00758   0.00000   0.00000
d_y2_d_x2   0.03245   0.00000   0.00000   0.01069   0.00000
d_y3_d_x2   0.00000   0.03369   0.00000   0.00000   0.00195
d_y1_d_x3   0.00000   0.00000  -0.00145   0.00000   0.00000
d_y2_d_x3   0.02101   0.00000   0.00000   0.00970   0.00000
d_y3_d_x3   0.00000   0.02265   0.00000   0.00000   0.01163
d_y1_d_x4   0.00000   0.00000   0.03871   0.00000   0.00000
d_y2_d_x4   0.00970   0.00000   0.00000   0.16594   0.00000
d_y3_d_x4   0.00000   0.01163   0.00000   0.00000   0.13538
> all.equal( summary( margEffUnc )[ , ], 
+    summary( margEffUncM )[ 1:( 12 * nObs ), ], check.attributes = FALSE )
[1] TRUE
> printCoefmat( summary( margEffUncM )[ -( 1:( 12 * (nObs-1) ) ), ], digits = 3 )
                Estimate Std. error z value Pr(> z)  
10: d_y1_d_x1    0.00210    0.01085    0.19   0.847  
10: d_y2_d_x1    0.24266    0.50885    0.48   0.633  
10: d_y3_d_x1   -0.12794    0.36564   -0.35   0.726  
10: d_y1_d_x2   -0.02934    0.12716   -0.23   0.818  
10: d_y2_d_x2    0.11782    0.34949    0.34   0.736  
10: d_y3_d_x2   -0.15753    0.40735   -0.39   0.699  
10: d_y1_d_x3    0.00936    0.03928    0.24   0.812  
10: d_y2_d_x3   -0.15640    0.29876   -0.52   0.601  
10: d_y3_d_x3    0.15952    0.28002    0.57   0.569  
10: d_y1_d_x4   -0.00535    0.02454   -0.22   0.827  
10: d_y2_d_x4   -0.20853    0.55887   -0.37   0.709  
10: d_y3_d_x4    0.17402    0.46353    0.38   0.707  
mean: d_y1_d_x1  0.21018    0.24829    0.85   0.397  
mean: d_y2_d_x1  0.24298    0.26401    0.92   0.357  
mean: d_y3_d_x1 -0.14850    0.25618   -0.58   0.562  
mean: d_y1_d_x2 -0.23573    0.24784   -0.95   0.342  
mean: d_y2_d_x2  0.17107    0.28563    0.60   0.549  
mean: d_y3_d_x2 -0.20352    0.29221   -0.70   0.486  
mean: d_y1_d_x3  0.25367    0.14107    1.80   0.072 .
mean: d_y2_d_x3 -0.30326    0.14494   -2.09   0.036 *
mean: d_y3_d_x3  0.27510    0.15051    1.83   0.068 .
mean: d_y1_d_x4 -0.14496    0.19675   -0.74   0.461  
mean: d_y2_d_x4 -0.40435    0.40735   -0.99   0.321  
mean: d_y3_d_x4  0.30010    0.36794    0.82   0.415  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -0.5074569 -0.4007881  0.9870865 -1.2228328
> 
> # calculating marginal effects, conditional
> # (assuming that all other dependent variables are one)
> margEffCond <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz() )
> round( margEffCond, 4 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     0.4118    0.1176   -0.3604   -0.2293    0.2459   -0.1258    0.1765
2     0.3072    0.1650   -0.2208   -0.2512    0.2360   -0.1732    0.4706
3     0.2668    0.2275   -0.3835   -0.3583    0.2302   -0.1483    0.4405
4     0.3740    0.2758   -0.3556   -0.3469    0.2638   -0.1563    0.5201
5     0.4392    0.2708   -0.2616   -0.3205    0.2632   -0.1630    0.3299
6     0.1333    0.0506   -0.3842   -0.2715    0.0596   -0.1101    0.2535
7     0.1186    0.1453   -0.1603   -0.0088    0.1129   -0.1545    0.0360
8     0.0480    0.3503   -0.2340   -0.2032    0.2396   -0.1769    0.1473
9     0.5486    0.0185   -0.1162   -0.3232    0.0740   -0.1035    0.3613
10    0.0002    0.2320   -0.1301   -0.0057    0.1110   -0.1662    0.0011
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    -0.3518    0.2230   -0.1468   -0.3287    0.6037
2    -0.3907    0.2418   -0.4008   -0.4048    0.4969
3    -0.3369    0.2351   -0.3803   -0.3246    0.5722
4    -0.4515    0.2437   -0.4144   -0.4488    0.5674
5    -0.5053    0.2791   -0.2239   -0.5676    0.4883
6    -0.0525    0.1581   -0.2782   -0.0481    0.3860
7    -0.3098    0.2977   -0.0217   -0.3993    0.3575
8    -0.3862    0.2839   -0.0911   -0.4669    0.4073
9    -0.0709    0.1415   -0.3929   -0.0665    0.3343
10   -0.1492    0.1853   -0.0006   -0.1992    0.1994
> margEffCondA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz() )
> all.equal( margEffCond, margEffCondA )
[1] TRUE
> # now with dummy variables specified explicitly
> margEffCondD <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    dummyVars = c( "x1", "x2" ), algorithm = GenzBretz() )
> all.equal( margEffCondD, margEffCond )
[1] TRUE
> # now with seemingly no dummy variables
> margEffCondD0 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    dummyVars = NULL, algorithm = GenzBretz() )
> round( margEffCondD0, 4 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     0.1885    0.1710   -0.4232   -0.1258    0.1881   -0.1289    0.1765
2     0.5100    0.2254   -0.3262   -0.3353    0.2040   -0.1465    0.4706
3     0.4822    0.1727   -0.3923   -0.3148    0.1787   -0.1384    0.4405
4     0.5393    0.2434   -0.3842   -0.3688    0.2383   -0.1457    0.5201
5     0.3085    0.3295   -0.3036   -0.2311    0.2607   -0.1746    0.3299
6     0.3290    0.0248   -0.2661   -0.1861    0.0280   -0.0911    0.2535
7     0.0314    0.2470   -0.1872   -0.0250    0.1549   -0.1922    0.0360
8     0.1301    0.2808   -0.2338   -0.1026    0.1961   -0.1812    0.1473
9     0.4657    0.0348   -0.2286   -0.2648    0.0376   -0.0821    0.3613
10    0.0009    0.1249   -0.0972   -0.0008    0.0741   -0.1205    0.0011
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    -0.3518    0.2230   -0.1468   -0.3287    0.6037
2    -0.3907    0.2418   -0.4008   -0.4048    0.4969
3    -0.3369    0.2351   -0.3803   -0.3246    0.5722
4    -0.4515    0.2437   -0.4144   -0.4488    0.5674
5    -0.5053    0.2791   -0.2239   -0.5676    0.4883
6    -0.0525    0.1581   -0.2782   -0.0481    0.3860
7    -0.3098    0.2977   -0.0217   -0.3993    0.3575
8    -0.3862    0.2839   -0.0911   -0.4669    0.4073
9    -0.0709    0.1415   -0.3929   -0.0665    0.3343
10   -0.1492    0.1853   -0.0006   -0.1992    0.1994
> # now with seemingly only dummy variables
> margEffCondDA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    dummyVars = c( "x1", "x2", "x3", "x4" ), algorithm = GenzBretz() )
> round( margEffCondDA, 4 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     0.4118    0.1176   -0.3604   -0.2293    0.2459   -0.1258    0.4323
2     0.3072    0.1650   -0.2208   -0.2512    0.2360   -0.1732    0.2240
3     0.2668    0.2275   -0.3835   -0.3583    0.2302   -0.1483    0.1875
4     0.3740    0.2758   -0.3556   -0.3469    0.2638   -0.1563    0.1835
5     0.4392    0.2708   -0.2616   -0.3205    0.2632   -0.1630    0.0273
6     0.1333    0.0506   -0.3842   -0.2715    0.0596   -0.1101    0.1416
7     0.1186    0.1453   -0.1603   -0.0088    0.1129   -0.1545    0.1148
8     0.0480    0.3503   -0.2340   -0.2032    0.2396   -0.1769    0.0745
9     0.5486    0.0185   -0.1162   -0.3232    0.0740   -0.1035    0.2209
10    0.0002    0.2320   -0.1301   -0.0057    0.1110   -0.1662    0.0408
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    -0.2693    0.1632   -0.1420   -0.3584    0.5437
2    -0.4616    0.3080   -0.3280   -0.4901    0.4347
3    -0.2979    0.2322   -0.4468   -0.1831    0.4040
4    -0.3042    0.2366   -0.4119   -0.2936    0.4426
5    -0.1606    0.1717   -0.1655   -0.5078    0.4720
6    -0.3691    0.2835   -0.3540   -0.0371    0.2900
7    -0.4063    0.3124   -0.0214   -0.4157    0.3597
8    -0.2637    0.2414   -0.1462   -0.2046    0.2328
9    -0.4620    0.3090   -0.1265   -0.3303    0.5490
10   -0.3739    0.3199   -0.0039   -0.0172    0.0469
> # now with integrals obtained by the Miwa algorithm, reduced precision
> margEffCond1 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = Miwa( steps = 32 ) )
> round( margEffCond1, 4 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     0.4118    0.1174   -0.3604   -0.2294    0.2460   -0.1258    0.1765
2     0.3073    0.1650   -0.2208   -0.2512    0.2360   -0.1732    0.4705
3     0.2669    0.2275   -0.3835   -0.3582    0.2305   -0.1482    0.4406
4     0.3740    0.2759   -0.3556   -0.3468    0.2640   -0.1561    0.5202
5     0.4392    0.2708   -0.2616   -0.3204    0.2633   -0.1629    0.3299
6     0.1334    0.0507   -0.3842   -0.2715    0.0598   -0.1100    0.2535
7     0.1186    0.1453   -0.1603   -0.0088    0.1129   -0.1545    0.0360
8     0.0480    0.3503   -0.2340   -0.2033    0.2396   -0.1770    0.1473
9     0.5485    0.0184   -0.1162   -0.3232    0.0741   -0.1035    0.3613
10    0.0002    0.2320   -0.1301   -0.0057    0.1110   -0.1662    0.0011
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    -0.3517    0.2231   -0.1469   -0.3287    0.6039
2    -0.3907    0.2417   -0.4009   -0.4049    0.4968
3    -0.3369    0.2351   -0.3804   -0.3247    0.5723
4    -0.4515    0.2438   -0.4145   -0.4488    0.5675
5    -0.5053    0.2792   -0.2239   -0.5675    0.4883
6    -0.0524    0.1582   -0.2783   -0.0482    0.3861
7    -0.3098    0.2977   -0.0218   -0.3993    0.3575
8    -0.3862    0.2840   -0.0911   -0.4669    0.4073
9    -0.0710    0.1415   -0.3929   -0.0664    0.3343
10   -0.1492    0.1853   -0.0007   -0.1992    0.1994
> all.equal( margEffCond, margEffCond1 )
 [1] "Component 1: Mean relative difference: 9.319688e-05" 
 [2] "Component 2: Mean relative difference: 0.0002259434" 
 [3] "Component 3: Mean relative difference: 8.422528e-05" 
 [4] "Component 4: Mean relative difference: 0.0002359585" 
 [5] "Component 5: Mean relative difference: 0.0004315704" 
 [6] "Component 6: Mean relative difference: 0.0003287333" 
 [7] "Component 7: Mean relative difference: 0.0002101608" 
 [8] "Component 8: Mean relative difference: 0.0001300595" 
 [9] "Component 9: Mean relative difference: 0.0002044696" 
[10] "Component 10: Mean relative difference: 0.0001675271"
[11] "Component 11: Mean relative difference: 0.0001336317"
[12] "Component 12: Mean relative difference: 0.0001409381"
> # now with integrals obtained by the GHK algorithm
> margEffCond2 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE )
> round( margEffCond2, 4 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     0.4120    0.1250   -0.3602   -0.2293    0.2466   -0.1265    0.1763
2     0.3106    0.1786   -0.2207   -0.2527    0.2376   -0.1746    0.4709
3     0.2665    0.2303   -0.3837   -0.3585    0.2315   -0.1490    0.4403
4     0.3737    0.2781   -0.3561   -0.3477    0.2648   -0.1577    0.5204
5     0.4399    0.2724   -0.2625   -0.3217    0.2642   -0.1646    0.3330
6     0.1334    0.0576   -0.3839   -0.2712    0.0624   -0.1099    0.2532
7     0.1212    0.1462   -0.1617   -0.0100    0.1135   -0.1593    0.0391
8     0.0498    0.3548   -0.2354   -0.2055    0.2403   -0.1801    0.1510
9     0.5582    0.0459   -0.1164   -0.3228    0.0773   -0.1034    0.3607
10    0.0006    0.2339   -0.1340   -0.0067    0.1117   -0.1708    0.0008
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    -0.3534    0.2234   -0.1466   -0.3332    0.6039
2    -0.3947    0.2425   -0.4012   -0.4153    0.4972
3    -0.3396    0.2355   -0.3801   -0.3322    0.5723
4    -0.4537    0.2449   -0.4140   -0.4551    0.5682
5    -0.5070    0.2836   -0.2242   -0.5721    0.4911
6    -0.0582    0.1580   -0.2793   -0.0653    0.3859
7    -0.3114    0.3059   -0.0230   -0.4025    0.3630
8    -0.3876    0.2910   -0.0922   -0.4701    0.4116
9    -0.0781    0.1413   -0.3951   -0.0867    0.3341
10   -0.1502    0.1921   -0.0021   -0.2006    0.2067
> all.equal( margEffCond, margEffCond2 )
 [1] "Component 1: Mean relative difference: 0.007274846" 
 [2] "Component 2: Mean relative difference: 0.03747971"  
 [3] "Component 3: Mean relative difference: 0.003518855" 
 [4] "Component 4: Mean relative difference: 0.003813365" 
 [5] "Component 5: Mean relative difference: 0.007335713" 
 [6] "Component 6: Mean relative difference: 0.01250843"  
 [7] "Component 7: Mean relative difference: 0.00447887"  
 [8] "Component 8: Mean relative difference: 0.009787098" 
 [9] "Component 9: Mean relative difference: 0.01291233"  
[10] "Component 10: Mean relative difference: 0.00370665" 
[11] "Component 11: Mean relative difference: 0.02416914" 
[12] "Component 12: Mean relative difference: 0.004914306"
> all.equal( margEffCond1, margEffCond2 )
 [1] "Component 1: Mean relative difference: 0.007302638" 
 [2] "Component 2: Mean relative difference: 0.03747545"  
 [3] "Component 3: Mean relative difference: 0.003532005" 
 [4] "Component 4: Mean relative difference: 0.00395168"  
 [5] "Component 5: Mean relative difference: 0.006977384" 
 [6] "Component 6: Mean relative difference: 0.01267949"  
 [7] "Component 7: Mean relative difference: 0.004478344" 
 [8] "Component 8: Mean relative difference: 0.0097754"   
 [9] "Component 9: Mean relative difference: 0.01282563"  
[10] "Component 10: Mean relative difference: 0.003641363"
[11] "Component 11: Mean relative difference: 0.02411041" 
[12] "Component 12: Mean relative difference: 0.004893427"
> # now with integrals obtained by the GHK algorithm, reduced precision
> margEffCond3 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    nGHK = 100 )
> round( margEffCond3, 4 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     0.3571    0.0783   -0.3574   -0.2179    0.2420   -0.1219    0.1682
2     0.1784    0.1043   -0.2112   -0.2323    0.2251   -0.1628    0.4307
3     0.2465    0.2057   -0.3914   -0.3338    0.2247   -0.1410    0.4121
4     0.3447    0.2555   -0.3654   -0.3214    0.2571   -0.1487    0.4850
5     0.3953    0.2535   -0.2731   -0.2961    0.2556   -0.1551    0.3002
6     0.1193    0.0164   -0.3811   -0.2474    0.0516   -0.1023    0.2305
7     0.1084    0.1340   -0.1617   -0.0057    0.1046   -0.1550    0.0268
8     0.0275    0.3272   -0.2327   -0.1837    0.2293   -0.1695    0.1235
9     0.3747   -0.0674   -0.1068   -0.2907    0.0654   -0.0946    0.3246
10    0.0210    0.2190   -0.1224   -0.0053    0.1023   -0.1670   -0.0241
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    -0.3430    0.2182   -0.1352   -0.2964    0.6083
2    -0.3733    0.2245   -0.2958   -0.3456    0.4849
3    -0.3255    0.2247   -0.3297   -0.2798    0.5686
4    -0.4397    0.2322   -0.3529   -0.4066    0.5675
5    -0.4874    0.2678   -0.1696   -0.5310    0.4938
6    -0.0347    0.1472   -0.2345    0.0183    0.3693
7    -0.2893    0.2928   -0.0210   -0.3716    0.3546
8    -0.3659    0.2742   -0.0672   -0.4359    0.4096
9    -0.0520    0.1296   -0.3172    0.0087    0.3164
10   -0.1377    0.1783   -0.0420   -0.1842    0.1853
> all.equal( margEffCond, margEffCond3 )
 [1] "Component 1: Mean relative difference: 0.1950758"  
 [2] "Component 2: Mean relative difference: 0.1761965"  
 [3] "Component 3: Mean relative difference: 0.02485851" 
 [4] "Component 4: Mean relative difference: 0.0796093"  
 [5] "Component 5: Mean relative difference: 0.04275513" 
 [6] "Component 6: Mean relative difference: 0.04227655" 
 [7] "Component 7: Mean relative difference: 0.09482927" 
 [8] "Component 8: Mean relative difference: 0.05197425" 
 [9] "Component 9: Mean relative difference: 0.04356983" 
[10] "Component 10: Mean relative difference: 0.19926"   
[11] "Component 11: Mean relative difference: 0.1322209" 
[12] "Component 12: Mean relative difference: 0.01804595"
> all.equal( margEffCond2, margEffCond3 )
 [1] "Component 1: Mean relative difference: 0.2002449"  
 [2] "Component 2: Mean relative difference: 0.205957"   
 [3] "Component 3: Mean relative difference: 0.02547425" 
 [4] "Component 4: Mean relative difference: 0.0824537"  
 [5] "Component 5: Mean relative difference: 0.04972607" 
 [6] "Component 6: Mean relative difference: 0.05214635" 
 [7] "Component 7: Mean relative difference: 0.0977991"  
 [8] "Component 8: Mean relative difference: 0.06116274" 
 [9] "Component 9: Mean relative difference: 0.05545767" 
[10] "Component 10: Mean relative difference: 0.2004108" 
[11] "Component 11: Mean relative difference: 0.1526995" 
[12] "Component 12: Mean relative difference: 0.02031045"
> # now with variance covariance matrix and Jacobian
> margEffCondV <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    vcov = diag( 18 ), returnJacobian = TRUE, algorithm = GenzBretz() )
> round( attr( margEffCondV, "vcov" ), 5 )
, , d_y1_d_x1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.97510  -0.00300  -0.44900  -0.22743   0.00683   0.15893   0.39343
5    0.29126   0.03872  -0.05824   0.02749  -0.07556   0.00747   0.05541
10   0.00001   0.00015   0.00005  -0.00014   0.00010   0.00020   0.00004
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.05458  -0.24326  -0.49449  -0.01982   0.26961
5    0.09227  -0.02132  -0.25953  -0.03995   0.08157
10  -0.00012  -0.00022  -0.00002  -0.00019  -0.00024

, , d_y2_d_x1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.00300   0.32131   0.08093   0.08914  -0.00505  -0.05181  -0.04443
5    0.03872   0.25646   0.05196  -0.03225  -0.04960  -0.03718   0.11173
10   0.00015   0.26345   0.01979  -0.00320   0.08899   0.02586   0.00112
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.36634   0.03800  -0.01870  -0.65414  -0.05528
5   -0.09091   0.03549  -0.14484  -0.08485   0.05410
10  -0.10893  -0.03756  -0.00049  -0.20179  -0.04416

, , d_y3_d_x1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.44900   0.08093   0.76522   0.06637  -0.00845  -0.38941  -0.05895
5   -0.05824   0.05196   0.25875  -0.10424   0.00791  -0.01687   0.20771
10   0.00005   0.01979   0.13904  -0.00149   0.00524   0.05040   0.00012
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.07703   0.47425   0.18966  -0.14708  -0.37530
5   -0.04967  -0.08375  -0.07117  -0.02863  -0.06050
10  -0.00551  -0.04794  -0.00029  -0.00957  -0.09159

, , d_y1_d_x2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.22743   0.08914   0.06637   0.24335  -0.05178  -0.11092  -0.16349
5    0.02749  -0.03225  -0.10424   0.38062  -0.06622  -0.07276  -0.36555
10  -0.00014  -0.00320  -0.00149   0.00297  -0.00334  -0.00640  -0.00070
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.06590   0.03490   0.14476  -0.17823  -0.03090
5    0.06481   0.00514   0.16355   0.00574   0.02351
10   0.00248   0.00495   0.00041   0.00403   0.00582

, , d_y2_d_x2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.00683  -0.00505  -0.00845  -0.05178   0.12068   0.04232   0.00677
5   -0.07556  -0.04960   0.00791  -0.06622   0.18071   0.04028  -0.00567
10   0.00010   0.08899   0.00524  -0.00334   0.12388   0.03179   0.00075
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.02483  -0.00713  -0.00168  -0.00486  -0.00707
5   -0.05096  -0.00251   0.08812   0.00368  -0.00317
10  -0.06786  -0.02980  -0.00032  -0.12439  -0.03404

, , d_y3_d_x2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.15893  -0.05181  -0.38941  -0.11092   0.04232   0.38993   0.01228
5    0.00747  -0.03718  -0.01687  -0.07276   0.04028   0.29151  -0.06897
10   0.00020   0.02586   0.05040  -0.00640   0.03179   0.19460   0.00091
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.03625  -0.25930  -0.06839   0.10610   0.14925
5    0.01311  -0.14268  -0.01752   0.06322   0.01111
10  -0.01954  -0.09175  -0.00078  -0.02874  -0.14046

, , d_y1_d_x3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.39343  -0.04443  -0.05895  -0.16349   0.00677   0.01228   0.30415
5    0.05541   0.11173   0.20771  -0.36555  -0.00567  -0.06897   0.88848
10   0.00004   0.00112   0.00012  -0.00070   0.00075   0.00091   0.00020
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.01467  -0.08688  -0.26737   0.08830   0.05003
5   -0.13094  -0.08481  -0.48822  -0.04093  -0.01410
10  -0.00083  -0.00117  -0.00012  -0.00141  -0.00098

, , d_y2_d_x3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.05458  -0.36634  -0.07703  -0.06590   0.02483   0.03625  -0.01467
5    0.09227  -0.09091  -0.04967   0.06481  -0.05096   0.01311  -0.13094
10  -0.00012  -0.10893  -0.00551   0.00248  -0.06786  -0.01954  -0.00083
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.53413   0.02805   0.04993   0.78777   0.08222
5    0.36792   0.02668  -0.04339   0.04117  -0.03046
10   0.08991   0.02952   0.00042   0.15676   0.03386

, , d_y3_d_x3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.24326   0.03800   0.47425   0.03490  -0.00713  -0.25930  -0.08688
5   -0.02132   0.03549  -0.08375   0.00514  -0.00251  -0.14268  -0.08481
10  -0.00022  -0.03756  -0.04794   0.00495  -0.02980  -0.09175  -0.00117
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.02805   0.54206   0.11748  -0.07872  -0.18479
5    0.02668   0.44284   0.09235  -0.09299   0.03846
10   0.02952   0.13440   0.00077   0.03941   0.16919

, , d_y1_d_x4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.49449  -0.01870   0.18966   0.14476  -0.00168  -0.06839  -0.26737
5   -0.25953  -0.14484  -0.07117   0.16355   0.08812  -0.01752  -0.48822
10  -0.00002  -0.00049  -0.00029   0.00041  -0.00032  -0.00078  -0.00012
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.04993   0.11748   0.34860   0.02448  -0.18620
5   -0.04339   0.09235   0.65425   0.04360  -0.14296
10   0.00042   0.00077   0.00007   0.00062   0.00104

, , d_y2_d_x4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.01982  -0.65414  -0.14708  -0.17823  -0.00486   0.10610   0.08830
5   -0.03995  -0.08485  -0.02863   0.00574   0.00368   0.06322  -0.04093
10  -0.00019  -0.20179  -0.00957   0.00403  -0.12439  -0.02874  -0.00141
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.78777  -0.07872   0.02448   1.45513   0.13386
5    0.04117  -0.09299   0.04360   0.24968  -0.04521
10   0.15676   0.03941   0.00062   0.30340   0.05139

, , d_y3_d_x4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.26961  -0.05528  -0.37530  -0.03090  -0.00707   0.14925   0.05003
5    0.08157   0.05410  -0.06050   0.02351  -0.00317   0.01111  -0.01410
10  -0.00024  -0.04416  -0.09159   0.00582  -0.03404  -0.14046  -0.00098
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.08222  -0.18479  -0.18620   0.13386   0.44162
5   -0.03046   0.03846  -0.14296  -0.04521   0.22948
10   0.03386   0.16919   0.00104   0.05139   0.28611

> round( drop( attr( margEffCondV, "vcov" )[ 1, , ] ), 5 )
          d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
d_y1_d_x1   0.97510  -0.00300  -0.44900  -0.22743   0.00683   0.15893   0.39343
d_y2_d_x1  -0.00300   0.32131   0.08093   0.08914  -0.00505  -0.05181  -0.04443
d_y3_d_x1  -0.44900   0.08093   0.76522   0.06637  -0.00845  -0.38941  -0.05895
d_y1_d_x2  -0.22743   0.08914   0.06637   0.24335  -0.05178  -0.11092  -0.16349
d_y2_d_x2   0.00683  -0.00505  -0.00845  -0.05178   0.12068   0.04232   0.00677
d_y3_d_x2   0.15893  -0.05181  -0.38941  -0.11092   0.04232   0.38993   0.01228
d_y1_d_x3   0.39343  -0.04443  -0.05895  -0.16349   0.00677   0.01228   0.30415
d_y2_d_x3  -0.05458  -0.36634  -0.07703  -0.06590   0.02483   0.03625  -0.01467
d_y3_d_x3  -0.24326   0.03800   0.47425   0.03490  -0.00713  -0.25930  -0.08688
d_y1_d_x4  -0.49449  -0.01870   0.18966   0.14476  -0.00168  -0.06839  -0.26737
d_y2_d_x4  -0.01982  -0.65414  -0.14708  -0.17823  -0.00486   0.10610   0.08830
d_y3_d_x4   0.26961  -0.05528  -0.37530  -0.03090  -0.00707   0.14925   0.05003
          d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
d_y1_d_x1  -0.05458  -0.24326  -0.49449  -0.01982   0.26961
d_y2_d_x1  -0.36634   0.03800  -0.01870  -0.65414  -0.05528
d_y3_d_x1  -0.07703   0.47425   0.18966  -0.14708  -0.37530
d_y1_d_x2  -0.06590   0.03490   0.14476  -0.17823  -0.03090
d_y2_d_x2   0.02483  -0.00713  -0.00168  -0.00486  -0.00707
d_y3_d_x2   0.03625  -0.25930  -0.06839   0.10610   0.14925
d_y1_d_x3  -0.01467  -0.08688  -0.26737   0.08830   0.05003
d_y2_d_x3   0.53413   0.02805   0.04993   0.78777   0.08222
d_y3_d_x3   0.02805   0.54206   0.11748  -0.07872  -0.18479
d_y1_d_x4   0.04993   0.11748   0.34860   0.02448  -0.18620
d_y2_d_x4   0.78777  -0.07872   0.02448   1.45513   0.13386
d_y3_d_x4   0.08222  -0.18479  -0.18620   0.13386   0.44162
> round( attr( margEffCondV, "jacobian" ), 5 )
, , b_1_0

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.28441   0.03659   0.07801  -0.22745   0.01938  -0.02312   0.27867
5   -0.15622  -0.00036  -0.01266   0.17568  -0.01723  -0.04385  -0.36560
10  -0.00082   0.00023   0.00079   0.01742  -0.00467  -0.01341  -0.00437
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.06761   0.01398  -0.23331  -0.06972  -0.00449
5    0.05018   0.08786   0.24185  -0.01494  -0.01519
10   0.00138   0.00404   0.00169  -0.00009  -0.00124

, , b_1_1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.43227  -0.01905  -0.08016   0.00000   0.00000   0.00000   0.00000
5    0.25598  -0.04309  -0.08364   0.17568  -0.01723  -0.04385  -0.36591
10   0.00000  -0.00001  -0.00002   0.00000   0.00000   0.00000   0.00000
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.00000   0.00000   0.00000   0.00000   0.00000
5    0.05033   0.08802   0.24203  -0.01503  -0.01528
10   0.00000   0.00000   0.00000   0.00000   0.00000

, , b_1_2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.28441   0.03659   0.07801   0.14786  -0.05564  -0.15816   0.27867
5    0.00000   0.00000   0.00000   0.43166  -0.06032  -0.12749   0.00000
10   0.00000   0.00000   0.00000   0.01824  -0.00491  -0.01423   0.00000
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.06761   0.01398  -0.23331  -0.06972  -0.00449
5    0.00000   0.00000   0.00000   0.00000   0.00000
10   0.00000   0.00000   0.00000   0.00000   0.00000

, , b_1_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.30370  -0.03908  -0.08330   0.24288  -0.02070   0.02468  -0.14977
5    0.09765   0.00023   0.00791  -0.10981   0.01077   0.02741   0.48463
10  -0.00102   0.00029   0.00099   0.02184  -0.00585  -0.01682  -0.00471
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.01618  -0.17283   0.24921   0.07412   0.00457
5   -0.07452  -0.13896  -0.15192   0.00928   0.00893
10   0.00147   0.00441   0.00311  -0.00007  -0.00115

, , b_1_4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.12129   0.01561   0.03327  -0.09700   0.00827  -0.00986   0.11891
5   -0.12835  -0.00030  -0.01040   0.14434  -0.01415  -0.03603  -0.29998
10   0.00031  -0.00009  -0.00030  -0.00663   0.00178   0.00510   0.00117
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.02817   0.00602   0.04830  -0.08553  -0.15967
5    0.04143   0.07341   0.45582  -0.05537  -0.09554
10  -0.00054  -0.00259  -0.00020  -0.00024  -0.00121

, , b_2_0

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.00904  -0.15338  -0.01959   0.03882  -0.14266  -0.01173  -0.04266
5    0.03295   0.14118   0.00901  -0.01489  -0.04799  -0.00465   0.04670
10   0.00016   0.21970   0.00661  -0.00326   0.13274   0.01284   0.00110
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.35058   0.03075   0.01289   0.32796   0.02922
5   -0.08005  -0.00233  -0.05231  -0.08233   0.00986
10  -0.22648  -0.01817  -0.00093  -0.30221  -0.01870

, , b_2_1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.02527   0.10253   0.00656   0.00000   0.00000   0.00000    0.0000
5   -0.04131   0.40078   0.03721  -0.01489  -0.04799  -0.00465    0.0467
10   0.00000   0.34692   0.02254   0.00000   0.00000   0.00000    0.0000
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.00000   0.00000   0.00000   0.00000   0.00000
5   -0.08005  -0.00233  -0.05231  -0.08233   0.00986
10   0.00000   0.00000   0.00000   0.00000   0.00000

, , b_2_2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.00904  -0.15338  -0.01959  -0.01622   0.25590   0.02615  -0.04266
5    0.00000   0.00000   0.00000  -0.05620   0.35279   0.03256   0.00000
10   0.00000   0.00000   0.00000  -0.00342   0.25996   0.02877   0.00000
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.35058   0.03075   0.01289   0.32796   0.02922
5    0.00000   0.00000   0.00000   0.00000   0.00000
10   0.00000   0.00000   0.00000   0.00000   0.00000

, , b_2_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.00965   0.16378   0.02092  -0.04146   0.15234   0.01252   0.02943
5   -0.02060  -0.08824  -0.00563   0.00931   0.03000   0.00291  -0.07078
10   0.00020   0.27547   0.00829  -0.00408   0.16643   0.01610   0.00190
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.11749  -0.00657  -0.01371  -0.34994  -0.03175
5    0.45038   0.03850   0.03171   0.05060  -0.00657
10  -0.15655  -0.00672  -0.00027  -0.37869  -0.02274

, , b_2_4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.00386  -0.06541  -0.00835   0.01656  -0.06084  -0.00500  -0.01822
5    0.02707   0.11599   0.00741  -0.01223  -0.03943  -0.00382   0.03878
10  -0.00006  -0.08359  -0.00252   0.00124  -0.05050  -0.00489  -0.00017
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.14950   0.01279  -0.01076   0.39597   0.03858
5   -0.06571  -0.00238  -0.08443   0.33279   0.04476
10   0.08609   0.00784   0.00024   0.24212   0.02348

, , b_3_0

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.10363  -0.01582  -0.16929   0.05851  -0.00835   0.03177  -0.07976
5    0.00920   0.01949   0.18336  -0.06215   0.00714   0.02361   0.11702
10   0.00018   0.01147   0.12396  -0.00466   0.00965   0.15088   0.00104
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.03260  -0.01487   0.08338   0.02132  -0.03353
5   -0.02672  -0.10144  -0.03926  -0.02001  -0.14109
10  -0.01008  -0.23104  -0.00044  -0.01215  -0.24736

, , b_3_1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.14905   0.01436   0.26325   0.00000   0.00000   0.00000   0.00000
5   -0.07099   0.03269   0.40079  -0.06215   0.00714   0.02361   0.11743
10  -0.00001   0.01493   0.31087   0.00000   0.00000   0.00000   0.00000
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.00000   0.00000   0.00000    0.0000   0.00000
5   -0.02651  -0.10119  -0.03904   -0.0199  -0.14078
10   0.00000   0.00000   0.00000    0.0000   0.00000

, , b_3_2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.10363  -0.01582  -0.16929  -0.04542   0.03018   0.43253  -0.07978
5    0.00000   0.00000   0.00000  -0.13313   0.03983   0.42440   0.00000
10   0.00000   0.00000   0.00000  -0.00484   0.01312   0.33778   0.00000
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.03229  -0.01518   0.08339   0.02149  -0.03335
5    0.00000   0.00000   0.00000   0.00000   0.00000
10   0.00000   0.00000   0.00000   0.00000   0.00000

, , b_3_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.11066   0.01689   0.18077  -0.06247   0.00892  -0.03393   0.03955
5   -0.00575  -0.01218  -0.11461   0.03884  -0.00446  -0.01476  -0.14297
10   0.00022   0.01438   0.15542  -0.00584   0.01210   0.18917  -0.00001
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.00601   0.44786  -0.08911  -0.02252   0.03570
5    0.05016   0.46436   0.02505   0.01266   0.08802
10  -0.00917  -0.10339  -0.00142  -0.01528  -0.31033

, , b_3_4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.04420  -0.00675  -0.07219   0.02495  -0.00356   0.01355  -0.03387
5    0.00756   0.01601   0.15064  -0.05106   0.00587   0.01940   0.09546
10  -0.00007  -0.00436  -0.04716   0.00177  -0.00367  -0.05740  -0.00008
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.01400  -0.00600  -0.00974   0.03892   0.41815
5   -0.02263  -0.08354  -0.10483   0.01553   0.28404
10   0.00389   0.08848   0.00057   0.00815   0.28185

, , R_1_2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.01230  -0.47309  -0.02287  -0.23682   0.03536   0.04842   0.18782
5   -0.38915  -0.13467   0.00613  -0.02640   0.20035   0.03806  -0.13627
10  -0.00220  -0.00014   0.00188   0.03400   0.00627  -0.02126  -0.01116
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.45737  -0.03635  -0.00213   0.96296   0.01910
5   -0.30168  -0.03261   0.51292   0.11471  -0.07003
10  -0.00104   0.00860   0.00724   0.00007  -0.00324

, , R_1_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.67800  -0.04396  -0.75180  -0.15288   0.01287   0.39436   0.21560
5    0.11009  -0.02721  -0.13417   0.25361   0.00216   0.25411  -0.44434
10  -0.00084   0.00013  -0.00075   0.02055  -0.00329   0.01486  -0.00429
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.01148  -0.51669  -0.38911   0.08926   0.45177
5    0.01633  -0.31213  -0.03406   0.04186   0.17542
10   0.00093  -0.00370   0.00169   0.00025   0.00155

, , R_2_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.02957  -0.03247  -0.08381   0.09015  -0.03837  -0.12401  -0.10115
5    0.05092   0.17908   0.04184  -0.03551   0.05246  -0.14277   0.11026
10   0.00048   0.10664  -0.00447  -0.01050   0.08874   0.12656   0.00309
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.17412   0.20078   0.03620   0.00546   0.17040
5   -0.19973   0.24403  -0.11746  -0.32110   0.23181
10  -0.08058  -0.24887  -0.00151  -0.09793  -0.21849

> round( drop( attr( margEffCondV, "jacobian" )[ 1, , ] ), 5 )
             b_1_0    b_1_1    b_1_2    b_1_3    b_1_4    b_2_0    b_2_1
d_y1_d_x1  0.28441  0.43227  0.28441 -0.30370  0.12129 -0.00904 -0.02527
d_y2_d_x1  0.03659 -0.01905  0.03659 -0.03908  0.01561 -0.15338  0.10253
d_y3_d_x1  0.07801 -0.08016  0.07801 -0.08330  0.03327 -0.01959  0.00656
d_y1_d_x2 -0.22745  0.00000  0.14786  0.24288 -0.09700  0.03882  0.00000
d_y2_d_x2  0.01938  0.00000 -0.05564 -0.02070  0.00827 -0.14266  0.00000
d_y3_d_x2 -0.02312  0.00000 -0.15816  0.02468 -0.00986 -0.01173  0.00000
d_y1_d_x3  0.27867  0.00000  0.27867 -0.14977  0.11891 -0.04266  0.00000
d_y2_d_x3 -0.06761  0.00000 -0.06761  0.01618 -0.02817  0.35058  0.00000
d_y3_d_x3  0.01398  0.00000  0.01398 -0.17283  0.00602  0.03075  0.00000
d_y1_d_x4 -0.23331  0.00000 -0.23331  0.24921  0.04830  0.01289  0.00000
d_y2_d_x4 -0.06972  0.00000 -0.06972  0.07412 -0.08553  0.32796  0.00000
d_y3_d_x4 -0.00449  0.00000 -0.00449  0.00457 -0.15967  0.02922  0.00000
             b_2_2    b_2_3    b_2_4    b_3_0    b_3_1    b_3_2    b_3_3
d_y1_d_x1 -0.00904  0.00965 -0.00386 -0.10363 -0.14905 -0.10363  0.11066
d_y2_d_x1 -0.15338  0.16378 -0.06541 -0.01582  0.01436 -0.01582  0.01689
d_y3_d_x1 -0.01959  0.02092 -0.00835 -0.16929  0.26325 -0.16929  0.18077
d_y1_d_x2 -0.01622 -0.04146  0.01656  0.05851  0.00000 -0.04542 -0.06247
d_y2_d_x2  0.25590  0.15234 -0.06084 -0.00835  0.00000  0.03018  0.00892
d_y3_d_x2  0.02615  0.01252 -0.00500  0.03177  0.00000  0.43253 -0.03393
d_y1_d_x3 -0.04266  0.02943 -0.01822 -0.07976  0.00000 -0.07978  0.03955
d_y2_d_x3  0.35058 -0.11749  0.14950  0.03260  0.00000  0.03229 -0.00601
d_y3_d_x3  0.03075 -0.00657  0.01279 -0.01487  0.00000 -0.01518  0.44786
d_y1_d_x4  0.01289 -0.01371 -0.01076  0.08338  0.00000  0.08339 -0.08911
d_y2_d_x4  0.32796 -0.34994  0.39597  0.02132  0.00000  0.02149 -0.02252
d_y3_d_x4  0.02922 -0.03175  0.03858 -0.03353  0.00000 -0.03335  0.03570
             b_3_4    R_1_2    R_1_3    R_2_3
d_y1_d_x1 -0.04420  0.01230  0.67800 -0.02957
d_y2_d_x1 -0.00675 -0.47309 -0.04396 -0.03247
d_y3_d_x1 -0.07219 -0.02287 -0.75180 -0.08381
d_y1_d_x2  0.02495 -0.23682 -0.15288  0.09015
d_y2_d_x2 -0.00356  0.03536  0.01287 -0.03837
d_y3_d_x2  0.01355  0.04842  0.39436 -0.12401
d_y1_d_x3 -0.03387  0.18782  0.21560 -0.10115
d_y2_d_x3  0.01400  0.45737  0.01148  0.17412
d_y3_d_x3 -0.00600 -0.03635 -0.51669  0.20078
d_y1_d_x4 -0.00974 -0.00213 -0.38911  0.03620
d_y2_d_x4  0.03892  0.96296  0.08926  0.00546
d_y3_d_x4  0.41815  0.01910  0.45177  0.17040
> print( summary( margEffCondV ), digits = 3 )
              Estimate Std. error z value Pr(> z)
1: d_y1_d_x1  0.411820   0.987470    0.42    0.68
1: d_y2_d_x1  0.117554   0.566841    0.21    0.84
1: d_y3_d_x1 -0.360357   0.874767   -0.41    0.68
1: d_y1_d_x2 -0.229336   0.493308   -0.46    0.64
1: d_y2_d_x2  0.245929   0.347387    0.71    0.48
1: d_y3_d_x2 -0.125805   0.624447   -0.20    0.84
1: d_y1_d_x3  0.176512   0.551496    0.32    0.75
1: d_y2_d_x3 -0.351793   0.730841   -0.48    0.63
1: d_y3_d_x3  0.222984   0.736245    0.30    0.76
1: d_y1_d_x4 -0.146837   0.590426   -0.25    0.80
1: d_y2_d_x4 -0.328722   1.206289   -0.27    0.79
1: d_y3_d_x4  0.603735   0.664542    0.91    0.36
2: d_y1_d_x1  0.439180   0.539681    0.81    0.42
2: d_y2_d_x1  0.270827   0.506415    0.53    0.59
2: d_y3_d_x1 -0.261575   0.508675   -0.51    0.61
2: d_y1_d_x2 -0.320545   0.616944   -0.52    0.60
2: d_y2_d_x2  0.263154   0.425100    0.62    0.54
2: d_y3_d_x2 -0.163006   0.539915   -0.30    0.76
2: d_y1_d_x3  0.329853   0.942591    0.35    0.73
2: d_y2_d_x3 -0.505313   0.606561   -0.83    0.40
2: d_y3_d_x3  0.279124   0.665465    0.42    0.67
2: d_y1_d_x4 -0.223869   0.808860   -0.28    0.78
2: d_y2_d_x4 -0.567550   0.499684   -1.14    0.26
2: d_y3_d_x4  0.488327   0.479037    1.02    0.31
3: d_y1_d_x1  0.000202   0.002780    0.07    0.94
3: d_y2_d_x1  0.231970   0.513273    0.45    0.65
3: d_y3_d_x1 -0.130110   0.372877   -0.35    0.73
3: d_y1_d_x2 -0.005713   0.054480   -0.10    0.92
3: d_y2_d_x2  0.110991   0.351961    0.32    0.75
3: d_y3_d_x2 -0.166167   0.441134   -0.38    0.71
3: d_y1_d_x3  0.001136   0.014178    0.08    0.94
3: d_y2_d_x3 -0.149187   0.299851   -0.50    0.62
3: d_y3_d_x3  0.185344   0.366606    0.51    0.61
3: d_y1_d_x4 -0.000621   0.008580   -0.07    0.94
3: d_y2_d_x4 -0.199202   0.550816   -0.36    0.72
3: d_y3_d_x4  0.199446   0.534888    0.37    0.71
> margEffCondVA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    vcov = diag( 18 ), returnJacobian = TRUE, algorithm = GenzBretz() )
> all.equal( margEffCondV, margEffCondVA )
[1] TRUE
> # now with Jacobian but without variance covariance matrix
> margEffCondJac <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    returnJacobian = TRUE, algorithm = GenzBretz() )
> all.equal( attr( margEffCondJac, "jacobian" ), attr( margEffCondV, "jacobian" ) )
[1] TRUE
> # now with mean values of marginal effects
> margEffCondM <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    vcov = diag( 18 ), addMean = TRUE, returnJacobian = TRUE,
+    algorithm = GenzBretz() )
> all.equal( margEffCondV, margEffCondM[ 1:3, ], check.attributes = FALSE )
[1] TRUE
> round( margEffCondM, 4 )
     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.4118    0.1176   -0.3604   -0.2293    0.2459   -0.1258    0.1765
2       0.4392    0.2708   -0.2616   -0.3205    0.2632   -0.1630    0.3299
3       0.0002    0.2320   -0.1301   -0.0057    0.1110   -0.1662    0.0011
mean    0.2837    0.2068   -0.2507   -0.1852    0.2067   -0.1517    0.1692
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.3518    0.2230   -0.1468   -0.3287    0.6037
2      -0.5053    0.2791   -0.2239   -0.5676    0.4883
3      -0.1492    0.1853   -0.0006   -0.1992    0.1994
mean   -0.3354    0.2292   -0.1238   -0.3652    0.4305
> all.equal( attr( margEffCondV, "vcov" ), 
+    attr( margEffCondM, "vcov" )[ 1:3, , ] )
[1] TRUE
> round( attr( margEffCondM, "vcov" ), 5 )
, , d_y1_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.97510  -0.00300  -0.44900  -0.22743   0.00683   0.15893   0.39343
5      0.29126   0.03872  -0.05824   0.02749  -0.07556   0.00747   0.05541
10     0.00001   0.00015   0.00005  -0.00014   0.00010   0.00020   0.00004
mean   0.16265   0.01043  -0.10587   0.05239  -0.01622   0.02530  -0.05399
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.05458  -0.24326  -0.49449  -0.01982   0.26961
5      0.09227  -0.02132  -0.25953  -0.03995   0.08157
10    -0.00012  -0.00022  -0.00002  -0.00019  -0.00024
mean  -0.00014  -0.03835  -0.05106  -0.03803   0.05838

, , d_y2_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.00300   0.32131   0.08093   0.08914  -0.00505  -0.05181  -0.04443
5      0.03872   0.25646   0.05196  -0.03225  -0.04960  -0.03718   0.11173
10     0.00015   0.26345   0.01979  -0.00320   0.08899   0.02586   0.00112
mean   0.01043   0.15172   0.02394   0.01498  -0.02043  -0.01709   0.00550
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.36634   0.03800  -0.01870  -0.65414  -0.05528
5     -0.09091   0.03549  -0.14484  -0.08485   0.05410
10    -0.10893  -0.03756  -0.00049  -0.20179  -0.04416
mean  -0.02052   0.01835  -0.04174  -0.13148   0.00003

, , d_y3_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.44900   0.08093   0.76522   0.06637  -0.00845  -0.38941  -0.05895
5     -0.05824   0.05196   0.25875  -0.10424   0.00791  -0.01687   0.20771
10     0.00005   0.01979   0.13904  -0.00149   0.00524   0.05040   0.00012
mean  -0.10587   0.02394   0.20951  -0.01552  -0.00422  -0.08104   0.04085
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.07703   0.47425   0.18966  -0.14708  -0.37530
5     -0.04967  -0.08375  -0.07117  -0.02863  -0.06050
10    -0.00551  -0.04794  -0.00029  -0.00957  -0.09159
mean  -0.00733   0.08702   0.02773  -0.02116  -0.08593

, , d_y1_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.22743   0.08914   0.06637   0.24335  -0.05178  -0.11092  -0.16349
5      0.02749  -0.03225  -0.10424   0.38062  -0.06622  -0.07276  -0.36555
10    -0.00014  -0.00320  -0.00149   0.00297  -0.00334  -0.00640  -0.00070
mean   0.05239   0.01498  -0.01552   0.05900  -0.02482  -0.03942   0.01389
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.06590   0.03490   0.14476  -0.17823  -0.03090
5      0.06481   0.00514   0.16355   0.00574   0.02351
10     0.00248   0.00495   0.00041   0.00403   0.00582
mean  -0.01234  -0.01306  -0.02727  -0.03132   0.00938

, , d_y2_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.00683  -0.00505  -0.00845  -0.05178   0.12068   0.04232   0.00677
5     -0.07556  -0.04960   0.00791  -0.06622   0.18071   0.04028  -0.00567
10     0.00010   0.08899   0.00524  -0.00334   0.12388   0.03179   0.00075
mean  -0.01622  -0.02043  -0.00422  -0.02482   0.11070   0.02656  -0.00967
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.02483  -0.00713  -0.00168  -0.00486  -0.00707
5     -0.05096  -0.00251   0.08812   0.00368  -0.00317
10    -0.06786  -0.02980  -0.00032  -0.12439  -0.03404
mean   0.04220   0.00418   0.01943   0.01536  -0.00117

, , d_y3_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.15893  -0.05181  -0.38941  -0.11092   0.04232   0.38993   0.01228
5      0.00747  -0.03718  -0.01687  -0.07276   0.04028   0.29151  -0.06897
10     0.00020   0.02586   0.05040  -0.00640   0.03179   0.19460   0.00091
mean   0.02530  -0.01709  -0.08104  -0.03942   0.02656   0.22942  -0.03345
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.03625  -0.25930  -0.06839   0.10610   0.14925
5      0.01311  -0.14268  -0.01752   0.06322   0.01111
10    -0.01954  -0.09175  -0.00078  -0.02874  -0.14046
mean   0.01523  -0.06550  -0.00978   0.02944   0.02455

, , d_y1_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.39343  -0.04443  -0.05895  -0.16349   0.00677   0.01228   0.30415
5      0.05541   0.11173   0.20771  -0.36555  -0.00567  -0.06897   0.88848
10     0.00004   0.00112   0.00012  -0.00070   0.00075   0.00091   0.00020
mean  -0.05399   0.00550   0.04085   0.01389  -0.00967  -0.03345   0.05105
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.01467  -0.08688  -0.26737   0.08830   0.05003
5     -0.13094  -0.08481  -0.48822  -0.04093  -0.01410
10    -0.00083  -0.00117  -0.00012  -0.00141  -0.00098
mean  -0.01004  -0.00767  -0.01217   0.00944  -0.00403

, , d_y2_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.05458  -0.36634  -0.07703  -0.06590   0.02483   0.03625  -0.01467
5      0.09227  -0.09091  -0.04967   0.06481  -0.05096   0.01311  -0.13094
10    -0.00012  -0.10893  -0.00551   0.00248  -0.06786  -0.01954  -0.00083
mean  -0.00014  -0.02052  -0.00733  -0.01234   0.04220   0.01523  -0.01004
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.53413   0.02805   0.04993   0.78777   0.08222
5      0.36792   0.02668  -0.04339   0.04117  -0.03046
10     0.08991   0.02952   0.00042   0.15676   0.03386
mean   0.02678   0.00190   0.01122   0.04196  -0.00033

, , d_y3_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.24326   0.03800   0.47425   0.03490  -0.00713  -0.25930  -0.08688
5     -0.02132   0.03549  -0.08375   0.00514  -0.00251  -0.14268  -0.08481
10    -0.00022  -0.03756  -0.04794   0.00495  -0.02980  -0.09175  -0.00117
mean  -0.03835   0.01835   0.08702  -0.01306   0.00418  -0.06550  -0.00767
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.02805   0.54206   0.11748  -0.07872  -0.18479
5      0.02668   0.44284   0.09235  -0.09299   0.03846
10     0.02952   0.13440   0.00077   0.03941   0.16919
mean   0.00190   0.18244   0.02932  -0.03420  -0.05560

, , d_y1_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.49449  -0.01870   0.18966   0.14476  -0.00168  -0.06839  -0.26737
5     -0.25953  -0.14484  -0.07117   0.16355   0.08812  -0.01752  -0.48822
10    -0.00002  -0.00049  -0.00029   0.00041  -0.00032  -0.00078  -0.00012
mean  -0.05106  -0.04174   0.02773  -0.02727   0.01943  -0.00978  -0.01217
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.04993   0.11748   0.34860   0.02448  -0.18620
5     -0.04339   0.09235   0.65425   0.04360  -0.14296
10     0.00042   0.00077   0.00007   0.00062   0.00104
mean   0.01122   0.02932   0.09684   0.04326  -0.06300

, , d_y2_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.01982  -0.65414  -0.14708  -0.17823  -0.00486   0.10610   0.08830
5     -0.03995  -0.08485  -0.02863   0.00574   0.00368   0.06322  -0.04093
10    -0.00019  -0.20179  -0.00957   0.00403  -0.12439  -0.02874  -0.00141
mean  -0.03803  -0.13148  -0.02116  -0.03132   0.01536   0.02944   0.00944
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.78777  -0.07872   0.02448   1.45513   0.13386
5      0.04117  -0.09299   0.04360   0.24968  -0.04521
10     0.15676   0.03941   0.00062   0.30340   0.05139
mean   0.04196  -0.03420   0.04326   0.32382   0.02372

, , d_y3_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.26961  -0.05528  -0.37530  -0.03090  -0.00707   0.14925   0.05003
5      0.08157   0.05410  -0.06050   0.02351  -0.00317   0.01111  -0.01410
10    -0.00024  -0.04416  -0.09159   0.00582  -0.03404  -0.14046  -0.00098
mean   0.05838   0.00003  -0.08593   0.00938  -0.00117   0.02455  -0.00403
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.08222  -0.18479  -0.18620   0.13386   0.44162
5     -0.03046   0.03846  -0.14296  -0.04521   0.22948
10     0.03386   0.16919   0.00104   0.05139   0.28611
mean  -0.00033  -0.05560  -0.06300   0.02372   0.19081

> round( drop( attr( margEffCondM, "vcov" )[ 4, , ] ), 5 )
          d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
d_y1_d_x1   0.16265   0.01043  -0.10587   0.05239  -0.01622   0.02530  -0.05399
d_y2_d_x1   0.01043   0.15172   0.02394   0.01498  -0.02043  -0.01709   0.00550
d_y3_d_x1  -0.10587   0.02394   0.20951  -0.01552  -0.00422  -0.08104   0.04085
d_y1_d_x2   0.05239   0.01498  -0.01552   0.05900  -0.02482  -0.03942   0.01389
d_y2_d_x2  -0.01622  -0.02043  -0.00422  -0.02482   0.11070   0.02656  -0.00967
d_y3_d_x2   0.02530  -0.01709  -0.08104  -0.03942   0.02656   0.22942  -0.03345
d_y1_d_x3  -0.05399   0.00550   0.04085   0.01389  -0.00967  -0.03345   0.05105
d_y2_d_x3  -0.00014  -0.02052  -0.00733  -0.01234   0.04220   0.01523  -0.01004
d_y3_d_x3  -0.03835   0.01835   0.08702  -0.01306   0.00418  -0.06550  -0.00767
d_y1_d_x4  -0.05106  -0.04174   0.02773  -0.02727   0.01943  -0.00978  -0.01217
d_y2_d_x4  -0.03803  -0.13148  -0.02116  -0.03132   0.01536   0.02944   0.00944
d_y3_d_x4   0.05838   0.00003  -0.08593   0.00938  -0.00117   0.02455  -0.00403
          d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
d_y1_d_x1  -0.00014  -0.03835  -0.05106  -0.03803   0.05838
d_y2_d_x1  -0.02052   0.01835  -0.04174  -0.13148   0.00003
d_y3_d_x1  -0.00733   0.08702   0.02773  -0.02116  -0.08593
d_y1_d_x2  -0.01234  -0.01306  -0.02727  -0.03132   0.00938
d_y2_d_x2   0.04220   0.00418   0.01943   0.01536  -0.00117
d_y3_d_x2   0.01523  -0.06550  -0.00978   0.02944   0.02455
d_y1_d_x3  -0.01004  -0.00767  -0.01217   0.00944  -0.00403
d_y2_d_x3   0.02678   0.00190   0.01122   0.04196  -0.00033
d_y3_d_x3   0.00190   0.18244   0.02932  -0.03420  -0.05560
d_y1_d_x4   0.01122   0.02932   0.09684   0.04326  -0.06300
d_y2_d_x4   0.04196  -0.03420   0.04326   0.32382   0.02372
d_y3_d_x4  -0.00033  -0.05560  -0.06300   0.02372   0.19081
> all.equal( attr( margEffCondV, "jacobian" ), 
+    attr( margEffCondM, "jacobian" )[ 1:3, , ] )
[1] TRUE
> round( attr( margEffCondM, "jacobian" ), 5 )
, , b_1_0

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.28441   0.03659   0.07801  -0.22745   0.01938  -0.02312   0.27867
5     -0.15622  -0.00036  -0.01266   0.17568  -0.01723  -0.04385  -0.36560
10    -0.00082   0.00023   0.00079   0.01742  -0.00467  -0.01341  -0.00437
mean   0.04246   0.01216   0.02205  -0.01145  -0.00084  -0.02679  -0.03043
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.06761   0.01398  -0.23331  -0.06972  -0.00449
5      0.05018   0.08786   0.24185  -0.01494  -0.01519
10     0.00138   0.00404   0.00169  -0.00009  -0.00124
mean  -0.00535   0.03529   0.00341  -0.02825  -0.00697

, , b_1_1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.43227  -0.01905  -0.08016   0.00000   0.00000   0.00000   0.00000
5      0.25598  -0.04309  -0.08364   0.17568  -0.01723  -0.04385  -0.36591
10     0.00000  -0.00001  -0.00002   0.00000   0.00000   0.00000   0.00000
mean   0.22942  -0.02072  -0.05461   0.05856  -0.00574  -0.01462  -0.12197
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.00000   0.00000   0.00000   0.00000   0.00000
5      0.05033   0.08802   0.24203  -0.01503  -0.01528
10     0.00000   0.00000   0.00000   0.00000   0.00000
mean   0.01678   0.02934   0.08068  -0.00501  -0.00509

, , b_1_2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.28441   0.03659   0.07801   0.14786  -0.05564  -0.15816   0.27867
5      0.00000   0.00000   0.00000   0.43166  -0.06032  -0.12749   0.00000
10     0.00000   0.00000   0.00000   0.01824  -0.00491  -0.01423   0.00000
mean   0.09480   0.01220   0.02600   0.19925  -0.04029  -0.09996   0.09289
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.06761   0.01398  -0.23331  -0.06972  -0.00449
5      0.00000   0.00000   0.00000   0.00000   0.00000
10     0.00000   0.00000   0.00000   0.00000   0.00000
mean  -0.02254   0.00466  -0.07777  -0.02324  -0.00150

, , b_1_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.30370  -0.03908  -0.08330   0.24288  -0.02070   0.02468  -0.14977
5      0.09765   0.00023   0.00791  -0.10981   0.01077   0.02741   0.48463
10    -0.00102   0.00029   0.00099   0.02184  -0.00585  -0.01682  -0.00471
mean  -0.06903  -0.01285  -0.02480   0.05164  -0.00526   0.01176   0.11005
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.01618  -0.17283   0.24921   0.07412   0.00457
5     -0.07452  -0.13896  -0.15192   0.00928   0.00893
10     0.00147   0.00441   0.00311  -0.00007  -0.00115
mean  -0.01896  -0.10246   0.03346   0.02778   0.00412

, , b_1_4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.12129   0.01561   0.03327  -0.09700   0.00827  -0.00986   0.11891
5     -0.12835  -0.00030  -0.01040   0.14434  -0.01415  -0.03603  -0.29998
10     0.00031  -0.00009  -0.00030  -0.00663   0.00178   0.00510   0.00117
mean  -0.00225   0.00507   0.00752   0.01357  -0.00137  -0.01359  -0.05997
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.02817   0.00602   0.04830  -0.08553  -0.15967
5      0.04143   0.07341   0.45582  -0.05537  -0.09554
10    -0.00054  -0.00259  -0.00020  -0.00024  -0.00121
mean   0.00424   0.02561   0.16797  -0.04705  -0.08547

, , b_2_0

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.00904  -0.15338  -0.01959   0.03882  -0.14266  -0.01173  -0.04266
5      0.03295   0.14118   0.00901  -0.01489  -0.04799  -0.00465   0.04670
10     0.00016   0.21970   0.00661  -0.00326   0.13274   0.01284   0.00110
mean   0.00802   0.06917  -0.00132   0.00689  -0.01931  -0.00118   0.00171
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.35058   0.03075   0.01289   0.32796   0.02922
5     -0.08005  -0.00233  -0.05231  -0.08233   0.00986
10    -0.22648  -0.01817  -0.00093  -0.30221  -0.01870
mean   0.01468   0.00342  -0.01345  -0.01886   0.00679

, , b_2_1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.02527   0.10253   0.00656   0.00000   0.00000   0.00000   0.00000
5     -0.04131   0.40078   0.03721  -0.01489  -0.04799  -0.00465   0.04670
10     0.00000   0.34692   0.02254   0.00000   0.00000   0.00000   0.00000
mean  -0.02219   0.28341   0.02211  -0.00496  -0.01600  -0.00155   0.01557
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.00000   0.00000   0.00000   0.00000   0.00000
5     -0.08005  -0.00233  -0.05231  -0.08233   0.00986
10     0.00000   0.00000   0.00000   0.00000   0.00000
mean  -0.02668  -0.00078  -0.01744  -0.02744   0.00329

, , b_2_2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.00904  -0.15338  -0.01959  -0.01622   0.25590   0.02615  -0.04266
5      0.00000   0.00000   0.00000  -0.05620   0.35279   0.03256   0.00000
10     0.00000   0.00000   0.00000  -0.00342   0.25996   0.02877   0.00000
mean  -0.00301  -0.05113  -0.00653  -0.02528   0.28955   0.02916  -0.01422
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.35058   0.03075   0.01289   0.32796   0.02922
5      0.00000   0.00000   0.00000   0.00000   0.00000
10     0.00000   0.00000   0.00000   0.00000   0.00000
mean   0.11686   0.01025   0.00430   0.10932   0.00974

, , b_2_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.00965   0.16378   0.02092  -0.04146   0.15234   0.01252   0.02943
5     -0.02060  -0.08824  -0.00563   0.00931   0.03000   0.00291  -0.07078
10     0.00020   0.27547   0.00829  -0.00408   0.16643   0.01610   0.00190
mean  -0.00358   0.11700   0.00786  -0.01208   0.11625   0.01051  -0.01315
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.11749  -0.00657  -0.01371  -0.34994  -0.03175
5      0.45038   0.03850   0.03171   0.05060  -0.00657
10    -0.15655  -0.00672  -0.00027  -0.37869  -0.02274
mean   0.05878   0.00840   0.00591  -0.22601  -0.02035

, , b_2_4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.00386  -0.06541  -0.00835   0.01656  -0.06084  -0.00500  -0.01822
5      0.02707   0.11599   0.00741  -0.01223  -0.03943  -0.00382   0.03878
10    -0.00006  -0.08359  -0.00252   0.00124  -0.05050  -0.00489  -0.00017
mean   0.00772  -0.01100  -0.00115   0.00185  -0.05026  -0.00457   0.00680
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.14950   0.01279  -0.01076   0.39597   0.03858
5     -0.06571  -0.00238  -0.08443   0.33279   0.04476
10     0.08609   0.00784   0.00024   0.24212   0.02348
mean   0.05663   0.00608  -0.03165   0.32363   0.03561

, , b_3_0

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.10363  -0.01582  -0.16929   0.05851  -0.00835   0.03177  -0.07976
5      0.00920   0.01949   0.18336  -0.06215   0.00714   0.02361   0.11702
10     0.00018   0.01147   0.12396  -0.00466   0.00965   0.15088   0.00104
mean  -0.03142   0.00505   0.04601  -0.00277   0.00281   0.06875   0.01277
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.03260  -0.01487   0.08338   0.02132  -0.03353
5     -0.02672  -0.10144  -0.03926  -0.02001  -0.14109
10    -0.01008  -0.23104  -0.00044  -0.01215  -0.24736
mean  -0.00140  -0.11578   0.01456  -0.00361  -0.14066

, , b_3_1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.14905   0.01436   0.26325   0.00000   0.00000   0.00000   0.00000
5     -0.07099   0.03269   0.40079  -0.06215   0.00714   0.02361   0.11743
10    -0.00001   0.01493   0.31087   0.00000   0.00000   0.00000   0.00000
mean  -0.07335   0.02066   0.32497  -0.02072   0.00238   0.00787   0.03914
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.00000   0.00000   0.00000   0.00000   0.00000
5     -0.02651  -0.10119  -0.03904  -0.01990  -0.14078
10     0.00000   0.00000   0.00000   0.00000   0.00000
mean  -0.00884  -0.03373  -0.01301  -0.00663  -0.04693

, , b_3_2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.10363  -0.01582  -0.16929  -0.04542   0.03018   0.43253  -0.07978
5      0.00000   0.00000   0.00000  -0.13313   0.03983   0.42440   0.00000
10     0.00000   0.00000   0.00000  -0.00484   0.01312   0.33778   0.00000
mean  -0.03454  -0.00527  -0.05643  -0.06113   0.02771   0.39824  -0.02659
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.03229  -0.01518   0.08339   0.02149  -0.03335
5      0.00000   0.00000   0.00000   0.00000   0.00000
10     0.00000   0.00000   0.00000   0.00000   0.00000
mean   0.01076  -0.00506   0.02780   0.00716  -0.01112

, , b_3_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.11066   0.01689   0.18077  -0.06247   0.00892  -0.03393   0.03955
5     -0.00575  -0.01218  -0.11461   0.03884  -0.00446  -0.01476  -0.14297
10     0.00022   0.01438   0.15542  -0.00584   0.01210   0.18917  -0.00001
mean   0.03504   0.00636   0.07386  -0.00982   0.00552   0.04683  -0.03448
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.00601   0.44786  -0.08911  -0.02252   0.03570
5      0.05016   0.46436   0.02505   0.01266   0.08802
10    -0.00917  -0.10339  -0.00142  -0.01528  -0.31033
mean   0.01166   0.26961  -0.02183  -0.00838  -0.06220

, , b_3_4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.04420  -0.00675  -0.07219   0.02495  -0.00356   0.01355  -0.03387
5      0.00756   0.01601   0.15064  -0.05106   0.00587   0.01940   0.09546
10    -0.00007  -0.00436  -0.04716   0.00177  -0.00367  -0.05740  -0.00008
mean  -0.01223   0.00163   0.01043  -0.00811  -0.00046  -0.00815   0.02050
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.01400  -0.00600  -0.00974   0.03892   0.41815
5     -0.02263  -0.08354  -0.10483   0.01553   0.28404
10     0.00389   0.08848   0.00057   0.00815   0.28185
mean  -0.00158  -0.00035  -0.03800   0.02087   0.32801

, , R_1_2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.01230  -0.47309  -0.02287  -0.23682   0.03536   0.04842   0.18782
5     -0.38915  -0.13467   0.00613  -0.02640   0.20035   0.03806  -0.13627
10    -0.00220  -0.00014   0.00188   0.03400   0.00627  -0.02126  -0.01116
mean  -0.12635  -0.20263  -0.00495  -0.07641   0.08066   0.02174   0.01346
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.45737  -0.03635  -0.00213   0.96296   0.01910
5     -0.30168  -0.03261   0.51292   0.11471  -0.07003
10    -0.00104   0.00860   0.00724   0.00007  -0.00324
mean   0.05155  -0.02012   0.17268   0.35925  -0.01806

, , R_1_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.67800  -0.04396  -0.75180  -0.15288   0.01287   0.39436   0.21560
5      0.11009  -0.02721  -0.13417   0.25361   0.00216   0.25411  -0.44434
10    -0.00084   0.00013  -0.00075   0.02055  -0.00329   0.01486  -0.00429
mean   0.26242  -0.02368  -0.29557   0.04043   0.00391   0.22111  -0.07768
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.01148  -0.51669  -0.38911   0.08926   0.45177
5      0.01633  -0.31213  -0.03406   0.04186   0.17542
10     0.00093  -0.00370   0.00169   0.00025   0.00155
mean   0.00958  -0.27750  -0.14049   0.04379   0.20958

, , R_2_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.02957  -0.03247  -0.08381   0.09015  -0.03837  -0.12401  -0.10115
5      0.05092   0.17908   0.04184  -0.03551   0.05246  -0.14277   0.11026
10     0.00048   0.10664  -0.00447  -0.01050   0.08874   0.12656   0.00309
mean   0.00728   0.08441  -0.01548   0.01471   0.03428  -0.04674   0.00406
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.17412   0.20078   0.03620   0.00546   0.17040
5     -0.19973   0.24403  -0.11746  -0.32110   0.23181
10    -0.08058  -0.24887  -0.00151  -0.09793  -0.21849
mean  -0.03540   0.06531  -0.02759  -0.13785   0.06124

> round( drop( attr( margEffCondM, "jacobian" )[ 4, , ] ), 5 )
             b_1_0    b_1_1    b_1_2    b_1_3    b_1_4    b_2_0    b_2_1
d_y1_d_x1  0.04246  0.22942  0.09480 -0.06903 -0.00225  0.00802 -0.02219
d_y2_d_x1  0.01216 -0.02072  0.01220 -0.01285  0.00507  0.06917  0.28341
d_y3_d_x1  0.02205 -0.05461  0.02600 -0.02480  0.00752 -0.00132  0.02211
d_y1_d_x2 -0.01145  0.05856  0.19925  0.05164  0.01357  0.00689 -0.00496
d_y2_d_x2 -0.00084 -0.00574 -0.04029 -0.00526 -0.00137 -0.01931 -0.01600
d_y3_d_x2 -0.02679 -0.01462 -0.09996  0.01176 -0.01359 -0.00118 -0.00155
d_y1_d_x3 -0.03043 -0.12197  0.09289  0.11005 -0.05997  0.00171  0.01557
d_y2_d_x3 -0.00535  0.01678 -0.02254 -0.01896  0.00424  0.01468 -0.02668
d_y3_d_x3  0.03529  0.02934  0.00466 -0.10246  0.02561  0.00342 -0.00078
d_y1_d_x4  0.00341  0.08068 -0.07777  0.03346  0.16797 -0.01345 -0.01744
d_y2_d_x4 -0.02825 -0.00501 -0.02324  0.02778 -0.04705 -0.01886 -0.02744
d_y3_d_x4 -0.00697 -0.00509 -0.00150  0.00412 -0.08547  0.00679  0.00329
             b_2_2    b_2_3    b_2_4    b_3_0    b_3_1    b_3_2    b_3_3
d_y1_d_x1 -0.00301 -0.00358  0.00772 -0.03142 -0.07335 -0.03454  0.03504
d_y2_d_x1 -0.05113  0.11700 -0.01100  0.00505  0.02066 -0.00527  0.00636
d_y3_d_x1 -0.00653  0.00786 -0.00115  0.04601  0.32497 -0.05643  0.07386
d_y1_d_x2 -0.02528 -0.01208  0.00185 -0.00277 -0.02072 -0.06113 -0.00982
d_y2_d_x2  0.28955  0.11625 -0.05026  0.00281  0.00238  0.02771  0.00552
d_y3_d_x2  0.02916  0.01051 -0.00457  0.06875  0.00787  0.39824  0.04683
d_y1_d_x3 -0.01422 -0.01315  0.00680  0.01277  0.03914 -0.02659 -0.03448
d_y2_d_x3  0.11686  0.05878  0.05663 -0.00140 -0.00884  0.01076  0.01166
d_y3_d_x3  0.01025  0.00840  0.00608 -0.11578 -0.03373 -0.00506  0.26961
d_y1_d_x4  0.00430  0.00591 -0.03165  0.01456 -0.01301  0.02780 -0.02183
d_y2_d_x4  0.10932 -0.22601  0.32363 -0.00361 -0.00663  0.00716 -0.00838
d_y3_d_x4  0.00974 -0.02035  0.03561 -0.14066 -0.04693 -0.01112 -0.06220
             b_3_4    R_1_2    R_1_3    R_2_3
d_y1_d_x1 -0.01223 -0.12635  0.26242  0.00728
d_y2_d_x1  0.00163 -0.20263 -0.02368  0.08441
d_y3_d_x1  0.01043 -0.00495 -0.29557 -0.01548
d_y1_d_x2 -0.00811 -0.07641  0.04043  0.01471
d_y2_d_x2 -0.00046  0.08066  0.00391  0.03428
d_y3_d_x2 -0.00815  0.02174  0.22111 -0.04674
d_y1_d_x3  0.02050  0.01346 -0.07768  0.00406
d_y2_d_x3 -0.00158  0.05155  0.00958 -0.03540
d_y3_d_x3 -0.00035 -0.02012 -0.27750  0.06531
d_y1_d_x4 -0.03800  0.17268 -0.14049 -0.02759
d_y2_d_x4  0.02087  0.35925  0.04379 -0.13785
d_y3_d_x4  0.32801 -0.01806  0.20958  0.06124
> all.equal( summary( margEffCondV )[ , ], summary( margEffCondM )[ 1:36, ],
+    check.attributes = FALSE ) 
[1] TRUE
> print( summary( margEffCondM )[ -( 1:24 ), ], digits = 3 )
                 Estimate Std. error z value Pr(> z)
3: d_y1_d_x1     0.000202    0.00278  0.0728  0.9420
3: d_y2_d_x1     0.231970    0.51327  0.4519  0.6513
3: d_y3_d_x1    -0.130110    0.37288 -0.3489  0.7271
3: d_y1_d_x2    -0.005713    0.05448 -0.1049  0.9165
3: d_y2_d_x2     0.110991    0.35196  0.3153  0.7525
3: d_y3_d_x2    -0.166167    0.44113 -0.3767  0.7064
3: d_y1_d_x3     0.001136    0.01418  0.0801  0.9361
3: d_y2_d_x3    -0.149187    0.29985 -0.4975  0.6188
3: d_y3_d_x3     0.185344    0.36661  0.5056  0.6132
3: d_y1_d_x4    -0.000621    0.00858 -0.0724  0.9423
3: d_y2_d_x4    -0.199202    0.55082 -0.3616  0.7176
3: d_y3_d_x4     0.199446    0.53489  0.3729  0.7092
mean: d_y1_d_x1  0.283734    0.40330  0.7035  0.4817
mean: d_y2_d_x1  0.206784    0.38951  0.5309  0.5955
mean: d_y3_d_x1 -0.250681    0.45772 -0.5477  0.5839
mean: d_y1_d_x2 -0.185198    0.24289 -0.7625  0.4458
mean: d_y2_d_x2  0.206692    0.33272  0.6212  0.5345
mean: d_y3_d_x2 -0.151660    0.47898 -0.3166  0.7515
mean: d_y1_d_x3  0.169167    0.22594  0.7487  0.4540
mean: d_y2_d_x3 -0.335431    0.16364 -2.0498  0.0404
mean: d_y3_d_x3  0.229151    0.42713  0.5365  0.5916
mean: d_y1_d_x4 -0.123776    0.31118 -0.3978  0.6908
mean: d_y2_d_x4 -0.365158    0.56905 -0.6417  0.5211
mean: d_y3_d_x4  0.430502    0.43681  0.9856  0.3244
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -0.6467480  0.2788967  0.1209011 -1.2689215
> 
> # calculating marginal effects, conditional
> # (assuming that all other dependent variables are as observed)
> margEffCondObs <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE, algorithm = GenzBretz() )
> round( margEffCondObs, 4 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     0.1720    0.2054   -0.1268   -0.0957    0.2233   -0.1748    0.0494
2     0.4534    0.1852   -0.1037   -0.3712    0.2664   -0.0853    0.5176
3     0.0972    0.3435   -0.2061   -0.2771    0.2302   -0.1283    0.2406
4     0.1824    0.2226   -0.3556   -0.3490    0.2464   -0.1563    0.3790
5     0.3960    0.2651   -0.2241   -0.3230    0.2517   -0.1343    0.5390
6     0.0242    0.1452   -0.0734   -0.1329    0.0697   -0.0617    0.0779
7     0.2475    0.1453   -0.1436   -0.0264    0.1129   -0.1252    0.0861
8     0.1052    0.3503   -0.2376   -0.2831    0.2396   -0.1483    0.2522
9     0.3051    0.0295   -0.0247   -0.2106    0.0827   -0.0517    0.1524
10    0.0014    0.2320   -0.1161   -0.0186    0.1110   -0.1378    0.0060
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    -0.3850    0.2442   -0.0357   -0.5042    0.3020
2    -0.4255    0.1320   -0.3423   -0.4682    0.2740
3    -0.3578    0.1925   -0.1696   -0.4356    0.3028
4    -0.3734    0.2437   -0.2637   -0.3558    0.5674
5    -0.5239    0.2320   -0.3951   -0.5387    0.4555
6    -0.0760    0.0650   -0.0527   -0.0982    0.0850
7    -0.3098    0.2531   -0.0656   -0.3993    0.3326
8    -0.3862    0.2369   -0.1850   -0.4669    0.3785
9    -0.0891    0.0574   -0.1004   -0.1127    0.0825
10   -0.1492    0.1482   -0.0046   -0.1992    0.1655
> margEffCondObsA <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE, algorithm = GenzBretz() )
> all.equal( margEffCondObs, margEffCondObsA )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm, reduced precision
> margEffCondObs1 <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = Miwa( steps = 32 ) )
> round( margEffCondObs1, 4 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     0.1720    0.2054   -0.1269   -0.0956    0.2233   -0.1748    0.0494
2     0.4534    0.1852   -0.1037   -0.3712    0.2664   -0.0854    0.5175
3     0.0972    0.3434   -0.2061   -0.2771    0.2302   -0.1283    0.2405
4     0.1824    0.2226   -0.3556   -0.3489    0.2465   -0.1561    0.3790
5     0.3961    0.2649   -0.2241   -0.3230    0.2517   -0.1343    0.5390
6     0.0242    0.1453   -0.0734   -0.1329    0.0699   -0.0617    0.0779
7     0.2476    0.1453   -0.1435   -0.0263    0.1129   -0.1252    0.0860
8     0.1051    0.3503   -0.2377   -0.2831    0.2396   -0.1483    0.2522
9     0.3051    0.0295   -0.0247   -0.2106    0.0828   -0.0517    0.1524
10    0.0014    0.2320   -0.1161   -0.0185    0.1110   -0.1378    0.0059
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    -0.3850    0.2442   -0.0357   -0.5042    0.3020
2    -0.4255    0.1320   -0.3423   -0.4683    0.2741
3    -0.3579    0.1926   -0.1696   -0.4356    0.3028
4    -0.3734    0.2438   -0.2637   -0.3559    0.5675
5    -0.5238    0.2321   -0.3951   -0.5387    0.4554
6    -0.0758    0.0651   -0.0527   -0.0984    0.0850
7    -0.3098    0.2531   -0.0655   -0.3993    0.3327
8    -0.3862    0.2369   -0.1849   -0.4669    0.3786
9    -0.0892    0.0575   -0.1004   -0.1128    0.0825
10   -0.1492    0.1482   -0.0045   -0.1992    0.1656
> all.equal( margEffCondObs, margEffCondObs1 )
 [1] "Component 1: Mean relative difference: 0.0001814309" 
 [2] "Component 2: Mean relative difference: 0.0001877033" 
 [3] "Component 3: Mean relative difference: 0.0001982085" 
 [4] "Component 4: Mean relative difference: 0.0002147753" 
 [5] "Component 5: Mean relative difference: 0.0001774133" 
 [6] "Component 6: Mean relative difference: 0.0003184793" 
 [7] "Component 7: Mean relative difference: 0.0001634689" 
 [8] "Component 8: Mean relative difference: 0.000165961"  
 [9] "Component 9: Mean relative difference: 0.0002713411" 
[10] "Component 10: Mean relative difference: 0.0001883149"
[11] "Component 11: Mean relative difference: 9.769877e-05"
[12] "Component 12: Mean relative difference: 0.000233469" 
> # now with integrals obtained by the GHK algorithm
> margEffCondObs2 <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE )
> round( margEffCondObs2, 4 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     0.1719    0.2032   -0.1239   -0.0957    0.2237   -0.1747    0.0494
2     0.4532    0.1844   -0.1028   -0.3716    0.2666   -0.0852    0.5181
3     0.0972    0.3420   -0.2008   -0.2773    0.2304   -0.1284    0.2407
4     0.1825    0.2220   -0.3561   -0.3492    0.2466   -0.1577    0.3794
5     0.3931    0.2638   -0.2240   -0.3202    0.2518   -0.1346    0.5318
6     0.0241    0.1434   -0.0711   -0.1329    0.0696   -0.0616    0.0779
7     0.2500    0.1462   -0.1425   -0.0255    0.1135   -0.1252    0.0858
8     0.1088    0.3548   -0.2369   -0.2838    0.2403   -0.1490    0.2528
9     0.3050    0.0289   -0.0241   -0.2106    0.0826   -0.0516    0.1524
10    0.0029    0.2339   -0.1161   -0.0174    0.1117   -0.1377    0.0034
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    -0.3851    0.2424   -0.0357   -0.5016    0.2960
2    -0.4256    0.1318   -0.3420   -0.4665    0.2716
3    -0.3581    0.1922   -0.1695   -0.4327    0.2987
4    -0.3736    0.2449   -0.2636   -0.3558    0.5682
5    -0.5228    0.2333   -0.3922   -0.5374    0.4550
6    -0.0751    0.0642   -0.0527   -0.0957    0.0827
7    -0.3114    0.2544   -0.0698   -0.4025    0.3317
8    -0.3876    0.2384   -0.1885   -0.4701    0.3779
9    -0.0887    0.0570   -0.1004   -0.1107    0.0805
10   -0.1502    0.1472   -0.0079   -0.2006    0.1642
> all.equal( margEffCondObs, margEffCondObs2 )
 [1] "Component 1: Mean relative difference: 0.005543512" 
 [2] "Component 2: Mean relative difference: 0.007674393" 
 [3] "Component 3: Mean relative difference: 0.008961165" 
 [4] "Component 4: Mean relative difference: 0.003050649" 
 [5] "Component 5: Mean relative difference: 0.00184501"  
 [6] "Component 6: Mean relative difference: 0.002549041" 
 [7] "Component 7: Mean relative difference: 0.005124569" 
 [8] "Component 8: Mean relative difference: 0.002339985" 
 [9] "Component 9: Mean relative difference: 0.005537837" 
[10] "Component 10: Mean relative difference: 0.00899678" 
[11] "Component 11: Mean relative difference: 0.005854874"
[12] "Component 12: Mean relative difference: 0.007158028"
> all.equal( margEffCondObs1, margEffCondObs2 )
 [1] "Component 1: Mean relative difference: 0.005627834" 
 [2] "Component 2: Mean relative difference: 0.007624478" 
 [3] "Component 3: Mean relative difference: 0.009017387" 
 [4] "Component 4: Mean relative difference: 0.003117591" 
 [5] "Component 5: Mean relative difference: 0.001876911" 
 [6] "Component 6: Mean relative difference: 0.002632088" 
 [7] "Component 7: Mean relative difference: 0.00515424"  
 [8] "Component 8: Mean relative difference: 0.002203596" 
 [9] "Component 9: Mean relative difference: 0.00552548"  
[10] "Component 10: Mean relative difference: 0.009180787"
[11] "Component 11: Mean relative difference: 0.005936969"
[12] "Component 12: Mean relative difference: 0.007245038"
> # now with variance covariance matrix and Jacobian
> margEffCondObsV <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, 
+    data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, vcov = diag( 18 ), returnJacobian = TRUE,
+    algorithm = GenzBretz() )
> round( attr( margEffCondObsV, "vcov" ), 5 )
, , d_y1_d_x1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.26711  -0.00190   0.00124  -0.08987   0.01110   0.02327   0.08713
5    0.48048   0.06699  -0.18654  -0.24009   0.01344  -0.18766  -0.10741
10   0.00007   0.00010   0.00028  -0.00075   0.00014   0.00052   0.00027
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.01774  -0.04527  -0.06151  -0.00682  -0.02509
5    0.10851   0.32829   0.04479  -0.24224   0.13745
10  -0.00010  -0.00041  -0.00019  -0.00015  -0.00059

, , d_y2_d_x1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.00190   0.17067   0.00322  -0.00761  -0.01922  -0.01513   0.00731
5    0.06699   0.33531  -0.02424  -0.02304  -0.06623  -0.13791  -0.09144
10   0.00010   0.26345   0.00604  -0.00233   0.08899   0.00212   0.00034
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.11859   0.00833  -0.00145  -0.27766   0.00286
5    0.08284   0.17888  -0.03703  -0.14850   0.08718
10  -0.10893  -0.00159  -0.00015  -0.20179  -0.00523

, , d_y3_d_x1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.00124   0.00322   0.11053  -0.02410  -0.01425   0.02281   0.01816
5   -0.18654  -0.02424   0.30724   0.09521  -0.06042   0.12725   0.02986
10   0.00028   0.00604   0.13769  -0.00394  -0.00395   0.06570   0.00112
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.00936  -0.11258  -0.00566   0.00302  -0.21024
5    0.02616  -0.30234  -0.02228   0.18054  -0.27740
10   0.00230  -0.06430  -0.00058  -0.00145  -0.10522

, , d_y1_d_x2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.08987  -0.00761  -0.02410   0.10986  -0.02228  -0.02627  -0.05818
5   -0.24009  -0.02304   0.09521   0.23267  -0.05217   0.06279  -0.01144
10  -0.00075  -0.00233  -0.00394   0.01074  -0.00362  -0.01076  -0.00279
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.01313   0.01915   0.03029   0.01718   0.04486
5   -0.01846  -0.21626  -0.15672   0.11149  -0.04115
10   0.00200   0.00514   0.00191   0.00336   0.00793

, , d_y2_d_x2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.01110  -0.01922  -0.01425  -0.02228   0.14733  -0.00810   0.00581
5    0.01344  -0.06623  -0.06042  -0.05217   0.18862  -0.00043   0.02739
10   0.00014   0.08899  -0.00395  -0.00362   0.12388   0.00823   0.00050
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.02950   0.04223  -0.00332   0.00095   0.04408
5   -0.08515   0.08368   0.04185  -0.11320   0.10280
10  -0.06786  -0.00022  -0.00029  -0.12439  -0.00270

, , d_y3_d_x2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.02327  -0.01513   0.02281  -0.02627  -0.00810   0.17061   0.00114
5   -0.18766  -0.13791   0.12725   0.06279  -0.00043   0.43037   0.02450
10   0.00052   0.00212   0.06570  -0.01076   0.00823   0.16222   0.00186
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.04325  -0.04572  -0.00497   0.04030  -0.08972
5   -0.01629  -0.34012  -0.09940   0.25272  -0.15380
10  -0.00163  -0.07127  -0.00133  -0.00621  -0.11694

, , d_y1_d_x3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.08713   0.00731   0.01816  -0.05818   0.00581   0.00114   0.05219
5   -0.10741  -0.09144   0.02986  -0.01144   0.02739   0.02450   0.35135
10   0.00027   0.00034   0.00112  -0.00279   0.00050   0.00186   0.00099
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.01537  -0.02564  -0.02944  -0.01482  -0.03375
5   -0.16576  -0.11752   0.23988   0.11584  -0.10064
10  -0.00040  -0.00164  -0.00068  -0.00052  -0.00231

, , d_y2_d_x3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.01774  -0.11859   0.00936   0.01313   0.02950   0.04325  -0.01537
5    0.10851   0.08284   0.02616  -0.01846  -0.08515  -0.01629  -0.16576
10  -0.00010  -0.10893   0.00230   0.00200  -0.06786  -0.00163  -0.00040
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.18708  -0.03306   0.00630   0.24045  -0.03963
5    0.33834   0.03722  -0.10152   0.00834  -0.07611
10   0.08991   0.00154   0.00016   0.15676   0.00406

, , d_y3_d_x3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.04527   0.00833  -0.11258   0.01915   0.04223  -0.04572  -0.02564
5    0.32829   0.17888  -0.30234  -0.21626   0.08368  -0.34012  -0.11752
10  -0.00041  -0.00159  -0.06430   0.00514  -0.00022  -0.07127  -0.00164
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.03306   0.22244   0.01455  -0.03355   0.27260
5    0.03722   0.70570   0.14233  -0.39185   0.34347
10   0.00154   0.07757   0.00093   0.00533   0.11818

, , d_y1_d_x4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.06151  -0.00145  -0.00566   0.03029  -0.00332  -0.00497  -0.02944
5    0.04479  -0.03703  -0.02228  -0.15672   0.04185  -0.09940   0.23988
10  -0.00019  -0.00015  -0.00058   0.00191  -0.00029  -0.00133  -0.00068
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.00630   0.01455   0.02168   0.00225   0.00903
5   -0.10152   0.14233   0.53514  -0.00955  -0.14368
10   0.00016   0.00093   0.00053   0.00023   0.00102

, , d_y2_d_x4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.00682  -0.27766   0.00302   0.01718   0.00095   0.04030  -0.01482
5   -0.24224  -0.14850   0.18054   0.11149  -0.11320   0.25272   0.11584
10  -0.00015  -0.20179  -0.00145   0.00336  -0.12439  -0.00621  -0.00052
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.24045  -0.03355   0.00225   0.60443  -0.02045
5    0.00834  -0.39185  -0.00955   0.56422  -0.26203
10   0.15676   0.00533   0.00023   0.30340   0.01131

, , d_y3_d_x4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.02509   0.00286  -0.21024   0.04486   0.04408  -0.08972  -0.03375
5    0.13745   0.08718  -0.27740  -0.04115   0.10280  -0.15380  -0.10064
10  -0.00059  -0.00523  -0.10522   0.00793  -0.00270  -0.11694  -0.00231
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.03963   0.27260   0.00903  -0.02045   0.52204
5   -0.07611   0.34347  -0.14368  -0.26203   0.47936
10   0.00406   0.11818   0.00102   0.01131   0.21146

> round( drop( attr( margEffCondObsV, "vcov" )[ 1, , ] ), 5 )
          d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
d_y1_d_x1   0.26711  -0.00190   0.00124  -0.08987   0.01110   0.02327   0.08713
d_y2_d_x1  -0.00190   0.17067   0.00322  -0.00761  -0.01922  -0.01513   0.00731
d_y3_d_x1   0.00124   0.00322   0.11053  -0.02410  -0.01425   0.02281   0.01816
d_y1_d_x2  -0.08987  -0.00761  -0.02410   0.10986  -0.02228  -0.02627  -0.05818
d_y2_d_x2   0.01110  -0.01922  -0.01425  -0.02228   0.14733  -0.00810   0.00581
d_y3_d_x2   0.02327  -0.01513   0.02281  -0.02627  -0.00810   0.17061   0.00114
d_y1_d_x3   0.08713   0.00731   0.01816  -0.05818   0.00581   0.00114   0.05219
d_y2_d_x3  -0.01774  -0.11859   0.00936   0.01313   0.02950   0.04325  -0.01537
d_y3_d_x3  -0.04527   0.00833  -0.11258   0.01915   0.04223  -0.04572  -0.02564
d_y1_d_x4  -0.06151  -0.00145  -0.00566   0.03029  -0.00332  -0.00497  -0.02944
d_y2_d_x4  -0.00682  -0.27766   0.00302   0.01718   0.00095   0.04030  -0.01482
d_y3_d_x4  -0.02509   0.00286  -0.21024   0.04486   0.04408  -0.08972  -0.03375
          d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
d_y1_d_x1  -0.01774  -0.04527  -0.06151  -0.00682  -0.02509
d_y2_d_x1  -0.11859   0.00833  -0.00145  -0.27766   0.00286
d_y3_d_x1   0.00936  -0.11258  -0.00566   0.00302  -0.21024
d_y1_d_x2   0.01313   0.01915   0.03029   0.01718   0.04486
d_y2_d_x2   0.02950   0.04223  -0.00332   0.00095   0.04408
d_y3_d_x2   0.04325  -0.04572  -0.00497   0.04030  -0.08972
d_y1_d_x3  -0.01537  -0.02564  -0.02944  -0.01482  -0.03375
d_y2_d_x3   0.18708  -0.03306   0.00630   0.24045  -0.03963
d_y3_d_x3  -0.03306   0.22244   0.01455  -0.03355   0.27260
d_y1_d_x4   0.00630   0.01455   0.02168   0.00225   0.00903
d_y2_d_x4   0.24045  -0.03355   0.00225   0.60443  -0.02045
d_y3_d_x4  -0.03963   0.27260   0.00903  -0.02045   0.52204
> round( attr( margEffCondObsV, "jacobian" ), 5 )
, , b_1_0

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.23712  -0.00429  -0.00454  -0.16363   0.02125   0.05309   0.11546
5    0.27926   0.01310  -0.04265  -0.18347   0.00669  -0.05042   0.04650
10  -0.00475   0.00023   0.00202   0.04644  -0.00467  -0.02072  -0.01887
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.01760  -0.04924  -0.08099   0.00493   0.00394
5    0.02015   0.09162  -0.02611  -0.04055   0.03286
10   0.00138   0.00886   0.01439  -0.00009  -0.00115

, , b_1_1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.27605  -0.00917  -0.02165   0.00000   0.00000   0.00000   0.00000
5    0.43008  -0.06483  -0.09133  -0.18347   0.00669  -0.05042   0.04634
10   0.00003  -0.00001  -0.00008   0.00000   0.00000   0.00000   0.00000
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.00000   0.00000   0.00000   0.00000   0.00000
5    0.02062   0.09177  -0.02602  -0.04081   0.03277
10   0.00000   0.00000   0.00000   0.00000   0.00000

, , b_1_2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.23712  -0.00429  -0.00454   0.03893  -0.00488  -0.01711   0.11546
5    0.00000   0.00000   0.00000   0.24661  -0.05814  -0.14175   0.00000
10   0.00000   0.00000   0.00000   0.05122  -0.00491  -0.02282   0.00000
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    -0.0176  -0.04924  -0.08099   0.00493   0.00394
5     0.0000   0.00000   0.00000   0.00000   0.00000
10    0.0000   0.00000   0.00000   0.00000   0.00000

, , b_1_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.25320   0.00458   0.00485   0.17473  -0.02269  -0.05669  -0.08438
5   -0.17455  -0.00819   0.02666   0.11468  -0.00418   0.03151   0.40111
10  -0.00595   0.00029   0.00253   0.05823  -0.00585  -0.02597  -0.01926
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.01353   0.03560   0.08651  -0.00417  -0.00411
5   -0.07871  -0.15012   0.01643   0.02549  -0.02056
10   0.00147   0.00900   0.01719  -0.00007  -0.00213

, , b_1_4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.10112  -0.00183  -0.00194  -0.06978   0.00906   0.02264   0.04925
5    0.22943   0.01076  -0.03504  -0.15074   0.00550  -0.04142   0.03801
10   0.00181  -0.00009  -0.00077  -0.01767   0.00178   0.00788   0.00665
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.00724  -0.02118   0.00438  -0.00293  -0.01549
5    0.01790   0.07716   0.40839  -0.09805  -0.06478
10  -0.00054  -0.00406  -0.00059  -0.00024  -0.00166

, , b_2_0

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.00670  -0.20931  -0.01111   0.02360  -0.07428  -0.01969  -0.01379
5   -0.04682   0.06017   0.02412   0.01983  -0.11311   0.01952   0.02022
10   0.00015   0.21970   0.01078  -0.00349   0.13274   0.01050   0.00103
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.24437   0.02653   0.00347   0.31739   0.02637
5    0.05338  -0.03731   0.03204   0.06253  -0.03699
10  -0.22648  -0.01033  -0.00013  -0.30221  -0.01217

, , b_2_1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.01020   0.11934   0.00357   0.00000   0.00000   0.00000   0.00000
5   -0.06152   0.40580   0.03474   0.01983  -0.11311   0.01952   0.02009
10   0.00000   0.34692   0.01437   0.00000   0.00000   0.00000   0.00000
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.00000   0.00000   0.00000   0.00000   0.00000
5    0.05351  -0.03731   0.03186   0.06271  -0.03699
10   0.00000   0.00000   0.00000   0.00000   0.00000

, , b_2_2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    -0.0067  -0.20931  -0.01111  -0.00349   0.32865   0.01467  -0.01379
5     0.0000   0.00000   0.00000  -0.04169   0.29269   0.05426   0.00000
10    0.0000   0.00000   0.00000  -0.00364   0.25996   0.01409   0.00000
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.24437   0.02653   0.00347   0.31739   0.02637
5    0.00000   0.00000   0.00000   0.00000   0.00000
10   0.00000   0.00000   0.00000   0.00000   0.00000

, , b_2_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.00716   0.22350   0.01186  -0.02520   0.07932   0.02103   0.01123
5    0.02926  -0.03761  -0.01508  -0.01239   0.07070  -0.01220  -0.07471
10   0.00019   0.27547   0.01351  -0.00437   0.16643   0.01316   0.00019
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.06788  -0.01381   -0.0037  -0.33893  -0.02807
5    0.37237   0.05801   -0.0199  -0.03886   0.02274
10  -0.15655  -0.01002   -0.0004  -0.37869  -0.01537

, , b_2_4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.00286  -0.08926  -0.00474   0.01006  -0.03168  -0.00840   -0.0059
5   -0.03846   0.04944   0.01982   0.01629  -0.09293   0.01604    0.0169
10  -0.00006  -0.08359  -0.00410   0.00133  -0.05050  -0.00399   -0.0003
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.10462   0.01126  -0.00203   0.46432   0.02570
5    0.04392  -0.03086  -0.03549   0.45714   0.00366
10   0.08609   0.00367   0.00007   0.24212   0.00834

, , b_3_0

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.02326  -0.01102  -0.15915   0.04569  -0.01558  -0.12588  -0.02863
5   -0.07395  -0.00731   0.22130   0.06229  -0.01369   0.05969  -0.03524
10   0.00082   0.01147   0.13120  -0.01095   0.00965   0.15417   0.00396
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.02497   0.24263   0.01171   0.02456   0.28566
5    0.00396  -0.14778  -0.03348   0.03184  -0.25575
10  -0.01008  -0.21642  -0.00191  -0.01215  -0.23932

, , b_3_1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.03173   0.00376   0.10064   0.00000   0.00000   0.00000    0.0000
5   -0.12452   0.04892   0.36505   0.06229  -0.01369   0.05969   -0.0353
10   0.00000   0.01493   0.27254   0.00000   0.00000   0.00000    0.0000
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.00000   0.00000   0.00000   0.00000   0.00000
5    0.00396  -0.14794  -0.03355   0.03184  -0.25566
10   0.00000   0.00000   0.00000   0.00000   0.00000

, , b_3_2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.02326  -0.01102  -0.15915  -0.00847   0.01478   0.25979  -0.02862
5    0.00000   0.00000   0.00000  -0.06223   0.03523   0.42473   0.00000
10   0.00000   0.00000   0.00000  -0.01177   0.01312   0.29552   0.00000
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.02466   0.24263    0.0117   0.02474   0.28566
5    0.00000   0.00000    0.0000   0.00000   0.00000
10   0.00000   0.00000    0.0000   0.00000   0.00000

, , b_3_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.02483   0.01176   0.16995  -0.04879   0.01664   0.13442   0.02210
5    0.04622   0.00457  -0.13832  -0.03894   0.00856  -0.03731  -0.10210
10   0.00103   0.01438   0.16450  -0.01372   0.01210   0.19330   0.00306
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.01119   0.00085  -0.01253  -0.02571  -0.30488
5    0.04594   0.45736   0.02078  -0.02043   0.16036
10  -0.00917  -0.13109  -0.00222  -0.01528  -0.30034

, , b_3_4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.00992  -0.00470  -0.06787   0.01948  -0.00664  -0.05368  -0.01222
5   -0.06075  -0.00601   0.18182   0.05118  -0.01125   0.04904  -0.02927
10  -0.00031  -0.00436  -0.04992   0.00416  -0.00367  -0.05866  -0.00160
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.01023   0.10332  -0.00348   0.02477   0.38150
5    0.00316  -0.12057  -0.15243   0.07508   0.15561
10   0.00389   0.08186  -0.00047   0.00815   0.23216

, , R_1_2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1    0.01196  -0.01747   0.00247  -0.10750   0.06024   0.05743   0.04467
5   -0.26275  -0.31026   0.05436   0.00082   0.14116   0.16573   0.36037
10   0.00030  -0.00014   0.00001  -0.00794   0.00627   0.00587   0.00205
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.02920  -0.03143  -0.00246   0.00719  -0.00812
5   -0.35411  -0.20290   0.36553   0.28639  -0.10569
10  -0.00104   0.00004   0.00004   0.00007  -0.00053

, , R_1_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.03037  -0.00286  -0.04604   0.16797  -0.01478   0.11986  -0.10555
5   -0.13515  -0.15223  -0.00830   0.21839  -0.00455   0.33427  -0.17428
10  -0.00310   0.00013  -0.00288   0.04100  -0.00329   0.03257  -0.01364
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1    0.01169  -0.08223   0.02381   0.00235   0.03042
5   -0.03336  -0.40430  -0.44755   0.17280   0.09166
10   0.00093  -0.01227   0.00440   0.00025   0.00457

, , R_2_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1   -0.00041   0.10004  -0.11475   0.01342   0.14424  -0.20173  -0.00506
5    0.10956   0.19147  -0.23512  -0.04746   0.19609  -0.26047  -0.06343
10  -0.00005   0.10664  -0.12692   0.00057   0.08874  -0.08387  -0.00046
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1   -0.22089   0.27925  -0.00020  -0.26432   0.34092
5   -0.23671   0.42570  -0.05653  -0.46083   0.51870
10  -0.08058   0.07938   0.00031  -0.09793   0.09797

> round( drop( attr( margEffCondObsV, "jacobian" )[ 1, , ] ), 5 )
             b_1_0    b_1_1    b_1_2    b_1_3    b_1_4    b_2_0    b_2_1
d_y1_d_x1  0.23712  0.27605  0.23712 -0.25320  0.10112 -0.00670 -0.01020
d_y2_d_x1 -0.00429 -0.00917 -0.00429  0.00458 -0.00183 -0.20931  0.11934
d_y3_d_x1 -0.00454 -0.02165 -0.00454  0.00485 -0.00194 -0.01111  0.00357
d_y1_d_x2 -0.16363  0.00000  0.03893  0.17473 -0.06978  0.02360  0.00000
d_y2_d_x2  0.02125  0.00000 -0.00488 -0.02269  0.00906 -0.07428  0.00000
d_y3_d_x2  0.05309  0.00000 -0.01711 -0.05669  0.02264 -0.01969  0.00000
d_y1_d_x3  0.11546  0.00000  0.11546 -0.08438  0.04925 -0.01379  0.00000
d_y2_d_x3 -0.01760  0.00000 -0.01760  0.01353 -0.00724  0.24437  0.00000
d_y3_d_x3 -0.04924  0.00000 -0.04924  0.03560 -0.02118  0.02653  0.00000
d_y1_d_x4 -0.08099  0.00000 -0.08099  0.08651  0.00438  0.00347  0.00000
d_y2_d_x4  0.00493  0.00000  0.00493 -0.00417 -0.00293  0.31739  0.00000
d_y3_d_x4  0.00394  0.00000  0.00394 -0.00411 -0.01549  0.02637  0.00000
             b_2_2    b_2_3    b_2_4    b_3_0    b_3_1    b_3_2    b_3_3
d_y1_d_x1 -0.00670  0.00716 -0.00286 -0.02326 -0.03173 -0.02326  0.02483
d_y2_d_x1 -0.20931  0.22350 -0.08926 -0.01102  0.00376 -0.01102  0.01176
d_y3_d_x1 -0.01111  0.01186 -0.00474 -0.15915  0.10064 -0.15915  0.16995
d_y1_d_x2 -0.00349 -0.02520  0.01006  0.04569  0.00000 -0.00847 -0.04879
d_y2_d_x2  0.32865  0.07932 -0.03168 -0.01558  0.00000  0.01478  0.01664
d_y3_d_x2  0.01467  0.02103 -0.00840 -0.12588  0.00000  0.25979  0.13442
d_y1_d_x3 -0.01379  0.01123 -0.00590 -0.02863  0.00000 -0.02862  0.02210
d_y2_d_x3  0.24437  0.06788  0.10462  0.02497  0.00000  0.02466 -0.01119
d_y3_d_x3  0.02653 -0.01381  0.01126  0.24263  0.00000  0.24263  0.00085
d_y1_d_x4  0.00347 -0.00370 -0.00203  0.01171  0.00000  0.01170 -0.01253
d_y2_d_x4  0.31739 -0.33893  0.46432  0.02456  0.00000  0.02474 -0.02571
d_y3_d_x4  0.02637 -0.02807  0.02570  0.28566  0.00000  0.28566 -0.30488
             b_3_4    R_1_2    R_1_3    R_2_3
d_y1_d_x1 -0.00992  0.01196 -0.03037 -0.00041
d_y2_d_x1 -0.00470 -0.01747 -0.00286  0.10004
d_y3_d_x1 -0.06787  0.00247 -0.04604 -0.11475
d_y1_d_x2  0.01948 -0.10750  0.16797  0.01342
d_y2_d_x2 -0.00664  0.06024 -0.01478  0.14424
d_y3_d_x2 -0.05368  0.05743  0.11986 -0.20173
d_y1_d_x3 -0.01222  0.04467 -0.10555 -0.00506
d_y2_d_x3  0.01023 -0.02920  0.01169 -0.22089
d_y3_d_x3  0.10332 -0.03143 -0.08223  0.27925
d_y1_d_x4 -0.00348 -0.00246  0.02381 -0.00020
d_y2_d_x4  0.02477  0.00719  0.00235 -0.26432
d_y3_d_x4  0.38150 -0.00812  0.03042  0.34092
> print( summary( margEffCondObsV ), digits = 3 )
             Estimate Std. error z value Pr(> z)
1: d_y1_d_x1  0.17200    0.51683    0.33    0.74
1: d_y2_d_x1  0.20542    0.41312    0.50    0.62
1: d_y3_d_x1 -0.12684    0.33246   -0.38    0.70
1: d_y1_d_x2 -0.09566    0.33145   -0.29    0.77
1: d_y2_d_x2  0.22332    0.38384    0.58    0.56
1: d_y3_d_x2 -0.17476    0.41304   -0.42    0.67
1: d_y1_d_x3  0.04937    0.22845    0.22    0.83
1: d_y2_d_x3 -0.38496    0.43253   -0.89    0.37
1: d_y3_d_x3  0.24421    0.47164    0.52    0.60
1: d_y1_d_x4 -0.03571    0.14724   -0.24    0.81
1: d_y2_d_x4 -0.50421    0.77745   -0.65    0.52
1: d_y3_d_x4  0.30197    0.72252    0.42    0.68
2: d_y1_d_x1  0.39598    0.69317    0.57    0.57
2: d_y2_d_x1  0.26512    0.57906    0.46    0.65
2: d_y3_d_x1 -0.22406    0.55429   -0.40    0.69
2: d_y1_d_x2 -0.32295    0.48236   -0.67    0.50
2: d_y2_d_x2  0.25167    0.43431    0.58    0.56
2: d_y3_d_x2 -0.13425    0.65603   -0.20    0.84
2: d_y1_d_x3  0.53896    0.59275    0.91    0.36
2: d_y2_d_x3 -0.52391    0.58167   -0.90    0.37
2: d_y3_d_x3  0.23199    0.84006    0.28    0.78
2: d_y1_d_x4 -0.39507    0.73153   -0.54    0.59
2: d_y2_d_x4 -0.53871    0.75115   -0.72    0.47
2: d_y3_d_x4  0.45553    0.69236    0.66    0.51
3: d_y1_d_x1  0.00139    0.00853    0.16    0.87
3: d_y2_d_x1  0.23197    0.51327    0.45    0.65
3: d_y3_d_x1 -0.11609    0.37107   -0.31    0.75
3: d_y1_d_x2 -0.01857    0.10363   -0.18    0.86
3: d_y2_d_x2  0.11099    0.35196    0.32    0.75
3: d_y3_d_x2 -0.13782    0.40276   -0.34    0.73
3: d_y1_d_x3  0.00597    0.03147    0.19    0.85
3: d_y2_d_x3 -0.14919    0.29985   -0.50    0.62
3: d_y3_d_x3  0.14823    0.27851    0.53    0.59
3: d_y1_d_x4 -0.00457    0.02305   -0.20    0.84
3: d_y2_d_x4 -0.19920    0.55082   -0.36    0.72
3: d_y3_d_x4  0.16555    0.45984    0.36    0.72
> margEffCondObsVA <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, vcov = diag( 18 ), returnJacobian = TRUE,
+    algorithm = GenzBretz() )
> all.equal( margEffCondObs, margEffCondObsA )
[1] TRUE
> # now with Jacobian but without variance covariance matrix
> margEffCondObsJac <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, 
+    data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, returnJacobian = TRUE, algorithm = GenzBretz() )
> all.equal( attr( margEffCondObsJac, "jacobian" ), 
+    attr( margEffCondObsV, "jacobian" ) )
[1] TRUE
> # now with mean values of marginal effects
> margEffCondObsM <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, 
+    data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, vcov = diag( 18 ), addMean = TRUE, returnJacobian = TRUE,
+    algorithm = GenzBretz() )
> all.equal( margEffCondObsV, margEffCondObsM[ 1:3, ], check.attributes = FALSE )
[1] TRUE
> round( margEffCondObsM, 4 )
     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.1720    0.2054   -0.1268   -0.0957    0.2233   -0.1748    0.0494
2       0.3960    0.2651   -0.2241   -0.3230    0.2517   -0.1343    0.5390
3       0.0014    0.2320   -0.1161   -0.0186    0.1110   -0.1378    0.0060
mean    0.1898    0.2342   -0.1557   -0.1457    0.1953   -0.1489    0.1981
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.3850    0.2442   -0.0357   -0.5042    0.3020
2      -0.5239    0.2320   -0.3951   -0.5387    0.4555
3      -0.1492    0.1482   -0.0046   -0.1992    0.1655
mean   -0.3527    0.2081   -0.1451   -0.4140    0.3077
> all.equal( attr( margEffCondObsV, "vcov" ), 
+    attr( margEffCondObsM, "vcov" )[ 1:3, , ] )
[1] TRUE
> round( attr( margEffCondObsM, "vcov" ), 5 )
, , d_y1_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.26711  -0.00190   0.00124  -0.08987   0.01110   0.02327   0.08713
5      0.48048   0.06699  -0.18654  -0.24009   0.01344  -0.18766  -0.10741
10     0.00007   0.00010   0.00028  -0.00075   0.00014   0.00052   0.00027
mean   0.14154   0.00646  -0.03485  -0.05735   0.00550  -0.03171  -0.00217
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.01774  -0.04527  -0.06151  -0.00682  -0.02509
5      0.10851   0.32829   0.04479  -0.24224   0.13745
10    -0.00010  -0.00041  -0.00019  -0.00015  -0.00059
mean   0.00816   0.04716  -0.00125  -0.04336   0.01185

, , d_y2_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.00190   0.17067   0.00322  -0.00761  -0.01922  -0.01513   0.00731
5      0.06699   0.33531  -0.02424  -0.02304  -0.06623  -0.13791  -0.09144
10     0.00010   0.26345   0.00604  -0.00233   0.08899   0.00212   0.00034
mean   0.00646   0.14878  -0.00926  -0.00312  -0.00143  -0.03899  -0.01458
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.11859   0.00833  -0.00145  -0.27766   0.00286
5      0.08284   0.17888  -0.03703  -0.14850   0.08718
10    -0.10893  -0.00159  -0.00015  -0.20179  -0.00523
mean   0.00186   0.04850  -0.00538  -0.10559   0.03317

, , d_y3_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.00124   0.00322   0.11053  -0.02410  -0.01425   0.02281   0.01816
5     -0.18654  -0.02424   0.30724   0.09521  -0.06042   0.12725   0.02986
10     0.00028   0.00604   0.13769  -0.00394  -0.00395   0.06570   0.00112
mean  -0.03485  -0.00926   0.10058   0.01153  -0.02538   0.02335   0.00190
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.00936  -0.11258  -0.00566   0.00302  -0.21024
5      0.02616  -0.30234  -0.02228   0.18054  -0.27740
10     0.00230  -0.06430  -0.00058  -0.00145  -0.10522
mean   0.02745  -0.05360   0.00326   0.04883  -0.08764

, , d_y1_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.08987  -0.00761  -0.02410   0.10986  -0.02228  -0.02627  -0.05818
5     -0.24009  -0.02304   0.09521   0.23267  -0.05217   0.06279  -0.01144
10    -0.00075  -0.00233  -0.00394   0.01074  -0.00362  -0.01076  -0.00279
mean  -0.05735  -0.00312   0.01153   0.07276  -0.01924   0.00350  -0.01090
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.01313   0.01915   0.03029   0.01718   0.04486
5     -0.01846  -0.21626  -0.15672   0.11149  -0.04115
10     0.00200   0.00514   0.00191   0.00336   0.00793
mean   0.00034  -0.04273  -0.03176   0.02129   0.00798

, , d_y2_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.01110  -0.01922  -0.01425  -0.02228   0.14733  -0.00810   0.00581
5      0.01344  -0.06623  -0.06042  -0.05217   0.18862  -0.00043   0.02739
10     0.00014   0.08899  -0.00395  -0.00362   0.12388   0.00823   0.00050
mean   0.00550  -0.00143  -0.02538  -0.01924   0.12933  -0.00405   0.00115
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.02950   0.04223  -0.00332   0.00095   0.04408
5     -0.08515   0.08368   0.04185  -0.11320   0.10280
10    -0.06786  -0.00022  -0.00029  -0.12439  -0.00270
mean  -0.00564   0.04239   0.00760  -0.05323   0.04362

, , d_y3_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.02327  -0.01513   0.02281  -0.02627  -0.00810   0.17061   0.00114
5     -0.18766  -0.13791   0.12725   0.06279  -0.00043   0.43037   0.02450
10     0.00052   0.00212   0.06570  -0.01076   0.00823   0.16222   0.00186
mean  -0.03171  -0.03899   0.02335   0.00350  -0.00405   0.18824  -0.01235
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.04325  -0.04572  -0.00497   0.04030  -0.08972
5     -0.01629  -0.34012  -0.09940   0.25272  -0.15380
10    -0.00163  -0.07127  -0.00133  -0.00621  -0.11694
mean   0.02917  -0.04504  -0.00705   0.06947  -0.04654

, , d_y1_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.08713   0.00731   0.01816  -0.05818   0.00581   0.00114   0.05219
5     -0.10741  -0.09144   0.02986  -0.01144   0.02739   0.02450   0.35135
10     0.00027   0.00034   0.00112  -0.00279   0.00050   0.00186   0.00099
mean  -0.00217  -0.01458   0.00190  -0.01090   0.00115  -0.01235   0.04534
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.01537  -0.02564  -0.02944  -0.01482  -0.03375
5     -0.16576  -0.11752   0.23988   0.11584  -0.10064
10    -0.00040  -0.00164  -0.00068  -0.00052  -0.00231
mean  -0.01708  -0.00552   0.03732   0.01873  -0.01594

, , d_y2_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.01774  -0.11859   0.00936   0.01313   0.02950   0.04325  -0.01537
5      0.10851   0.08284   0.02616  -0.01846  -0.08515  -0.01629  -0.16576
10    -0.00010  -0.10893   0.00230   0.00200  -0.06786  -0.00163  -0.00040
mean   0.00816   0.00186   0.02745   0.00034  -0.00564   0.02917  -0.01708
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.18708  -0.03306   0.00630   0.24045  -0.03963
5      0.33834   0.03722  -0.10152   0.00834  -0.07611
10     0.08991   0.00154   0.00016   0.15676   0.00406
mean   0.07198  -0.03222  -0.01298   0.05219  -0.05140

, , d_y3_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.04527   0.00833  -0.11258   0.01915   0.04223  -0.04572  -0.02564
5      0.32829   0.17888  -0.30234  -0.21626   0.08368  -0.34012  -0.11752
10    -0.00041  -0.00159  -0.06430   0.00514  -0.00022  -0.07127  -0.00164
mean   0.04716   0.04850  -0.05360  -0.04273   0.04239  -0.04504  -0.00552
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.03306   0.22244   0.01455  -0.03355   0.27260
5      0.03722   0.70570   0.14233  -0.39185   0.34347
10     0.00154   0.07757   0.00093   0.00533   0.11818
mean  -0.03222   0.12854   0.00954  -0.09693   0.08399

, , d_y1_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.06151  -0.00145  -0.00566   0.03029  -0.00332  -0.00497  -0.02944
5      0.04479  -0.03703  -0.02228  -0.15672   0.04185  -0.09940   0.23988
10    -0.00019  -0.00015  -0.00058   0.00191  -0.00029  -0.00133  -0.00068
mean  -0.00125  -0.00538   0.00326  -0.03176   0.00760  -0.00705   0.03732
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.00630   0.01455   0.02168   0.00225   0.00903
5     -0.10152   0.14233   0.53514  -0.00955  -0.14368
10     0.00016   0.00093   0.00053   0.00023   0.00102
mean  -0.01298   0.00954   0.06018   0.00063  -0.03323

, , d_y2_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.00682  -0.27766   0.00302   0.01718   0.00095   0.04030  -0.01482
5     -0.24224  -0.14850   0.18054   0.11149  -0.11320   0.25272   0.11584
10    -0.00015  -0.20179  -0.00145   0.00336  -0.12439  -0.00621  -0.00052
mean  -0.04336  -0.10559   0.04883   0.02129  -0.05323   0.06947   0.01873
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.24045  -0.03355   0.00225   0.60443  -0.02045
5      0.00834  -0.39185  -0.00955   0.56422  -0.26203
10     0.15676   0.00533   0.00023   0.30340   0.01131
mean   0.05219  -0.09693   0.00063   0.31822  -0.07006

, , d_y3_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.02509   0.00286  -0.21024   0.04486   0.04408  -0.08972  -0.03375
5      0.13745   0.08718  -0.27740  -0.04115   0.10280  -0.15380  -0.10064
10    -0.00059  -0.00523  -0.10522   0.00793  -0.00270  -0.11694  -0.00231
mean   0.01185   0.03317  -0.08764   0.00798   0.04362  -0.04654  -0.01594
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.03963   0.27260   0.00903  -0.02045   0.52204
5     -0.07611   0.34347  -0.14368  -0.26203   0.47936
10     0.00406   0.11818   0.00102   0.01131   0.21146
mean  -0.05140   0.08399  -0.03323  -0.07006   0.21564

> round( drop( attr( margEffCondObsM, "vcov" )[ 4, , ] ), 5 )
          d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
d_y1_d_x1   0.14154   0.00646  -0.03485  -0.05735   0.00550  -0.03171  -0.00217
d_y2_d_x1   0.00646   0.14878  -0.00926  -0.00312  -0.00143  -0.03899  -0.01458
d_y3_d_x1  -0.03485  -0.00926   0.10058   0.01153  -0.02538   0.02335   0.00190
d_y1_d_x2  -0.05735  -0.00312   0.01153   0.07276  -0.01924   0.00350  -0.01090
d_y2_d_x2   0.00550  -0.00143  -0.02538  -0.01924   0.12933  -0.00405   0.00115
d_y3_d_x2  -0.03171  -0.03899   0.02335   0.00350  -0.00405   0.18824  -0.01235
d_y1_d_x3  -0.00217  -0.01458   0.00190  -0.01090   0.00115  -0.01235   0.04534
d_y2_d_x3   0.00816   0.00186   0.02745   0.00034  -0.00564   0.02917  -0.01708
d_y3_d_x3   0.04716   0.04850  -0.05360  -0.04273   0.04239  -0.04504  -0.00552
d_y1_d_x4  -0.00125  -0.00538   0.00326  -0.03176   0.00760  -0.00705   0.03732
d_y2_d_x4  -0.04336  -0.10559   0.04883   0.02129  -0.05323   0.06947   0.01873
d_y3_d_x4   0.01185   0.03317  -0.08764   0.00798   0.04362  -0.04654  -0.01594
          d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
d_y1_d_x1   0.00816   0.04716  -0.00125  -0.04336   0.01185
d_y2_d_x1   0.00186   0.04850  -0.00538  -0.10559   0.03317
d_y3_d_x1   0.02745  -0.05360   0.00326   0.04883  -0.08764
d_y1_d_x2   0.00034  -0.04273  -0.03176   0.02129   0.00798
d_y2_d_x2  -0.00564   0.04239   0.00760  -0.05323   0.04362
d_y3_d_x2   0.02917  -0.04504  -0.00705   0.06947  -0.04654
d_y1_d_x3  -0.01708  -0.00552   0.03732   0.01873  -0.01594
d_y2_d_x3   0.07198  -0.03222  -0.01298   0.05219  -0.05140
d_y3_d_x3  -0.03222   0.12854   0.00954  -0.09693   0.08399
d_y1_d_x4  -0.01298   0.00954   0.06018   0.00063  -0.03323
d_y2_d_x4   0.05219  -0.09693   0.00063   0.31822  -0.07006
d_y3_d_x4  -0.05140   0.08399  -0.03323  -0.07006   0.21564
> all.equal( attr( margEffCondObsV, "jacobian" ), 
+    attr( margEffCondObsM, "jacobian" )[ 1:3, , ] )
[1] TRUE
> round( attr( margEffCondObsM, "jacobian" ), 5 )
, , b_1_0

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.23712  -0.00429  -0.00454  -0.16363   0.02125   0.05309   0.11546
5      0.27926   0.01310  -0.04265  -0.18347   0.00669  -0.05042   0.04650
10    -0.00475   0.00023   0.00202   0.04644  -0.00467  -0.02072  -0.01887
mean   0.17054   0.00301  -0.01506  -0.10022   0.00776  -0.00601   0.04770
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.01760  -0.04924  -0.08099   0.00493   0.00394
5      0.02015   0.09162  -0.02611  -0.04055   0.03286
10     0.00138   0.00886   0.01439  -0.00009  -0.00115
mean   0.00131   0.01708  -0.03090  -0.01190   0.01188

, , b_1_1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.27605  -0.00917  -0.02165   0.00000   0.00000   0.00000   0.00000
5      0.43008  -0.06483  -0.09133  -0.18347   0.00669  -0.05042   0.04634
10     0.00003  -0.00001  -0.00008   0.00000   0.00000   0.00000   0.00000
mean   0.23539  -0.02467  -0.03769  -0.06116   0.00223  -0.01681   0.01545
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.00000   0.00000   0.00000   0.00000   0.00000
5      0.02062   0.09177  -0.02602  -0.04081   0.03277
10     0.00000   0.00000   0.00000   0.00000   0.00000
mean   0.00687   0.03059  -0.00867  -0.01360   0.01092

, , b_1_2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.23712  -0.00429  -0.00454   0.03893  -0.00488  -0.01711   0.11546
5      0.00000   0.00000   0.00000   0.24661  -0.05814  -0.14175   0.00000
10     0.00000   0.00000   0.00000   0.05122  -0.00491  -0.02282   0.00000
mean   0.07904  -0.00143  -0.00151   0.11225  -0.02264  -0.06056   0.03849
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.01760  -0.04924  -0.08099   0.00493   0.00394
5      0.00000   0.00000   0.00000   0.00000   0.00000
10     0.00000   0.00000   0.00000   0.00000   0.00000
mean  -0.00587  -0.01641  -0.02700   0.00164   0.00131

, , b_1_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.25320   0.00458   0.00485   0.17473  -0.02269  -0.05669  -0.08438
5     -0.17455  -0.00819   0.02666   0.11468  -0.00418   0.03151   0.40111
10    -0.00595   0.00029   0.00253   0.05823  -0.00585  -0.02597  -0.01926
mean  -0.14457  -0.00110   0.01135   0.11588  -0.01091  -0.01705   0.09916
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.01353   0.03560   0.08651  -0.00417  -0.00411
5     -0.07871  -0.15012   0.01643   0.02549  -0.02056
10     0.00147   0.00900   0.01719  -0.00007  -0.00213
mean  -0.02124  -0.03517   0.04004   0.00708  -0.00893

, , b_1_4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.10112  -0.00183  -0.00194  -0.06978   0.00906   0.02264   0.04925
5      0.22943   0.01076  -0.03504  -0.15074   0.00550  -0.04142   0.03801
10     0.00181  -0.00009  -0.00077  -0.01767   0.00178   0.00788   0.00665
mean   0.11079   0.00295  -0.01258  -0.07940   0.00544  -0.00363   0.03130
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.00724  -0.02118   0.00438  -0.00293  -0.01549
5      0.01790   0.07716   0.40839  -0.09805  -0.06478
10    -0.00054  -0.00406  -0.00059  -0.00024  -0.00166
mean   0.00337   0.01731   0.13739  -0.03374  -0.02731

, , b_2_0

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.00670  -0.20931  -0.01111   0.02360  -0.07428  -0.01969  -0.01379
5     -0.04682   0.06017   0.02412   0.01983  -0.11311   0.01952   0.02022
10     0.00015   0.21970   0.01078  -0.00349   0.13274   0.01050   0.00103
mean  -0.01779   0.02352   0.00793   0.01331  -0.01822   0.00344   0.00249
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.24437   0.02653   0.00347   0.31739   0.02637
5      0.05338  -0.03731   0.03204   0.06253  -0.03699
10    -0.22648  -0.01033  -0.00013  -0.30221  -0.01217
mean   0.02376  -0.00704   0.01179   0.02590  -0.00760

, , b_2_1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.01020   0.11934   0.00357   0.00000   0.00000   0.00000   0.00000
5     -0.06152   0.40580   0.03474   0.01983  -0.11311   0.01952   0.02009
10     0.00000   0.34692   0.01437   0.00000   0.00000   0.00000   0.00000
mean  -0.02391   0.29069   0.01756   0.00661  -0.03770   0.00651   0.00670
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.00000   0.00000   0.00000   0.00000   0.00000
5      0.05351  -0.03731   0.03186   0.06271  -0.03699
10     0.00000   0.00000   0.00000   0.00000   0.00000
mean   0.01784  -0.01244   0.01062   0.02090  -0.01233

, , b_2_2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.00670  -0.20931  -0.01111  -0.00349   0.32865   0.01467  -0.01379
5      0.00000   0.00000   0.00000  -0.04169   0.29269   0.05426   0.00000
10     0.00000   0.00000   0.00000  -0.00364   0.25996   0.01409   0.00000
mean  -0.00223  -0.06977  -0.00370  -0.01627   0.29377   0.02768  -0.00460
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.24437   0.02653   0.00347   0.31739   0.02637
5      0.00000   0.00000   0.00000   0.00000   0.00000
10     0.00000   0.00000   0.00000   0.00000   0.00000
mean   0.08146   0.00884   0.00116   0.10580   0.00879

, , b_2_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.00716   0.22350   0.01186  -0.02520   0.07932   0.02103   0.01123
5      0.02926  -0.03761  -0.01508  -0.01239   0.07070  -0.01220  -0.07471
10     0.00019   0.27547   0.01351  -0.00437   0.16643   0.01316   0.00019
mean   0.01220   0.15379   0.00343  -0.01399   0.10548   0.00733  -0.02109
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.06788  -0.01381   -0.0037  -0.33893  -0.02807
5      0.37237   0.05801   -0.0199  -0.03886   0.02274
10    -0.15655  -0.01002   -0.0004  -0.37869  -0.01537
mean   0.09457   0.01139   -0.0080  -0.25216  -0.00690

, , b_2_4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.00286  -0.08926  -0.00474   0.01006  -0.03168  -0.00840  -0.00590
5     -0.03846   0.04944   0.01982   0.01629  -0.09293   0.01604   0.01690
10    -0.00006  -0.08359  -0.00410   0.00133  -0.05050  -0.00399  -0.00030
mean  -0.01379  -0.04114   0.00366   0.00923  -0.05837   0.00121   0.00357
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.10462   0.01126  -0.00203   0.46432   0.02570
5      0.04392  -0.03086  -0.03549   0.45714   0.00366
10     0.08609   0.00367   0.00007   0.24212   0.00834
mean   0.07821  -0.00531  -0.01248   0.38786   0.01257

, , b_3_0

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.02326  -0.01102  -0.15915   0.04569  -0.01558  -0.12588  -0.02863
5     -0.07395  -0.00731   0.22130   0.06229  -0.01369   0.05969  -0.03524
10     0.00082   0.01147   0.13120  -0.01095   0.00965   0.15417   0.00396
mean  -0.03213  -0.00229   0.06445   0.03235  -0.00654   0.02933  -0.01997
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.02497   0.24263   0.01171   0.02456   0.28566
5      0.00396  -0.14778  -0.03348   0.03184  -0.25575
10    -0.01008  -0.21642  -0.00191  -0.01215  -0.23932
mean   0.00629  -0.04052  -0.00789   0.01475  -0.06980

, , b_3_1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.03173   0.00376   0.10064   0.00000   0.00000   0.00000   0.00000
5     -0.12452   0.04892   0.36505   0.06229  -0.01369   0.05969  -0.03530
10     0.00000   0.01493   0.27254   0.00000   0.00000   0.00000   0.00000
mean  -0.05208   0.02254   0.24608   0.02076  -0.00456   0.01990  -0.01177
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.00000   0.00000   0.00000   0.00000   0.00000
5      0.00396  -0.14794  -0.03355   0.03184  -0.25566
10     0.00000   0.00000   0.00000   0.00000   0.00000
mean   0.00132  -0.04931  -0.01118   0.01061  -0.08522

, , b_3_2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.02326  -0.01102  -0.15915  -0.00847   0.01478   0.25979  -0.02862
5      0.00000   0.00000   0.00000  -0.06223   0.03523   0.42473   0.00000
10     0.00000   0.00000   0.00000  -0.01177   0.01312   0.29552   0.00000
mean  -0.00775  -0.00367  -0.05305  -0.02749   0.02104   0.32668  -0.00954
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.02466   0.24263    0.0117   0.02474   0.28566
5      0.00000   0.00000    0.0000   0.00000   0.00000
10     0.00000   0.00000    0.0000   0.00000   0.00000
mean   0.00822   0.08088    0.0039   0.00825   0.09522

, , b_3_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.02483   0.01176   0.16995  -0.04879   0.01664   0.13442   0.02210
5      0.04622   0.00457  -0.13832  -0.03894   0.00856  -0.03731  -0.10210
10     0.00103   0.01438   0.16450  -0.01372   0.01210   0.19330   0.00306
mean   0.02403   0.01024   0.06537  -0.03382   0.01243   0.09681  -0.02564
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.01119   0.00085  -0.01253  -0.02571  -0.30488
5      0.04594   0.45736   0.02078  -0.02043   0.16036
10    -0.00917  -0.13109  -0.00222  -0.01528  -0.30034
mean   0.00853   0.10904   0.00201  -0.02047  -0.14829

, , b_3_4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.00992  -0.00470  -0.06787   0.01948  -0.00664  -0.05368  -0.01222
5     -0.06075  -0.00601   0.18182   0.05118  -0.01125   0.04904  -0.02927
10    -0.00031  -0.00436  -0.04992   0.00416  -0.00367  -0.05866  -0.00160
mean  -0.02366  -0.00502   0.02134   0.02494  -0.00719  -0.02110  -0.01436
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.01023   0.10332  -0.00348   0.02477   0.38150
5      0.00316  -0.12057  -0.15243   0.07508   0.15561
10     0.00389   0.08186  -0.00047   0.00815   0.23216
mean   0.00576   0.02154  -0.05213   0.03600   0.25642

, , R_1_2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.01196  -0.01747   0.00247  -0.10750   0.06024   0.05743   0.04467
5     -0.26275  -0.31026   0.05436   0.00082   0.14116   0.16573   0.36037
10     0.00030  -0.00014   0.00001  -0.00794   0.00627   0.00587   0.00205
mean  -0.08350  -0.10929   0.01895  -0.03821   0.06922   0.07634   0.13570
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.02920  -0.03143  -0.00246   0.00719  -0.00812
5     -0.35411  -0.20290   0.36553   0.28639  -0.10569
10    -0.00104   0.00004   0.00004   0.00007  -0.00053
mean  -0.12811  -0.07810   0.12104   0.09788  -0.03811

, , R_1_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.03037  -0.00286  -0.04604   0.16797  -0.01478   0.11986  -0.10555
5     -0.13515  -0.15223  -0.00830   0.21839  -0.00455   0.33427  -0.17428
10    -0.00310   0.00013  -0.00288   0.04100  -0.00329   0.03257  -0.01364
mean  -0.05621  -0.05165  -0.01907   0.14245  -0.00754   0.16224  -0.09782
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.01169  -0.08223   0.02381   0.00235   0.03042
5     -0.03336  -0.40430  -0.44755   0.17280   0.09166
10     0.00093  -0.01227   0.00440   0.00025   0.00457
mean  -0.00691  -0.16627  -0.13978   0.05847   0.04222

, , R_2_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.00041   0.10004  -0.11475   0.01342   0.14424  -0.20173  -0.00506
5      0.10956   0.19147  -0.23512  -0.04746   0.19609  -0.26047  -0.06343
10    -0.00005   0.10664  -0.12692   0.00057   0.08874  -0.08387  -0.00046
mean   0.03637   0.13272  -0.15893  -0.01116   0.14303  -0.18202  -0.02298
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.22089   0.27925  -0.00020  -0.26432   0.34092
5     -0.23671   0.42570  -0.05653  -0.46083   0.51870
10    -0.08058   0.07938   0.00031  -0.09793   0.09797
mean  -0.17939   0.26145  -0.01881  -0.27436   0.31919

> round( drop( attr( margEffCondObsM, "jacobian" )[ 4, , ] ), 5 )
             b_1_0    b_1_1    b_1_2    b_1_3    b_1_4    b_2_0    b_2_1
d_y1_d_x1  0.17054  0.23539  0.07904 -0.14457  0.11079 -0.01779 -0.02391
d_y2_d_x1  0.00301 -0.02467 -0.00143 -0.00110  0.00295  0.02352  0.29069
d_y3_d_x1 -0.01506 -0.03769 -0.00151  0.01135 -0.01258  0.00793  0.01756
d_y1_d_x2 -0.10022 -0.06116  0.11225  0.11588 -0.07940  0.01331  0.00661
d_y2_d_x2  0.00776  0.00223 -0.02264 -0.01091  0.00544 -0.01822 -0.03770
d_y3_d_x2 -0.00601 -0.01681 -0.06056 -0.01705 -0.00363  0.00344  0.00651
d_y1_d_x3  0.04770  0.01545  0.03849  0.09916  0.03130  0.00249  0.00670
d_y2_d_x3  0.00131  0.00687 -0.00587 -0.02124  0.00337  0.02376  0.01784
d_y3_d_x3  0.01708  0.03059 -0.01641 -0.03517  0.01731 -0.00704 -0.01244
d_y1_d_x4 -0.03090 -0.00867 -0.02700  0.04004  0.13739  0.01179  0.01062
d_y2_d_x4 -0.01190 -0.01360  0.00164  0.00708 -0.03374  0.02590  0.02090
d_y3_d_x4  0.01188  0.01092  0.00131 -0.00893 -0.02731 -0.00760 -0.01233
             b_2_2    b_2_3    b_2_4    b_3_0    b_3_1    b_3_2    b_3_3
d_y1_d_x1 -0.00223  0.01220 -0.01379 -0.03213 -0.05208 -0.00775  0.02403
d_y2_d_x1 -0.06977  0.15379 -0.04114 -0.00229  0.02254 -0.00367  0.01024
d_y3_d_x1 -0.00370  0.00343  0.00366  0.06445  0.24608 -0.05305  0.06537
d_y1_d_x2 -0.01627 -0.01399  0.00923  0.03235  0.02076 -0.02749 -0.03382
d_y2_d_x2  0.29377  0.10548 -0.05837 -0.00654 -0.00456  0.02104  0.01243
d_y3_d_x2  0.02768  0.00733  0.00121  0.02933  0.01990  0.32668  0.09681
d_y1_d_x3 -0.00460 -0.02109  0.00357 -0.01997 -0.01177 -0.00954 -0.02564
d_y2_d_x3  0.08146  0.09457  0.07821  0.00629  0.00132  0.00822  0.00853
d_y3_d_x3  0.00884  0.01139 -0.00531 -0.04052 -0.04931  0.08088  0.10904
d_y1_d_x4  0.00116 -0.00800 -0.01248 -0.00789 -0.01118  0.00390  0.00201
d_y2_d_x4  0.10580 -0.25216  0.38786  0.01475  0.01061  0.00825 -0.02047
d_y3_d_x4  0.00879 -0.00690  0.01257 -0.06980 -0.08522  0.09522 -0.14829
             b_3_4    R_1_2    R_1_3    R_2_3
d_y1_d_x1 -0.02366 -0.08350 -0.05621  0.03637
d_y2_d_x1 -0.00502 -0.10929 -0.05165  0.13272
d_y3_d_x1  0.02134  0.01895 -0.01907 -0.15893
d_y1_d_x2  0.02494 -0.03821  0.14245 -0.01116
d_y2_d_x2 -0.00719  0.06922 -0.00754  0.14303
d_y3_d_x2 -0.02110  0.07634  0.16224 -0.18202
d_y1_d_x3 -0.01436  0.13570 -0.09782 -0.02298
d_y2_d_x3  0.00576 -0.12811 -0.00691 -0.17939
d_y3_d_x3  0.02154 -0.07810 -0.16627  0.26145
d_y1_d_x4 -0.05213  0.12104 -0.13978 -0.01881
d_y2_d_x4  0.03600  0.09788  0.05847 -0.27436
d_y3_d_x4  0.25642 -0.03811  0.04222  0.31919
> all.equal( summary( margEffCondObsV )[ , ], summary( margEffCondObsM )[ 1:36, ],
+    check.attributes = FALSE )
[1] TRUE
> print( summary( margEffCondObsM )[ -( 1:24 ), ], digits = 3 )
                Estimate Std. error z value Pr(> z)
3: d_y1_d_x1     0.00139    0.00853   0.163   0.870
3: d_y2_d_x1     0.23197    0.51327   0.452   0.651
3: d_y3_d_x1    -0.11609    0.37107  -0.313   0.754
3: d_y1_d_x2    -0.01857    0.10363  -0.179   0.858
3: d_y2_d_x2     0.11099    0.35196   0.315   0.752
3: d_y3_d_x2    -0.13782    0.40276  -0.342   0.732
3: d_y1_d_x3     0.00597    0.03147   0.190   0.850
3: d_y2_d_x3    -0.14919    0.29985  -0.498   0.619
3: d_y3_d_x3     0.14823    0.27851   0.532   0.595
3: d_y1_d_x4    -0.00457    0.02305  -0.198   0.843
3: d_y2_d_x4    -0.19920    0.55082  -0.362   0.718
3: d_y3_d_x4     0.16555    0.45984   0.360   0.719
mean: d_y1_d_x1  0.18979    0.37622   0.504   0.614
mean: d_y2_d_x1  0.23417    0.38572   0.607   0.544
mean: d_y3_d_x1 -0.15566    0.31714  -0.491   0.624
mean: d_y1_d_x2 -0.14573    0.26974  -0.540   0.589
mean: d_y2_d_x2  0.19533    0.35962   0.543   0.587
mean: d_y3_d_x2 -0.14894    0.43387  -0.343   0.731
mean: d_y1_d_x3  0.19810    0.21293   0.930   0.352
mean: d_y2_d_x3 -0.35269    0.26829  -1.315   0.189
mean: d_y3_d_x3  0.20814    0.35852   0.581   0.562
mean: d_y1_d_x4 -0.14512    0.24531  -0.592   0.554
mean: d_y2_d_x4 -0.41404    0.56411  -0.734   0.463
mean: d_y3_d_x4  0.30768    0.46437   0.663   0.508
> 
> # for testing state of random number generator
> rnorm( 4 )
[1]  0.1870145  0.3303074 -1.2090711  1.9202205
> 
> 
> proc.time()
   user  system elapsed 
 46.394   0.036  46.468 
