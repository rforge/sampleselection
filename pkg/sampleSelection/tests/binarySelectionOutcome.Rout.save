
R version 3.1.0 (2014-04-10) -- "Spring Dance"
Copyright (C) 2014 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> 
> options(digits=5)
> 
> ## Leeman Lucas (and many others): binary outcome
> 
> set.seed(0)
> N <- 500
> rho <- 0.7
> library( "mvtnorm" )
> eps <- rmvnorm(N, c(0,0), matrix(c(1,rho,rho,1), 2, 2) )
> xs <- runif(N)
> ysX <- 3*xs + eps[,1]
> ys <- ysX > 0
> xo <- runif(N)
> yoX <- -1 + 2*xo + eps[,2]
> yo <- factor((yoX > 0)*(ys > 0))
>                            # binary outcome, only observable if ys>0
> print(table(ys, yo, exclude=NULL))
       yo
ys        0   1 <NA>
  FALSE  74   0    0
  TRUE  202 224    0
  <NA>    0   0    0
> library( "sampleSelection" )
Loading required package: maxLik
Loading required package: miscTools

Please cite the 'maxLik' package as:
Henningsen, Arne and Toomet, Ott (2011). maxLik: A package for maximum likelihood estimation in R. Computational Statistics 26(3), 443-458. DOI 10.1007/s00180-010-0217-1.

If you have questions, suggestions, or comments regarding the 'maxLik' package, please use a forum or 'tracker' at maxLik's R-Forge site:
https://r-forge.r-project.org/projects/maxlik/
> 
> # estimation with BHHH method
> ss <- selection( ys ~ xs, yo ~ xo, steptol = 1e-12 )
> print(summary(ss))
--------------------------------------------
Tobit 2 model (sample selection model)
Maximum Likelihood estimation
BHHH maximisation, 5 iterations
Return code 2: successive function values within tolerance limit
Log-Likelihood: -398.2 
500 observations (74 censored and 426 observed)
5 free parameters (df = 495)
Probit selection equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.130      0.130   -1.00    0.32    
xs             3.347      0.392    8.54  <2e-16 ***
Outcome equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -1.054      0.124   -8.47  <2e-16 ***
xo             1.997      0.220    9.07  <2e-16 ***
Error terms:
    Estimate Std. error t value Pr(> t)    
rho    0.803      0.158    5.07   4e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
--------------------------------------------
> 
> # estimation with BFGS method
> ssBFGS <- selection( ys ~ xs, yo ~ xo, maxMethod = "BFGS" )
> print( summary( ssBFGS ) )
--------------------------------------------
Tobit 2 model (sample selection model)
Maximum Likelihood estimation
BFGS maximisation, 77 iterations
Return code 0: successful convergence 
Log-Likelihood: -398.19 
500 observations (74 censored and 426 observed)
5 free parameters (df = 495)
Probit selection equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.127      0.133   -0.96    0.34    
xs             3.339      0.397    8.40  <2e-16 ***
Outcome equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -1.053      0.121   -8.69  <2e-16 ***
xo             1.987      0.225    8.83  <2e-16 ***
Error terms:
    Estimate Std. error t value Pr(> t)    
rho    0.811      0.147    5.51 3.6e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
--------------------------------------------
> all.equal( coef( ssBFGS ), coef( ss ), tol = 1e-2 )
[1] TRUE
> 
> # BHHH estimation with equal weights
> we <- rep( 0.7, N )
> ssWe <- selection( ys ~ xs, yo ~ xo, weights = we, steptol = 1e-12 )
> summary( ssWe )
--------------------------------------------
Tobit 2 model (sample selection model)
Maximum Likelihood estimation
BHHH maximisation, 8 iterations
Return code 2: successive function values within tolerance limit
Log-Likelihood: -278.74 
500 observations (74 censored and 426 observed)
5 free parameters (df = 495)
Probit selection equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.127      0.186   -0.69    0.49    
xs             3.342      0.561    5.96 2.5e-09 ***
Outcome equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -1.057      0.178   -5.93 3.0e-09 ***
xo             2.000      0.315    6.35 2.2e-10 ***
Error terms:
    Estimate Std. error t value Pr(> t)    
rho    0.798      0.231    3.46 0.00055 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
--------------------------------------------
> all.equal( coef( ssWe ), coef( ss ), tol = 1e-2 )
[1] TRUE
> 
> # BHHH estimation with equal weights
> ssWeBFGS <- selection( ys ~ xs, yo ~ xo, weights = we, maxMethod = "BFGS" )
> summary( ssWeBFGS )
--------------------------------------------
Tobit 2 model (sample selection model)
Maximum Likelihood estimation
BFGS maximisation, 68 iterations
Return code 0: successful convergence 
Log-Likelihood: -278.74 
500 observations (74 censored and 426 observed)
5 free parameters (df = 495)
Probit selection equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.122      0.158   -0.77    0.44    
xs             3.325      0.474    7.02 2.2e-12 ***
Outcome equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -1.049      0.145   -7.24 4.6e-13 ***
xo             1.980      0.269    7.36 1.8e-13 ***
Error terms:
    Estimate Std. error t value Pr(> t)    
rho    0.807      0.181    4.45 8.5e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
--------------------------------------------
> all.equal( coef( ssWeBFGS ), coef( ssBFGS ), tol = 1e-2 )
[1] TRUE
> 
> # BHHH estimation with unequal weights
> wu <- 2 * runif( N )
> ssWu <- selection( ys ~ xs, yo ~ xo, weights = wu )
> summary( ssWu )
--------------------------------------------
Tobit 2 model (sample selection model)
Maximum Likelihood estimation
BHHH maximisation, 26 iterations
Return code 1: gradient close to zero
Log-Likelihood: -395.66 
500 observations (74 censored and 426 observed)
5 free parameters (df = 495)
Probit selection equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.111      0.102   -1.08    0.28    
xs             3.355      0.275   12.20  <2e-16 ***
Outcome equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -1.069      0.106   -10.1  <2e-16 ***
xo             1.989      0.181    11.0  <2e-16 ***
Error terms:
    Estimate Std. error t value Pr(> t)    
rho   0.9572     0.0666    14.4  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
--------------------------------------------
> 
> # BFGS estimation with unequal weights
> ssWuBFGS <- selection( ys ~ xs, yo ~ xo, weights = wu, maxMethod = "BFGS" )
> summary( ssWuBFGS )
--------------------------------------------
Tobit 2 model (sample selection model)
Maximum Likelihood estimation
BFGS maximisation, 48 iterations
Return code 0: successful convergence 
Log-Likelihood: -395.66 
500 observations (74 censored and 426 observed)
5 free parameters (df = 495)
Probit selection equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.110      0.129   -0.85    0.39    
xs             3.355      0.387    8.66  <2e-16 ***
Outcome equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -1.070      0.120   -8.93  <2e-16 ***
xo             1.992      0.215    9.27  <2e-16 ***
Error terms:
    Estimate Std. error t value Pr(> t)    
rho   0.9568     0.0633    15.1  <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
--------------------------------------------
> all.equal( coef( ssWuBFGS ), coef( ssWu ), tol = 1e-2 )
[1] TRUE
> 
> # comparison of estimated coefficients, standard errors, and logLik values
> round( rbind( coef( ss ), coef( ssBFGS ), coef( ssWe ), coef( ssWeBFGS ),
+    coef( ssWu ), coef( ssWuBFGS ) ), 3 )
     (Intercept)    xs (Intercept)    xo   rho
[1,]      -0.130 3.347      -1.054 1.997 0.803
[2,]      -0.127 3.339      -1.053 1.987 0.811
[3,]      -0.127 3.342      -1.057 2.000 0.798
[4,]      -0.122 3.325      -1.049 1.980 0.807
[5,]      -0.111 3.355      -1.069 1.989 0.957
[6,]      -0.110 3.355      -1.070 1.992 0.957
> round( rbind( coef( summary( ss ) )[ , 2 ], coef( summary( ssBFGS ) )[ , 2 ],
+    coef( summary( ssWe ) )[ , 2 ], coef( summary( ssWeBFGS ) )[ , 2 ],
+    coef( summary( ssWu ) )[ , 2 ], coef( summary( ssWuBFGS ) )[ , 2 ] ), 3 )
     (Intercept)    xs (Intercept)    xo   rho
[1,]       0.130 0.392       0.124 0.220 0.158
[2,]       0.133 0.397       0.121 0.225 0.147
[3,]       0.186 0.561       0.178 0.315 0.231
[4,]       0.158 0.474       0.145 0.269 0.181
[5,]       0.102 0.275       0.106 0.181 0.067
[6,]       0.129 0.387       0.120 0.215 0.063
> print( rbind( logLik( ss ), logLik( ssBFGS ), logLik( ssWe ),
+    logLik( ssWeBFGS ), logLik( ssWu ), logLik( ssWuBFGS ) ), digits = 6 )
         [,1]
[1,] -398.197
[2,] -398.192
[3,] -278.739
[4,] -278.737
[5,] -395.660
[6,] -395.660
> 
> # binary outcome NA if unobserved
> yo[ !ys ] <- NA
> print(table(ys, yo, exclude=NULL))
       yo
ys        0   1 <NA>
  FALSE   0   0   74
  TRUE  202 224    0
  <NA>    0   0    0
> ssN <- selection( ys ~ xs, yo ~ xo, steptol = 1e-12 )
> print(summary(ssN))
--------------------------------------------
Tobit 2 model (sample selection model)
Maximum Likelihood estimation
BHHH maximisation, 5 iterations
Return code 2: successive function values within tolerance limit
Log-Likelihood: -398.2 
500 observations (74 censored and 426 observed)
5 free parameters (df = 495)
Probit selection equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.130      0.130   -1.00    0.32    
xs             3.347      0.392    8.54  <2e-16 ***
Outcome equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -1.054      0.124   -8.47  <2e-16 ***
xo             1.997      0.220    9.07  <2e-16 ***
Error terms:
    Estimate Std. error t value Pr(> t)    
rho    0.803      0.158    5.07   4e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
--------------------------------------------
> all.equal(ss,ssN)
[1] TRUE
> 
> # binary outcome logical
> yo <- yoX > 0 & ys
> print(table(ys, yo, exclude=NULL))
       yo
ys      FALSE TRUE <NA>
  FALSE    74    0    0
  TRUE    202  224    0
  <NA>      0    0    0
> ssL <- selection( ys ~ xs, yo ~ xo, steptol = 1e-12 )
> print(summary(ssL))
--------------------------------------------
Tobit 2 model (sample selection model)
Maximum Likelihood estimation
BHHH maximisation, 5 iterations
Return code 2: successive function values within tolerance limit
Log-Likelihood: -398.2 
500 observations (74 censored and 426 observed)
5 free parameters (df = 495)
Probit selection equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.130      0.130   -1.00    0.32    
xs             3.347      0.392    8.54  <2e-16 ***
Outcome equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -1.054      0.124   -8.47  <2e-16 ***
xo             1.997      0.220    9.07  <2e-16 ***
Error terms:
    Estimate Std. error t value Pr(> t)    
rho    0.803      0.158    5.07   4e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
--------------------------------------------
> all.equal(ss,ssL)
[1] "Component \"twoStep\": Component \"lm\": Component \"model\": Attributes: < Component \"row.names\": Modes: numeric, character >"              
[2] "Component \"twoStep\": Component \"lm\": Component \"model\": Attributes: < Component \"row.names\": target is numeric, current is character >"
[3] "Component \"twoStep\": Component \"lm\": Component \"model\": Component \"YO\": Modes: numeric, logical"                                       
[4] "Component \"twoStep\": Component \"lm\": Component \"model\": Component \"YO\": names for current but not for target"                          
[5] "Component \"twoStep\": Component \"lm\": Component \"model\": Component \"YO\": target is numeric, current is logical"                         
> 
> # binary outcome logical and NA if unobserved
> yo[ !ys ] <- NA
> print(table(ys, yo, exclude=NULL))
       yo
ys      FALSE TRUE <NA>
  FALSE     0    0   74
  TRUE    202  224    0
  <NA>      0    0    0
> ssLN <- selection( ys ~ xs, yo ~ xo, steptol = 1e-12 )
> print(summary(ssLN))
--------------------------------------------
Tobit 2 model (sample selection model)
Maximum Likelihood estimation
BHHH maximisation, 5 iterations
Return code 2: successive function values within tolerance limit
Log-Likelihood: -398.2 
500 observations (74 censored and 426 observed)
5 free parameters (df = 495)
Probit selection equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.130      0.130   -1.00    0.32    
xs             3.347      0.392    8.54  <2e-16 ***
Outcome equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -1.054      0.124   -8.47  <2e-16 ***
xo             1.997      0.220    9.07  <2e-16 ***
Error terms:
    Estimate Std. error t value Pr(> t)    
rho    0.803      0.158    5.07   4e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
--------------------------------------------
> all.equal(ssL,ssLN)
[1] TRUE
> 
> proc.time()
   user  system elapsed 
 65.184   0.135  65.369 
