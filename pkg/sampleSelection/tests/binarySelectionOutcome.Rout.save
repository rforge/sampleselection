
R version 3.1.0 (2014-04-10) -- "Spring Dance"
Copyright (C) 2014 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> 
> options(digits=5)
> 
> ## Leeman Lucas (and many others): binary outcome
> 
> set.seed(0)
> N <- 500
> rho <- 0.7
> library(mvtnorm)
> eps <- rmvnorm(N, c(0,0), matrix(c(1,rho,rho,1), 2, 2), pre0.9_9994 = TRUE )
> xs <- runif(N)
> ysX <- 3*xs + eps[,1]
> ys <- ysX > 0
> xo <- runif(N)
> yoX <- -1 + 2*xo + eps[,2]
> yo <- factor((yoX > 0)*(ys > 0))
>                            # binary outcome, only observable if ys>0
> print(table(ys, yo, exclude=NULL))
       yo
ys        0   1 <NA>
  FALSE  84   0    0
  TRUE  204 212    0
  <NA>    0   0    0
> library(sampleSelection)
Loading required package: maxLik
Loading required package: miscTools

Please cite the 'maxLik' package as:
Henningsen, Arne and Toomet, Ott (2011). maxLik: A package for maximum likelihood estimation in R. Computational Statistics 26(3), 443-458. DOI 10.1007/s00180-010-0217-1.

If you have questions, suggestions, or comments regarding the 'maxLik' package, please use a forum or 'tracker' at maxLik's R-Forge site:
https://r-forge.r-project.org/projects/maxlik/
> ss <- selection(ys~xs, yo ~xo)
> print(summary(ss))
--------------------------------------------
Tobit 2 model (sample selection model)
Maximum Likelihood estimation
BHHH maximisation, 5 iterations
Return code 3: Last step could not find a value above the current.
Boundary of parameter space?  
Consider switching to a more robust optimisation method temporarily.
Log-Likelihood: -423.84 
500 observations (84 censored and 416 observed)
5 free parameters (df = 495)
Probit selection equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.163      0.133   -1.23    0.22    
xs             3.049      0.377    8.08 6.5e-16 ***
Outcome equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.968      0.131   -7.38 1.6e-13 ***
xo             1.793      0.231    7.77 8.0e-15 ***
Error terms:
    Estimate Std. error t value Pr(> t)   
rho    0.559      0.200    2.79  0.0052 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
--------------------------------------------
> 
> # estimation with equal weights
> we <- rep( 0.7, N )
> ssWe <- selection( ys ~ xs, yo ~ xo, weights = we )
> summary( ssWe )
--------------------------------------------
Tobit 2 model (sample selection model)
Maximum Likelihood estimation
BHHH maximisation, 7 iterations
Return code 3: Last step could not find a value above the current.
Boundary of parameter space?  
Consider switching to a more robust optimisation method temporarily.
Log-Likelihood: -296.7 
500 observations (84 censored and 416 observed)
5 free parameters (df = 495)
Probit selection equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.163      0.190   -0.86    0.39    
xs             3.042      0.539    5.64 1.7e-08 ***
Outcome equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.965      0.188   -5.14 2.8e-07 ***
xo             1.789      0.330    5.42 5.9e-08 ***
Error terms:
    Estimate Std. error t value Pr(> t)  
rho    0.553      0.288    1.92   0.055 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
--------------------------------------------
> all.equal( coef( ssWe ), coef( ss ), tol = 1e-4 )
[1] "Mean relative difference: 0.0030537"
> 
> # estimation with unequal weights
> wu <- 2 * runif( N )
> ssWu <- selection( ys ~ xs, yo ~ xo, weights = wu )
> summary( ssWu )
--------------------------------------------
Tobit 2 model (sample selection model)
Maximum Likelihood estimation
BHHH maximisation, 19 iterations
Return code 1: gradient close to zero
Log-Likelihood: -430.8 
500 observations (84 censored and 416 observed)
5 free parameters (df = 495)
Probit selection equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.245      0.114   -2.15   0.031 *  
xs             3.237      0.339    9.55  <2e-16 ***
Outcome equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.974      0.116   -8.36  <2e-16 ***
xo             1.719      0.196    8.78  <2e-16 ***
Error terms:
    Estimate Std. error t value Pr(> t)   
rho    0.499      0.177    2.81  0.0049 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
--------------------------------------------
> 
> # binary outcome NA if unobserved
> yo[ !ys ] <- NA
> print(table(ys, yo, exclude=NULL))
       yo
ys        0   1 <NA>
  FALSE   0   0   84
  TRUE  204 212    0
  <NA>    0   0    0
> ssN <- selection(ys~xs, yo ~xo)
> print(summary(ssN))
--------------------------------------------
Tobit 2 model (sample selection model)
Maximum Likelihood estimation
BHHH maximisation, 5 iterations
Return code 3: Last step could not find a value above the current.
Boundary of parameter space?  
Consider switching to a more robust optimisation method temporarily.
Log-Likelihood: -423.84 
500 observations (84 censored and 416 observed)
5 free parameters (df = 495)
Probit selection equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.163      0.133   -1.23    0.22    
xs             3.049      0.377    8.08 6.5e-16 ***
Outcome equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.968      0.131   -7.38 1.6e-13 ***
xo             1.793      0.231    7.77 8.0e-15 ***
Error terms:
    Estimate Std. error t value Pr(> t)   
rho    0.559      0.200    2.79  0.0052 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
--------------------------------------------
> all.equal(ss,ssN)
[1] TRUE
> 
> # binary outcome logical
> yo <- yoX > 0 & ys
> print(table(ys, yo, exclude=NULL))
       yo
ys      FALSE TRUE <NA>
  FALSE    84    0    0
  TRUE    204  212    0
  <NA>      0    0    0
> ssL <- selection(ys~xs, yo ~xo)
> print(summary(ssL))
--------------------------------------------
Tobit 2 model (sample selection model)
Maximum Likelihood estimation
BHHH maximisation, 5 iterations
Return code 3: Last step could not find a value above the current.
Boundary of parameter space?  
Consider switching to a more robust optimisation method temporarily.
Log-Likelihood: -423.84 
500 observations (84 censored and 416 observed)
5 free parameters (df = 495)
Probit selection equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.163      0.133   -1.23    0.22    
xs             3.049      0.377    8.08 6.5e-16 ***
Outcome equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.968      0.131   -7.38 1.6e-13 ***
xo             1.793      0.231    7.77 8.0e-15 ***
Error terms:
    Estimate Std. error t value Pr(> t)   
rho    0.559      0.200    2.79  0.0052 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
--------------------------------------------
> all.equal(ss,ssL)
[1] "Component \"twoStep\": Component \"lm\": Component \"model\": Attributes: < Component \"row.names\": Modes: numeric, character >"              
[2] "Component \"twoStep\": Component \"lm\": Component \"model\": Attributes: < Component \"row.names\": target is numeric, current is character >"
[3] "Component \"twoStep\": Component \"lm\": Component \"model\": Component \"YO\": Modes: numeric, logical"                                       
[4] "Component \"twoStep\": Component \"lm\": Component \"model\": Component \"YO\": names for current but not for target"                          
[5] "Component \"twoStep\": Component \"lm\": Component \"model\": Component \"YO\": target is numeric, current is logical"                         
> 
> # binary outcome logical and NA if unobserved
> yo[ !ys ] <- NA
> print(table(ys, yo, exclude=NULL))
       yo
ys      FALSE TRUE <NA>
  FALSE     0    0   84
  TRUE    204  212    0
  <NA>      0    0    0
> ssLN <- selection(ys~xs, yo ~xo)
> print(summary(ssLN))
--------------------------------------------
Tobit 2 model (sample selection model)
Maximum Likelihood estimation
BHHH maximisation, 5 iterations
Return code 3: Last step could not find a value above the current.
Boundary of parameter space?  
Consider switching to a more robust optimisation method temporarily.
Log-Likelihood: -423.84 
500 observations (84 censored and 416 observed)
5 free parameters (df = 495)
Probit selection equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.163      0.133   -1.23    0.22    
xs             3.049      0.377    8.08 6.5e-16 ***
Outcome equation:
            Estimate Std. error t value Pr(> t)    
(Intercept)   -0.968      0.131   -7.38 1.6e-13 ***
xo             1.793      0.231    7.77 8.0e-15 ***
Error terms:
    Estimate Std. error t value Pr(> t)   
rho    0.559      0.200    2.79  0.0052 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
--------------------------------------------
> all.equal(ssL,ssLN)
[1] TRUE
> 
> proc.time()
   user  system elapsed 
 34.573   0.098  34.705 
